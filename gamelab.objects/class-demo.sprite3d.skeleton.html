
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Gamelab.Sprite3d-Demo</title>
    <script src="../dist/gamelab/gamelab.js"></script>
    <script src="../res/libraries/three.js"></script>
    <link rel="stylesheet" href="../res/styles/gamelab-example.css">
    <style>
      div#container{
        position:fixed;
        top:0px;
        left:0px;
        bottom:0px;
        right:0px;
        width:100%;
        height:100%;
        background:#777;
      }
    </style>
  </head>
  <body>
    <header>
      <img src="../res/images/gamelab-logo.png" alt="" id="logo">
      <span class="title">Sprite3d-Demo:Skeleton</span>
    </header>
    <div id="container"></div>
    <script>
    var threejsWindow = new Gamelab.ThreeJsWindow('#container'),
    gameWindow = new Gamelab.GameWindow();

    var spriteController = new Gamelab.SpriteController();
    var knownGroups = [];
    var sprites = [];
    let HumanoidModule = undefined;

    window.addButton = function(text, callback){

      var button = document.createElement('button');

      if(!window.buttonContainer)
      {
        window.buttonContainer = document.createElement('div');
        window.buttonContainer.style.marginLeft = '15%';
        window.buttonContainer.style.marginTop = '-90%';
        document.body.append(window.buttonContainer);
      }

      button.innerText = text;
      button.style.position = 'relative';
      button.style.display = 'block';
      button.style.zIndex = '9999';
      button.style.marginTop = '10px';
      window.buttonContainer.append(button);
    };

    function load(callback){

      new Gamelab.Module().load('./res/humanoid-skeleton.resources/skeleton.res.js', function(mod){
          let assets = new mod('skeleton');
          let ct = 0, countMembers = 0;
          assets.forEach((s)=>{
            s.index = ct;
            if(s instanceof Sprite)
            {
              sprites.push(s);
              s.onLoad(function(){
                let zOffset = -1000;
                let t3d = new Gamelab.Sprite3D(this, 0.8);
                if(!(knownGroups.indexOf(t3d.group) >= 0))
                {
                  knownGroups.push(t3d.group);
                  spriteController.add(t3d);
                  t3d.memberIndex = countMembers;
                  countMembers += 1.0;
                  threejsWindow.add(t3d.group);

                }
                gameWindow.add(this);
              });
            }

            if(s instanceof Bone3D)
            {
              //do nothing
            }

            ct += 1;
          });

          gameWindow.onBeforeDraw(function(){
            var sprites =  this.drawables.filter(function(a){ return a.constructor.name == 'Sprite' });
            sprites.forEach(function(s){
            });
          });

          callback(sprites, 'skeleton');
      });
    };

    new Gamelab.Module().load('./res/humanoid-skeleton.resources/scripts/humanoid.module.js', function(mod){
      HumanoidModule = mod;
      load(function(){
          new HumanoidModule(sprites, 'skeleton');
      });
    });

    Gamelab.ready(function(){
      threejsWindow.start();
      gameWindow.start();
      window.addButton('walk', function(){});
      window.addButton('run', function(){});
      window.addButton('jump', function(){});
      window.addButton('slide', function(){});
      window.addButton('roll', function(){});
      window.addButton('magic', function(){});
      window.addButton('sword-1', function(){});
      window.addButton('sword-2', function(){});
    });
    </script>
</body>
</html>
