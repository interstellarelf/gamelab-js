{"version":3,"sources":["../../src/__concat/gamelab.js"],"names":["TypeCode","DEV","info","arg1","arg2","console","log","error","warn","number","fallback","string","arrayWrap","obj","Array","allDefined","obj_all","list","failed","x","getPreferredPropertyByKey","property","key","warning","hasOwnProperty","psuedoTypeCheck","psuedotype","throwing","getAllFuncs","Object","getOwnPropertyNames","filter","p","getProtoFuncs","__proto__","truthOrDie","exitMessage","findError","Error","e","truthyPropsPerArray","propKeys","kill","keys","prop","y","typeArgsExtract","type","typeOrHalt","typeOrError","check","object","propKey","propValue","dev","tag","psuedoType","constructor","name","Gamelab","data_type","delay","f","duration","setTimeout","repeat","setInterval","Gamelab_Module","module","settings","DEBUG","gui_mode","recursionCount","errorLimit","errors","stopDraw","defSize","WIDTH","document","body","clientWidth","HEIGHT","clientHeight","getGameWindow","ix","game_windows","gs_renderables","gs_events","spriteTypes","systemSpriteTypes","__gameWindowList","all","all_objects","forEach","item","concat","drawables","init","testSquare","Sprite","objectDestroyed","dead","gw","objects","getObjectById","id","length","interlog","message","div","isNaN","create_id","S4","Math","random","toString","substring","quit","m","initializers","addInitializer","i","push","Collision","boxesCollide","pos1","size1","pos2","size2","spriteBoxesCollide","obj1","obj2","camPos","Vector","padding","paddingX","round","size","paddingY","left","position","right","top","bottom","spriteBoxesCollideTop","pixelsCollide","sourceSprite","targetSprite","hitBox","source","target","height","width","pixelMap","selected_animation","s","sourcePixel","sourceArea","relatedPixel","t","targetPixel","targetArea","_gameWindow","setGameWindow","gameWindow","ExtendEvents","extendedObject","extendedKey","extendor","extendorKey","evtLink","GSEventLink","parent","onRun","onComplete","assignAll","args","__gamelabInstance","each","onResult","ready_callstack","ready","callback","reload","callReady","funx","call","InputSystem","__running","getArg","k","normalArgs","a","normal","str","toLowerCase","replace","isNormalStringMatch","str1","str2","instance_type_pairs","objectList","constructor_name","getById","select","group","query","__inst","GamelabApi","get","post","contents","jstr","GSO","run_ext","complete_ext","caller","callkey","indexOf","exports","JSON","stringify","$Q","selector","mainSelector","before","trim","msfChar","__targetClassName","output","cleanSelectorString","after","criterion","between","cparts","split","__targetGroup","__targetName","getParts","on","evt_key","selectorObject","controller_ix","boolTrigger","boolCall","boolEvent","BoolEvent","On","Call","evt_profile","cix","contains_any","button_mode","GamepadAdapter","item1","iy","item2","onUpdate","update","sprite","hasBoxCollision","condition","evt_parts","run","mykey","parseFloat","propkey","spr","complete","c1","test_str","start_pos","end_pos","contains","contains_all","cList","c2","test_selector_method","Q_TestStrings","test","Mouse","Position","Speed","setPosition","isIdle","speed","events","mousemove","mousepos","leftclick","rightclick","middleclick","wheelup","wheelDown","keymap","keyReplace","String","fromCharCode","extendKey","onFinish","down","extend","downCall","upCall","up","MOUSE","window","im","kmapItem","onkeydown","onkeyup","event","gs_key_string","keyCode","evt_object","canvases","querySelectorAll","getMousePos","c","pageX","pageY","clientX","scrollLeft","documentElement","clientY","scrollTop","offsetLeft","style","mouseMoving","pos","el","applyMouseMove","addEventListener","onmousedown","value","which","preventDefault","onmouseup","file_system","localizedSource","src","hostUrl","gs_folder_ix","loadJSON","filepath","readTextFile","file","rawFile","XMLHttpRequest","open","onreadystatechange","readyState","status","allText","responseText","send","loadLevel","jsonText","data","parse","$","sprites","xitem","yitem","iz","zitem","add","loadJSONLevel","lib","Screen","center","EventInterfaceMap","Animation","Motion","Shot","Terrain","Interactive","Global","instance","fkey","ObjectFeatureMap","SpriteBrush","Elipse","Frame","Particle","Line2d","Text","InputIFM","GamepadButtons","GamepadSticks","Keyboard","MouseMove","MouseButton","MouseWheel","LeapMotion","UIEditables","UIOption","hint","script","UIPrefab","MainSelect","FormEditables","UIPrefabMainSelect","Background","getCustomPrefabMeta","UIObjectPrefabs","Bone","target_id","targetAnimation","parentAnimation","origin","rotation","parentOffset","Size","z","Origin","Rotation","rotatedOffset","VectorMath","rotatePointsXY","fullPosition","BoneState","boneList","states","bone","offset","Camera","RGBColor","r","g","b","ColorCalc","hexToRgba","ColorStrings","match","parseInt","color","sumOfSquares","pow","sqrt","tolerance","matches","total_diff","diff","abs","ColorCalculator","hexToRgbArray","hex","result","exec","rgbFromString","rgba_string","join","scaledRGBAFromHex","hexcolor_a","hexcolor_b","scalePoint","rgba_a","rgba_b","finalRgba","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","map_orange","map_green","map_red","map_blue","map_darkgreen","map_yellow","map_aqua","map_grey","map_gray","map_darkgrey","map_darkgray","map_black","RE_RGB","Colors","fromString","Curves","linearNone","easeInQuadratic","easeOutQuadratic","easeInOutQuadratic","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuartic","easeOutQuartic","easeInOutQuartic","easeInQuintic","easeOutQuintic","easeInOutQuintic","inOutCurves","quadratic","cubic","quartic","quintic","linear","Smooth","InOut","Game","srcFile","Gamelab","uri","__object","bind","createElement","onload","construct","load","head","appendChild","GameWindow","canvas","bool_events","engaged","setAttribute","append","context","getContext","camera","update_ext","onresize","isAbsoluteSize","ctx","onerror","clearTimeout","__trackStat","w","h","srcImage_Path","Pos","evt","rect","getBoundingClientRect","total_x","total_y","grid","GridUnit","def_update","graphic","bool","before_draw_ext","reset_draw","__gameWindow","draw","after_draw_ext","boundCall","beforeDraw","afterDraw","parentNode","options","optionsGuide","layer","window_offset","GSEvent","apply","splice","background","backgroundColor","$window","life","remove","time","requestAnimationFrame","animate","__stats","begin","__statsMS","__statsMB","isAtPlay","TWEEN","autoClear","clearRect","end","Stats","showPanel","dom","marginLeft","Module","OffscreenCanvasGS","OffscreenCanvas","PointTransformation","Within","CreateMesh","Rotate","FlipX","FlipY","Reflect","onX","onY","Rectangle","x1","y1","x2","y2","Min","Max","min","max","VectorBounds","VectorFrameBounds","termPoint","GeoMath","angle","theta","PI","point","cos","sin","Renderable","GameImage","onCreate","I","HTMLCanvasElement","domElement","__error","Script","Scriptable","siblings","url","MOD","halfX","halfY","Canvas","arc","SpatialPattern","unitSize","basicGridChunk","m1","m2","chunk","FromData","target_x","target_y","onLoad","Trigonometry","rotate_from_xy","cx","cy","radians","nx","ny","rotational_speed","find_point_on_circle","radius","degrees","Trig","Curve_ToComplete","log_it","sub_tag","In","Out","Seamless","linkedCurves","Twix","Linear","None","Quadratic","Cubic","Quartic","Quintic","Sine","Cosine","Tangent","Exponential","LinkedCurves","TranceCurves","power","Power","TrigFunctions","SpecialFunctions","Sawtooth","Square","Triangle","Floor","Sign","core","XYFunctions","SigmaFunctions","GammaFunctions","single_numeric_x","undefined","copied","valid_check","v","multiple","d","floor","ceil","dist","sub","v1","v2","minFloat","maxFloat","mult","p1","p2","atan2","minimize","key1","key2","maximize","Vector3","Vector2","Vector2d","Vector2D","rotatePosition3D","$rot","pos3","Raycaster","viewport","rays","ray","$scope","total","reset","start","$o","pixelGridList","getVisibleFramesAsPixelGridArray","pixelObject","tpos","position3d","putImageData","pixel","Ray","alphaPos","endPos","Viewport","raycaster","farSize","reveal3D","drawImage","Voxel","VoxelArray","voxels","array","jsonData","WebGL","THREE","PerspectiveCamera","container","querySelector","renderer","WebGLRenderer","scene","Scene","setSize","threejs","light","AmbientLight","__WebGL","render","WebGl","MouseMoveEvent","Callback","cb","MousePosEvent","MouseLeftClickEvent","MouseRightClickEvent","parent_id","child_id","parent_key","child_key","InputEvent","btnix","button_ix","gpix","gamepad_ix","six","stickix","stick_ix","inputKey","keyboardKeys","keyitem","KeyboardEvent","GamepadEvent","gps","gamepadKeys","CollisionEvent","callbackFunction","$collision","$obj","$sprite","$sib","onBool","boolFunction","Bool","Event","BoxCollisionEvent","framePos","image","fxn","frameSize","offscreen","OffscreenCanvasRendering","StoreOffscreen","toDataURL","getImageData","vector","gridObject","colorMap","getColoredPixelGrid","nonColorMap","getNonColoredPixelGrid","altImage","getFullPixelGrid","testCtx","fullPixelMap","ControllerEventKeys","left_stick","right_stick","gamepads","__gamepads","intervals","controller_stack","__gamepadMaster","gamepad","index","buttons","axes","mainLoop","clearInterval","navigator","getGamepads","process","game_pad_index","game_pad","gp","stick_left","stick_right","extendFunc","f1","f2","fc","current_cb","parts","gpEvents","process_buttons","process_axes","axis1","axia2","pressed","clearance_1","gpc","bkey","GamepadEvents","points","lineWidth","x_total","out_of_1","next_x","next_y","next_point","save","strokeStyle","beginPath","real_pos","getOffsetPos","moveTo","lineTo","stroke","restore","Line2D","Sound","sound","loop","val","volume","play","SoundList","sounds","Audio","init_singleFrame","HTMLImageElement","min_cix","visible","frameBounds","scale","frameOffset","apply2DFrames","flipX","selected_frame","frames","timer","seesaw_mode","reverse_frames","$f","parentBone","$frame","Scale","$anime","load_call","FrameSize","FrameBounds","__isInit","_hang","minVector","maxVector","termVector","millis","fcount","quitLoop","Image","FramePos","frames_reversed","slice","reverse","pop","sized_Object","canvasObject","ColoredPixelGrid","frameSizeDiv","map","frame","init_colorMap","fun","update_frame","__frametype","engage","call_on_run","tween","Tween","easing","curve","Easing","to","call_on_complete","isComplete","continuous","continue","Box2D","Mesh","vertices","FeildSpan","transition","ticker","Duration","Clone","getValue","option","tvalue","curveMethod","finalValue","portion","curveStep","ColorFeildSpan","colors","birthrate","display","Life","DefaultValues","Options","sourceSprites","livingSprites","Src","birthInterval","def_life","BirthRate","Composite","Alpha","Color","composite","globalComposite","gobalCompositeOperation","Angle","alpha","stock","particle","detached_particle","globalCompositeOperation","flyByRotation","gunOptions","opacity","EffectCanvas","angleDiff","fly_angle","anime","Opacity","gunSpeed","addParticles","Checkers","ListProps","props","animations","active","SingleFrame","apply_args","img","effectCanvas","effectCtx","fillStyle","globalAlpha","fillRect","load_total","err","o","array_instance","description","listnames","$object","ln","motions","particles","shots","init_ext","scrollFactor","noScroll","realPosition","collision_bounds","acceleration","rot_speed","rot_accel","TweenMotion","GSProton","clone","Anime","selected_sprite","DRAWOFFSCREEN","onScreen","draw_current_frame","frameList","camera_pos","targetSize","realWidth","realHeight","xpos","ypos","draw_image_frame","flipY","fx","fy","fxlCopy","scaleFloat","boundFun","framesize","__mapSize","mx","my","wth","htw","_obj","extendedFunc","ef","lineObject","curveKey","motionCurveOptions","line","__crtLineIx","pctFloat","ixChange","alt_anime","grid1","selectedFramePixelMap","getCurrentPixelMap","grid2","scaleOf","colliderHighlights","unitMarker","hSprite","collider_highlightsOn","init_pixelCollision","init_colliderHighlights","gridPiece","anime_scale","real_gridPiece_pos","real_gridPiece_size","highlightSprite","hasPixelCollision","boxCollisionSettings","prep_key","animation","bullet","velocity","rot_offset","rot_disp","__playerInst","bx","by","bw","bh","shot","rotPlus","subsprite","alert","accel","assertSpeed","amt","rate","target_Position","differential_SpeedMultiple","diff_min_y","diff_min_x","diff_max_y","diff_max_x","dimens","minkey","apart","ct","diffX","distX","overlap_x","diffY","distY","__inAir","overlap_y","collide_stop_x","groundMaxY","file_path","getJSON","decycle","getTextHeight","font","text","css","fontFamily","block","verticalAlign","ascent","descent","FontSize","FontFamily","fsize","ffamily","fontSize","measureText","realPos","fillText","GravityForce","subjects","clasticObjects","topClastics","itemx","jumping","flying","accelY","itemy","collide_stop_top","Force","GForce","arguments","BoneSprite","bones","oncreate","frame_offset","mode","overlaySprites","spritebrush","outputSprite","oix","addSprite","addOverlaySprite","SpriteFill","shape","selection_mode","selected_mode","onCreateShape","Infinity","bounds","enclose_rectangle","tracker","currentSize","currentIndex","offscreenCanvas","nextSprite","FeatureSymbol","symbol","Symbol","FeatureInjectors","FeatureInject","GClassFeatures","featureSymbols","hasKey","hasSymbol","prototype","CssFeatures","min_color","max_color","DataFunctions","Name","n","Description","Context","VectorFunctions","collision_callback","onCollide","collideables","Rot","Transpose","Minimum","Maximum","minable","maxable","np","middle","curve_string","setTweenCurve","cps","s1","s2","easeType","curvesToArray","FilterUtils","HSVtoRGB","q","RGBtoHSV","getPixel","pixels","pix","clampPixel","haveNextGaussian","nextGaussian","gaussianRandom","triangle","mod","mixColors","rgb1","rgb2","linearInterpolate","bilinearInterpolate","nw","ne","sw","se","m0","r0","g0","b0","a0","r1","g1","b1","a1","r2","g2","b2","a2","r3","g3","b3","a3","tableFilter","inputData","table","convolveFilter","matrix","outputData","rows","cols","rows2","cols2","trace","row","ioffset","moffset","col","iPixel","transformFilter","transformInverse","out","j","srcX","srcY","xWeight","yWeight","rgba","BlurFilter","isDirAnimatable","defaultValues","amount","valueRanges","input","values","width4","qq","qqq","bigB","indexLast","ppixel","pppixel","ppppixel","BrightnessFilter","filterUtils","hsv","rgb","BumpFilter","CircleSmearFilter","density","mix","radius2","numShapes","sx","sy","mixedRGB","l","ContrastFilter","CrossSmearFilter","distance","DiffusionFilter","sinTable","cosTable","transInverse","DitherFilter","levels","sum","direction","er","eg","eb","jx","factor","EdgeFilter","matrixH","matrixV","rh","gh","rv","gv","bv","EmbossFilter","elevation","bumpHeight","width45","pixelScale","bumpPixels","bumpMapWidth","bumpMapHeight","Nx","Ny","Nz","Lx","Ly","Lz","Nz2","NzLz","NdotL","shade","bumpIndex","s3","ExposureFilter","exposure","exp","GainFilter","gain","bias","GammaFilter","GrayscaleFilter","luma","HueFilter","InvertFilter","KaleidoscopeFilter","sides","centerX","centerY","iCenterX","iCenterY","dx","dy","LensDistortionFilter","refraction","rRefraction","z2","xAngle","acos","angle1","angle2","asin","yAngle","LineSmearFilter","sinAngle","cosAngle","x0","y0","incrE","incrNE","ddx","ddy","MaximumFilter","maxR","maxG","maxB","MedianFilter","rList","gList","bList","sortFunc","sort","MinimumFilter","minR","minG","minB","NoiseFilter","monochrome","OilFilter","range","rHistogram","gHistogram","bHistogram","rTotal","gTotal","bTotal","ro","go","bo","ri","gi","bi","OpacityFilter","PinchFilter","PixelationFilter","bPixel","PosterizeFilter","RGBAdjustFilter","SaturationFilter","RW","RG","RB","pR","pG","pB","SawtoothRippleFilter","xAmplitude","yAmplitude","xWavelength","yWavelength","SepiaFilter","SharpenFilter","SineRippleFilter","SolarizeFilter","SparkleFilter","randomness","rayLengths","SquareSmearFilter","ThresholdFilter","threshold","brightness","colorVal","TriangleRippleFilter","TwirlFilter","VignetteFilter","gradient","createRadialGradient","addColorStop","WaterRippleFilter","phase","wavelength","amplitude","distance2","JSManipulate","blur","bump","circlesmear","contrast","crosssmear","diffusion","dither","edge","emboss","gamma","grayscale","hue","invert","kaleidoscope","lensdistortion","linesmear","maximum","median","minimum","noise","oil","pinch","pixelate","posterize","rgbadjust","saturation","sawtoothripple","sepia","sharpen","sineripple","solarize","sparkle","squaresmear","triangleripple","twirl","vignette","waterripple","ImageFilters","GamelabCanvas","__levelMaker","draw_object","isStopped","canvasContext","fw","fh","deg","rad","translate","rotate","psuedoImage","htmlImage","testCanvas","zIndex","paths","derez","path","nu","$ref","retrocycle","px","rez","eval","json_stringify","arg3","clean_object","json_parse","retro_object","cssText","children","addPanel","panel","beginTime","performance","Date","now","prevTime","fpsPanel","Panel","msPanel","self","memory","memPanel","REVISION","usedJSHeapSize","jsHeapSizeLimit","setMode","fg","bg","PR","devicePixelRatio","TEXT_X","TEXT_Y","GRAPH_X","GRAPH_Y","GRAPH_WIDTH","GRAPH_HEIGHT","textBaseline","maxValue","_tweens","getAll","removeAll","preserve","_object","_valuesStart","_valuesEnd","_valuesStartRepeat","_duration","_repeat","_repeatDelayTime","_yoyo","_isPlaying","_reversed","_delayTime","_startTime","_easingFunction","_interpolationFunction","Interpolation","_chainedTweens","_onStartCallback","_onStartCallbackFired","_onUpdateCallback","_onCompleteCallback","_onStopCallback","field","properties","stop","stopChainedTweens","numChainedTweens","times","repeatDelay","yoyo","interpolation","chain","onStart","onStop","elapsed","charAt","isFinite","tmp","Sinusoidal","Circular","Elastic","Back","Bounce","fn","Utils","Bezier","pw","bn","Bernstein","CatmullRom","p0","Factorial","p3","v0","t2","t3","root","define","amd"],"mappings":"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","file":"gamelab.js","sourcesContent":["let TypeCode = {\r\n\r\n  DEV:false,\r\n\r\n  //Display message in console\r\n  info: function(arg1, arg2) {\r\n\r\n    if(!this.DEV)\r\n    return;\r\n\r\n    console.info(arg1, arg2);\r\n\r\n  },\r\n\r\n  log:function(arg1, arg2){\r\n\r\n    if(!this.DEV)\r\n    return;\r\n\r\n      console.log(arg1, arg2);\r\n\r\n  },\r\n\r\n  /* ERRORS always show */\r\n  error:function(arg1, arg2){\r\n\r\n    if(!this.DEV)\r\n    return;\r\n\r\n      console.error(arg1, arg2);\r\n\r\n  },\r\n\r\n\r\n  warn:function(arg1, arg2){\r\n\r\n    if(!this.DEV)\r\n    return;\r\n\r\n      console.error(arg1, arg2);\r\n\r\n  },\r\n\r\n  //obj is number or becomes fallback\r\n  number: function(number, fallback = 0) {\r\n\r\n    number = typeof(number) == 'number' ? number : fallback;\r\n\r\n  },\r\n\r\n  //obj is string or becomes fallback\r\n  string: function(string, fallback) {\r\n\r\n    string = typeof(string) == 'string' ? string : fallback;\r\n\r\n  },\r\n\r\n  //obj is Array or becomes wrapped in [] as [obj]\r\n  arrayWrap: function(obj) {\r\n    if (obj instanceof Array)\r\n      return obj;\r\n    else\r\n      return [obj];\r\n  },\r\n\r\n  //obj or array-of-objects are ALL truthy (return=true) or not (return=false)\r\n  allDefined: function(obj_all) {\r\n\r\n    var list = this.arrayWrap(obj_all);\r\n\r\n    var failed = false;\r\n\r\n    for (var x in list) {\r\n      if (!list[x]) {\r\n        failed = true;\r\n        console.error('Failed to define @ TypeCode.Define()');\r\n      }\r\n    };\r\n\r\n    return !failed;\r\n  },\r\n\r\n  //getPreferredPropertyByKey(): uses the property[key] if present, if not returns same property passed in\r\n  getPreferredPropertyByKey:function(property, key, warning){\r\n\r\n    if(property.hasOwnProperty(key))\r\n    {\r\n      this.warn(warning);\r\n      return property[key];\r\n    }\r\n\r\n    else {\r\n      return property;\r\n    }\r\n  },\r\n\r\n  //obj's are all of type or return false\r\n  psuedoTypeCheck: function(obj, psuedotype = [], throwing = false) //obj is type or is encapsulated into type\r\n  {\r\n    var list = this.arrayWrap(obj);\r\n\r\n    for (var x in list) {\r\n      if (typeof(list[x]) !== psuedotype && !(list[x] instanceof psuedotype)) {\r\n        if (!throwing)\r\n          return console.error(error);\r\n        else\r\n          throw new console.error(error);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  },\r\n\r\n  getAllFuncs: function(obj) {\r\n\r\n    return Object.getOwnPropertyNames(obj).filter(function (p) {\r\n        return typeof obj[p] === 'function';\r\n    });\r\n\r\n  },\r\n\r\n  getProtoFuncs: function(obj) {\r\n\r\n    return Object.getOwnPropertyNames(obj.__proto__).filter(function (p) {\r\n        return typeof obj[p] === 'function';\r\n    });\r\n\r\n  },\r\n\r\n  truthOrDie:function(list, exitMessage) //All members of Array are truthy or the program exits with Error()\r\n  {\r\n    function findError(obj, error) {\r\n      return obj || new Error(error)\r\n    };\r\n\r\n    for (var x in list) {\r\n\r\n        let e = findError(list[x], exitMessage);\r\n\r\n        if (e instanceof Error) {\r\n            console.Error(e);\r\n        }\r\n      };\r\n  },\r\n\r\n  truthyPropsPerArray: function(obj, propKeys, kill) {\r\n\r\n    var list = this.arrayWrap(obj),\r\n      keys = this.arrayWrap(propKeys);\r\n\r\n    let error = \"The required truthy property has non-truthy value.\";\r\n\r\n    function findError(obj, prop) {\r\n      return obj[prop] || new Error(error)\r\n    };\r\n\r\n    var failed = false;\r\n\r\n    for (var x in list) {\r\n      for (var y in keys) {\r\n        let e = findError(list[x], keys[y]);\r\n        if (e instanceof Error) {\r\n          failed = true;\r\n          if (kill)\r\n            throw e;\r\n          else\r\n            console.error(e);\r\n        }\r\n      }\r\n    }\r\n\r\n    return !failed;\r\n  },\r\n\r\n  typeArgsExtract: function(obj, type) //obj is type or is each-converted into type\r\n  {\r\n    if (obj instanceof type) {\r\n      return obj;\r\n    } else {\r\n      obj = [obj];\r\n    }\r\n    return obj;\r\n  },\r\n\r\n  typeOrHalt: function(obj, type) //obj is type or error is thrown\r\n  {\r\n    if (obj instanceof type) {\r\n      return obj;\r\n    } else {\r\n      throw new Error('object not of required type');\r\n      console.info(obj);\r\n      console.info(type + \"?\");\r\n    }\r\n    return obj;\r\n  },\r\n\r\n  typeOrError: function(obj, type) //obj is type or error is logged, execution continues\r\n  {\r\n    if (obj instanceof type) {\r\n      return obj;\r\n    } else {\r\n      console.log(new Error('object not of required type'));\r\n      console.info(obj);\r\n      console.info(type + \"?\");\r\n    }\r\n    return obj;\r\n  },\r\n\r\n  check:function(object, propKey, propValue)\r\n  {\r\n    if(!object[propKey])\r\n    {\r\n       object[propKey] = propValue;\r\n    }\r\n  }\r\n};\r\n;/**@author\r\n Jordan Blake\r\n * */\r\n\r\n/**@copyright\r\n Copyright 2018\r\n **/\r\n\r\n/**\r\n * Main module-object; references all Gamelab classes.\r\n * */\r\n\r\n\r\nconsole.dev = function(tag, object) {\r\n\r\n  var psuedoType = \"--unknown\";\r\n\r\n  switch (typeof object) {\r\n    case \"string\":\r\n    case \"number\":\r\n    case \"boolean\":\r\n    case \"null\":\r\n      psuedoType = typeof object;\r\n    default:\r\n      {\r\n        if (typeof object == 'object')\r\n          psuedoType = object.constructor.name;\r\n      }\r\n  }\r\n\r\n  if (Gamelab.DEV)\r\n    console.info('gamelab::', tag, {\r\n      data_type: psuedoType,\r\n      object: object\r\n    });\r\n\r\n\r\n};\r\n\r\n\r\nlet delay = function(f, duration) {\r\n  setTimeout(f, duration);\r\n}\r\n\r\n\r\nlet repeat = function(f, duration) {\r\n  setInterval(f, duration);\r\n}\r\n\r\n//Gamelab: the main module object:\r\nlet Gamelab_Module = function() {\r\n\r\n  var module = {\r\n\r\n    settings: {\r\n\r\n      DEBUG: false,\r\n\r\n      gui_mode: true,\r\n\r\n      recursionCount: 0,\r\n\r\n      errorLimit: 20\r\n    },\r\n\r\n    errors: 0,\r\n\r\n    stopDraw:false,\r\n\r\n    defSize() {\r\n      if (this.WIDTH == 0) {\r\n        this.WIDTH = document.body.clientWidth;\r\n      }\r\n\r\n      if (this.HEIGHT == 0) {\r\n        this.HEIGHT = document.body.clientHeight;\r\n      }\r\n\r\n    },\r\n\r\n    getGameWindow(ix = 0) {\r\n      return this.game_windows[0]\r\n    },\r\n\r\n    WIDTH: 0,\r\n\r\n    HEIGHT: 0,\r\n\r\n    game_windows: [],\r\n\r\n    gs_renderables: [],\r\n\r\n    gs_events: [],\r\n\r\n    spriteTypes: [],\r\n\r\n    systemSpriteTypes: ['player', 'enemy', 'background', 'interactive', 'terrain', 'weapon', 'subsprite'],\r\n\r\n    __gameWindowList: [],\r\n\r\n    all: function() {\r\n\r\n      var all_objects = [];\r\n\r\n      this.game_windows.forEach(function(item) {\r\n\r\n        all_objects = all_objects.concat(item.drawables);\r\n\r\n      });\r\n\r\n      console.info('Gamelab.all():', all_objects);\r\n\r\n      return all_objects;\r\n\r\n    },\r\n\r\n    init: function() {\r\n\r\n      this.testSquare = new Gamelab.Sprite();\r\n\r\n    },\r\n\r\n    objectDestroyed(obj) {\r\n      var dead = true;\r\n\r\n      for (var x in this.game_windows) {\r\n        let gw = this.game_windows[x];\r\n\r\n        for (var y in gw.objects) {\r\n          if (gw.objects[y] === obj)\r\n            dead = false;\r\n\r\n        }\r\n      }\r\n\r\n      return dead;\r\n\r\n    },\r\n\r\n    getObjectById(id) {\r\n\r\n      for (var x = 0; x < this.all_objects.length; x++) {\r\n        if (this.all_objects[x].id == id) {\r\n\r\n          return this.all_objects[x];\r\n\r\n        }\r\n      }\r\n    },\r\n\r\n    interlog: function(message, div) //recursive safe :: won't go crazy with recursive logs :: log message every x times this is called\r\n    {\r\n      this.recursionCount++;\r\n\r\n      if (!isNaN(div) && this.settings.recursionCount % div == 0) {\r\n        //   console.log('Interval Log:'+  message);\r\n      }\r\n    },\r\n\r\n\r\n    create_id: function() {\r\n      var S4 = function() {\r\n        return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\r\n      };\r\n      return (S4() + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + \"-\" + S4() + S4() + S4());\r\n    },\r\n\r\n\r\n    error: function(quit, message) {\r\n\r\n      if (quit) {\r\n        throw new Error(message);\r\n      } else {\r\n        console.error('E!' + message);\r\n      }\r\n    },\r\n\r\n    info: function(m) {\r\n\r\n      if (Gamelab.DEBUG) {\r\n        console.info('Info:' + m);\r\n      }\r\n    },\r\n\r\n\r\n    log: function(m) {\r\n\r\n      if (Gamelab.DEBUG) {\r\n        console.log('Gamelab:' + m);\r\n      }\r\n    },\r\n\r\n    initializers: [],\r\n\r\n    addInitializer: function(i) {\r\n\r\n      this.initializers.push(i);\r\n\r\n    },\r\n\r\n    Collision: {\r\n\r\n      boxesCollide(pos1, size1, pos2, size2) {\r\n\r\n        return pos1.x >= pos2.x - size1.x &&\r\n          pos1.x <= pos2.x + size2.x &&\r\n          pos1.y >= pos2.y - size1.y &&\r\n          pos1.y <= pos2.y + size2.y;\r\n      },\r\n\r\n      spriteBoxesCollide(obj1, obj2, gw) {\r\n        gw = gw || Gamelab.game_windows[0];\r\n\r\n        var camPos = new Gamelab.Vector(0, 0, 0);\r\n\r\n        obj1.padding = obj1.padding || new Gamelab.Vector(0, 0, 0);\r\n\r\n        var paddingX = Math.round(obj1.padding.x * obj1.size.x),\r\n\r\n          paddingY = Math.round(obj1.padding.y * obj1.size.y),\r\n          left = obj1.position.x + paddingX + camPos.x,\r\n\r\n          right = obj1.position.x + obj1.size.x - paddingX + camPos.x,\r\n\r\n          top = obj1.position.y + camPos.y + paddingY,\r\n          bottom = obj1.position.y + obj1.size.y - paddingY + camPos.y;\r\n\r\n        if (right > obj2.position.x && left < obj2.position.x + obj2.size.x &&\r\n          bottom > obj2.position.y && top < obj2.position.y + obj2.size.y) {\r\n\r\n          return true;\r\n\r\n        }\r\n\r\n      },\r\n\r\n      spriteBoxesCollideTop(obj1, obj2, gw) {\r\n        gw = gw || Gamelab.game_windows[0];\r\n\r\n        var camPos = new Gamelab.Vector(0, 0, 0);\r\n\r\n        obj1.padding = obj1.padding || new Gamelab.Vector(0, 0, 0);\r\n\r\n        var paddingX = Math.round(obj1.padding.x * obj1.size.x),\r\n\r\n          paddingY = Math.round(obj1.padding.y * obj1.size.y),\r\n          left = obj1.position.x + paddingX + camPos.x,\r\n\r\n          right = obj1.position.x + obj1.size.x - paddingX + camPos.x,\r\n\r\n          top = obj1.position.y + camPos.y + paddingY,\r\n          bottom = obj1.position.y + obj1.size.y - paddingY + camPos.y;\r\n\r\n        if (right > obj2.position.x && left < obj2.position.x + obj2.size.x &&\r\n          bottom > obj2.position.y && top < obj2.position.y + obj2.size.y\r\n        ) {\r\n\r\n          return true;\r\n\r\n        }\r\n\r\n      },\r\n\r\n      /*\r\n       *\r\n       *  ##Not known to be working -->> Below function\r\n       *\r\n       * */\r\n\r\n      pixelsCollide(sourceSprite, targetSprite, gw) {\r\n        gw = gw || Gamelab.game_windows[0];\r\n\r\n        var camPos = new Gamelab.Vector(0, 0, 0);\r\n\r\n        /* Box model detection, return true on collision */\r\n        function hitBox(source, target) {\r\n          /* Source and target objects contain x, y and width, height */\r\n          return !(\r\n            ((source.y + source.height) < (target.y)) ||\r\n            (source.y > (target.y + target.height)) ||\r\n            ((source.x + source.width) < target.x) ||\r\n            (source.x > (target.x + target.width))\r\n          );\r\n        }\r\n\r\n        var source = {\r\n\r\n            position: sourceSprite.position,\r\n\r\n            pixelMap: sourceSprite.selected_animation.pixelMap\r\n\r\n          },\r\n\r\n          target = {\r\n\r\n            position: targetSprite.position,\r\n\r\n            pixelMap: targetSprite.selected_animation.pixelMap\r\n\r\n          };\r\n\r\n        // Loop through all the pixels in the source image\r\n        for (var s = 0; s < source.pixelMap.length; s++) {\r\n          var sourcePixel = source.pixelMap[s];\r\n          // Add positioning offset\r\n          var sourceArea = {\r\n            x: sourcePixel.x + sourceSprite.position.x,\r\n            y: sourcePixel.y + sourceSprite.position.y,\r\n            width: 1,\r\n            height: 1\r\n          };\r\n\r\n          var relatedPixel;\r\n\r\n          // Loop through all the pixels in the target image\r\n          for (var t = 0; t < target.pixelMap.length; t++) {\r\n            var targetPixel = target.pixelMap[t];\r\n            // Add positioning offset\r\n            var targetArea = {\r\n              x: targetPixel.x + targetSprite.position.x,\r\n              y: targetPixel.y + targetSprite.position.y,\r\n              width: 1,\r\n              height: 1\r\n            };\r\n\r\n            /* Use the earlier aforementioned hitbox function */\r\n            if (hitBox(sourceArea, targetArea)) {\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    _gameWindow: {},\r\n\r\n    setGameWindow: function(gameWindow) {\r\n      this._gameWindow = gameWindow;\r\n    },\r\n\r\n    ExtendEvents: function(extendedObject, extendedKey, extendor, extendorKey) {\r\n      var evtLink = new GSEventLink(extendedObject, extendedKey, extendor, extendorKey);\r\n\r\n      this.all_objects.push(new GSEventLink(extendedObject, extendedKey, extendor, extendorKey));\r\n\r\n      var parent = extendedObject;\r\n\r\n      // console.log(parent);\r\n\r\n      if (parent) {\r\n        console.log('Gamelab:EXTENDING EVENTS:' + extendedKey + \":\" + extendorKey);\r\n\r\n        if (parent.onRun) //Any extendable object has an onRun ... OR\r\n        {\r\n          parent.onRun(extendor, extendorKey);\r\n\r\n        }\r\n        if (parent.onComplete) //object has an onComplete\r\n        {\r\n          parent.onComplete(extendor, extendorKey);\r\n\r\n        }\r\n\r\n\r\n      }\r\n\r\n    },\r\n\r\n\r\n    assignAll: function(object, args, keys) {\r\n\r\n      __gamelabInstance.each(keys, function(ix, item) {\r\n\r\n        object[ix] = args[ix];\r\n\r\n      });\r\n\r\n    },\r\n\r\n\r\n    each: function(list, onResult, onComplete) {\r\n      for (var i in list) {\r\n        onResult(i, list[i]);\r\n      }\r\n\r\n      if (typeof(onComplete) === 'function') {\r\n        onComplete(false, list)\r\n      };\r\n\r\n    },\r\n\r\n    ready_callstack: [],\r\n\r\n    ready: function(callback) {\r\n\r\n      this.ready_callstack.push(callback);\r\n\r\n    },\r\n    reload: function() {\r\n\r\n      this.callReady();\r\n\r\n    },\r\n\r\n    callReady: function() {\r\n\r\n      var funx = this.ready_callstack;\r\n\r\n      var gameWindow = this.game_windows[0],\r\n        module = this;\r\n\r\n      //call every function in the ready_callstack\r\n\r\n      this.each(funx, function(ix, call) {\r\n\r\n        call(module, gameWindow);\r\n\r\n      });\r\n\r\n      this.InputSystem.init();\r\n\r\n      this.__running = true;\r\n\r\n    },\r\n\r\n    getArg: function(args, keys, fallback) {\r\n\r\n      if (typeof(keys) == 'string') {\r\n        keys = [keys]; //always array\r\n      }\r\n      for (var x = 0; x < keys.length; x++) {\r\n        var k = keys[x];\r\n\r\n        if (args && args.hasOwnProperty(k)) {\r\n          return args[k]; //return first argument match\r\n        }\r\n      }\r\n      return fallback;\r\n    },\r\n\r\n    normalArgs: function(args) {\r\n\r\n      var a = {};\r\n\r\n      function normal(str) {\r\n        return str.toLowerCase().replace('-', '').replace(' ', '').replace('_', '')\r\n      };\r\n\r\n      for (var x in args) {\r\n        a[normal(x)] = args[x];\r\n      }\r\n\r\n      return a;\r\n    },\r\n\r\n    isNormalStringMatch: function(str1, str2) {\r\n\r\n      return str1.toLowerCase().replace(' ', '') == str2.toLowerCase().replace(' ', '');\r\n\r\n    },\r\n\r\n    instance_type_pairs: function() {\r\n\r\n      //get an array of all instance/type pairs added to the library\r\n\r\n      //example : [ {constructor_name:Sprite, type:enemy_basic}, {constructor_name:Animation, type:enemy_attack}  ];\r\n\r\n      var objectList = [];\r\n\r\n      this.each(this.all_objects, function(ix, item) {\r\n\r\n        objectList.push({\r\n          constructor_name: item.constructor.name,\r\n          type: item.type\r\n        });\r\n\r\n      });\r\n\r\n      return objectList;\r\n\r\n    },\r\n\r\n    getById: function(id) {\r\n\r\n      for (var x in this.all_objects) {\r\n        if (this.all_objects[x].id == id) {\r\n          return this.all_objects[x];\r\n\r\n        }\r\n\r\n      }\r\n\r\n    },\r\n\r\n    select: function(constructor_name, name, group /*ignoring spaces and CAPS/CASE on type match*/ ) {\r\n\r\n      var query = [];\r\n\r\n      var __inst = this;\r\n\r\n      this.each(Gamelab.all(), function(ix, item) {\r\n\r\n        if (constructor_name == '*' || item.constructor.name == constructor_name) {\r\n\r\n          if (group == '*' || __inst.isNormalStringMatch(group, item.group)) {\r\n\r\n            if (name == '*' || __inst.isNormalStringMatch(name, item.name)) {\r\n\r\n              query.push(item);\r\n\r\n            }\r\n          }\r\n        }\r\n      });\r\n\r\n      return query;\r\n    }\r\n  }\r\n\r\n  return module;\r\n\r\n};\r\n\r\nlet GamelabApi = {\r\n  get: function() {\r\n\r\n\r\n  },\r\n\r\n  post: function(object) {\r\n    //TODO decycle the object before saving\r\n\r\n    if (!object.id) {\r\n      object.id = Gamelab.create_id();\r\n\r\n    }\r\n\r\n    var name = object.name,\r\n      type = object.constructor.name,\r\n      contents = jstr(object),\r\n      id = object.id;\r\n\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\nclass GSO //Gamelab-Overrideable\r\n{\r\n  constructor(args = {}) {\r\n\r\n    this.run_ext = args.run_ext || [];\r\n\r\n    this.complete_ext = args.complete_ext || [];\r\n  }\r\n\r\n  /*****\r\n   * Overridable / Extendable functions\r\n   * -allows stacking of external object-function calls\r\n   ******/\r\n\r\n  onRun(caller, callkey) {\r\n    this.run_ext = this.run_ext || [];\r\n\r\n    if (this.run_ext.indexOf(caller[callkey]) == -1) {\r\n      this.run_ext.push({\r\n        caller: caller,\r\n        callkey: callkey\r\n      });\r\n    }\r\n  }\r\n\r\n  onComplete(caller, callkey) {\r\n    this.complete_ext = this.complete_ext || [];\r\n\r\n    if (this.complete_ext.indexOf(caller[callkey]) == -1) {\r\n      this.complete_ext.push({\r\n        caller: caller,\r\n        callkey: callkey\r\n      });\r\n    }\r\n  }\r\n\r\n  call_on_run() {\r\n    //call any function extension that is present\r\n    for (var x = 0; x < this.run_ext.length; x++) {\r\n      this.run_ext[x].caller[this.run_ext[x].callkey]();\r\n    }\r\n  }\r\n\r\n  call_on_complete() {\r\n    //call any function extension that is present\r\n    for (var x = 0; x < this.complete_ext.length; x++) {\r\n      this.complete_ext[x].caller[this.complete_ext[x].callkey]();\r\n    }\r\n  }\r\n\r\n}\r\n\r\nlet Gamelab = Gamelab_Module();\r\n\r\n\r\nGamelab.DEV = true;\r\n\r\n\r\nif (typeof module !== 'undefined' && module.exports) {\r\n\r\n  //This library is being instaniated via require() aka node.js require or similar library loader\r\n  module.exports = Gamelab;\r\n\r\n} else {\r\n\r\n\r\n}\r\n\r\n/***************\r\n * TODO : fix the above duplicate references, which exist now for backward compatibility with previouslyh authored code\r\n *  -apply find and replace accross the codebase\r\n * ****************/\r\n\r\n/********\r\n * jstr() : public function for stringifying objects and arrays (uses pretty print style)\r\n * *********/\r\n\r\nfunction jstr(obj) {\r\n\r\n  return JSON.stringify(obj);\r\n\r\n};\r\n\r\nGamelab.jstr = jstr;\r\n\r\n/**********\r\n * $Q : Selector Function\r\n *  -allows string-based-selection of game-objects.\r\n * **********/\r\n\r\nfunction $Q(selector) {\r\n\r\n  //declare events:\r\n\r\n  console.log(selector);\r\n\r\n  var query = [];\r\n\r\n  //handle selector / selection of objects:\r\n\r\n  if (typeof selector !== 'string') {\r\n\r\n    if (selector instanceof Array) {\r\n\r\n    } else {\r\n\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n\r\n    if (selector && selector !== '*') {\r\n\r\n      var s = selector || '';\r\n\r\n      console.info('selector:' + s);\r\n\r\n\r\n      var mainSelector = $Q.before('[', s).trim(),\r\n        msfChar = mainSelector.substring(0, 1);\r\n\r\n      var __targetClassName = \"*\";\r\n\r\n      var output = [];\r\n\r\n      var cleanSelectorString = function(str) {\r\n        return str.replace(\",\", \"\");\r\n      };\r\n\r\n      switch (msfChar.toLowerCase()) {\r\n        case \".\":\r\n\r\n          console.info('Selecting by \".\" or class');\r\n\r\n          __targetClassName = cleanSelectorString($Q.after('.', mainSelector));\r\n\r\n          console.info('Target class is:' + __targetClassName);\r\n\r\n          break;\r\n\r\n        case \"*\":\r\n\r\n          console.info('Selecting by \"*\" or ANY object in the library instance');\r\n\r\n          __targetClassName = \"*\";\r\n\r\n          break;\r\n\r\n      }\r\n\r\n      var criterion = $Q.between('[', ']', s),\r\n        cparts = criterion.split('=');\r\n\r\n      var __targetGroup = \"*\",\r\n        __targetName = \"*\";\r\n\r\n      var getParts = function() {\r\n\r\n        if (cparts.length >= 2) {\r\n\r\n          switch (cparts[0].toLowerCase()) {\r\n\r\n            case \"name\":\r\n\r\n              //get all objects according to name=name\r\n\r\n              console.log('Q():Detected parts in selector:' + jstr(cparts));\r\n\r\n              __targetName = cleanSelectorString(cparts[1]);\r\n\r\n              break;\r\n\r\n            case \"group\":\r\n\r\n              console.log('Q():Detected parts in selector:' + jstr(cparts));\r\n\r\n              __targetGroup = cleanSelectorString(cparts[1]);\r\n\r\n              break;\r\n\r\n          }\r\n\r\n        }\r\n\r\n        if (cparts.length >= 4) {\r\n\r\n          cparts[2] = cparts[2].replace(\",\", \"\");\r\n\r\n          switch (cparts[2].toLowerCase()) {\r\n\r\n            case \"name\":\r\n\r\n              //get all objects according to name=name\r\n\r\n              console.log('Q():Detected parts in selector:' + jstr(cparts));\r\n\r\n              __targetName = cleanSelectorString(cparts[3]);\r\n\r\n              break;\r\n\r\n            case \"group\":\r\n\r\n              console.log('Q():Detected parts in selector:' + jstr(cparts));\r\n\r\n              __targetGroup = cleanSelectorString(cparts[3]);\r\n\r\n              break;\r\n\r\n          }\r\n\r\n        }\r\n\r\n      };\r\n\r\n      getParts(cparts);\r\n\r\n      query = Gamelab.select(__targetClassName, __targetName, __targetGroup);\r\n\r\n    } else if (selector == '*') {\r\n\r\n      query = Gamelab.all();\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  query.each = function(callback) {\r\n\r\n    var objects = [];\r\n\r\n    for (var x = 0; x < this.length; x++) {\r\n      if (typeof x == 'number') {\r\n\r\n        callback(x, this[x]);\r\n      }\r\n\r\n    }\r\n\r\n\r\n  };\r\n\r\n  query.on = function(evt_key, selectorObject, controller_ix, callback) //handle each event such as on('collide') OR on('stick_left_0') << first controller stick_left\r\n  {\r\n\r\n    if (typeof evt_key == 'function' && typeof selectorObject == 'function') {\r\n      //this is a special pattern of if(f() == true){ runFunction(); };\r\n\r\n      var boolTrigger = evt_key,\r\n        boolCall = selectorObject,\r\n\r\n        boolEvent = new Gamelab.BoolEvent().On(boolTrigger).Call(boolCall);\r\n\r\n    }\r\n\r\n\r\n    var criterion = $Q.between('[', ']', evt_key);\r\n\r\n    if (criterion.indexOf('===') >= 0) {\r\n      criterion = criterion.replace('===', '=');\r\n    }\r\n\r\n    if (criterion.indexOf('==') >= 0) {\r\n      criterion = criterion.replace('==', '=').replace('==', 0);\r\n    }\r\n\r\n    var cparts = criterion.split('=');\r\n\r\n    var __targetGroup = \"*\",\r\n      __targetName = \"*\";\r\n\r\n    if (evt_key.indexOf('[') >= 0) {\r\n      evt_key = $Q.before('[', evt_key).trim();\r\n\r\n    }\r\n\r\n\r\n    var padding = 0;\r\n\r\n    //if controller_ix is function, and callback not present, then controller_ix is the callback aka optional argument\r\n\r\n    if (controller_ix && typeof controller_ix == 'function' && !callback) {\r\n      callback = controller_ix;\r\n      controller_ix = 0;\r\n    }\r\n\r\n    //optional argument: if controller_ix is function, and callback not present, then callback is selectorObject\r\n\r\n    if (selectorObject && typeof selectorObject == 'function' && !callback) {\r\n\r\n      callback = selectorObject;\r\n\r\n      selectorObject = $Q('*');\r\n\r\n      controller_ix = 0;\r\n    };\r\n\r\n    var evt_profile = {};\r\n\r\n    //which controller?\r\n\r\n    evt_profile.cix = controller_ix;\r\n\r\n    //Need the control key: 'left_stick', 'button_0', etc..\r\n\r\n    evt_profile.evt_key = evt_key;\r\n\r\n    if ($Q.contains_any(['stick', 'button', 'click', 'key'], evt_profile.evt_key)) {\r\n\r\n      var button_mode = evt_profile.evt_key.indexOf('button') >= 0;\r\n\r\n      Gamelab.GamepadAdapter.on(evt_profile.evt_key, 0, function(x, y) {\r\n\r\n        callback(x, y);\r\n\r\n      });\r\n\r\n      console.info('detected input event key in:' + evt_profile.evt_key);\r\n\r\n      console.info('TODO: rig events');\r\n\r\n    }\r\n\r\n    //TODO: test collision events:\r\n    else if ($Q.contains_any(['collide', 'collision', 'hit', 'touch'], evt_profile.evt_key)) {\r\n\r\n      //   console.info('Rigging a collision event');\r\n\r\n      //   console.info('detected collision event key in:' + evt_profile.evt_key);\r\n\r\n      //  console.info('TODO: rig collision events');\r\n\r\n      this.each(function(ix, item1) {\r\n\r\n        // console.info('Collision Processing 1:' + item1.name);\r\n        //  console.info('Collision Processing 1:' + item1.type);\r\n\r\n        selectorObject.each(function(iy, item2) {\r\n\r\n          //    console.info('Collision Processing 2:' + item2.name);\r\n          //   console.info('Collision Processing 2:' + item2.type);\r\n\r\n          if (typeof(item1.onUpdate) == 'function') {\r\n\r\n            var update = function(sprite) {\r\n\r\n              console.log('Box collide::' + jstr([this, item2]));\r\n\r\n              if (this.hasBoxCollision(item2, padding)) {\r\n\r\n                callback(this, item2);\r\n\r\n              };\r\n\r\n            };\r\n\r\n            item1.onUpdate(update);\r\n\r\n          }\r\n\r\n\r\n        });\r\n\r\n      });\r\n\r\n\r\n    } else {\r\n      console.info('Rigging a property event');\r\n\r\n      //TODO: test property-watch events:\r\n\r\n      console.info('detected property threshhold event key in:' + evt_profile.evt_key);\r\n\r\n      console.info('TODO: rig property events');\r\n\r\n      var condition = \"_\",\r\n        key = criterion || evt_profile.evt_key;\r\n\r\n      if (key.indexOf('[') >= 0 || key.indexOf(']') >= 0) {\r\n        key = $Q.between('[', ']', key);\r\n\r\n      }\r\n\r\n      var evt_parts = [];\r\n\r\n      var run = function() {\r\n        console.error('Sprite property check was not set correctly');\r\n\r\n      };\r\n\r\n      if (key.indexOf('>=') >= 0) {\r\n        condition = \">=\";\r\n\r\n\r\n      } else if (key.indexOf('<=') >= 0) {\r\n        condition = \"<=\";\r\n      } else if (key.indexOf('>') >= 0) {\r\n        condition = \">\";\r\n      } else if (key.indexOf('<') >= 0) {\r\n        condition = \"<\";\r\n      } else if (key.indexOf('=') >= 0) {\r\n        condition = \"=\";\r\n      }\r\n\r\n      evt_parts = key.split(condition);\r\n\r\n      for (var x = 0; x < evt_parts.length; x++) {\r\n        evt_parts[x] = evt_parts[x].replace('=', '').replace('=', '').trim(); //remove any trailing equals and trim()\r\n\r\n      }\r\n\r\n      var mykey, number;\r\n\r\n      // alert(evt_parts[0]);\r\n\r\n      try {\r\n\r\n        mykey = evt_parts[0];\r\n\r\n        number = parseFloat(evt_parts[1]);\r\n\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n\r\n      console.info('Gamelab:Processing condition with:' + condition);\r\n\r\n      switch (condition) {\r\n\r\n        case \">=\":\r\n\r\n\r\n          run = function(obj, key) {\r\n            if (obj[key] >= number) {\r\n              callback();\r\n            }\r\n          };\r\n\r\n          break;\r\n\r\n        case \"<=\":\r\n\r\n          run = function(obj, key) {\r\n            if (obj[key] <= number) {\r\n              callback();\r\n            }\r\n          };\r\n\r\n          break;\r\n\r\n\r\n        case \">\":\r\n\r\n          run = function(obj, key) {\r\n            if (obj[key] > number) {\r\n              callback();\r\n            }\r\n          };\r\n\r\n          break;\r\n\r\n        case \"<\":\r\n\r\n          run = function(obj, key) {\r\n            if (obj[key] < number) {\r\n              callback();\r\n            }\r\n          };\r\n\r\n          break;\r\n\r\n        case \"=\":\r\n\r\n          run = function(obj, key) {\r\n            if (obj[key] == number) {\r\n              callback();\r\n            }\r\n          };\r\n\r\n          break;\r\n\r\n      }\r\n\r\n\r\n      /************\r\n       * Attach update to each member\r\n       *\r\n       * **************/\r\n\r\n      var keys = mykey.split('.'),\r\n        propkey = \"\";\r\n\r\n      this.each(function(ix, item) {\r\n\r\n        var object = {};\r\n\r\n        if (keys.length == 1) {\r\n          object = item;\r\n\r\n          propkey = mykey;\r\n\r\n        } else if (keys.length == 2) {\r\n          object = item[keys[0]];\r\n\r\n          propkey = keys[1];\r\n\r\n\r\n        } else if (keys.length == 3) {\r\n          object = item[keys[0]][keys[1]];\r\n\r\n          propkey = keys[2];\r\n\r\n        } else {\r\n          console.error(\":length of '.' notation out of range. We use max length of 3 or prop.prop.key.\");\r\n\r\n        }\r\n\r\n        if (typeof item.onUpdate == 'function') {\r\n\r\n\r\n          var spr = item;\r\n\r\n          item.onUpdate(function(sprite) {\r\n\r\n            run(object, propkey);\r\n\r\n          });\r\n\r\n        }\r\n\r\n      });\r\n\r\n    }\r\n\r\n  };\r\n\r\n\r\n  return query;\r\n\r\n}\r\n\r\n\r\n$Q.each = function(obj, callback, complete) {\r\n\r\n  for (var x in obj) {\r\n    callback(obj);\r\n\r\n  }\r\n\r\n  if (typeof(complete) == 'function') {\r\n    complete(obj);\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\n$Q.before = function(c1, test_str) {\r\n  var start_pos = 0;\r\n  var end_pos = test_str.indexOf(c1, start_pos);\r\n  return test_str.substring(start_pos, end_pos);\r\n};\r\n\r\n\r\n$Q.contains = function(c1, test_str) {\r\n  return test_str.indexOf(c1) >= 0;\r\n};\r\n\r\n$Q.contains_all = function(cList, test_str) {\r\n  for (var x = 0; x < cList.length; x++) {\r\n    if (test_str.indexOf(cList[x]) < 0) {\r\n      return false;\r\n\r\n    }\r\n  }\r\n\r\n  return true;\r\n\r\n};\r\n\r\n$Q.contains_any = function(cList, test_str) {\r\n\r\n  for (var x = 0; x < cList.length; x++) {\r\n    if (test_str.indexOf(cList[x]) >= 0) {\r\n      return true;\r\n\r\n    }\r\n  }\r\n\r\n  return false;\r\n\r\n};\r\n\r\n$Q.after = function(c1, test_str) {\r\n  var start_pos = test_str.indexOf(c1) + 1;\r\n  var end_pos = test_str.length;\r\n  return test_str.substring(start_pos, end_pos);\r\n};\r\n\r\n$Q.between = function(c1, c2, test_str) {\r\n  var start_pos = test_str.indexOf(c1) + 1;\r\n  var end_pos = test_str.indexOf(c2, start_pos);\r\n  return test_str.substring(start_pos, end_pos)\r\n};\r\n\r\n\r\n/****************************************\r\n *  Developer's own test-function:\r\n *      -Q.test_selector_method():\r\n * ***************************************/\r\n\r\n$Q.test_selector_method = function() { //leftover method of hand-testing\r\n  var Q_TestStrings = ['*', '.Sprite', '*[group=\"enemy_type_0\"]', '.Sprite[group=\"enemy_type_0\"]'];\r\n\r\n  for (var x = 0; x < Q_TestStrings.length; x++) {\r\n    var test = Q_TestStrings[x];\r\n\r\n    console.info('testing:' + test);\r\n\r\n    $Q(test);\r\n  }\r\n\r\n  console.log('Testing stick left');\r\n\r\n  this.on('stick_left_0');\r\n\r\n  console.log('Testing button');\r\n\r\n  this.on('button_0');\r\n\r\n\r\n  console.log('Testing collide');\r\n\r\n  this.on('collide');\r\n\r\n\r\n  console.log('Testing button');\r\n\r\n  this.on('collide');\r\n\r\n  console.log('Testing prop');\r\n\r\n  this.on('health>=0');\r\n\r\n\r\n};\r\n\r\n\r\nGamelab.$Q = $Q;\r\n\r\nGamelab.query = $Q;\r\n\r\n\r\n/********************\r\n * Gamelab.InputSystem\r\n * Various Keyboard + mouse Input Events\r\n ********************/\r\n\r\nGamelab.InputSystem = {\r\n\r\n  //PC input events\r\n\r\n  Mouse: {\r\n    Position: {\r\n      x: 0,\r\n      y: 0\r\n    },\r\n    Speed: {\r\n      x: 0,\r\n      y: 0\r\n    },\r\n    setPosition(x, y) {\r\n\r\n      this.Speed.x = x - this.Position.x;\r\n\r\n      this.Speed.y = y - this.Position.y;\r\n\r\n      this.Position.x = x;\r\n\r\n      this.Position.y = y;\r\n\r\n    },\r\n    isIdle: function() {\r\n      return this.speed.x == 0 && this.speed.y == 0;\r\n    }\r\n  },\r\n\r\n  events: {\r\n\r\n    mousemove: [],\r\n    mousepos: [],\r\n    leftclick: [],\r\n    rightclick: [],\r\n    middleclick: [],\r\n    wheelup: [],\r\n    wheelDown: []\r\n  },\r\n\r\n  keymap: {},\r\n\r\n  keyReplace: function(str) {\r\n    return str.toLowerCase().replace('space', ' ').replace('left', String.fromCharCode(37)).replace('left', String.fromCharCode(37)).replace('up', String.fromCharCode(38)).replace('right', String.fromCharCode(39)).replace('down', String.fromCharCode(40));\r\n  },\r\n\r\n  extendKey: function(evt_key, callback, onFinish) {\r\n\r\n    evt_key = this.keyReplace(evt_key);\r\n\r\n    Gamelab.InputSystem.keymap[evt_key] = {\r\n\r\n      down: false,\r\n\r\n      callback: function() {\r\n        callback(evt_key);\r\n      }\r\n    };\r\n\r\n    return Gamelab.InputSystem.keymap[evt_key];\r\n\r\n  },\r\n\r\n  extend: function(evt_key, downCall, upCall, onFinish) {\r\n\r\n    evt_key = evt_key.toLowerCase();\r\n\r\n    //each event-group has object-type\r\n    Gamelab.InputSystem.events[evt_key] = Gamelab.InputSystem.events[evt_key] || [];\r\n\r\n    Gamelab.InputSystem.events[evt_key].push({\r\n\r\n      down: downCall,\r\n\r\n      up: upCall\r\n\r\n    });\r\n\r\n  },\r\n\r\n  init: function() {\r\n\r\n    var MOUSE = this.Mouse;\r\n\r\n    window.setInterval(function() {\r\n\r\n      Gamelab.each(Gamelab.InputSystem.keymap, function(im, kmapItem) {\r\n\r\n        if (kmapItem.down == true) {\r\n\r\n          kmapItem.callback();\r\n\r\n        }\r\n\r\n      });\r\n\r\n    }, 10);\r\n\r\n    document.onkeydown = document.onkeyup = function(e) {\r\n\r\n      e = e || event; // to deal with IE\r\n\r\n      var gs_key_string = 'key_' + String.fromCharCode(e.keyCode),\r\n\r\n        evt_object = Gamelab.InputSystem['keymap'][gs_key_string] || Gamelab.InputSystem['keymap'][gs_key_string.toLowerCase()];\r\n\r\n      if (evt_object) {\r\n        evt_object.down = e.type == 'keydown';\r\n\r\n      }\r\n\r\n    }\r\n\r\n    var canvases = document.querySelectorAll('canvas.gamewindow');\r\n\r\n\r\n    function getMousePos(e, c) {\r\n\r\n      var x;\r\n      var y;\r\n      if (e.pageX || e.pageY) {\r\n        x = e.pageX;\r\n        y = e.pageY;\r\n      } else {\r\n        x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n        y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\r\n      }\r\n      x -= c.offsetLeft;\r\n      y -= c.style.top;\r\n      return {\r\n        x: x,\r\n        y: y\r\n      };\r\n    }\r\n\r\n    let InputSystem = Gamelab.InputSystem;\r\n\r\n    function mouseMoving(event, c) {\r\n\r\n      var pos = getMousePos(event, c);\r\n\r\n      MOUSE.setPosition(pos.x, pos.y);\r\n\r\n      if (InputSystem.events['mousemove']) {\r\n        Gamelab.each(InputSystem.events['mousemove'], function(ix, el) {\r\n\r\n          el.down(pos.x, pos.y);\r\n\r\n        });\r\n      }\r\n\r\n    };\r\n\r\n    //Interval for mouse-idle time : run mouse move again with same position, no difference\r\n    setInterval(function() {\r\n\r\n      if (InputSystem.events['mousepos']) {\r\n\r\n        var pos = MOUSE.Position;\r\n\r\n        Gamelab.each(InputSystem.events['mousepos'], function(ix, el) {\r\n\r\n          el.down(pos.x, pos.y);\r\n\r\n        });\r\n      }\r\n\r\n    }, 10);\r\n\r\n\r\n    for (var x = 0; x < canvases.length; x++) {\r\n      var c = canvases[x];\r\n\r\n      function applyMouseMove(e) {\r\n        mouseMoving(e, c);\r\n      }\r\n\r\n      console.info('Gamelab-lib-code:main.js: InputSystem applying mousemove');\r\n\r\n      document.addEventListener(\"mousemove\", applyMouseMove);\r\n\r\n      c.onmousedown = function(e) {\r\n        //    alert(JSON.stringify(Gamelab.InputSystem, true, 2));\r\n\r\n        var value = e.which;\r\n        var pos = getMousePos(e, c);\r\n        var InputSystem = Gamelab.InputSystem;\r\n\r\n        e.preventDefault();\r\n\r\n        switch (e.which) {\r\n          case 1:\r\n\r\n            for (var x in InputSystem.events) {\r\n\r\n              if (InputSystem.events[x] instanceof Array && x == 'leftclick') {\r\n\r\n                Gamelab.each(InputSystem.events[x], function(ix, el) {\r\n\r\n                  el.down(pos.x, pos.y);\r\n                });\r\n              }\r\n            }\r\n\r\n            break;\r\n          case 2:\r\n            // alert('Middle Mouse button pressed.');\r\n\r\n            for (var x in Gamelab.InputSystem.events) {\r\n\r\n              if (InputSystem.events[x] instanceof Array && x == 'middleclick') {\r\n\r\n                Gamelab.each(InputSystem.events[x], function(ix, el) {\r\n\r\n                  el.down(pos.x, pos.y);\r\n                });\r\n              }\r\n            }\r\n            break;\r\n          case 3:\r\n            //  alert('Right Mouse button pressed.');\r\n\r\n\r\n            for (var x in Gamelab.InputSystem.events) {\r\n\r\n\r\n              if (InputSystem.events[x] instanceof Array && x == 'rightclick') {\r\n\r\n\r\n                Gamelab.each(InputSystem.events[x], function(ix, el) {\r\n\r\n                  el.down(pos.x, pos.y);\r\n                });\r\n\r\n                return false;\r\n              }\r\n\r\n\r\n            }\r\n\r\n            break;\r\n          default:\r\n\r\n            return 0;\r\n            //alert('You have a strange Mouse!');\r\n\r\n        }\r\n\r\n\r\n        e.preventDefault();\r\n        return 0;\r\n      };\r\n\r\n      c.onmouseup = function(e) {\r\n\r\n        //    alert(JSON.stringify(Gamelab.InputSystem, true, 2));\r\n\r\n        var value = e.which;\r\n        var pos = getMousePos(e, c);\r\n        var InputSystem = Gamelab.InputSystem;\r\n\r\n\r\n        e.preventDefault();\r\n\r\n        switch (e.which) {\r\n          case 1:\r\n\r\n            for (var x in InputSystem.events) {\r\n\r\n\r\n              if (InputSystem.events[x] instanceof Array && x == 'leftclick') {\r\n\r\n\r\n                Gamelab.each(InputSystem.events[x], function(ix, el) {\r\n\r\n                  el.up(pos.x, pos.y);\r\n                });\r\n              }\r\n\r\n\r\n            }\r\n\r\n            break;\r\n          case 2:\r\n            // alert('Middle Mouse button pressed.');\r\n\r\n\r\n            for (var x in Gamelab.InputSystem.events) {\r\n\r\n\r\n              if (InputSystem.events[x] instanceof Array && x == 'middleclick') {\r\n\r\n\r\n                Gamelab.each(InputSystem.events[x], function(ix, el) {\r\n\r\n                  el.up(pos.x, pos.y);\r\n                });\r\n              }\r\n\r\n\r\n            }\r\n            break;\r\n          case 3:\r\n            //  alert('Right Mouse button pressed.');\r\n\r\n\r\n            for (var x in Gamelab.InputSystem.events) {\r\n\r\n\r\n              if (InputSystem.events[x] instanceof Array && x == 'rightclick') {\r\n\r\n\r\n                Gamelab.each(InputSystem.events[x], function(ix, el) {\r\n\r\n                  el.up(pos.x, pos.y);\r\n                });\r\n\r\n\r\n                return false;\r\n\r\n              }\r\n\r\n\r\n            }\r\n\r\n            break;\r\n          default:\r\n\r\n            return 0;\r\n            //alert('You have a strange Mouse!');\r\n\r\n        }\r\n\r\n\r\n      };\r\n    }\r\n\r\n\r\n  }\r\n\r\n\r\n};\r\n\r\n//Override the existing window.onload function\r\n\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n\r\n  Gamelab.callReady();\r\n\r\n});\r\n\r\nGamelab.file_system = {\r\n\r\n  localizedSource: function(src, hostUrl) {\r\n\r\n    hostUrl = hostUrl || \"../\";\r\n\r\n    var gs_folder_ix = src.indexOf('assets/game');\r\n\r\n    return hostUrl + src.substring(gs_folder_ix, src.length);\r\n\r\n  },\r\n\r\n  loadJSON: function(filepath, callback) {\r\n\r\n    function readTextFile(file, callback) {\r\n      var rawFile = new XMLHttpRequest();\r\n      rawFile.open(\"GET\", file, false);\r\n      rawFile.onreadystatechange = function() {\r\n        if (rawFile.readyState === 4) {\r\n          if (rawFile.status === 200 || rawFile.status == 0) {\r\n            var allText = rawFile.responseText;\r\n            callback(JSON.stringify(allText));\r\n          }\r\n        }\r\n      }\r\n      rawFile.send(null);\r\n    };\r\n\r\n    readTextFile('file:///' + filepath, callback);\r\n\r\n  },\r\n\r\n  loadLevel: function(jsonText, gw, callback) {\r\n\r\n    var data = JSON.parse(jsonText);\r\n\r\n    if (typeof(gw) == 'function' || !gw) {\r\n      callback = gw || callback || function() {};\r\n\r\n      gw = Gamelab.game_windows[0];\r\n    }\r\n\r\n    $.each(data.sprites, function(ix, xitem) {\r\n\r\n      if (typeof(xitem.src) == 'string') {\r\n\r\n        xitem.src = Gamelab.file_system.localizedSource(xitem.src);\r\n      }\r\n\r\n      __gamelabInstance.each(xitem, function(iy, yitem) {\r\n\r\n        if (yitem.src) {\r\n\r\n          yitem.src = Gamelab.file_system.localizedSource(yitem.src);\r\n\r\n        }\r\n\r\n        __gamelabInstance.each(yitem, function(iz, zitem) {\r\n\r\n          if (zitem.src) {\r\n            zitem.src = Gamelab.file_system.localizedSource(zitem.src);\r\n\r\n          }\r\n\r\n\r\n        });\r\n\r\n\r\n      });\r\n\r\n      xitem = new Gamelab.Sprite(xitem);\r\n\r\n      gw.add(xitem);\r\n      //sprite.image = sprite.selected_animation.image;\r\n\r\n\r\n      if (ix >= data.sprites.length - 1) {\r\n\r\n        //last sprite is loaded //WHY DOESN't this work?\r\n\r\n        callback(false, data);\r\n      }\r\n\r\n    });\r\n\r\n  },\r\n\r\n  loadJSONLevel: function(filepath, gw, callback) {\r\n\r\n    if (typeof(gw) == 'function' || !gw) {\r\n      callback = gw || callback || function() {};\r\n\r\n      gw = Gamelab.game_windows[0];\r\n    }\r\n\r\n    this.loadJSON(filepath, function(data) {\r\n\r\n      //localize .src up to three levels of recursion (.src must be altered to refer locally)\r\n\r\n      $.each(data.sprites, function(ix, xitem) {\r\n\r\n        if (typeof(xitem.src) == 'string') {\r\n\r\n          xitem.src = Gamelab.file_system.localizedSource(xitem.src);\r\n        }\r\n\r\n        __gamelabInstance.each(xitem, function(iy, yitem) {\r\n\r\n          if (yitem.src) {\r\n\r\n            yitem.src = Gamelab.file_system.localizedSource(yitem.src);\r\n\r\n          }\r\n\r\n          __gamelabInstance.each(yitem, function(iz, zitem) {\r\n\r\n            if (zitem.src) {\r\n              zitem.src = Gamelab.file_system.localizedSource(zitem.src);\r\n\r\n            }\r\n\r\n\r\n          });\r\n\r\n\r\n        });\r\n\r\n        xitem = new Gamelab.Sprite(xitem);\r\n\r\n        gw.add(xitem);\r\n        //sprite.image = sprite.selected_animation.image;\r\n\r\n\r\n        if (ix >= data.sprites.length - 1) {\r\n\r\n          //last sprite is loaded //WHY DOESN't this work?\r\n\r\n          callback(false, data);\r\n        }\r\n\r\n\r\n      });\r\n\r\n\r\n    });\r\n\r\n  }\r\n\r\n\r\n};\r\n\r\n\r\nGamelab.ready(function(lib) {\r\n\r\n  Gamelab.log('Gamelab: library is ready');\r\n\r\n});\r\n\r\n\r\n/* Screen */\r\n\r\nlet Screen = {\r\n\r\n  size: function() {\r\n    return new Gamelab.Vector(Gamelab.WIDTH, Gamelab.HEIGHT);\r\n  },\r\n\r\n  center: function() {\r\n    return new Gamelab.Vector(Gamelab.WIDTH / 2, Gamelab.HEIGHT / 2).round();\r\n  }\r\n\r\n};\r\n;\r\n/**************************\r\n  EventInterfaceMap: StringKeys:\r\n\r\n    * (must implement without option)\r\n    @ (may implement optional)\r\n*****************************/\r\n\r\n\r\nlet EventInterfaceMap = {  //className / must have named functions whyen carrying Symbol of className\r\n\r\n  Sprite: ['@onUpdate', '@onDestroy'],\r\n\r\n  Animation: ['@onRun', '@onComplete', '*onCollide'],\r\n\r\n  Motion: ['@onCommit', '@onComplete', '*onCollide'],\r\n\r\n  Shot: ['@onShoot', '*onCollide', '*onCollide'],\r\n\r\n  Terrain: ['@onCollide'],\r\n\r\n  Interactive: ['@onCollide'],\r\n\r\n  Global: ['@onUpdate'],\r\n\r\n  check: function(instance) {\r\n    for (var x in this) {\r\n      if (x == 'check')\r\n        continue;\r\n      else {\r\n        if (this[x] instanceof Array) {\r\n          this[x].forEach(function(f) {\r\n            var fkey = f.replace('@', '');\r\n            if (!instance.getOwnPropertyNames.indexOf(fkey) >= 0)\r\n              throw new Error('Object must implement function by name of:' + fkey);\r\n\r\n          });\r\n        }\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n/**************************\r\n  ObjectFeatureInterfaceMap:\r\n      Indicates classNames, and what they must carry as functions\r\n*****************************/\r\n\r\nlet ObjectFeatureMap = { //className / must have named function properties when carrying Symbol of className\r\n\r\n  Sprite: ['@spatial', '@data'],\r\n\r\n  SpriteBrush: ['@spatial', '@data'],\r\n\r\n  Elipse:['@spatial'],\r\n\r\n  Frame:['@spatial'],\r\n\r\n  Particle:['@spatial'],\r\n\r\n  Animation: ['@anchored', '@framedriven', '@effectdriven', '@data'],\r\n\r\n  Line2d:['@spatial', '@pointarrayflippable', '@selftransposable',  '@data'],\r\n\r\n  Text:['@spatial', '@text', '@colored'],\r\n\r\n};\r\n\r\nGamelab.ObjectFeatureMap = ObjectFeatureMap;\r\n\r\n\r\nlet InputIFM = {\r\n\r\n  GamepadButtons: ['@onButton'],\r\n\r\n  GamepadSticks: ['@onStick'],\r\n\r\n  Keyboard: ['@onKey'],\r\n\r\n  MouseMove: ['@onMouseMove'],\r\n\r\n  MouseButton: ['@onMouseButton'],\r\n\r\n  MouseWheel: ['@onMouseWheel'],\r\n\r\n  LeapMotion: ['@onLeapMotion']\r\n\r\n};\r\n\r\n\r\nlet UIEditables = {\r\n\r\n  Sprite: ['size', 'position', 'rotation'],\r\n\r\n  Animation: ['frameBounds', 'etc']\r\n\r\n};\r\n\r\n\r\nlet UIOption = function(name, hint, script) {\r\n  return {\r\n    name,\r\n    hint,\r\n    script\r\n  }\r\n};\r\n\r\nlet UIPrefab = {\r\n\r\n  MainSelect: {\r\n    Interactive: {\r\n\r\n      name: 'FourwayClasticRect',\r\n\r\n      hint: 'Object is collideable on four rectangular sides',\r\n\r\n      script: '#MY-SCRIPT-PATH'\r\n    }\r\n  },\r\n\r\n  FormEditables: {\r\n\r\n    Interactive: []\r\n  }\r\n};\r\n\r\n\r\n\r\nlet UIPrefabMainSelect = {\r\n\r\n  Background: ['Bound']\r\n\r\n};\r\n\r\n\r\nlet getCustomPrefabMeta = function() { //get name and file/data resources for each custom prefab\r\n\r\n};\r\n\r\n/**********************************\r\n\r\n  UIObjectSelectMap:\r\n\r\n    -Just the system default options\r\n\r\n*********************************/\r\n\r\nlet UIObjectPrefabs = {\r\n\r\n  Sprite: ['Side-Scroll-Player', 'Collider', 'Spaceship', 'Robot'],\r\n\r\n};\r\n;class Bone {\r\n\r\n  constructor(target={}, size) {\r\n\r\n    this.size = size || target.size;\r\n\r\n    if (typeof target == 'Object' && target.id)\r\n      this.target_id = target.id;\r\n\r\n    this.targetAnimation = target;\r\n\r\n    this.parentAnimation = {};\r\n\r\n    this.origin = target.origin || new Gamelab.Vector(0, 0, 0);\r\n\r\n    this.rotation = target.rotation || new Gamelab.Vector(0, 0, 0);\r\n\r\n    this.parentOffset = new Gamelab.Vector(0, 0, 0);\r\n\r\n    this.size = size;\r\n\r\n    //every frame of the target object gets same size::\r\n\r\n    if(target.Size)\r\n    {\r\n        target.Size(size.x, size.y, size.z);\r\n    }\r\n\r\n  }\r\n\r\n  Target(t){\r\n\r\n    this.targetAnimation = t;\r\n    return this;\r\n  }\r\n\r\n\r\n  Parent(p){\r\n\r\n      this.parentAnimation = p;\r\n      return this;\r\n    }\r\n\r\n  ParentOffset(x, y)\r\n  {\r\n    this.parentOffset = new Gamelab.Vector(x, y);\r\n    return this;\r\n  }\r\n\r\n  Origin(x, y, z){\r\n\r\n    this.origin = new Gamelab.Vector(x, y, z);\r\n    this.targetAnimation.Origin(x, y, z);\r\n    return this;\r\n  }\r\n\r\n  Size(x, y, z){\r\n\r\n    this.size = new Gamelab.Vector(x, y, z);\r\n    this.targetAnimation.Size(x, y, z);\r\n\r\n  }\r\n\r\n  Rotation(x, y, z)\r\n  {\r\n    this.rotation = new Gamelab.Vector(x, y, z);\r\n    this.targetAnimation.Rotation(this.rotation);\r\n    return this;\r\n  }\r\n\r\n  update(){\r\n\r\n          console.log('Bone.js :: onPosition, --setting');\r\n\r\n          var rotatedOffset = Gamelab.VectorMath.rotatePointsXY(this.parentOffset.x, this.parentOffset.y, this.parentAnimation.rotation.x),\r\n\r\n          fullPosition = this.parentAnimation.position.add(rotatedOffset);\r\n\r\n          this.targetAnimation.Position(fullPosition);\r\n\r\n  }\r\n\r\n}\r\n\r\n\r\nclass BoneState {\r\n\r\n  constructor(boneList) {\r\n\r\n    var states = [];\r\n\r\n    boneList.forEach(function(bone) {\r\n\r\n      states.push({\r\n        bone:bone,\r\n        offset: new Gamelab.Vector(),\r\n        rotation: new Gamelab.Vector(),\r\n        size: new Gamelab.Vector(),\r\n      });\r\n\r\n    });\r\n\r\n  }\r\n\r\n}\r\nGamelab.BoneState = BoneState;\r\nGamelab.Bone = Bone;\r\n;(function() {\r\n  console.log('Camera class... creating');\r\n\r\n  /**\r\n   * Creates a new Camera\r\n\r\n   * @param {number} x=0 position-x\r\n   * @param {number} y=0 position-y\r\n   * @param {number} z=0 position-z\r\n   * @returns {Camera}\r\n   */\r\n\r\n\r\n  class Camera {\r\n    constructor(x, y, z) {\r\n      if (isNaN(x)) {\r\n        x = 0;\r\n      }\r\n\r\n      if (isNaN(y)) {\r\n        y = 0;\r\n      }\r\n\r\n      if (isNaN(z)) {\r\n        z = 0;\r\n      }\r\n\r\n         /**\r\n          *\r\n          * @property {Vector} position the Vector position of Camera, having numeric x, y, and z values\r\n          * @memberof Camera\r\n          **********/\r\n\r\n\r\n      this.position = new Gamelab.Vector(x, y, z);\r\n    }\r\n\r\n  }\r\n\r\n  Gamelab.Camera = Camera;\r\n\r\n})();\r\n;\r\n//RGBAColor:: Color object\r\nclass RGBColor {\r\n  constructor(r = 0, g = 0, b = 0, a = 0) {\r\n    this.r = r;\r\n    this.g = g;\r\n    this.b = b;\r\n    this.a = a;\r\n  }\r\n\r\n  //Create color from string (rgba-string or hex-string to RGBAColor{})\r\n  fromString(str) {\r\n    if(str.indexOf('#') >= 0) //color-string is hex-color-string\r\n    {\r\n      str = Gamelab.ColorCalc.hexToRgba(str);\r\n    }\r\n\r\n    str = str.replace(/^\\s*#|\\s*$/g, '');\r\n    str = str.toLowerCase();\r\n    if (ColorStrings[str]) str = ColorStrings[str];\r\n\r\n    var match;\r\n    // RGB(A)\r\n    if ((match = str.match(/\\d+/g))) {\r\n\r\n      return new Gamelab.RGBColor(\r\n        parseInt(match[0], 10),\r\n        parseInt(match[1], 10),\r\n        parseInt(match[2], 10),\r\n        1.0\r\n      );\r\n    }\r\n  }\r\n\r\n  //Create color from pixel-data\r\n  fromData(data) {\r\n    return new Gamelab.RGBColor(\r\n      parseInt(data[0], 10),\r\n      parseInt(data[1], 10),\r\n      parseInt(data[2], 10),\r\n      1.0\r\n    );\r\n\r\n  }\r\n\r\n  //Distance between two colors (a 3d distance fxn)\r\n  distance(color) {\r\n    var sumOfSquares = 0;\r\n    sumOfSquares += Math.pow(this.r - color.r, 2);\r\n    sumOfSquares += Math.pow(this.g - color.g, 2);\r\n    sumOfSquares += Math.pow(this.b - color.b, 2);\r\n    return Math.sqrt(sumOfSquares);\r\n  }\r\n\r\n  //Fuzzy Match with tolerance for distance\r\n  match_by_tolerance(color, tolerance) {\r\n\r\n    var matches = {\r\n      r: color.r,\r\n      g: color.g,\r\n      b: color.b\r\n    };\r\n\r\n    var total_diff = 0;\r\n\r\n    for (var x in matches) {\r\n      var diff = Math.abs(color[x] - this[x]);\r\n\r\n      console.log('COLOR-DIFF: --1::' + jstr(this) + ':: --2::' + jstr(color));\r\n\r\n      total_diff += diff;\r\n    }\r\n\r\n    return total_diff <= tolerance;\r\n\r\n  }\r\n\r\n};\r\n\r\n\r\nGamelab.RGBColor = RGBColor;\r\n\r\n//Color calculations::\r\nGamelab.ColorCalculator = {\r\n\r\n  hexToRgbArray(hex) {\r\n  var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n  return result ? [\r\n    parseInt(result[1], 16),\r\n    parseInt(result[2], 16),\r\n    parseInt(result[3], 16)\r\n  ] : null;\r\n  },\r\n\r\n  rgbFromString: function(rgba_string) {\r\n    return new Gamelab.RGBColor(rgba_string);\r\n  },\r\n\r\n  hexToRgba: function(hex) {\r\n    var c;\r\n    if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {\r\n      c = hex.substring(1).split('');\r\n      if (c.length == 3) {\r\n        c = [c[0], c[0], c[1], c[1], c[2], c[2]];\r\n      }\r\n      c = '0x' + c.join('');\r\n      return 'rgba(' + [(c >> 16) & 255, (c >> 8) & 255, c & 255].join(',') + ',1)';\r\n    }\r\n    throw new Error('Bad Hex');\r\n  },\r\n\r\n  scaledRGBAFromHex:function(hexcolor_a, hexcolor_b, scalePoint){\r\n\r\n    //get the point between color_a and color_b using value of 0-1 ::\r\n    //scalePoint of 0 = color_a as rgba & scalePoint of 1.0 will return color_b as rgba\r\n\r\n    var rgba_a = this.hexToRgbArray(hexcolor_a),\r\n    rgba_b = this.hexToRgbArray(hexcolor_b);\r\n\r\n\r\n    var finalRgba={\r\n      0:rgba_a[0] + ((rgba_a[0] - rgba_b[0]) * scalePoint * -1.0),\r\n      1:rgba_a[1] + ((rgba_a[1] - rgba_b[1]) * scalePoint * -1.0),\r\n      2:rgba_a[2] + ((rgba_a[2] - rgba_b[2]) * scalePoint * -1.0),\r\n      3:1.0\r\n    };\r\n\r\n    //first 3 values are rounded / whole number\r\n    [0, 1, 2].forEach(function(x){\r\n      if(finalRgba[x] >= 255)\r\n      {\r\n        finalRgba[x] = 255\r\n      }\r\n      finalRgba[x] = Math.round(finalRgba[x]);\r\n    });\r\n\r\n    return \"rgba(\"+ finalRgba[0] +  \",\" + finalRgba[1] + \",\" + finalRgba[2] + \", 1.0)\" ;\r\n  }\r\n\r\n};\r\n\r\n//Css Colors by name::\r\nvar ColorStrings = {\r\n  aliceblue: 'rgb(240, 248, 255)',\r\n  antiquewhite: 'rgb(250, 235, 215)',\r\n  aqua: 'rgb(0, 255, 255)',\r\n  aquamarine: 'rgb(127, 255, 212)',\r\n  azure: 'rgb(240, 255, 255)',\r\n  beige: 'rgb(245, 245, 220)',\r\n  bisque: 'rgb(255, 228, 196)',\r\n  black: 'rgb(0, 0, 0)',\r\n  blanchedalmond: 'rgb(255, 235, 205)',\r\n  blue: 'rgb(0, 0, 255)',\r\n  blueviolet: 'rgb(138, 43, 226)',\r\n  brown: 'rgb(165, 42, 42)',\r\n  burlywood: 'rgb(222, 184, 135)',\r\n  cadetblue: 'rgb(95, 158, 160)',\r\n  chartreuse: 'rgb(127, 255, 0)',\r\n  chocolate: 'rgb(210, 105, 30)',\r\n  coral: 'rgb(255, 127, 80)',\r\n  cornflowerblue: 'rgb(100, 149, 237)',\r\n  cornsilk: 'rgb(255, 248, 220)',\r\n  crimson: 'rgb(220, 20, 60)',\r\n  cyan: 'rgb(0, 255, 255)',\r\n  darkblue: 'rgb(0, 0, 139)',\r\n  darkcyan: 'rgb(0, 139, 139)',\r\n  darkgoldenrod: 'rgb(184, 134, 11)',\r\n  darkgray: 'rgb(169, 169, 169)',\r\n  darkgreen: 'rgb(0, 100, 0)',\r\n  darkgrey: 'rgb(169, 169, 169)',\r\n  darkkhaki: 'rgb(189, 183, 107)',\r\n  darkmagenta: 'rgb(139, 0, 139)',\r\n  darkolivegreen: 'rgb(85, 107, 47)',\r\n  darkorange: 'rgb(255, 140, 0)',\r\n  darkorchid: 'rgb(153, 50, 204)',\r\n  darkred: 'rgb(139, 0, 0)',\r\n  darksalmon: 'rgb(233, 150, 122)',\r\n  darkseagreen: 'rgb(143, 188, 143)',\r\n  darkslateblue: 'rgb(72, 61, 139)',\r\n  darkslategray: 'rgb(47, 79, 79)',\r\n  darkslategrey: 'rgb(47, 79, 79)',\r\n  darkturquoise: 'rgb(0, 206, 209)',\r\n  darkviolet: 'rgb(148, 0, 211)',\r\n  deeppink: 'rgb(255, 20, 147)',\r\n  deepskyblue: 'rgb(0, 191, 255)',\r\n  dimgray: 'rgb(105, 105, 105)',\r\n  dimgrey: 'rgb(105, 105, 105)',\r\n  dodgerblue: 'rgb(30, 144, 255)',\r\n  firebrick: 'rgb(178, 34, 34)',\r\n  floralwhite: 'rgb(255, 250, 240)',\r\n  forestgreen: 'rgb(34, 139, 34)',\r\n  fuchsia: 'rgb(255, 0, 255)',\r\n  gainsboro: 'rgb(220, 220, 220)',\r\n  ghostwhite: 'rgb(248, 248, 255)',\r\n  gold: 'rgb(255, 215, 0)',\r\n  goldenrod: 'rgb(218, 165, 32)',\r\n  gray: 'rgb(128, 128, 128)',\r\n  green: 'rgb(0, 128, 0)',\r\n  greenyellow: 'rgb(173, 255, 47)',\r\n  grey: 'rgb(128, 128, 128)',\r\n  honeydew: 'rgb(240, 255, 240)',\r\n  hotpink: 'rgb(255, 105, 180)',\r\n  indianred: 'rgb(205, 92, 92)',\r\n  indigo: 'rgb(75, 0, 130)',\r\n  ivory: 'rgb(255, 255, 240)',\r\n  khaki: 'rgb(240, 230, 140)',\r\n  lavender: 'rgb(230, 230, 250)',\r\n  lavenderblush: 'rgb(255, 240, 245)',\r\n  lawngreen: 'rgb(124, 252, 0)',\r\n  lemonchiffon: 'rgb(255, 250, 205)',\r\n  lightblue: 'rgb(173, 216, 230)',\r\n  lightcoral: 'rgb(240, 128, 128)',\r\n  lightcyan: 'rgb(224, 255, 255)',\r\n  lightgoldenrodyellow: 'rgb(250, 250, 210)',\r\n  lightgray: 'rgb(211, 211, 211)',\r\n  lightgreen: 'rgb(144, 238, 144)',\r\n  lightgrey: 'rgb(211, 211, 211)',\r\n  lightpink: 'rgb(255, 182, 193)',\r\n  lightsalmon: 'rgb(255, 160, 122)',\r\n  lightseagreen: 'rgb(32, 178, 170)',\r\n  lightskyblue: 'rgb(135, 206, 250)',\r\n  lightslategray: 'rgb(119, 136, 153)',\r\n  lightslategrey: 'rgb(119, 136, 153)',\r\n  lightsteelblue: 'rgb(176, 196, 222)',\r\n  lightyellow: 'rgb(255, 255, 224)',\r\n  lime: 'rgb(0, 255, 0)',\r\n  limegreen: 'rgb(50, 205, 50)',\r\n  linen: 'rgb(250, 240, 230)',\r\n  magenta: 'rgb(255, 0, 255)',\r\n  maroon: 'rgb(128, 0, 0)',\r\n  mediumaquamarine: 'rgb(102, 205, 170)',\r\n  mediumblue: 'rgb(0, 0, 205)',\r\n  mediumorchid: 'rgb(186, 85, 211)',\r\n  mediumpurple: 'rgb(147, 112, 219)',\r\n  mediumseagreen: 'rgb(60, 179, 113)',\r\n  mediumslateblue: 'rgb(123, 104, 238)',\r\n  mediumspringgreen: 'rgb(0, 250, 154)',\r\n  mediumturquoise: 'rgb(72, 209, 204)',\r\n  mediumvioletred: 'rgb(199, 21, 133)',\r\n  midnightblue: 'rgb(25, 25, 112)',\r\n  mintcream: 'rgb(245, 255, 250)',\r\n  mistyrose: 'rgb(255, 228, 225)',\r\n  moccasin: 'rgb(255, 228, 181)',\r\n  navajowhite: 'rgb(255, 222, 173)',\r\n  navy: 'rgb(0, 0, 128)',\r\n  oldlace: 'rgb(253, 245, 230)',\r\n  olive: 'rgb(128, 128, 0)',\r\n  olivedrab: 'rgb(107, 142, 35)',\r\n  orange: 'rgb(255, 165, 0)',\r\n  orangered: 'rgb(255, 69, 0)',\r\n  orchid: 'rgb(218, 112, 214)',\r\n  palegoldenrod: 'rgb(238, 232, 170)',\r\n  palegreen: 'rgb(152, 251, 152)',\r\n  paleturquoise: 'rgb(175, 238, 238)',\r\n  palevioletred: 'rgb(219, 112, 147)',\r\n  papayawhip: 'rgb(255, 239, 213)',\r\n  peachpuff: 'rgb(255, 218, 185)',\r\n  peru: 'rgb(205, 133, 63)',\r\n  pink: 'rgb(255, 192, 203)',\r\n  plum: 'rgb(221, 160, 221)',\r\n  powderblue: 'rgb(176, 224, 230)',\r\n  purple: 'rgb(128, 0, 128)',\r\n  red: 'rgb(255, 0, 0)',\r\n  rosybrown: 'rgb(188, 143, 143)',\r\n  royalblue: 'rgb(65, 105, 225)',\r\n  saddlebrown: 'rgb(139, 69, 19)',\r\n  salmon: 'rgb(250, 128, 114)',\r\n  sandybrown: 'rgb(244, 164, 96)',\r\n  seagreen: 'rgb(46, 139, 87)',\r\n  seashell: 'rgb(255, 245, 238)',\r\n  sienna: 'rgb(160, 82, 45)',\r\n  silver: 'rgb(192, 192, 192)',\r\n  skyblue: 'rgb(135, 206, 235)',\r\n  slateblue: 'rgb(106, 90, 205)',\r\n  slategray: 'rgb(112, 128, 144)',\r\n  slategrey: 'rgb(112, 128, 144)',\r\n  snow: 'rgb(255, 250, 250)',\r\n  springgreen: 'rgb(0, 255, 127)',\r\n  steelblue: 'rgb(70, 130, 180)',\r\n  tan: 'rgb(210, 180, 140)',\r\n  teal: 'rgb(0, 128, 128)',\r\n  thistle: 'rgb(216, 191, 216)',\r\n  tomato: 'rgb(255, 99, 71)',\r\n  turquoise: 'rgb(64, 224, 208)',\r\n  violet: 'rgb(238, 130, 238)',\r\n  wheat: 'rgb(245, 222, 179)',\r\n  white: 'rgb(255, 255, 255)',\r\n  whitesmoke: 'rgb(245, 245, 245)',\r\n  yellow: 'rgb(255, 255, 0)',\r\n  yellowgreen: 'rgb(154, 205, 50)',\r\n\r\n\r\n  //special map Colors\r\n  map_orange: 'rgb(255, 106, 0)',\r\n  map_green: 'rgb(76, 255, 0)',\r\n  map_red: 'rgb(255, 0, 0)',\r\n  map_blue: 'rgb(0, 38, 255)',\r\n  map_darkgreen: 'rgb(38, 127, 0)',\r\n  map_yellow: 'rgb(255, 216, 0)',\r\n  map_aqua: 'rgb(0, 255, 255)',\r\n  map_grey: 'rgb(128, 128, 128)',\r\n  map_gray: 'rgb(128, 128, 128)',\r\n  map_darkgrey: 'rgb(64, 64, 64)',\r\n  map_darkgray: 'rgb(64, 64, 64)',\r\n  map_black: 'rgb(0, 0, 0)',\r\n};\r\n\r\nvar RE_RGB = /^rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/;\r\n\r\nGamelab.Colors = {};\r\n\r\nfor (var x in ColorStrings) {\r\n  if (ColorStrings.hasOwnProperty(x)) {\r\n    Gamelab.Colors[x] = new Gamelab.RGBColor().fromString(x);\r\n  }\r\n}\r\n;\n(function(){\n    console.log('Line() class... creating');\n\n    var Curves = { //ALL HAVE INPUT AND OUTPUT OF: 0-1.0\n    // no easing, no acceleration\n    linearNone: function (t) { return t },\n\n    // accelerating from zero velocity\n    easeInQuadratic: function (t) { return t*t },\n    // decelerating to zero velocity\n    easeOutQuadratic: function (t) { return t*(2-t) },\n    // acceleration until halfway, then deceleration\n    easeInOutQuadratic: function (t) { return t<.5 ? 2*t*t : -1+(4-2*t)*t },\n    // accelerating from zero velocity\n    easeInCubic: function (t) { return t*t*t },\n    // decelerating to zero velocity\n    easeOutCubic: function (t) { return (--t)*t*t+1 },\n    // acceleration until halfway, then deceleration\n    easeInOutCubic: function (t) { return t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1 },\n    // accelerating from zero velocity\n    easeInQuartic: function (t) { return t*t*t*t },\n    // decelerating to zero velocity\n    easeOutQuartic: function (t) { return 1-(--t)*t*t*t },\n    // acceleration until halfway, then deceleration\n    easeInOutQuartic: function (t) { return t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t },\n    // accelerating from zero velocity\n    easeInQuintic: function (t) { return t*t*t*t*t },\n    // decelerating to zero velocity\n    easeOutQuintic: function (t) { return 1+(--t)*t*t*t*t },\n    // acceleration until halfway, then deceleration\n    easeInOutQuintic: function (t) { return t<.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t }\n}\n\nGamelab.Curves = Curves;\n\nvar inOutCurves = {\n\n    quadratic: function (t) { return t<.5 ? 2*t*t : -1+(4-2*t)*t },\n\n    cubic: function (t) { return t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1 },\n\n    quartic: function (t) { return t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t },\n\n    quintic: function (t) { return t<.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t },\n\n    linear: function (t) { return t; } //provided for consistency / in case 'linear' is needed\n\n    };\n\n\nGamelab.Curves.Smooth = inOutCurves;\nGamelab.Curves.InOut = inOutCurves;\n\n\n})();\n;\nclass Game\n{\n    constructor(srcFile)\n    {\n\n    }\n}\n\nGamelab.Game = Game;\n\n;\r\nclass Gamelab {\r\n\r\n  constructor(){\r\n  }\r\n\r\n  load(uri, callback){\r\n\r\n    var __object = this;\r\n\r\n    callback = callback || function(){};\r\n\r\n    callback.bind(this);\r\n\r\n    var script = document.createElement('SCRIPT');\r\n    script.src = uri;\r\n\r\n    //define onload fxn\r\n    script.onload = function(){\r\n      var construct = function()\r\n      {\r\n        this.load = load;\r\n        this.update = update;\r\n      };\r\n\r\n      callback(construct);\r\n    };\r\n\r\n    //append to the document\r\n    document.head.appendChild(script);\r\n  }\r\n\r\n};\r\n\r\nGamelab.Gamelab = Gamelab;\r\n;\r\n  /**\r\n   * Creates a new GameWindow\r\n   * <iframe style='width:400px; height:450px; overflow:hidden;' src='../client/examples/js-class/GameWindow.html'> </iframe>\r\n   * @param   {Object} canvas the canvas element for this gameWindow. --GameWindow's if not supplied, the constructor will create a full-screen canvas, if a canvas.\r\n    * @param   {Array} drawables=[] a list of drawable objects to be drawn. --Drawables can also be added after constructor call.\r\n   * @returns {GameWindow} a Gamelab.GameWindow object\r\n   * */\r\n\r\n  class GameWindow {\r\n    constructor(canvas = false, drawables = []) {\r\n\r\n            /**\r\n             * list of all drawables in the window.\r\n             *\r\n             * @property this.drawables\r\n             * @memberof GameWindow\r\n             **********/\r\n\r\n      this.drawables = drawables;\r\n\r\n      this.bool_events = Gamelab.bool_events || [];\r\n\r\n      this.settings = {};\r\n\r\n            /**\r\n             * the html-canvas of the GameWindow.\r\n             *\r\n             * @property this.canvas\r\n             * @memberof GameWindow\r\n             **********/\r\n\r\n      this.canvas = canvas || false;\r\n\r\n      this.engaged = true;\r\n\r\n      if (!canvas) {\r\n        console.info('GameWindow() had no {canvas:canvas} argument. Creating a new canvas in document.body...');\r\n        this.canvas = document.createElement('CANVAS');\r\n        this.canvas.setAttribute('class', 'gamewindow');\r\n        document.body.append(this.canvas);\r\n      }\r\n\r\n      this.context = this.canvas.getContext('2d');\r\n\r\n      document.body.style.position = \"absolute\";\r\n\r\n      document.body.style.width = \"100%\";\r\n\r\n      document.body.style.height = \"100%\";\r\n\r\n      /**\r\n       * the camera of the GameWindow. --An instance of Gamelab.Camera\r\n       *\r\n       * @property this.camera\r\n       * @memberof GameWindow\r\n       **********/\r\n\r\n\r\n      this.camera = new Gamelab.Camera();\r\n\r\n      this.camera.target = false;\r\n\r\n      Gamelab.camera = this.camera;\r\n\r\n      var __inst = this;\r\n\r\n      this.Size();\r\n\r\n      this.update_ext = [];\r\n\r\n      window.onresize = function() {\r\n\r\n        if (__inst.isAbsoluteSize)\r\n          return;\r\n\r\n        __inst.Size();\r\n\r\n      };\r\n\r\n      this.ctx = this.canvas.getContext('2d');\r\n\r\n      Gamelab.game_windows.push(this);\r\n\r\n\r\n      window.onerror = function(){\r\n\r\n        Gamelab.errors += 1;\r\n\r\n        console.log('Canvas Error --');\r\n\r\n        if (Gamelab.errors > Gamelab.settings.errorLimit) {\r\n          Gamelab.stopDraw = true;\r\n\r\n        var call = call ||  window.setTimeout(function(){\r\n\r\n          if(call)\r\n          {\r\n            window.clearTimeout(call);\r\n          }\r\n            console.log('%cDraw stopped at errorLimit:' + Gamelab.settings.errorLimit, 'color:darkorange;');\r\n\r\n          }, 200);\r\n\r\n        }\r\n\r\n      }\r\n\r\n    }\r\n\r\n\r\n\r\n      /**\r\n       * returns the gameWindow.canvas property, an HTMLCanvasElement\r\n       *\r\n       * @function\r\n       * @memberof GameWindow\r\n       **********/\r\n\r\n    getCanvas(){\r\n      return this.canvas;\r\n    }\r\n\r\n\r\n      /**\r\n       * returns a vector(x, y) showing the center of the GameWindow\r\n       *\r\n       * @function\r\n       * @memberof GameWindow\r\n       **********/\r\n\r\n\r\n    center() {\r\n\r\n      return new Gamelab.Vector(Math.round(this.canvas.width / 2), Math.round(this.canvas.height / 2));\r\n\r\n    }\r\n\r\n\r\n    TrackStat(){\r\n\r\n      this.__trackStat = true;\r\n      return this;\r\n    }\r\n\r\n\r\n    GridUnit(x, y, w, h, srcImage_Path){\r\n\r\n      var size = new Gamelab.Vector(w, h),\r\n      position = new Gamelab.Vector(x, y);\r\n\r\n      var sprite;\r\n\r\n      if(srcImage_Path)\r\n      {\r\n        sprite = new Gamelab.Sprite(srcImage_Path);\r\n        sprite.Size(size);\r\n        sprite.Pos(position);\r\n\r\n        Gamelab.game_windows[0].add(sprite);\r\n      }\r\n\r\n      return {\r\n        size:size,\r\n        position:position\r\n      };\r\n    }\r\n\r\n\r\n    onMouseMove(callback){\r\n\r\n      var canvas = this.canvas;\r\n\r\n      this.canvas.addEventListener('mousemove',  function(evt){\r\n\r\n        var x = evt.clientX, y = evt.clientY;\r\n\r\n        const rect = canvas.getBoundingClientRect();\r\n\r\n        x -= rect.left;\r\n        y -= rect.top;\r\n\r\n        callback(x, y);\r\n\r\n      });\r\n    }\r\n\r\n\r\n\r\n\r\n    onMouseClick(callback){\r\n\r\n      var canvas = this.canvas;\r\n\r\n\r\n      this.canvas.addEventListener('click',  function(evt){\r\n\r\n        var x = evt.clientX, y = evt.clientY;\r\n\r\n        const rect = canvas.getBoundingClientRect();\r\n\r\n        x -= rect.left;\r\n        y -= rect.top;\r\n\r\n        callback(x, y);\r\n\r\n      });\r\n\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * creates an array of gridUnits\r\n     *\r\n     * @function\r\n     * @memberof GameWindow\r\n     **********/\r\n\r\n     GridStyle(total_x, total_y, w, h, srcImage_Path)\r\n     {\r\n\r\n       if(!(this.grid instanceof Array))\r\n       {\r\n         this.grid = [];\r\n       }\r\n\r\n       function GridUnit(x, y, w, h, srcImage_Path){\r\n\r\n         var size = new Gamelab.Vector(w, h),\r\n         position = new Gamelab.Vector(x, y);\r\n\r\n         var sprite;\r\n\r\n         if(srcImage_Path)\r\n         {\r\n           sprite = new Gamelab.Sprite(srcImage_Path);\r\n           sprite.Size(size);\r\n           sprite.Pos(position);\r\n\r\n           Gamelab.game_windows[0].add(sprite);\r\n         }\r\n\r\n         return {\r\n           size:size,\r\n           position:position\r\n         };\r\n       };\r\n\r\n       for(var y = 0; y < total_y; y++)\r\n       {\r\n\r\n         for(var x = 0; x < total_x; x++)\r\n         {\r\n\r\n           this.grid.push(new GridUnit(x * w, y * h, w, h, srcImage_Path));\r\n\r\n         }\r\n\r\n       }\r\n       return this;\r\n     }\r\n\r\n  getCanvas(){\r\n    return this.canvas;\r\n  }\r\n\r\n    /**\r\n     * adds an update to the GameWindow:: update to be called every 20 milliseconds\r\n     *\r\n     * @function\r\n     * @memberof GameWindow\r\n     **********/\r\n\r\n\r\n    onUpdate(f) {\r\n\r\n      this.update_ext.push(f);\r\n\r\n    }\r\n\r\n        /**\r\n         * the main update for the GameWindow:: called automatically after call of GameWindow.start() or GameWindow.animate()\r\n         *\r\n         * @function\r\n         * @memberof GameWindow\r\n         **********/\r\n\r\n    update() {\r\n\r\n\r\n      Gamelab.each(this.drawables, function(ix, item) {\r\n\r\n        if (item && typeof(item.def_update) == 'function') {\r\n\r\n          item.def_update(item);\r\n\r\n        }\r\n\r\n        if (item && typeof(item.update) == 'function') {\r\n          item.update(item);\r\n\r\n        }\r\n\r\n                if (item && ['SpriteArray', 'RobotixArray', 'RobotixVerticalChain'].indexOf(item.constructor.name) >= 0  &&\r\n                   typeof item.each  == 'function') {\r\n\r\n                  item.each(function(ix, graphic){\r\n\r\n                    graphic.update(graphic);\r\n\r\n                  });\r\n\r\n                }\r\n\r\n      });\r\n\r\n      Gamelab.each(this.bool_events, function(ix, item) {\r\n\r\n        if (item && item.bool()) {\r\n          item.callback();\r\n        }\r\n\r\n      });\r\n\r\n\r\n      for (var x in this.update_ext) {\r\n        this.update_ext[x]();\r\n      }\r\n    }\r\n\r\n    reset_draw(){\r\n      this.before_draw_ext = function(){};\r\n    }\r\n\r\n    disengage(){\r\n      this.drawables = [];\r\n      this.engaged = false;\r\n      this.reset_draw();\r\n    }\r\n\r\n    engage(){\r\n      this.engaged = true;\r\n    }\r\n\r\n    draw() {\r\n\r\n      var __gameWindow = this;\r\n\r\n      if (this.before_draw_ext) {\r\n        this.before_draw_ext();\r\n      }\r\n\r\n      Gamelab.each(this.drawables, function(ix, item) {\r\n\r\n        if(typeof item.draw == 'function')\r\n        {\r\n          item.draw(__gameWindow.ctx, __gameWindow.camera);\r\n        }\r\n\r\n      });\r\n\r\n\r\n      if (this.after_draw_ext) {\r\n        this.after_draw_ext();\r\n      }\r\n\r\n    }\r\n\r\n\r\n        /**\r\n         * adds a call before the GameWindow draw()\r\n         *\r\n         * @function\r\n         * @memberof GameWindow\r\n         **********/\r\n\r\n    onBeforeDraw(f) {\r\n\r\n      var boundCall = f.bind(this);\r\n\r\n      if(!this.before_draw_ext)\r\n      this.before_draw_ext = function(){};\r\n\r\n      var beforeDraw = this.before_draw_ext.bind(this);\r\n\r\n      this.before_draw_ext = function() {\r\n        beforeDraw();\r\n        boundCall();\r\n      };\r\n\r\n    }\r\n\r\n    /**\r\n     * adds a call after the GameWindow draw()\r\n     *\r\n     * @function\r\n     * @memberof GameWindow\r\n     **********/\r\n\r\n\r\n    onAfterDraw(f) {\r\n\r\n      var boundCall = f.bind(this);\r\n\r\n      if(!this.after_draw_ext)\r\n      this.after_draw_ext = function(){};\r\n\r\n\r\n      var afterDraw = this.after_draw_ext.bind(this);\r\n\r\n      this.after_draw_ext = function() {\r\n        afterDraw();\r\n        boundCall();\r\n      };\r\n\r\n    }\r\n\r\n    /**\r\n     * sets the size of the GameWindow\r\n     *\r\n     * @function\r\n     * @param {integer} w the width of the GameWindow\r\n     * @param {integer} h the HEIGHT of the GameWindow\r\n     * @memberof GameWindow\r\n     **********/\r\n\r\n    Size(w, h, isAbsoluteSize) { //call with no args to fill to browser-window-size;\r\n\r\n      w = w || this.canvas.parentNode.clientWidth;\r\n\r\n      h = h || this.canvas.parentNode.clientHeight;\r\n\r\n      var c = this.canvas;\r\n\r\n      if (c) {\r\n        c.setAttribute('width', w)\r\n      };\r\n\r\n      if (c) {\r\n        c.setAttribute('height', h)\r\n      };\r\n\r\n      Gamelab.WIDTH = w;\r\n\r\n      Gamelab.HEIGHT = h;\r\n\r\n      this.canvas.width = w;\r\n\r\n      this.canvas.height = h;\r\n\r\n      this.size = new Gamelab.Vector(w, h);\r\n\r\n      this.isAbsoluteSize = isAbsoluteSize || false;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    /**\r\n     * adds an object to the GameWindow\r\n     *\r\n     * @function\r\n     * @param {Object} obj the object to be added (Sprite)\r\n     * @param {Boolean} onBottom if true, adds to the bottom of layer-stack in GameWindow\r\n     * @memberof GameWindow\r\n     **********/\r\n\r\n    add(obj, options={}) {\r\n\r\n      var optionsGuide = {\r\n        obj:'The Object{} being added into play',\r\n        options:{\r\n          position:'The Vector(x, y) offset to use when drawing the obj'\r\n        }\r\n      };\r\n\r\n      //console.info('GameWindow.add() --2nd argument options is object of arguments >>>', optionsGuide);\r\n\r\n      var layer = options.layer || this.drawables.length - 1;\r\n\r\n      if(!(typeof layer == 'number' && layer >= 0))\r\n      layer = this.drawables.length;\r\n\r\n      var offset = new Gamelab.Vector(0, 0);\r\n\r\n      if(options.position)\r\n      offset = options.position;\r\n\r\n      obj.window_offset = offset;\r\n\r\n      //1: if Sprite(), Add object to the existing __gameWindow\r\n\r\n      var __inst = this;\r\n\r\n      if (obj instanceof Gamelab.Camera) {\r\n\r\n        this.camera = obj;\r\n\r\n      } else if (obj instanceof Gamelab.GSEvent) {\r\n\r\n        if (Gamelab.__running) {\r\n\r\n          return console.error('Events can only be added before Gamstack.animate() is called::aka before the main update / loop begins');\r\n        } else {\r\n\r\n          obj.apply();\r\n\r\n        }\r\n      } else {\r\n\r\n        this.drawables.splice(layer, 0, obj);\r\n\r\n      };\r\n\r\n      return obj;\r\n\r\n    }\r\n\r\n    /**\r\n     * set background-color of GameWindow\r\n     *\r\n     * @function\r\n     * @param {string} c the new background-color for GameWindow\r\n     * @memberof GameWindow\r\n     **********/\r\n\r\n    Background(c) {\r\n      this.canvas.style.background = c;\r\n\r\n      this.canvas.style.backgroundColor = c;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    /**\r\n     * removes an object from the GameWindow\r\n     *\r\n     * @function\r\n     * @param {Object} obj the object to be removed (Sprite)\r\n     * @memberof GameWindow\r\n     **********/\r\n\r\n    remove(obj) {\r\n\r\n      var ix = this.drawables.indexOf(obj);\r\n\r\n      if (ix >= 0) {\r\n        this.drawables.splice(ix, 1);\r\n      }\r\n    }\r\n\r\n\r\n    removeDeadObjects() {\r\n\r\n      var $window = this;\r\n\r\n      this.drawables.forEach(function(sprite){\r\n\r\n        if(sprite.life <= 0)\r\n        {\r\n          $window.remove(sprite);\r\n        }\r\n\r\n      });\r\n\r\n    }\r\n\r\n    /**\r\n     * begins the animation-loop of GameWindow.\r\n     *\r\n     * @function\r\n     * @param {number} time optional time parameter for usage with Tween\r\n     * @memberof GameWindow\r\n     **********/\r\n\r\n\r\n    animate(time) {\r\n\r\n      if(!this.engaged)\r\n      return false;\r\n\r\n      var __inst = this;\r\n\r\n      requestAnimationFrame(function() {\r\n\r\n        __inst.animate();\r\n\r\n      });\r\n\r\n\r\n      if (this.__stats) {\r\n        this.__stats.begin();\r\n        this.__statsMS.begin();\r\n        this.__statsMB.update();\r\n      }\r\n\r\n      Gamelab.isAtPlay = true;\r\n\r\n      if (window.TWEEN)\r\n        TWEEN.update(time);\r\n\r\n      __inst.update();\r\n\r\n      if(this.settings.hasOwnProperty('autoClear') && this.settings.autoClear == false)\r\n      {\r\n\r\n      }\r\n      else{\r\n          this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n      }\r\n\r\n\r\n      this.draw();\r\n\r\n      if (this.__stats) {\r\n       this.__stats.end();\r\n      this.__statsMS.end();\r\n      }\r\n\r\n    }\r\n\r\n    /**\r\n     * begins the animation-loop of GameWindow, with performance Stats shown on-screen\r\n     *\r\n     * @function\r\n     * @memberof GameWindow\r\n     **********/\r\n\r\n\r\n    start() {\r\n\r\n      if (typeof(Stats) == 'function') //Stats library exists\r\n      {\r\n        //basic stat animation\r\n        this.__stats = new Stats();\r\n        this.__stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom\r\n\r\n        this.__stats.dom.style.left = '10%';\r\n\r\n        this.__stats.dom.setAttribute('class', 'stat');\r\n\r\n        this.canvas.parentNode.appendChild(this.__stats.dom);\r\n\r\n        //basic stat animation\r\n        this.__statsMS = new Stats();\r\n        this.__statsMS.showPanel(1); // 0: fps, 1: ms, 2: mb, 3+: custom\r\n\r\n        this.__statsMS.dom.style.left = '10%';\r\n\r\n        this.__statsMS.dom.style.marginLeft = '90px';\r\n\r\n        this.__statsMS.dom.setAttribute('class', 'stat');\r\n\r\n        this.canvas.parentNode.appendChild(this.__statsMS.dom);\r\n\r\n        //basic stat animation\r\n        this.__statsMB = new Stats();\r\n        this.__statsMB.showPanel(2); // 0: fps, 1: ms, 2: mb, 3+: custom\r\n\r\n        this.__statsMB.dom.style.left = '10%';\r\n\r\n        this.__statsMB.dom.setAttribute('class', 'stat');\r\n\r\n        this.__statsMB.dom.style.marginLeft = '180px';\r\n\r\n        this.canvas.parentNode.appendChild(this.__statsMB.dom);\r\n      }\r\n\r\n      this.animate();\r\n    }\r\n  }\r\n\r\n  Gamelab.GameWindow = GameWindow;\r\n;\r\n  /**\r\n   * Creates a new Module\r\n   * @param   {string} uri the uri that the .js file is located at\r\n    * @param   {Function} callback=function(){} The callback to call after the module is loaded\r\n   * @returns {Module} a Gamelab.Module object\r\n   * */\r\n\r\nconsole.info('Module class :: keep as public');\r\n\r\nclass Module{\r\n\r\n  constructor(uri, callback){\r\n\r\n    if(uri)\r\n    this.load(uri, callback);\r\n\r\n  }\r\n\r\n  load(uri, callback){\r\n\r\n    var __object = this;\r\n\r\n    callback = callback || function(){};\r\n\r\n    callback = callback.bind(this);\r\n\r\n    var script = document.createElement('SCRIPT');\r\n    script.src = uri;\r\n\r\n    //define onload fxn\r\n    script.onload = function(){\r\n\r\n      window.module = window.module || {};\r\n\r\n      var construct = window.module.exports;\r\n      callback(construct);\r\n\r\n    };\r\n\r\n    //append to the document\r\n    document.head.appendChild(script);\r\n\r\n  }\r\n\r\n};\r\n\r\nGamelab.Module = Module;\r\n;\r\n(function(){\r\n\r\n\r\n  class OffscreenCanvasGS {\r\n\r\n    constructor(canvas, x, y){\r\n      this.canvas = canvas;\r\n      this.x = x;\r\n      this.y = y;\r\n\r\n      this.ctx = this.canvas.getContext('2d');\r\n    }\r\n    draw(ctx)\r\n    {\r\n      ctx.draw(this.canvas, this.x, this.y);\r\n    }\r\n\r\n  }\r\n\r\n  Gamelab.OffscreenCanvas = OffscreenCanvasGS;\r\n\r\n\r\n})();\r\n;//expected properties:\r\n/*\r\n1. Object.points --Array of Vector()\r\n2. Object.rotation --Object{x, y, z} of Vector()\r\n*/\r\n\r\nlet PointTransformation = {\r\n  Within:function(size){\r\n    //draw recangle w/ this.rotation around this.points\r\n    //transform positions until this.points fits within the size{x, y, z}\r\n    //--Vector argument\r\n  },\r\n  CreateMesh:function(){\r\n    //create a mesh from the points\r\n  },\r\n  Rotate:function(size){\r\n    //rotate and transpose the points\r\n  },\r\n  FlipX:function(){\r\n  },\r\n\r\n  FlipY:function(){\r\n  },\r\n  Reflect:function(onX, onY){\r\n    //flip and repeat across the x and y axis\r\n  },\r\n  Smooth:function(){\r\n    //subdivide and smooth along the edge of points\r\n  }\r\n};\r\n\r\n\r\n\r\nGamelab.PointTransformation = PointTransformation;\r\n;\n\n/**\n * Creates an instance of Rectangle.\n * @param   {Gamelab.Vector} min the minimum vector point (x,y)\n * @param   {Gamelab.Vector} max the maximum vector point (x,y)\n *\n * @returns {Rectangle} a Rectangle object\n */\n\nclass Rectangle {\n    constructor(x1, y1, x2, y2) {\n      this.Min(x1, y1);\n      this.Max(x2, y2);\n    }\n    Min(x, y)\n    {\n      this.min = new Gamelab.Vector(x, y);\n      return this;\n    }\n    Max(x, y)\n    {\n      this.max = new Gamelab.Vector(x, y);\n      return this;\n    }\n}\n;\n\n\n\nlet VectorBounds = Rectangle;\n\nGamelab.VectorBounds =VectorBounds;\n\nGamelab.Rectangle = Rectangle;\n\n/**\n * Takes the min and max vectors plus termPoint ('termination-point'), returns VectorFrameBounds\n *  *use this to define the bounds of an Animation object.\n * @param   {Vector} min the minimum vector point (x,y)\n * @param   {Vector} max the maximum vector point (x,y)\n * @param   {Vector=} termPoint the optional termination vector point (x,y) : defaults to the value of 'max'\n * -While a min and max Gamelab.Vector(x,y) will describe the grid-size of Animation frames,\n * the termPoint will indicate the last frame on-grid for this set of frames --Animation may stop early on the 'grid')\n * @returns {VectorFrameBounds} a VectorFrameBounds object\n */\n\nclass VectorFrameBounds {\n\n    constructor(min, max, termPoint) {\n\n        this.min = min;\n        this.max = max;\n\n        this.termPoint = termPoint || new Gamelab.Vector(this.max.x, this.max.y, this.max.z);\n\n    }\n\n\n}\n;\n\nGamelab.VectorFrameBounds = VectorFrameBounds;\n\n\n\n\nvar GeoMath = {\n\n        rotatePointsXY:function(x,y,angle) {\n\n            var theta = angle*Math.PI/180;\n\n            var point = {};\n            point.x = x * Math.cos(theta) - y * Math.sin(theta);\n            point.y = x * Math.sin(theta) + y * Math.cos(theta);\n\n            point.z = 0;\n\n            return point\n        }\n\n}\n\nGamelab.GeoMath = GeoMath;\n;\r\n\r\n/**\r\n * Renderable : consistent base-type for graphic-objects\r\n * @param   {Object} args the object of arguments\r\n * @returns {Renderable} a Gamelab.Renderable object.\r\n * */\r\n\r\nclass Renderable\r\n{\r\n    constructor(args={})\r\n    {\r\n      //  Gamelab.FeatureInject(this, args);\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * A game-image object based on HTMLImage element. Creates GameImage, attaches gameImage.domElement --an instance of HTMLImageElement\r\n * @param   {string} src the sourcePath of the image-file.\r\n * @returns {GameImage} a Gamelab.GameImage object.\r\n * */\r\n\r\nclass GameImage extends Renderable {\r\n\r\n    constructor(src={}, onCreate=function(){I('image: applied default arg to onCreate():');}) {\r\n\r\n        super(src);\r\n\r\n        if(typeof src == 'object' && !(src instanceof HTMLCanvasElement)) {\r\n\r\n          return src;\r\n\r\n        }\r\n\r\n\r\n                    console.dev('GameImage--', this);\r\n\r\n\r\n\r\n                                if(typeof src == 'string')\r\n                                {\r\n                                    this.domElement = document.createElement('IMG');\r\n                                    this.domElement.src = src;\r\n                                }\r\n                                else if(src  instanceof HTMLCanvasElement)\r\n                                {\r\n                                  this.domElement = src;\r\n                                }\r\n\r\n\r\n            this.domElement.onerror = function () {\r\n                this.__error = true;\r\n                console.dev('--image error');\r\n            };\r\n\r\n    }\r\n};\r\n\r\nGamelab.GameImage = GameImage;\r\n;\r\n\r\nconsole.info('Scriptable class :: keep as public');\r\nconsole.info('Script class :: keep as public');\r\n\r\n\r\nclass Script{\r\n\r\n  constructor(uri, callback){\r\n\r\n    this.src = uri || '';\r\n\r\n    if(uri && callback)\r\n    {\r\n    this.load(uri, callback);\r\n    }\r\n    else{\r\n      console.info('Created Script() without uri + callback --1st and 2nd arguments. To use object call script.load()');\r\n    }\r\n\r\n  }\r\n\r\n  load(uri, callback){\r\n\r\n    var __object = this;\r\n\r\n    callback = callback || function(){};\r\n\r\n    callback.bind(this);\r\n\r\n    var script = document.createElement('SCRIPT');\r\n    script.src = uri;\r\n\r\n    //define onload fxn\r\n    script.onload = function(){\r\n\r\n      var construct = module.exports;\r\n      callback(construct);\r\n\r\n    };\r\n\r\n    //append to the document\r\n    document.head.appendChild(script);\r\n\r\n  }\r\n\r\n};\r\n\r\nGamelab.Script = Script;\r\n\r\n\r\nclass Scriptable{\r\n\r\n  constructor(object, siblings){\r\n\r\n    this.object = object;\r\n\r\n    this.siblings = siblings;\r\n\r\n  }\r\n\r\n  Object(object)\r\n  {\r\n    this.object = object;\r\n    return this;\r\n  }\r\n\r\n\r\n  load(url, callback){\r\n\r\n    var __object = this;\r\n\r\n    callback = callback || function(){};\r\n\r\n    callback = callback.bind(this);\r\n\r\n    var script = document.createElement('SCRIPT');\r\n    script.src = url;\r\n\r\n    //define onload fxn\r\n    script.onload = function(){\r\n\r\n      var construct = window.module.exports;\r\n\r\n      var MOD = construct(__object.object, __object.siblings);\r\n\r\n      callback.bind(__object).call(MOD, __object.object, __object.siblings);\r\n    };\r\n\r\n    //append to the document\r\n    document.head.appendChild(script);\r\n\r\n  }\r\n\r\n};\r\n\r\nGamelab.Scriptable = Scriptable;\r\n;\n\n\nclass Elipse{\n\n  constructor(pos, size){\n    this.position = new Gamelab.Vector(0, 0, 0);\n    this.size = new Gamelab.Vector(0, 0, 0);\n    this.rotation = new Gamelab.Vector(0, 0, 0);\n    this.Pos(pos);\n    this.Size(size);\n  }\n\n  draw(){\n              var halfX = (this.size.x / 2);\n              var halfY = (this.size.y / 2);\n              Gamelab.Canvas.arc(this.position, new Gamelab.Vector(halfX, halfY));\n  }\n\n}\n\nGamelab.Elipse = Elipse;\n;\r\n\r\n\r\n\r\nclass SpatialPattern {\r\n\r\n  constructor(src, unitSize){\r\n    this.objects= [];\r\n    this.basicGridChunk = new Gamelab.Sprite(src).Size(unitSize, unitSize);\r\n\r\n  }\r\n\r\n  StepFunction(call){\r\n    this.call = call || function(){};\r\n    return this;\r\n  }\r\n\r\n  add(sprite)\r\n  {\r\n    this.objects.push(sprite);\r\n\r\n  }\r\n\r\n  Min(m1, m2){\r\n    this.min = new Gamelab.Vector(m1, m2);\r\n    return this;\r\n  }\r\n  Max(m1, m2){\r\n    this.max = new Gamelab.Vector(m1, m2);\r\n    return this;\r\n  }\r\n\r\n  Fill(callback){\r\n\r\n    for(var x = this.min.x; x < this.max.x; x++)\r\n    {\r\n\r\n      for(var y = this.min.y; y < this.max.y; y++)\r\n      {\r\n\r\n       if(this.call(x, y))\r\n       {\r\n\r\n         var chunk = new Gamelab.Sprite().FromData(this.basicGridChunk);\r\n\r\n         chunk.target_x = x;\r\n         chunk.target_y = y;\r\n\r\n         chunk.onLoad(function(){\r\n\r\n          //  this.Size();\r\n\r\n          this.Position(this.target_x, this.target_y);\r\n\r\n         });\r\n\r\n          this.add(chunk);\r\n\r\n       }\r\n      }\r\n    }\r\n\r\n\r\n    callback(this.objects);\r\n\r\n  }\r\n\r\n}\r\n\r\n\r\nGamelab.SpatialPattern = SpatialPattern;\r\n;\r\n\r\nvar Trigonometry = {\r\n\r\n  rotate_from_xy:function(cx, cy, x, y, angle) {\r\n      var radians = (Math.PI / 180) * angle,\r\n          cos = Math.cos(radians),\r\n          sin = Math.sin(radians),\r\n          nx = (cos * (x - cx)) + (sin * (y - cy)) + cx,\r\n          ny = (cos * (y - cy)) - (sin * (x - cx)) + cy;\r\n      return new Gamelab.Vector(nx, ny);\r\n  },\r\n\r\n  rotational_speed:function(angle, speed){\r\n    // Move towards the player\r\n    var radians = (angle / 360) * Math.PI * 2.0;\r\n    return new Gamelab.Vector(Math.cos(radians) * speed, Math.sin(radians) * speed);\r\n  },\r\n\r\n  find_point_on_circle:function(x, y, radius, degrees){\r\n\r\n  }\r\n};\r\n\r\n\r\nGamelab.Trig = Trigonometry;\r\nGamelab.Trigonometry = Trigonometry;\r\n;\r\n\r\n\r\n\r\nfunction Curve_ToComplete(tag){\r\n  var log_it = function(sub_tag){\r\n    return (function(){\r\n        console.info('Curve_ToComplete:' + tag + '.' + sub_tag);\r\n    })();\r\n  };\r\n  return {\r\n    In:log_it('In'),\r\n    Out:log_it('Out'),\r\n    Seamless:log_it('Seamless')\r\n  }\r\n};\r\n\r\n\r\n\r\n  var linkedCurves = {\r\n\r\n    quadratic: function(t) {\r\n      return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t\r\n    },\r\n\r\n    cubic: function(t) {\r\n      return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1\r\n    },\r\n\r\n    quartic: function(t) {\r\n      return t < .5 ? 8 * t * t * t * t : 1 - 8 * (--t) * t * t * t\r\n    },\r\n\r\n    quintic: function(t) {\r\n      return t < .5 ? 16 * t * t * t * t * t : 1 + 16 * (--t) * t * t * t * t\r\n    },\r\n\r\n    linear: function(t) {\r\n      return t;\r\n    } //provided for consistency / in case 'linear' is needed\r\n\r\n  };\r\n\r\n\r\nlet Twix = {\r\n\r\n  Curves:{\r\n    //ALL HAVE INPUT AND OUTPUT OF: 0-1.0\r\n      // no easing, no acceleration\r\n      Linear: {\r\n        None: function(t) {\r\n          return t;\r\n        }\r\n      },\r\n\r\n      Quadratic: {\r\n        In: function(t) {\r\n          return t * t;\r\n        },\r\n        Out: function(t) {\r\n          return t * (2 - t);\r\n        },\r\n        Seamless: function(t) {\r\n          return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\r\n        }\r\n      },\r\n\r\n      Cubic: {\r\n        In: function(t) {\r\n          return t * t * t;\r\n        },\r\n        Out: function(t) {\r\n          return (--t) * t * t + 1;\r\n        },\r\n        Seamless: function(t) {\r\n          return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\r\n        }\r\n      },\r\n\r\n      Quartic: {\r\n        In: function(t) { return t * t * t * t; },\r\n        Out: function(t) { return 1 - (--t) * t * t * t; },\r\n        Seamless: function(t) { return t < .5 ? 8 * t * t * t * t : 1 - 8 * (--t) * t * t * t; }\r\n      },\r\n\r\n      Quintic: {\r\n        In: function(t) { return t * t * t * t * t; },\r\n        Out: function(t) { return 1 + (--t) * t * t * t * t; },\r\n        Seamless: function(t) { return t < .5 ? 16 * t * t * t * t * t : 1 + 16 * (--t) * t * t * t * t; }\r\n      },\r\n\r\n      Sine:Curve_ToComplete('Sine'),\r\n\r\n      Cosine:Curve_ToComplete('Cosine'),\r\n\r\n      Tangent:Curve_ToComplete('Tangent'),\r\n\r\n      Exponential:Curve_ToComplete('Exponential'),\r\n\r\n\r\n  },\r\n\r\n  LinkedCurves:linkedCurves\r\n\r\n};\r\n\r\n\r\n\r\nconst TranceCurves = {};\r\n\r\nTranceCurves.Exponential = (value, power, min, max) => {\r\n\r\n};\r\n\r\nTranceCurves.Power = (value, power, min, max) => {\r\n\r\n};\r\n\r\n\r\nconst TrigFunctions = {};\r\n\r\nTrigFunctions.Sine = {};\r\n\r\nTrigFunctions.Cosine = {};\r\n\r\nTrigFunctions.Tangent = {};\r\n\r\n\r\nconst SpecialFunctions = {};\r\n\r\nSpecialFunctions.Sawtooth = (t) => { return t <= 1.0 ? t : 0; };\r\n\r\nSpecialFunctions.Square = () => {};\r\n\r\nSpecialFunctions.Triangle = () => {};\r\n\r\nSpecialFunctions.Floor = () => {};\r\n\r\nSpecialFunctions.Sign = () => {};\r\n\r\nGamelab.core = Gamelab.core || {};\r\n\r\nGamelab.core.XYFunctions = {};\r\n\r\nGamelab.core.XYFunctions.SpecialFunctions = SpecialFunctions;\r\n\r\n\r\n\r\nconst SigmaFunctions = {};\r\n\r\nconst GammaFunctions = {};\r\n;(function() {\r\n  console.log('Vector class... creating');\r\n\r\n  /**\r\n   * Creates a Vector object with x, y, and --optional z.\r\n   * @param   {number} x the x coordinate\r\n   * @param   {number} y the y coordinate\r\n   * @param   {number} z the optional z coordinate\r\n   * @param   {number} r the optional r value\r\n   * @returns {Vector} a Vector object\r\n   */\r\n\r\n\r\nfunction single_numeric_x(x, y, z)\r\n{\r\n  return typeof x == 'number' && y == undefined && z == undefined;\r\n}\r\n\r\n\r\n  class Vector {\r\n    constructor(x, y, z, r) {\r\n\r\n      var copied = false;\r\n\r\n      if (typeof(x) == 'object' && x.hasOwnProperty('x') && x.hasOwnProperty('y')) //optionally pass vector3\r\n      {\r\n        this.x = x.x;\r\n        this.y = x.y;\r\n        this.z = x.z || 0;\r\n\r\n        if (this.z == null) {\r\n          this.z = 0;\r\n        }\r\n\r\n        this.valid_check();\r\n\r\n        copied = true;\r\n      }\r\n\r\n      if (!copied) {\r\n\r\n        if(single_numeric_x(x, y, z))\r\n        {\r\n          this.x = x;\r\n          this.y = x;\r\n          this.z = x;\r\n        }\r\n        else{\r\n          if (z == null) {\r\n            z = 0;\r\n          }\r\n\r\n                  this.x = x;\r\n                  this.y = y;\r\n                  this.z = z;\r\n                  this.r = r;\r\n        }\r\n\r\n        this.valid_check();\r\n      }\r\n    }\r\n\r\n    valid_check() {\r\n      if (this.x == undefined) {\r\n        this.x = 0;\r\n      }\r\n      if (this.y == undefined) {\r\n        this.y = 0;\r\n      }\r\n      if (this.z == undefined) {\r\n        this.z = 0;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Subtracts another Vector from this vector and returns a vector for the resulting difference.\r\n     *\r\n     * @function\r\n     * @param {Vector} v the vector to be subtracted from this vector\r\n     * @memberof Vector\r\n     **********/\r\n\r\n    sub(x, y, z) {\r\n      var v = new Gamelab.Vector(x, y, z);\r\n      return new Gamelab.Vector(this.x - v.x, this.y - v.y, this.z - v.z);\r\n    }\r\n\r\n    /**\r\n     * Adds another Vector to this vector and returns a vector for the resulting sum.\r\n     *\r\n     * @function\r\n     * @param {Vector} v the vector to be added to this vector\r\n     * @memberof Vector\r\n     **********/\r\n\r\n    add(x, y, z) {\r\n      var v = new Gamelab.Vector(x, y, z);\r\n      return new Gamelab.Vector(this.x + v.x, this.y + v.y, this.z + v.z);\r\n    }\r\n\r\n    /**\r\n     * Multiplies another Vector by this vector and returns a vector for the resulting product.\r\n     *\r\n     * @function\r\n     * @param {Vector} v the vector that this vector will by muliplied by\r\n     * @memberof Vector\r\n     **********/\r\n\r\n    mult(x, y, z) {\r\n      var v = new Gamelab.Vector(x, y, z);\r\n      return new Gamelab.Vector(this.x * v.x, this.y * v.y, this.z * v.z);\r\n    }\r\n\r\n    /**\r\n     * Gets vector of absolute values.\r\n     *\r\n     * @function\r\n     * @param {Vector} v the absolute vector\r\n     * @memberof Vector\r\n     **********/\r\n\r\n    abs() {\r\n      return new Gamelab.Vector(Math.abs(this.x), Math.abs(this.y), Math.abs(this.z));\r\n    }\r\n\r\n    /**\r\n     * Divides another Vector by this vector and returns a vector for the resulting quotient.\r\n     *\r\n     * @function\r\n     * @param {Vector} v the vector for this vector to be divided by\r\n     * @memberof Vector\r\n     **********/\r\n\r\n    div(x, y, z) {\r\n      var v = new Gamelab.Vector(x, y, z);\r\n      return new Gamelab.Vector(this.x / v.x, this.y / v.y, this.z / v.z);\r\n    }\r\n\r\n    /**\r\n     * Rounds this vector to the nearest set of whole numbers and returns the result.\r\n     *\r\n     * @function\r\n     * @memberof Vector\r\n     * @returns {Vector} a Gamelab.Vector object\r\n     **********/\r\n\r\n    round(multiple=1.0) {\r\n      var d = multiple;\r\n      if(isNaN(d) || d < 1)\r\n      {\r\n        d = 1;\r\n      }\r\n\r\n      var z = !isNaN(this.z) ? this.z : 0;\r\n      return new Gamelab.Vector(Math.round(this.x * d) / d, Math.round(this.y * d) / d, Math.round(this.z  * d) / d);\r\n    }\r\n\r\n    /**\r\n     * Floors this vector to the nearest set of whole numbers and returns the result (subtractive-only, an x of 1.7 becomes 1)\r\n     *\r\n     * @function\r\n     * @memberof Vector\r\n     * @returns {Vector} a Gamelab.Vector object\r\n     **********/\r\n\r\n     floor(multiple=1.0) {\r\n       var d = multiple;\r\n       if(isNaN(d) || d < 1)\r\n       {\r\n         d = 1;\r\n       }\r\n\r\n       var z = !isNaN(this.z) ? this.z : 0;\r\n       return new Gamelab.Vector(Math.floor(this.x * d) / d, Math.floor(this.y * d) / d, Math.floor(this.z  * d) / d);\r\n     }\r\n\r\n    /**\r\n     * Ceils this vector to the nearest set of whole numbers  and returns the result (additive-only, an x of 1.2 becomes 2)\r\n     *\r\n     * @function\r\n     * @memberof Vector\r\n     * @returns {Vector} a Gamelab.Vector object\r\n     **********/\r\n\r\n     ceil(multiple=1.0) {\r\n       var d = multiple;\r\n       if(isNaN(d) || d < 1)\r\n       {\r\n         d = 1;\r\n       }\r\n\r\n       var z = !isNaN(this.z) ? this.z : 0;\r\n       return new Gamelab.Vector(Math.ceil(this.x * d) / d, Math.ceil(this.y * d) / d, Math.ceil(this.z  * d) / d);\r\n     }\r\n\r\n    /**\r\n     * Creates new vector, with the negated x,y,z values (-x-y-z), returns the resulting vector\r\n     *\r\n     * @function\r\n     * @memberof Vector\r\n     * @returns {Vector} a Gamelab.Vector object\r\n     **********/\r\n\r\n    neg() {\r\n      return new Gamelab.Vector(-this.x, -this.y, -this.z);\r\n    }\r\n\r\n    /**\r\n     * An equals-test for vectors. Returns true OR false.\r\n     *\r\n     * @function\r\n     * @memberof Vector\r\n     * @returns {boolean} a true OR false value\r\n     **********/\r\n\r\n    equals(x, y, z) {\r\n      var v = new Gamelab.Vector(x, y, z);\r\n      return this.x == v.x && this.y == v.y && this.z == v.z;\r\n    }\r\n\r\n    /**\r\n     * Gets  the specific distance between this and the argument-vector. --applies to x and y of two vectors. Returns a single number.\r\n     *\r\n     * @function\r\n     * @memberof Vector\r\n     * @returns {number} the specific distance between this and the argument-vector\r\n     **********/\r\n\r\n    trig_distance_xy(v) {\r\n      var dist = this.sub(v);\r\n      return Math.sqrt(dist.x * dist.x + dist.y * dist.y);\r\n    }\r\n\r\n\r\n    is_between(v1, v2) {\r\n      //TODO : overlap vectors return boolean\r\n\r\n      return this.x >= v1.x && this.x <= v2.x &&\r\n        this.y >= v1.y && this.y <= v2.y &&\r\n        this.z >= v1.z && this.z <= v2.z;\r\n    }\r\n\r\n    /**\r\n     * Returns a vector-multiple: the original-size, multiplied by a random between the minFloat and maxFloat arguments.\r\n     *\r\n     * @function\r\n     * @memberof Vector\r\n     * @returns {Vector} the resulting vector.\r\n     **********/\r\n\r\n    randomize(minFloat, maxFloat) {\r\n      var random = (Math.random() * (maxFloat - minFloat) + minFloat) * 1000 / 1000;\r\n      return this.mult(random);\r\n    }\r\n\r\n    /**\r\n     * Returns a speed vector, based on rotation.\r\n     *\r\n     * @function\r\n     * @param {number} rotation in degrees, 0-360\r\n     * @param {number} speed the level of speed to apply, default being 1\r\n     * @returns {Vector}\r\n     * @memberof Vector\r\n     **********/\r\n\r\n    rotationalSpeedPoint(rotation, speed) {\r\n      var r = rotation;\r\n      if (isNaN(speed)) {\r\n        speed = 1;\r\n      }\r\n      if (typeof(rotation) == 'object' && rotation.x) {\r\n        r = rotation.x;\r\n      }\r\n\r\n      return new Gamelab.Vector(Math.cos((r) * 3.14 / 180) * speed, Math.sin((r) * 3.14 / 180) * speed);\r\n    }\r\n\r\n    /**\r\n     * Returns the right-handed angle of degrees between two two position-vectors.\r\n\r\n     * @memberof Vector\r\n     * @function\r\n     * @param {Vector} p1 the 1st vector-argument\r\n     * @param {Vector} p2 the 2nd vector-argument\r\n     * @returns {number} the resulting angle in degrees.\r\n     **********/\r\n\r\n    angleBetween(p1, p2) {\r\n      return Math.atan2(p2.y - p1.y, p2.x - p1.x) * 180 / Math.PI;\r\n    }\r\n\r\n    //apply minimum value to all values\r\n    min2d() {\r\n\r\n      function minimize(object, key1, key2) {\r\n        if (object[key1] < object[key2])\r\n          object[key2] = object[key1];\r\n\r\n        if (object[key2] < object[key1])\r\n          object[key1] = object[key2];\r\n      };\r\n\r\n      minimize(this, 'x', 'y');\r\n\r\n      return this;\r\n    }\r\n\r\n\r\n    //apply maximum value to all values\r\n    max2d() {\r\n\r\n      function maximize(object, key1, key2) {\r\n        if (object[key1] > object[key2])\r\n          object[key2] = object[key1];\r\n\r\n        if (object[key2] > object[key1])\r\n          object[key1] = object[key2];\r\n      };\r\n\r\n      maximize(this, 'x', 'y');\r\n\r\n      return this;\r\n    }\r\n\r\n  };\r\n\r\n  let Vector3 = Vector,\r\n    Pos = Vector,\r\n    Size = Vector,\r\n    Position = Vector,\r\n    Vector2 = Vector,\r\n    Rotation = Vector;\r\n\r\n  Gamelab.Vector = Vector;\r\n\r\n  //synonymous w/ Vector::\r\n  Gamelab.Vector2d = Vector;\r\n  Gamelab.Vector2D = Vector;\r\n  Gamelab.Rotation = Vector;\r\n  Gamelab.Pos = Vector;\r\n  Gamelab.Position = Vector;\r\n  Gamelab.Size = Vector;\r\n\r\n  //The above are a list of synonymous expressions for Vector. All of these do the same thing in this library (store and manipulate x,y,z values)\r\n\r\n  var VectorMath = {\r\n\r\n    rotatePointsXY(x, y, angle) {\r\n\r\n      var theta = angle * Math.PI / 180;\r\n\r\n      var point = {};\r\n      point.x = x * Math.cos(theta) - y * Math.sin(theta);\r\n      point.y = x * Math.sin(theta) + y * Math.cos(theta);\r\n\r\n      point.z = 0;\r\n\r\n      return new Gamelab.Vector(point.x, point.y, point.z);\r\n    },\r\n\r\n    rotatePosition3D(x, y, z, $rot) {\r\n\r\n      var pos1 = this.rotatePointsXY(x, z, $rot.y);\r\n      var pos2 = this.rotatePointsXY(pos1.x, y, $rot.z);\r\n      //var pos3 = this.rotatePointsXY(y, z, $rot.x);\r\n\r\n      return new Gamelab.Vector(pos2.x, pos3.x, pos3.y);\r\n    }\r\n\r\n  }\r\n\r\n  Gamelab.VectorMath = VectorMath;\r\n\r\n})();\r\n;class Raycaster {\r\n\r\n  constructor(viewport) {\r\n\r\n    this.rays = [];\r\n    this.viewport = viewport;\r\n    this.canvas  =  document.createElement('CANVAS');\r\n    this.canvas.width = 500;\r\n    this.canvas.height = 500;\r\n    this.ctx =  this.canvas.getContext('2d');\r\n\r\n    //distance / origin / drawable\r\n  }\r\n\r\n  reset(){\r\n    this.rays = [];\r\n  }\r\n\r\n  addRay(ray, options){\r\n    this.rays.push(ray);\r\n    return ray;\r\n  }\r\n\r\n  reveal3D(objects){\r\n\r\n    var $scope = this;\r\n    var total = 0;\r\n\r\n    this.reset();\r\n\r\n\r\n    var start = new Gamelab.Vector($scope.viewport.position);\r\n\r\n    $scope.ctx.clearRect(0, 0, 2000, 2000);\r\n\r\n    objects.forEach(function($o){\r\n\r\n      var pixelGridList = $o.getVisibleFramesAsPixelGridArray();\r\n\r\n    //  console.info('pxg ROT:' + jstr(pixelGridList.rotation));\r\n\r\n      pixelGridList.forEach(function(chunk){\r\n\r\n        chunk.forEach(function(pixelObject){\r\n\r\n          total += 1;\r\n\r\n          //console.info('pxg POS:' + jstr(pos));\r\n\r\n          var tpos = Gamelab.VectorMath.rotatePosition3D(pixelObject.position.x, pixelObject.position.y, pixelObject.position.z, pixelGridList.rotation);\r\n\r\n          pixelObject.position3d = pixelObject.position.add(tpos).add(pixelGridList.origin);\r\n\r\n          $scope.ctx.putImageData(pixelObject.pixel, pixelObject.position3d.x, pixelObject.position3d.y );\r\n\r\n        });\r\n\r\n        //Then create + apply a ray\r\n\r\n      //  console.log('Raycaster.reveal3D()::chunk Has Pixels::' + chunk.length);\r\n\r\n      });\r\n\r\n    });\r\n\r\n    console.log('--total ' + total);\r\n\r\n    return $scope.canvas;\r\n  }\r\n}\r\n\r\nGamelab.Raycaster = Raycaster;\r\n\r\nclass Ray {\r\n\r\n  constructor(origin, angle, size) {\r\n\r\n\r\n  }\r\n\r\n  Pixel(p)\r\n  {\r\n    this.pixel =p;\r\n    return this;\r\n  }\r\n\r\n  AlphaPos(x, y, z)\r\n  {\r\n    this.alphaPos = new Gamelab.Vector(x, y, z);\r\n    return this;\r\n  }\r\n\r\n  EndPos(x, y, z)\r\n  {\r\n    this.endPos = new Gamelab.Vector(x, y, z);\r\n    return this;\r\n  }\r\n\r\n  intersect(object) {\r\n    //intersect the Ray w/ the object\r\n    //return the pixel that it touches, w/ a size and intensity\r\n  }\r\n}\r\n\r\nGamelab.Ray = Ray;\r\n\r\nclass Viewport {\r\n\r\n  constructor(size=new Gamelab.Vector(0, 0, 0)) {\r\n    this.size = size;\r\n    this.raycaster = new Gamelab.Raycaster(this);\r\n  }\r\n\r\n  Position(x, y, z) {\r\n    this.position = new Gamelab.Vector(x, y, z);\r\n    return this;\r\n  }\r\n\r\n  Size(x, y) {\r\n    this.farSize = new Gamelab.Vector(x, y);\r\n    return this;\r\n  }\r\n\r\n  update(objects, ctx){\r\n    var c =this.raycaster.reveal3D(objects);\r\n    ctx.drawImage(c, 0, 0);\r\n  }\r\n\r\n  lookAt(position) {\r\n\r\n    if (!p) {\r\n      throw new Error('1st argument must be either Vector() or have {}.position --Vector ');\r\n    }\r\n    return this;\r\n  }\r\n\r\n}\r\n\r\nGamelab.Viewport = Viewport;\r\n;\r\nclass Voxel {\r\n\r\n  constructor(x, y, w, h){\r\n    this.size = new Gamelab.Vector(w, h);\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n\r\n}\r\n\r\n\r\nclass VoxelArray {\r\n\r\n  constructor(voxels, onCreate){\r\n\r\n      onCreate = onCreate || function(){};\r\n\r\n      var array = this;\r\n\r\n      voxels = voxels || [];\r\n\r\n      this.voxels = [];\r\n\r\n      this.id = Gamelab.create_id();\r\n\r\n      voxels.forEach(function(v){\r\n\r\n        array.push(v);\r\n\r\n      });\r\n\r\n      onCreate.bind(this).call();\r\n  }\r\n\r\n  Clone(object){\r\n    if(object.voxels instanceof Array)\r\n    return new Gamelab.VoxelArray(object.voxels);\r\n    else\r\n    return console.error('needs array-type@ on 1st arg: .voxels');\r\n  }\r\n\r\n  push(item){\r\n    this.voxels.push(item);\r\n  }\r\n  add(item)\r\n  {\r\n    this.voxels.push(item);\r\n  }\r\n\r\n  FromData(data)\r\n  {\r\n    var jsonData = JSON.parse(JSON.stringify(data));\r\n    return new VoxelArray(jsonData.voxels);\r\n  }\r\n}\r\n\r\nGamelab.Voxel = Voxel;\r\nGamelab.VoxelArray = VoxelArray;\r\n;/**\r\n * Creates a new WebGl --an experimental class for 3D-objects via THREE.js --requires THREE.js be included\r\n * @param   {Object} canvas the canvas element.\r\n * @param   {Object} drawables the drawable objects to be drawn.\r\n * @returns {WebGL} a 2d/3d game-window object\r\n * */\r\n\r\nclass WebGL {\r\n  constructor(canvas = false, drawables = []) {\r\n\r\n    if (!THREE) {\r\n      return console.error('THREE.js required in window');\r\n    }\r\n\r\n\r\n    document.body.style.position = \"absolute\";\r\n\r\n    document.body.style.width = \"100%\";\r\n\r\n    document.body.style.height = \"100%\";\r\n\r\n\r\n    var camera = new THREE.PerspectiveCamera();\r\n\r\n    var container = document.querySelector('#threejs-window');\r\n\r\n    this.renderer = new THREE.WebGLRenderer();\r\n\r\n    this.camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000); //was 1000 last arg\r\n\r\n    this.scene = new THREE.Scene();\r\n\r\n    this.renderer.setSize(container.clientWidth, container.clientHeight);\r\n\r\n    Gamelab.threejs = {};\r\n\r\n    Gamelab.threejs.renderer = this.renderer;\r\n\r\n    Gamelab.threejs.camera = this.camera;\r\n\r\n    Gamelab.threejs.scene = this.scene;\r\n\r\n    container.append(this.renderer.domElement);\r\n\r\n\r\n    this.scene.add(this.camera);\r\n\r\n    this.light = new THREE.AmbientLight(0x404040); // soft white light\r\n    this.scene.add(this.light);\r\n\r\n    this.drawables = drawables;\r\n\r\n    this.bool_events = Gamelab.bool_events || [];\r\n\r\n    this.canvas = this.renderer.domElement;\r\n\r\n    this.camera.target = false;\r\n\r\n    var __inst = this;\r\n\r\n    this.update_ext = [];\r\n\r\n\r\n    window.onerror = function() {\r\n\r\n      Gamelab.errors += 1;\r\n\r\n      console.log('Canvas Error --');\r\n\r\n      if (Gamelab.errors > Gamelab.settings.errorLimit) {\r\n        Gamelab.stopDraw = true;\r\n\r\n        var call = call || window.setTimeout(function() {\r\n\r\n          if (call) {\r\n            window.clearTimeout(call);\r\n          }\r\n          console.log('%cDraw stopped at errorLimit:' + Gamelab.settings.errorLimit, 'color:darkorange;');\r\n\r\n        }, 200);\r\n\r\n      }\r\n\r\n    }\r\n\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * returns the webGL.canvas property, an HTMLCanvasElement\r\n   *\r\n   * @function\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n  getCanvas() {\r\n    return this.canvas;\r\n  }\r\n\r\n\r\n  /**\r\n   * returns a vector(x, y) of the center of the WebGL\r\n   *\r\n   * @function\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n\r\n  center() {\r\n\r\n    return new Gamelab.Vector(Math.round(this.canvas.width / 2), Math.round(this.canvas.height / 2));\r\n\r\n  }\r\n\r\n\r\n\r\n  getCanvas() {\r\n    return this.canvas;\r\n  }\r\n\r\n\r\n  /**\r\n   * adds an update to the WebGL:: update to be called every 20 milliseconds\r\n   *\r\n   * @function\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n\r\n  onUpdate(f) {\r\n\r\n    this.update_ext.push(f);\r\n\r\n  }\r\n\r\n  /**\r\n   * the main update for the WebGL:: called automatically after call of WebGL.start() or WebGL.animate()\r\n   *\r\n   * @function\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n  update() {\r\n\r\n    Gamelab.each(this.drawables, function(ix, item) {\r\n\r\n      if (item && typeof(item.def_update) == 'function') {\r\n\r\n        item.def_update(item);\r\n\r\n      }\r\n\r\n      if (item && typeof(item.update) == 'function') {\r\n        item.update(item);\r\n\r\n      }\r\n\r\n\r\n      if (item && ['SpriteArray', 'RobotixArray', 'RobotixVerticalChain'].indexOf(item.constructor.name) >= 0 &&\r\n        typeof item.each == 'function') {\r\n\r\n        item.each(function(ix, graphic) {\r\n\r\n          graphic.update(graphic);\r\n\r\n        });\r\n\r\n      }\r\n\r\n    });\r\n\r\n    Gamelab.each(this.bool_events, function(ix, item) {\r\n\r\n      if (item && item.bool()) {\r\n        item.callback();\r\n      }\r\n\r\n    });\r\n\r\n\r\n    for (var x in this.update_ext) {\r\n      this.update_ext[x]();\r\n    }\r\n  }\r\n\r\n  draw() {\r\n\r\n    var __WebGL = this;\r\n\r\n    if (this.before_draw_ext) {\r\n      this.before_draw_ext();\r\n    }\r\n\r\n    Gamelab.each(this.drawables, function(ix, item) {\r\n\r\n      if (typeof item.draw == 'function') {\r\n        item.draw(__WebGL.ctx, __WebGL.camera);\r\n      }\r\n\r\n    });\r\n\r\n\r\n    if (this.after_draw_ext) {\r\n      this.after_draw_ext();\r\n    }\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * adds a call before the WebGL draw()\r\n   *\r\n   * @function\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n  onBeforeDraw(f) {\r\n\r\n    var boundCall = f.bind(this);\r\n\r\n    if (!this.before_draw_ext)\r\n      this.before_draw_ext = function() {};\r\n\r\n    var beforeDraw = this.before_draw_ext.bind(this);\r\n\r\n    this.before_draw_ext = function() {\r\n      beforeDraw();\r\n      boundCall();\r\n    };\r\n\r\n  }\r\n\r\n  /**\r\n   * adds a call after the WebGL draw()\r\n   *\r\n   * @function\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n\r\n  onAfterDraw(f) {\r\n\r\n    var boundCall = f.bind(this);\r\n\r\n    if (!this.after_draw_ext)\r\n      this.after_draw_ext = function() {};\r\n\r\n\r\n    var afterDraw = this.after_draw_ext.bind(this);\r\n\r\n    this.after_draw_ext = function() {\r\n      afterDraw();\r\n      boundCall();\r\n    };\r\n\r\n  }\r\n\r\n  /**\r\n   * sets the size of the WebGL\r\n   *\r\n   * @function\r\n   * @param {integer} w the width of the WebGL\r\n   * @param {integer} h the HEIGHT of the WebGL\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n  Size(w, h, isAbsoluteSize) { //call with no args to fill to browser-window-size;\r\n\r\n    w = w || this.canvas.parentNode.clientWidth;\r\n\r\n    h = h || this.canvas.parentNode.clientHeight;\r\n\r\n    var c = this.canvas;\r\n\r\n    if (c) {\r\n      c.setAttribute('width', w)\r\n    };\r\n\r\n    if (c) {\r\n      c.setAttribute('height', h)\r\n    };\r\n\r\n    Gamelab.WIDTH = w;\r\n\r\n    Gamelab.HEIGHT = h;\r\n\r\n    this.canvas.width = w;\r\n\r\n    this.canvas.height = h;\r\n\r\n    this.size = new Gamelab.Vector(w, h);\r\n\r\n    this.isAbsoluteSize = isAbsoluteSize || false;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n  /**\r\n   * adds an object to the WebGL\r\n   *\r\n   * @function\r\n   * @param {Object} obj the object to be added (Sprite)\r\n   * @param {Boolean} onBottom if true, adds to the bottom of layer-stack in WebGL\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n  add(obj, options = {}) {\r\n\r\n    var optionsGuide = {\r\n      obj: 'The Object{} being added into play',\r\n      options: {\r\n        position: 'The Vector(x, y) offset to use when drawing the obj'\r\n      }\r\n    };\r\n\r\n    console.info('WebGL.add() --2nd argument options is object of arguments >>>', optionsGuide);\r\n\r\n    var layer = options.layer || this.drawables.length - 1;\r\n\r\n    if (!(typeof layer == 'number' && layer >= 0))\r\n      layer = this.drawables.length;\r\n\r\n    var offset = new Gamelab.Vector(0, 0);\r\n\r\n    if (options.position)\r\n      offset = options.position;\r\n\r\n    obj.window_offset = offset;\r\n\r\n    //1: if Sprite(), Add object to the existing __WebGL\r\n\r\n    var __inst = this;\r\n\r\n    if (obj instanceof Gamelab.Camera) {\r\n\r\n      this.camera = obj;\r\n\r\n    } else if (obj instanceof Gamelab.GSEvent) {\r\n\r\n      if (Gamelab.__running) {\r\n\r\n        return console.error('Events can only be added before Gamstack.animate() is called::aka before the main update / loop begins');\r\n      } else {\r\n\r\n        obj.apply();\r\n\r\n      }\r\n    } else {\r\n\r\n      this.drawables.splice(layer, 0, obj);\r\n\r\n    };\r\n\r\n    return obj;\r\n\r\n  }\r\n\r\n  /**\r\n   * set background-color of WebGL\r\n   *\r\n   * @function\r\n   * @param {string} c the new background-color for WebGL\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n  Background(c) {\r\n    this.canvas.style.background = c;\r\n\r\n    this.canvas.style.backgroundColor = c;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n  /**\r\n   * removes an object from the WebGL\r\n   *\r\n   * @function\r\n   * @param {Object} obj the object to be removed (Sprite)\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n  remove(obj) {\r\n\r\n    var ix = this.drawables.indexOf(obj);\r\n\r\n    if (ix >= 0) {\r\n      this.drawables.splice(ix, 1);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * begins the animation-loop of WebGL.\r\n   *\r\n   * @function\r\n   * @param {number} time optional time parameter for usage with Tween\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n\r\n  animate(time) {\r\n\r\n    var __inst = this;\r\n\r\n    requestAnimationFrame(function() {\r\n\r\n      __inst.animate();\r\n\r\n    });\r\n\r\n\r\n    if (Gamelab.__stats) {\r\n      Gamelab.__stats.begin();\r\n      Gamelab.__statsMS.begin();\r\n      Gamelab.__statsMB.update();\r\n    }\r\n\r\n    Gamelab.isAtPlay = true;\r\n\r\n    if (window.TWEEN)\r\n      TWEEN.update(time);\r\n\r\n    console.log('Rendering');\r\n    this.renderer.render(this.scene, this.camera);\r\n\r\n\r\n    if (Gamelab.__stats) {\r\n      Gamelab.__stats.end();\r\n      Gamelab.__statsMS.end();\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * begins the animation-loop of WebGL, with performance Stats shown on-screen\r\n   *\r\n   * @function\r\n   * @memberof WebGL\r\n   **********/\r\n\r\n\r\n  start() {\r\n\r\n    if (typeof(Stats) == 'function') //Stats library exists\r\n    {\r\n      //basic stat animation\r\n      Gamelab.__stats = new Stats();\r\n      Gamelab.__stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom\r\n\r\n      Gamelab.__stats.dom.style.left = '10%';\r\n\r\n      Gamelab.__stats.dom.setAttribute('class', 'stat');\r\n\r\n      this.canvas.parentNode.appendChild(Gamelab.__stats.dom);\r\n\r\n      //basic stat animation\r\n      Gamelab.__statsMS = new Stats();\r\n      Gamelab.__statsMS.showPanel(1); // 0: fps, 1: ms, 2: mb, 3+: custom\r\n\r\n      Gamelab.__statsMS.dom.style.left = '10%';\r\n\r\n      Gamelab.__statsMS.dom.style.marginLeft = '90px';\r\n\r\n      Gamelab.__statsMS.dom.setAttribute('class', 'stat');\r\n\r\n      this.canvas.parentNode.appendChild(Gamelab.__statsMS.dom);\r\n\r\n      //basic stat animation\r\n      Gamelab.__statsMB = new Stats();\r\n      Gamelab.__statsMB.showPanel(2); // 0: fps, 1: ms, 2: mb, 3+: custom\r\n\r\n      Gamelab.__statsMB.dom.style.left = '10%';\r\n\r\n      Gamelab.__statsMB.dom.setAttribute('class', 'stat');\r\n\r\n      Gamelab.__statsMB.dom.style.marginLeft = '180px';\r\n\r\n      this.canvas.parentNode.appendChild(Gamelab.__statsMB.dom);\r\n    }\r\n\r\n    this.animate();\r\n  }\r\n}\r\n\r\nGamelab.WebGL = WebGL;\r\n\r\nGamelab.WebGl = WebGL;\r\n;(function() {\r\n  console.log('GSEvent class... creating');\r\n\r\n  class GSEvent {\r\n\r\n    constructor(args = {}) {\r\n\r\n      //  Gamelab.Modifiers.informable(this, args);\r\n\r\n    }\r\n  }\r\n\r\n  class MouseMoveEvent {\r\n    constructor(callback) {\r\n      callback = callback || function(x, y) {};\r\n\r\n      this.Callback(callback);\r\n    }\r\n    Callback(cb) {\r\n      Gamelab.InputSystem.extend('mousemove', function(x, y) {\r\n\r\n        cb(x, y);\r\n\r\n      });\r\n    }\r\n  };\r\n\r\n  Gamelab.MouseMoveEvent = MouseMoveEvent;\r\n\r\n  class MousePosEvent {\r\n    constructor(callback) {\r\n      callback = callback || function(x, y) {};\r\n\r\n      this.Callback(callback);\r\n    }\r\n    Callback(cb) {\r\n      Gamelab.InputSystem.extend('mousepos', function(x, y) {\r\n\r\n        cb(x, y);\r\n\r\n      });\r\n    }\r\n  };\r\n\r\n  Gamelab.MousePosEvent = MousePosEvent;\r\n\r\n  class MouseLeftClickEvent {\r\n    constructor(callback) {\r\n      callback = callback || function(x, y) {};\r\n\r\n      this.Callback(callback);\r\n    }\r\n    Callback(cb) {\r\n\r\n      Gamelab.InputSystem.extend('leftclick', function(x, y) {\r\n\r\n        cb(x, y);\r\n\r\n      });\r\n    }\r\n  };\r\n\r\n  Gamelab.MouseLeftClickEvent = MouseLeftClickEvent;\r\n\r\n  class MouseRightClickEvent {\r\n    constructor(callback) {\r\n      callback = callback || function(x, y) {};\r\n\r\n      this.Callback(callback);\r\n    }\r\n    Callback(cb) {\r\n\r\n      Gamelab.InputSystem.extend('rightclick', function(x, y) {\r\n\r\n        cb(x, y);\r\n\r\n      });\r\n    }\r\n  };\r\n\r\n  Gamelab.MouseRightClickEvent = MouseRightClickEvent;\r\n\r\n  function GSEventLink(extendedObject, extendedKey, extendor, extendorKey) {\r\n    this.parent_id = extendedObject.id,\r\n\r\n      this.child_id = extendor.id,\r\n\r\n      this.parent_key = extendedKey,\r\n\r\n      this.child_key = extendorKey;\r\n  };\r\n\r\n  /**\r\n   * Creates an instance of InputEvent\r\n   * <info-bit> Gamelab.InputEvent runs a callback function when a specified input is triggered</info-bit>\r\n   *\r\n   * <tip is=\"p\">Instead of calling\r\n   *\r\n   * @param   {Object} args object of arguments\r\n   * @param   {number} args.btnix the index of controller-button to be applied\r\n   * @param   {number} args.gpix the index of pc-gamepad --the 1st gamepad will have index 0\r\n   * @param   {number} args.stickix the controller-stick-index to be applied\r\n   * @param   {Array} args.keys array of strings for keys to be applied\r\n   * @param   {Function} args.callback the function to call when InputEvent is triggered\r\n   * @returns {Gamelab.InputEvent} a Gamelab.InputEvent object\r\n   */\r\n\r\n\r\n  class InputEvent extends GSEvent {\r\n    constructor(args) {\r\n      super(args);\r\n\r\n      var btnix = args.btnix || args.button_ix || false,\r\n\r\n        gpix = args.gpix || args.gamepad_ix || 0,\r\n\r\n        callback = args.callback || function() {\r\n\r\n\r\n        };\r\n\r\n      var six = args.stickix || args.six || args.stick_ix || false;\r\n\r\n      var inputKey = six !== false ? 'stick_' + six : btnix !== false ? 'button_' + btnix : false;\r\n\r\n      //Keys:\r\n\r\n      var keyboardKeys = TypeCode.arrayWrap(args.keys || []);\r\n\r\n      //Run the Q() function\r\n\r\n      if (keyboardKeys instanceof Array) {\r\n\r\n        Gamelab.each(keyboardKeys, function(ix, keyitem) {\r\n\r\n          Gamelab.InputSystem.extendKey('key_' + keyitem.toLowerCase(), function() {\r\n\r\n            callback(keyitem.toLowerCase());\r\n\r\n          });\r\n        });\r\n      }\r\n\r\n      if (inputKey && gpix >= 0) {\r\n\r\n        Gamelab.GamepadAdapter.on(inputKey, gpix, function(x, y) {\r\n\r\n          callback(x, y);\r\n\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n  /**\r\n   *\r\n   * @extends InputEvent\r\n   *\r\n   * Creates an instance of KeyboardEvent\r\n   * <info-bit> Gamelab.KeyboardEvent runs a callback function when keyboard-keys are pressed</info-bit>\r\n   * @param   {Array | string} keys the Array of keys or single string-key for this event\r\n   * @param   {Function} callback the callback-function to be called when this event is triggered\r\n\r\n   * @returns {Gamelab.KeyboardEvent}\r\n   */\r\n\r\n  class KeyboardEvent extends InputEvent {\r\n    constructor(keys = keys instanceof Array ? keys : [keys], callback = function() {}) {\r\n\r\n      super({});\r\n\r\n      this.keys = keys;\r\n\r\n      this.callback = callback;\r\n\r\n    }\r\n\r\n    init() {\r\n      var keyboardKeys = this.keys;\r\n\r\n      var __inst = this;\r\n\r\n      if (keyboardKeys instanceof Array) {\r\n\r\n        Gamelab.each(keyboardKeys, function(ix, keyitem) {\r\n\r\n          Gamelab.InputSystem.extendKey('key_' + keyitem.toLowerCase(), function() {\r\n\r\n            __inst.callback(keyitem.toLowerCase());\r\n\r\n          });\r\n        });\r\n      }\r\n    }\r\n\r\n    Keys(keys = []) {\r\n      this.keys = TypeCode.arrayWrap(keys)\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    Call(callback = function() {}) {\r\n      this.callback = callback;\r\n\r\n      this.init();\r\n\r\n      return this;\r\n    }\r\n  };\r\n\r\n  /**\r\n   *\r\n   * @extends InputEvent\r\n   *\r\n   * Creates an instance of GamepadEvent\r\n   * <info-bit> Gamelab.GamepadEvent runs a callback function when any specified gamepad-buttons or gamepad-sticks are pressed</info-bit>\r\n   * @param   {Array | string} gamepadKeys the Array of gamepadKeys or single string-key, representing gamepad-buttons or gamepad-sticks for this event\r\n   * @param   {Function} callback the callback-function to be called when this event is triggered\r\n\r\n   * @returns {Gamelab.GamepadEvent}\r\n   */\r\n\r\n  class GamepadEvent extends InputEvent {\r\n    constructor(keys = [], callback = function() {}) {\r\n\r\n      super({});\r\n\r\n      this.keys = keys;\r\n\r\n      this.callback = callback;\r\n\r\n    }\r\n\r\n    Gamepads(gps = []) {\r\n      this.gps = gps = TypeCode.arrayWrap(gps || []);\r\n\r\n      return this;\r\n    }\r\n\r\n    init() {\r\n      var gamepadKeys = TypeCode.arrayWrap(this.keys || []);\r\n\r\n      var __inst = this;\r\n\r\n      Gamelab.GamepadAdapter.on(gamepadKeys, this.gps, function(x, y) {\r\n\r\n        __inst.callback(x, y);\r\n\r\n      });\r\n    }\r\n\r\n    Keys(keys = []) {\r\n      this.keys = TypeCode.arrayWrap(keys);\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    Call(callback = function() {}) {\r\n      this.callback = callback;\r\n\r\n      this.init();\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n  };\r\n\r\n  class CollisionEvent extends GSEvent {\r\n    constructor(args = {}) {\r\n      super(args);\r\n\r\n    }\r\n\r\n    /**\r\n     * applies objects and siblings to be compared for the CollisionEvent instance\r\n     * @memberof CollisionEvent\r\n     * @param   {Array} objects the main-objects for collision processing\r\n     * @param   {Array} siblings the comparable-objects for collision processing\r\n     * @returns {CollisionEvent} the current instance of CollisionEvent, reference to 'this' keyword\r\n     */\r\n\r\n    OnCollision(objects, siblings) {\r\n\r\n      this.objects = TypeCode.arrayWrap(objects || this.objects || []);\r\n\r\n      this.siblings = TypeCode.arrayWrap(siblings || this.siblings || []);\r\n\r\n      return this;\r\n    }\r\n\r\n    /**\r\n     * applies a callback to be called whenever the onBool function returns true\r\n     * @memberof CollisionEvent\r\n     * @param   {callbackFunction} callbackFunction the function to be called --replaces the value of collisionEvent.callback\r\n\r\n     * @returns {CollisionEvent} the current instance of CollisionEvent, reference to 'this' keyword\r\n     */\r\n\r\n    Call(callbackFunction) {\r\n\r\n      this.callback = callbackFunction || this.callback || function() {};\r\n\r\n      let $collision = this;\r\n\r\n      this.objects.forEach(function($obj){\r\n\r\n        $obj.onUpdate(function(){\r\n\r\n          var $sprite = this;\r\n\r\n          $collision.siblings.forEach(function($sib){\r\n            if($sprite.hasBoxCollision($sib))\r\n            {\r\n              $collision.callback($sprite, $sib);\r\n            }\r\n          });\r\n        });\r\n      });\r\n\r\n\r\n      return this;\r\n\r\n    }\r\n  };\r\n\r\n  /**\r\n   * returns BoolEvent --allows code to run whenever a conditional-function returns true\r\n   * @param   {onBool} onBool the function to be tested each update\r\n   * @param   {call} call the function to be called when onBool returns true;\r\n\r\n   * @returns {BoolEvent} a Gamelab.BoolEvent object\r\n   */\r\n\r\n\r\n  class BoolEvent extends GSEvent {\r\n    constructor(onBool, callback) {\r\n\r\n      super({});\r\n\r\n      this.bool = onBool || function() {\r\n        console.info('CustomBoolEvent():needs .on function(){}. --Add this as 1st argument or via chainable On() function returning bool argument');\r\n      }\r\n      /*Defaults to false to avoid broken code*/\r\n\r\n      this.callback = callback || function() {\r\n        console.info('CustomBoolEvent():needs .callback function(){} --Add this as 2nd argument or via chainable Call() function');\r\n      };\r\n\r\n      Gamelab.gs_events.push(this);\r\n\r\n    }\r\n\r\n    /**\r\n     * applies a boolFunction to be tested for true each update\r\n     * @param   {boolFunction} boolFunction the function to be tested each update --replaces the value of boolEvent.onBool\r\n\r\n     * @returns {BoolEvent} the current instance of BoolEvent, reference to 'this' keyword\r\n     */\r\n\r\n    On(boolFunction) {\r\n\r\n      this.bool = boolFunction;\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * applies a callback to be called whenever the onBool function returns true\r\n     * @memberof BoolEvent\r\n     * @param   {callbackFunction} callbackFunction the function to be called --replaces the value of boolEvent.callback\r\n\r\n     * @returns {BoolEvent} the current instance of BoolEvent, reference to 'this' keyword\r\n     */\r\n\r\n    Call(callbackFunction) {\r\n\r\n      this.callback = callbackFunction || this.callback || function() {};\r\n\r\n      return this;\r\n\r\n    }\r\n  };\r\n\r\n  BoolEvent.Bool = BoolEvent.On;\r\n\r\n  Gamelab.GSEvent = GSEvent;\r\n\r\n  Gamelab.Event = GSEvent;\r\n\r\n  Gamelab.GSEventLink = GSEventLink;\r\n\r\n  Gamelab.InputEvent = InputEvent;\r\n\r\n  Gamelab.GamepadEvent = GamepadEvent;\r\n\r\n  Gamelab.KeyboardEvent = KeyboardEvent;\r\n\r\n  Gamelab.CollisionEvent = CollisionEvent;\r\n\r\n  Gamelab.BoxCollisionEvent = CollisionEvent;\r\n\r\n  Gamelab.BoolEvent = BoolEvent;\r\n\r\n})();\r\n;(function() {\r\n  console.log('Frame class... creating');\r\n\r\n  /**\r\n   * Creates an instance of Frame\r\n   *\r\n   * <info-bit>Gamelab.Frame is called automatically by Gamelab.Sprite and Gamelab.Animation.\r\n   * Gamelab.Frame does not take arguments.\r\n   * It is instantiated, then initilized with chainable function-calls.</info-bit>\r\n   *\r\n   * @returns {Frame}\r\n   *\r\n   * @example\r\n   *\r\n   * var selected_frame = new Gamelab.Frame().Image(gameImage).Size(frameSizeVector);\r\n   */\r\n\r\n\r\n  class Frame {\r\n    constructor() {\r\n      var __inst = this;\r\n      this.framePos = new Gamelab.Vector(0, 0);\r\n      this.origin = new Gamelab.Vector(0, 0);\r\n      this.rotation = new Gamelab.Vector(0, 0, 0);\r\n    }\r\n\r\n    Image(src) {\r\n      this.image = new Gamelab.GameImage(src);\r\n      return this;\r\n    }\r\n\r\n    onLoad(fxn) {\r\n\r\n      fxn = fxn || function() {};\r\n      fxn = fxn.bind(this);\r\n      this.image.domElement.onload = function() {\r\n        fxn();\r\n      };\r\n\r\n    }\r\n\r\n    Origin(x, y, z) {\r\n      this.origin = new Gamelab.Vector(x, y, z);\r\n      return this;\r\n    }\r\n\r\n    Rotation(x, y, z) {\r\n      this.rotation = new Gamelab.Vector(x, y, z);\r\n      return this;\r\n    }\r\n\r\n    FramePos(p) {\r\n      this.framePos = new Gamelab.Vector(p, p, p);\r\n\r\n      return this;\r\n    }\r\n\r\n    FrameSize(x, y, z) {\r\n      this.frameSize = new Gamelab.Vector(x, y, z);\r\n      return this;\r\n    }\r\n\r\n    Scale(s)\r\n    {\r\n      if(this.image && this.image.domElement)\r\n      {\r\n        this.size = new Gamelab.Vector(Math.round(this.image.domElement.width * s), Math.round(this.image.domElement.height * s));\r\n      }  \r\n    }\r\n\r\n    StoreOffscreen() {\r\n\r\n      this.offscreen = this.offscreen || new Gamelab.OffscreenCanvasRendering(this.image);\r\n\r\n      for (var x in this.offscreen) {\r\n        if (x == 'ctx' || x == 'canvas')\r\n          this[x] = this.offscreen[x];\r\n      }\r\n\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    getURL() {\r\n      this.StoreOffscreen();\r\n      return this.offscreen.canvas.toDataURL();\r\n    }\r\n\r\n    getColoredPixelGrid(unitSize = 5, ctx) {\r\n\r\n      var grid = [];\r\n\r\n      ctx = ctx || this.ctx;\r\n\r\n      let min = this.framePos,\r\n        max = this.framePos.add(this.frameSize);\r\n\r\n\r\n      for (var x = min.x; x <= max.x; x += unitSize) {\r\n        for (var y = min.y; y <= max.y; y += unitSize) {\r\n          // Fetch pixel at current position\r\n          var pixel = ctx.getImageData(x, y, 1, 1);\r\n          // Check that opacity is above zero\r\n          if (pixel.data[3] != 0) {\r\n\r\n            var vector = new Gamelab.Vector(x, y),\r\n\r\n              gridObject = {\r\n\r\n                position: vector,\r\n\r\n                x:x,\r\n                y:y,\r\n\r\n                size: new Gamelab.Vector(unitSize, unitSize),\r\n\r\n                pixel: pixel,\r\n\r\n                rotation:this.rotation\r\n\r\n              };\r\n\r\n            grid.push(gridObject);\r\n          }\r\n        }\r\n      }\r\n\r\n      return grid;\r\n    }\r\n\r\n    getNonColoredPixelGrid(unitSize = 5, ctx) {\r\n\r\n      var grid = [];\r\n\r\n      ctx = ctx || this.ctx;\r\n\r\n      let min = this.framePos,\r\n        max = this.framePos.add(this.frameSize);\r\n\r\n\r\n      for (var x = min.x; x <= max.x; x += unitSize) {\r\n        for (var y = min.y; y <= max.y; y += unitSize) {\r\n          // Fetch pixel at current position\r\n          var pixel = ctx.getImageData(x, y, 1, 1);\r\n          // Check that opacity is above zero\r\n          if (pixel.data[3] == 0) {\r\n\r\n            var vector = new Gamelab.Vector(x, y),\r\n\r\n              gridObject = {\r\n\r\n                position: vector,\r\n\r\n                x:x,\r\n                y:y,\r\n\r\n                size: new Gamelab.Vector(unitSize, unitSize),\r\n\r\n                pixel: pixel,\r\n\r\n                rotation:this.rotation\r\n\r\n              };\r\n\r\n            grid.push(gridObject);\r\n          }\r\n        }\r\n      }\r\n\r\n      return grid;\r\n    }\r\n\r\n    getFullPixelGrid(unitSize = 5, ctx) {\r\n\r\n      ctx = ctx || this.ctx;\r\n\r\n      var grid = [];\r\n\r\n      let min = this.framePos,\r\n        max = this.framePos.add(this.frameSize);\r\n\r\n      for (var x = min.x; x <= max.x; x += unitSize) {\r\n        for (var y = min.y; y <= max.y; y += unitSize) {\r\n          // Fetch pixel at current position\r\n          var pixel = ctx.getImageData(x, y, 1, 1);\r\n          // Check that opacity is above zero\r\n\r\n\r\n          var vector = new Gamelab.Vector(x, y),\r\n\r\n            gridObject = {\r\n\r\n              position: vector,\r\n\r\n              x:x,\r\n              y:y,\r\n\r\n              size: new Gamelab.Vector(unitSize, unitSize),\r\n\r\n              pixel: pixel,\r\n\r\n              rotation:this.rotation\r\n\r\n            };\r\n\r\n          grid.push(gridObject);\r\n        }\r\n      }\r\n\r\n      return grid;\r\n    }\r\n\r\n\r\n    /**\r\n     * Creates and returns a ColorMap for this animation, allowing opacity-based pixel-collision.\r\n     *\r\n     * @function\r\n     * @param {number} unitDimen a Colormap grid-unit-size --A larger unitDimen decreases accuracy, and results in faster-processing.\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    createColorMap(size, ctx) {\r\n\r\n      this.StoreOffscreen();\r\n\r\n      ctx = ctx || this.ctx;\r\n\r\n      this.colorMap = this.colorMap || this.getColoredPixelGrid(size, ctx);\r\n\r\n      return this.colorMap;\r\n    }\r\n\r\n    createNonColorMap(size, ctx) {\r\n      this.StoreOffscreen();\r\n      ctx = ctx || this.ctx;\r\n      this.nonColorMap = this.nonColorMap || this.getNonColoredPixelGrid(size, ctx);\r\n      return this.nonColorMap;\r\n    }\r\n\r\n\r\n    createPixelMap(size, altImage) {\r\n      if(this.image.domElement instanceof HTMLCanvasElement)\r\n      {\r\n        this.canvas = this.image.domElement;\r\n        ctx = this.ctx = this.canvas.getContext('2d');\r\n      }\r\n      else{\r\n        this.StoreOffscreen();\r\n        ctx = ctx || this.ctx;\r\n      }\r\n\r\n      this.pixelMap = this.pixelMap || this.getFullPixelGrid(size, this.testCtx);\r\n      return this.fullPixelMap;\r\n    }\r\n\r\n  }\r\n\r\n  Gamelab.Frame = Frame;\r\n\r\n})();\r\n;/**\n * @ignore\n * */\n\nclass ControllerEventKeys {\n    constructor() {\n        return {\n\n            left_stick: false,\n\n            right_stick: false,\n\n            0: false,\n\n            1: false,\n\n            2: false,\n\n            3: false,\n\n            4: false,\n\n            5: false,\n\n            6: false,\n\n            7: false,\n\n            8: false,\n\n            9: false,\n\n            10: false,\n\n            11: false,\n\n            12: false,\n\n            13: false,\n\n            14: false,\n\n            15: false,\n\n            16: false,\n\n            17: false,\n\n            18: false,\n\n            19: false\n\n        }\n\n    }\n\n}\n\nGamelab.ControllerEventKeys = ControllerEventKeys;\n\n\n/**\n * Creates an instance of GamepadAdapter: --instead use the existing: Gamelab.GamepadAdapter, a working instance of this class.\n * -supports game-controller input for web-games\n * -accesses live gamepad input from the HTML5 Gamepad Api\n * @returns {GamepadAdapter} an instance of GamepadAdapter\n * */\n\nGamelab.gamepads = Gamelab.gamepads || [];\n\nclass GamepadAdapter {\n\n    constructor() {\n\n        this.__gamepads = [];\n\n        this.intervals = [];\n\n        let controller_stack = this;\n\n        let __gamepadMaster = this;\n\n        this.events = [];\n\n        window.addEventListener(\"gamepadconnected\", function (e) {\n            console.log(\"Gamepad connected at index %d: %s. %d buttons, %d axes.\",\n                e.gamepad.index, e.gamepad.id,\n                e.gamepad.buttons.length, e.gamepad.axes.length);\n\n            if (__gamepadMaster.mainLoop) {\n                window.clearInterval(__gamepadMaster.mainLoop);\n            }\n\n            __gamepadMaster.mainLoop = window.setInterval(function () {\n\n                var gps = navigator.getGamepads();\n\n                __gamepadMaster.gps = gps;\n\n                for (var x = 0; x < gps.length; x++) {\n\n                    var events = __gamepadMaster.__gamepads[x] ? __gamepadMaster.__gamepads[x] : {};\n\n                    __gamepadMaster.process(__gamepadMaster.gps[x], events);\n\n                }\n\n            }, 20);\n\n\n        });\n\n\n    }\n\n    gamepads() {\n\n        return navigator.getGamepads();\n\n    }\n\n    disconnect_all() {\n\n        for (var x = 0; x < this.intervals.length; x++) {\n\n            window.clearInterval(this.intervals[x]);\n\n        }\n    }\n\n    disconnect_by_index(game_pad_index) {\n\n        window.clearInterval(this.intervals[game_pad_index]);\n\n    }\n\n    hasAnyPad() {\n        return \"getGamepads\" in navigator;\n\n    }\n\n    Event(key, game_pad, callback) {\n        return {\n\n            key: key, game_pad: game_pad, callback: callback\n\n        }\n\n    }\n\n    GamepadEvents(args) {\n\n        var gp = {};\n\n        gp.stick_left = args.stick_left || function (x, y) {\n\n            //  console.log('Def call');\n\n        }\n\n        gp.stick_right = args.stick_right || function (x, y) {\n\n        }\n\n        gp.buttons = [];\n\n        gp.extendFunc = function (f1, f2) {\n\n            var fc = f2;\n\n            return function (x, y) {\n\n                f2(x, y);\n\n                f1(x, y);\n\n            }\n\n        };\n\n        gp.on = function (key, callback) {\n\n            if (this[key] && key !== \"on\") {\n\n                var current_cb = typeof(this[key]) == 'function' ? this[key] : function (x, y) {\n                };\n\n                this[key] = this.extendFunc(callback, current_cb);\n\n\n            }\n\n            else if (key.indexOf('button') >= 0 && key.indexOf('_') >= 0) {\n                var parts = key.split('_');\n\n                var number;\n\n                try {\n\n                    number = parseInt(parts[1]);\n\n\n                    var current_cb = typeof(this['buttons'][number]) == 'function' ? this['buttons'][number] : function (x, y) {\n                    };\n\n                    this['buttons'][number] = this.extendFunc(callback, current_cb);\n\n                }\n                catch (e) {\n                    console.error('could not parse \"on\" event with ' + key);\n\n                }\n\n            }\n\n\n        }\n\n        gp.constructor = {name: \"GamepadEvents\"};\n\n        this.__gamepads.push(gp);\n\n        Gamelab.gamepads = this.__gamepads;\n\n        return gp;\n\n    }\n\n    getGamepads() {\n        return Gamelab.gamepads;\n\n    }\n\n    process(gp, gpEvents) {\n\n        this.process_buttons(gp, gpEvents);\n\n        this.process_axes(gp, gpEvents);\n\n    }\n\n    process_axes(gp, events) {\n\n        if (!gp || !gp['axes']) {\n\n            return false;\n\n        }\n\n\n        for (var i = 0; i < gp.axes.length; i += 2) {\n\n            var axis1 = gp.axes[i], axia2 = gp.axes[i + 1];\n\n            var ix = (Math.ceil(i / 2) + 1), x = gp.axes[i], y = gp.axes[i + 1];\n\n            if (ix == 1 && events.stick_left) {\n                events.stick_left(x, y);\n\n            }\n\n            if (ix == 2 && events.stick_right) {\n                events.stick_right(x, y);\n\n            }\n\n            if (this.events && this.events['stick_' + i] && typeof(this.events['stick_' + i].callback) == 'function') {\n                this.events['stick_' + i].callback();\n\n            }\n        }\n\n    }\n\n\n    process_buttons(gp, events) {\n\n        if (!gp || !gp['buttons']) {\n            return false;\n\n        }\n\n        for (var i = 0; i < gp.buttons.length; i++) {\n\n            if (!events.buttons)\n                break;\n\n            else if (events.buttons.length > i && typeof(events.buttons[i]) == 'function') {\n                events.buttons[i](gp.buttons[i].pressed);\n            }\n            else if (events.buttons.length > i && typeof(events.buttons[i]) == 'object' && typeof(events.buttons[i].update) == 'function') {\n                events.buttons[i].update(events.buttons[i].pressed);\n\n            }\n            var clearance_1 = this.events && this.events[i], gpc, bkey = \"button_\" + i;\n\n            if (clearance_1) {\n                gpc = this.events[bkey] && !isNaN(this.events[bkey].game_pad) ? this.gamepads[this.events[bkey].game_pad] : this.events[bkey].game_pad;\n            }\n            ;\n\n            if (clearance_1 && gpc && typeof(this.events[bkey].callback) == 'function') {\n                //call the callback\n                this.events[i].callback();\n\n            }\n\n        }\n    }\n\n\n    on(key, gpix, callback) {\n\n        var keys = TypeCode.arrayWrap(key || []), gps = TypeCode.arrayWrap(gpix || []);;\n\n        for(var x in keys)\n        {\n            for(var y in gps)\n            {\n                if (gps[y] >= this.__gamepads.length) {\n\n                    this.__gamepads.push(this.GamepadEvents({}));\n\n                }\n\n                this.__gamepads[y].on(keys[x], callback);\n\n            }\n        }\n    }\n}\n\n/**********\n * NOTE: here we bind the instance, and NOT the instantiator.\n *\n * *********/\n\nif (!Gamelab.GamepadAdapter) {\n\n    Gamelab.GamepadAdapter = new GamepadAdapter();\n\n    // __gameInstance.gamepads.push(gamepad);\n\n}\n;class Line2d extends Scriptable {\r\n\r\n  constructor() {\r\n    super();\r\n    this.Object(this);\r\n    this.points = [];\r\n    this.position = new Gamelab.Vector(0, 0);\r\n    this.size = new Gamelab.Vector(0, 0);\r\n    this.index = 0;\r\n    this.lineWidth = 1.0;\r\n    this.call = function() {};\r\n  }\r\n\r\n  StepFunction(call) {\r\n    this.call = call;\r\n    return this;\r\n  }\r\n\r\n  next() {\r\n    this.index += 1;\r\n    return this.points[this.index % this.points.length];\r\n  }\r\n\r\n  Color(c) {\r\n    this.color = c;\r\n    return this;\r\n  }\r\n\r\n  Fill() {\r\n\r\n    for (var x = 1; x <= this.size.x; x++) {\r\n          var x_total = this.size.x;\r\n          var out_of_1 = x / x_total;\r\n          var next_x = this.position.x + x;\r\n          console.log('using x portion::' + out_of_1);\r\n          var next_y = this.position.y + (this.size.y * this.call(out_of_1, 1.0)),\r\n            next_point = new Gamelab.Vector(next_x, next_y);\r\n          this.points.push(next_point);\r\n      }\r\n\r\n    return this;\r\n  }\r\n\r\n  getOffsetPos(pos){\r\n    var offset = this.window_offset || new Gamelab.Vector(0, 0);\r\n    return pos.add(offset);\r\n  }\r\n\r\n  LineWidth(number)\r\n  {\r\n    this.lineWidth = number;\r\n    return this;\r\n  }\r\n\r\n  draw(ctx, camera) {\r\n\r\n    ctx = ctx || Gamelab.game_windows[0].ctx;\r\n    camera = camera || Gamelab.game_windows[0].camera;\r\n\r\n    var points = this.points;\r\n\r\n    ctx.save();\r\n    ctx.strokeStyle = this.color;\r\n    ctx.lineWidth = this.lineWidth;\r\n\r\n    ctx.beginPath();\r\n    if (points instanceof Array) {\r\n      for (var x = 0; x < points.length; x++) {\r\n        var p = points[x];\r\n\r\n        var position = p.position || p;\r\n\r\n        var real_pos = this.getOffsetPos(position);\r\n\r\n        if (real_pos.hasOwnProperty('x') && real_pos.hasOwnProperty('y')) {\r\n          if (x == 0)\r\n            ctx.moveTo(real_pos.x, real_pos.y)\r\n          else {\r\n            ctx.lineTo(real_pos.x, real_pos.y);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    ctx.stroke();\r\n    ctx.restore();\r\n\r\n  }\r\n\r\n}\r\n\r\nGamelab.Line2d = Line2d;\r\n\r\nGamelab.Line2D = Line2d;\r\n;\n/**\n * Creates a Sound instance. Implements HTML5-Audio object\n * --DevTODO : complete docs for the Sound class\n *\n * @param   {string} src the source-path of the targeted sound-file\n * @returns {Sound} instance of Gamelab.Sound\n * */\n\nclass Sound {\n\n    constructor(src, data) {\n\n        if (typeof(src) == 'object') {\n\n            this.sound = document.createElement('audio');\n\n            this.sound.src = src.src;\n\n            this.src = src.src;\n        }\n\n        else if (typeof(src) == 'string') {\n\n            this.sound = document.createElement('audio');\n\n            this.sound.src = src;\n\n            this.src = src;\n\n        }\n\n        if(typeof(data)=='object') {\n            for (var x in data) {\n                if (x !== 'sound') {\n                    this[x] = data[x];\n\n                }\n            }\n        }\n\n        this.onLoad = this.onLoad || function () {\n            };\n\n        if (typeof(this.onLoad) == 'function') {\n\n            this.onLoad(this.sound);\n\n        }\n\n    }\n\n    Loop(loop)\n    {\n        this.sound.loop = loop || true;\n\n        return this;\n\n    }\n\n    loop(loop) //same as Loop()\n    {\n        this.sound.loop = loop || true;\n\n        return this;\n\n    }\n\n\n    Volume(val)\n    {\n\n        this.sound.volume = val;\n\n        return this;\n\n    }\n\n\n    volume(val) //same as Volume()\n    {\n\n        this.sound.volume = val;\n\n        return this;\n\n    }\n\n    Play() {\n        if (typeof(this.sound) == 'object' && typeof(this.sound.play) == 'function') {\n\n            this.sound.play();\n\n        }\n\n        return this;\n\n    }\n\n    play() { //same as Play()\n        if (typeof(this.sound) == 'object' && typeof(this.sound.play) == 'function') {\n\n            this.sound.play();\n        }\n        return this;\n    }\n\n}\n\n\nclass SoundList{\n\n    constructor(list)\n    {\n        this.cix = 1;\n\n        this.sounds = [];\n\n        if(list instanceof Array)\n        {\n            for(var x in list)\n            {\n                if(list[x].src)\n                {\n                    this.sounds.push(new Sound(list[x].src, list[x]));\n\n                }\n                else if(typeof(list[x]) == 'string')\n                {\n                    this.sounds.push(new Sound(list[x]));\n\n                }\n            }\n        }\n    }\n\n    add(src, name)\n    {\n        if(typeof(src) == 'object' && src.src)\n        {\n            this.sounds.push(new Sound(src.src, src));\n\n        }\n        else if(typeof(src) == 'string')\n        {\n            var data = {};\n\n            if(name)\n            {\n                data.name = name;\n            }\n\n            this.sounds.push(new Sound(list[x], data));\n\n        }\n\n    }\n\n    Volume(v)\n    {\n        for(var x = 0; x < this.sounds.length;x++)\n        {\n            this.sounds[x].volume(v);\n\n        }\n\n        return this;\n    }\n\n    volume(v)\n    {\n        for(var x = 0; x < this.sounds.length;x++)\n        {\n            this.sounds[x].volume(v);\n\n        }\n\n        return this;\n    }\n\n\n    PlayNext()\n    {\n        this.sounds[this.cix % this.sounds.length].play();\n\n        this.cix += 1;\n\n    }\n\n    Play()\n    {\n\n        this.sounds[this.cix % this.sounds.length].play();\n\n        this.cix += 1;\n\n\n    }\n\n    playNext() //same as PlayNext()\n    {\n        this.sounds[this.cix % this.sounds.length].play();\n\n        this.cix += 1;\n\n    }\n\n    play() //same as Play()\n    {\n\n        this.sounds[this.cix % this.sounds.length].play();\n\n        this.cix += 1;\n\n\n    }\n\n}\n\nGamelab.Sound = Sound;\n\nGamelab.SoundList = SoundList;\n\n\n\n\nclass Audio {\n\n  constructor(){\n\n\n  }\n\n}\n\nGamelab.Audio = Audio;\n;(function() {\r\n  console.log('Animation class... creating');\r\n\r\n  /**\r\n   *\r\n   * Creates an instance of Animation with one or more Frames.\r\n   *\r\n   * <iframe style='width:400px; height:450px; overflow:hidden;' src='../client/examples/js-class/Animation.html'> </iframe>\r\n   *\r\n   * @param   {string=} [src] the src-image-path for this Animation\r\n   * @returns {Animation} an Animation object\r\n   *\r\n   * @example\r\n   *\r\n   * //constructor call: Creates a single-frame Animation from src\r\n   * var singleFrameAnime = new Animation('directory/myFile.png');\r\n   *\r\n   * @example\r\n   * //constructor call with chainable function-calls: Creates multi-frame Animation from src, then sets properties with chainable-function-calls.\r\n   * var multiFrameAnime = new Gamelab.Animation('../images/characters/full/spaceman1.png') //constructor is called\r\n   * .FrameSize(130, 130)\r\n   * .FrameBounds(new Gamelab.Vector(9, 0), new Gamelab.Vector(23, 0), new Gamelab.Vector(23, 0))\r\n   * .Seesaw() //The Animation will play back-and-forth repeatedly (cycle through frames forwards, then backwards and so on.\r\n   * .Duration(900); //Animation lasts 900 millis OR just under 1 second\r\n   *\r\n   *  @design\r\n   *\r\n   * //single-responsibility : to define a list of frames, then progress that list of frames with a 'selected_frame' property\r\n   * var singleFrameAnime = new Animation('directory/myFile.png');\r\n   */\r\n\r\n  class Animation {\r\n\r\n    constructor(src = {}) {\r\n\r\n      var args = typeof(src) == 'object' ? src : {};\r\n\r\n      //Gamelab.Modifiers.informable(this, args);\r\n\r\n      if (typeof src == 'string' || src instanceof HTMLCanvasElement) {\r\n        this.src = src;\r\n        this.image = new Gamelab.GameImage(src);\r\n        this.init_singleFrame();\r\n      } else if (args instanceof Gamelab.GameImage) {\r\n        console.log('Animation(): args are an instance of GameImage');\r\n\r\n        this.image = args;\r\n      } else if (args instanceof HTMLImageElement) {\r\n        console.log('Animation(): args was an instance of HTMLImageElement');\r\n\r\n        this.image = new Gamelab.GameImage(args);\r\n      } else if (args instanceof Gamelab.Animation) {\r\n\r\n        this.image = args.image;\r\n\r\n      } else if (typeof(args) == 'object' && args.src) {\r\n        this.src = args.src;\r\n        this.image = new Gamelab.GameImage(args.src);\r\n      }\r\n\r\n      this.min_cix = 0;\r\n\r\n      this.visible = args.visible || true;\r\n\r\n      /**\r\n       * @property {Vector} frameSize the frameSize of the Animation\r\n       * @memberof Animation\r\n       **********/\r\n\r\n      this.frameSize = this.frameSize || new Gamelab.Vector(args.frameSize || new Gamelab.Vector(0, 0));\r\n\r\n\r\n      if (args.frameBounds && args.frameBounds.min && args.frameBounds.max) {\r\n\r\n        /**\r\n         * @property {VectorFrameBounds} frameBounds the frameBounds of the Animation, has three Vectors\r\n         * @memberof Animation\r\n         **********/\r\n\r\n        this.frameBounds = new Gamelab.VectorFrameBounds(args.frameBounds.min, args.frameBounds.max, args.frameBounds.termPoint);\r\n\r\n      } else {\r\n\r\n        this.frameBounds = new Gamelab.VectorFrameBounds(new Gamelab.Vector(0, 0, 0), new Gamelab.Vector(0, 0, 0), new Gamelab.Vector(0, 0, 0));\r\n\r\n      }\r\n\r\n      this.scale = 1.0;\r\n\r\n      this.origin = new Gamelab.Vector(0, 0, 0);\r\n\r\n      this.position = new Gamelab.Vector(0, 0);\r\n\r\n      this.rotation = new Gamelab.Vector(0, 0, 0);\r\n\r\n      this.frameOffset = this.getArg(args, 'frameOffset', new Gamelab.Vector(0, 0, 0));\r\n\r\n      this.apply2DFrames();\r\n\r\n      this.flipX = this.getArg(args, 'flipX', false);\r\n\r\n      this.cix = 0;\r\n\r\n      /**\r\n       * @property {Frame} selected_frame the selected_frame of the Animation, a Gamelab.Frame\r\n       * @memberof Animation\r\n       **********/\r\n\r\n      this.selected_frame = this.frames[0] || false;\r\n\r\n      this.timer = 0;\r\n\r\n      this.duration = args.duration || 2000;\r\n\r\n      this.seesaw_mode = args.seesaw_mode || false;\r\n\r\n      this.reverse_frames = args.reverse_frames || false;\r\n\r\n      this.run_ext = args.run_ext || [];\r\n\r\n      this.complete_ext = args.complete_ext || [];\r\n\r\n\r\n      // this.colorMap = this.createColorMap(5);\r\n\r\n    }\r\n\r\n    set img_src(value) {\r\n      this.src = value;\r\n    }\r\n\r\n    get img_src() {\r\n      return this.src;\r\n    }\r\n\r\n    Origin(x, y, z) {\r\n      this.origin = new Gamelab.Vector(x, y, z);\r\n\r\n      this.frames.forEach(function($f) {\r\n        $f.origin = new Gamelab.Vector(x, y, z);\r\n      });\r\n      if (this.selected_frame) {\r\n        this.selected_frame.origin = new Gamelab.Vector(x, y, z);\r\n      }\r\n      return this;\r\n    }\r\n\r\n    Position(x, y, z) {\r\n      this.position = new Gamelab.Vector(x, y, z);\r\n\r\n      this.frames.forEach(function($f) {\r\n\r\n        $f.position = new Gamelab.Vector(x, y, z);\r\n\r\n      });\r\n\r\n      return this;\r\n    }\r\n\r\n    Size(x, y) {\r\n\r\n      this.size = new Gamelab.Vector(x, y);\r\n      this.frames.forEach(function(f) {\r\n\r\n        f.Size(x, y);\r\n\r\n      });\r\n      return this;\r\n    }\r\n\r\n    Bone(b) {\r\n      this.bone = b;\r\n      return this;\r\n    }\r\n\r\n    ParentBone(b) {\r\n      this.parentBone = b;\r\n      return this;\r\n    }\r\n\r\n    Rotation(x, y, z) {\r\n\r\n      this.rotation = new Gamelab.Vector(x, y, z);\r\n\r\n      this.frames.forEach(function($frame) {\r\n        $frame.Rotation(x, y, z);\r\n      });\r\n\r\n      return this;\r\n    }\r\n\r\n    Src(src, options = {}) {\r\n\r\n      if (typeof src == 'string') {\r\n\r\n        console.log('setting GameImage with string:' + src);\r\n        this.src = src;\r\n        this.image = new Gamelab.GameImage(src);\r\n\r\n      } else if (src instanceof GameImage) {\r\n        console.log('Animation(): args are an instance of GameImage');\r\n\r\n        this.image = src;\r\n      } else if (src instanceof HTMLImageElement) {\r\n        console.log('Animation(): args was an instance of HTMLImageElement');\r\n\r\n        this.image = new Gamelab.GameImage(src);\r\n      }\r\n\r\n      if (!options.frameBounds)\r\n        this.init_singleFrame();\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    Scale(s) {\r\n\r\n      this.scale = s;\r\n\r\n      if (this.image && this.image.domElement && this.image.domElement.width > 0) {\r\n        this.size = new Gamelab.Vector(this.image.domElement.width * s, this.image.domElement.height * s).round();\r\n        this.Size(this.size);\r\n      }\r\n\r\n      if(this.frames instanceof Array)\r\n      this.frames.forEach(function(f){\r\n\r\n        f.Scale(s);\r\n\r\n      });\r\n\r\n      return this;\r\n    }\r\n\r\n    Size(x, y, z) {\r\n\r\n      this.size = new Gamelab.Vector(x, y, z);\r\n\r\n      this.frames.forEach(function(f) {\r\n        f.size = new Gamelab.Vector(x, y, z);\r\n      });\r\n\r\n      return this;\r\n    }\r\n\r\n    Image(src) {\r\n\r\n      if (typeof(src) == 'string') {\r\n\r\n        console.log('setting GameImage with string:' + src);\r\n        this.src = src;\r\n        this.image = new Gamelab.GameImage(src);\r\n\r\n      } else if (src instanceof Gamelab.GameImage) {\r\n        console.log('Animation(): args are an instance of GameImage');\r\n\r\n        this.image = src;\r\n      } else if (src instanceof HTMLImageElement) {\r\n        console.log('Animation(): args was an instance of HTMLImageElement');\r\n\r\n        this.image = new Gamelab.GameImage(src);\r\n      }\r\n\r\n      this.init_singleFrame();\r\n\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * sets this Animation to a single-frame-animation, from existing image\r\n     * @function\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    init_singleFrame() {\r\n\r\n      var $anime = this;\r\n\r\n      $anime.load_call = $anime.load_call || function() {};\r\n\r\n      this.image.domElement.onload = function() {\r\n\r\n        //alert('Anime loaded');\r\n\r\n        $anime.FrameSize($anime.image.domElement.width, $anime.image.domElement.height)\r\n          .FrameBounds(new Gamelab.Vector(0, 0), new Gamelab.Vector(0, 0));\r\n\r\n        $anime.apply2DFrames();\r\n\r\n        $anime.Size($anime.frameSize.mult(new Gamelab.Vector($anime.scale, $anime.scale)));\r\n\r\n\r\n        $anime.load_call();\r\n\r\n      };\r\n\r\n      Gamelab.log('Animation():set single-frame animation');\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    /*****\r\n     * Overridable / Extendable functions\r\n     * -allows stacking of external object-function calls\r\n     ******/\r\n\r\n\r\n    /**\r\n     * Provides a function to be called when this Animation.image loads.\r\n     *\r\n     * @function\r\n     * @params {Function} call the function to be called on load\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    onLoad(call) {\r\n\r\n      var $anime = this;\r\n      call = call || function() {};\r\n\r\n      this.load_call = call;\r\n\r\n      this.image.domElement.onload = function() {\r\n\r\n        call.bind($anime).call();\r\n\r\n      };\r\n\r\n    }\r\n\r\n    /**\r\n     * Provides a function to be called whenever this Animation starts. Function should run every time the Animation reaches frame-index 0\r\n     *\r\n     * @function\r\n     * @params {Function} call the function to be called on start\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    onRun(call) {\r\n\r\n      if (this.run_ext.indexOf(call) == -1) {\r\n        this.run_ext.push(call.bind(this));\r\n      }\r\n    }\r\n\r\n\r\n    /**\r\n     * Provides a function to be called whenever this Animation completes. Function should run every time the Animation reaches it's last frame-index.\r\n     *\r\n     * @function\r\n     * @params {Function} call the function to be called on complete\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    onComplete(call) {\r\n\r\n      if (this.complete_ext.indexOf(call) == -1) {\r\n        this.complete_ext.push(call.bind(this));\r\n      }\r\n    }\r\n\r\n    call_on_run() {\r\n      //call any function extension that is present\r\n      for (var x = 0; x < this.run_ext.length; x++) {\r\n        this.run_ext[x](this);\r\n      }\r\n    }\r\n\r\n    call_on_complete() {\r\n      //call any function extension that is present\r\n      for (var x = 0; x < this.complete_ext.length; x++) {\r\n        this.complete_ext[x](this);\r\n      }\r\n    }\r\n\r\n\r\n    Visible(v) {\r\n      this.visible = v;\r\n      return this;\r\n    }\r\n\r\n\r\n    FrameSize(w, h) {\r\n      this.frameSize = new Gamelab.Vector(w, h);\r\n      this.__isInit = true;\r\n      this.run();\r\n      return this;\r\n    }\r\n\r\n    Hang() {\r\n      this._hang = true;\r\n      return this;\r\n    }\r\n\r\n    FrameBounds(minVector, maxVector, termVector) {\r\n      this.frameBounds = new Gamelab.VectorFrameBounds(minVector, maxVector, termVector);\r\n      this.__isInit = true;\r\n      this.run();\r\n      return this;\r\n    }\r\n\r\n    FrameOffset(x, y) {\r\n      this.frameOffset = new Gamelab.Vector(x, y);\r\n      return this;\r\n    }\r\n\r\n    Seesaw() {\r\n      if (!this.seesaw_mode) {\r\n        this.seesaw_mode = true;\r\n      }\r\n      return this;\r\n    }\r\n\r\n    Duration(millis) {\r\n      this.duration = millis;\r\n      return this;\r\n    }\r\n\r\n\r\n    /**\r\n     * Reverses all frames of the animation. Frames are then expected to run backwards.\r\n     *\r\n     * @function\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    ReverseFrames() {\r\n\r\n      this.reverse_frames = true;\r\n      return this;\r\n    }\r\n\r\n    /**\r\n     * Sets the animation a a single frame / full-image. Use before img is loaded\r\n     *\r\n     * @function\r\n     * @param {Vector} frameSize optional size param\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    SingleFrame() {\r\n      this.init_singleFrame();\r\n      return this;\r\n    }\r\n\r\n    getArg(args, key, fallback) {\r\n\r\n      if (args.hasOwnProperty(key)) {\r\n        return args[key];\r\n      } else {\r\n        return fallback;\r\n      }\r\n    }\r\n\r\n    init() {\r\n      this.apply2DFrames();\r\n      return this;\r\n    }\r\n\r\n\r\n    apply2DFrames() {\r\n\r\n      console.log('Running apply2DFrames(): --' + this.name);\r\n\r\n      this.frames = [];\r\n\r\n      if (!this.size) {\r\n        this.Size(this.frameSize.x, this.frameSize.y);\r\n      }\r\n\r\n      var fcount = 0;\r\n\r\n      var quitLoop = false;\r\n\r\n      for (let y = this.frameBounds.min.y; y <= this.frameBounds.max.y; y++) {\r\n\r\n        for (let x = this.frameBounds.min.x; x <= this.frameBounds.max.x; x++) {\r\n\r\n          let framePos = {\r\n            x: x * this.frameSize.x + this.frameOffset.x,\r\n            y: y * this.frameSize.y + this.frameOffset.y\r\n          };\r\n\r\n          var f = new Gamelab.Frame().Image(this.image).FramePos(framePos).FrameSize(this.frameSize).Origin(this.origin).Size(this.size || this.frameSize).Position(this.position || framePos);\r\n          f.Rotation(this.rotation);\r\n\r\n          this.frames.push(f);\r\n\r\n          if (x >= this.frameBounds.termPoint.x && y >= this.frameBounds.termPoint.y) {\r\n\r\n            quitLoop = true;\r\n\r\n            break;\r\n          }\r\n\r\n          fcount += 1;\r\n\r\n          if (quitLoop)\r\n            break;\r\n\r\n        }\r\n\r\n      }\r\n\r\n      this.frames[0] = this.selected_frame = this.frames[0] || new Gamelab.Frame().Image(this.image).FrameSize(this.frameSize).Size(this.frameSize);\r\n\r\n      if (this.seesaw_mode) {\r\n\r\n        // console.log('Animation: applying seesaw');\r\n\r\n        var frames_reversed = this.frames.slice().reverse();\r\n\r\n        this.frames.pop();\r\n\r\n        this.frames = this.frames.concat(frames_reversed);\r\n\r\n      }\r\n      if (this.reverse_frames) {\r\n        this.frames.reverse();\r\n      }\r\n    }\r\n\r\n    scaleOf(sized_Object) {\r\n\r\n      var s = TypeCode.getPreferredPropertyByKey(sized_Object, 'size', 'argument had nested size variable. Using this instead.');\r\n\r\n      return s.div(this.frameSize);\r\n\r\n    }\r\n\r\n    init_colorMap() {\r\n      TypeCode.info('init_colorMap()');\r\n\r\n      if (!TypeCode.allDefined([this.image, this.image.domElement]))\r\n        return [];\r\n\r\n      this.canvasObject = this.canvasObject || new Gamelab.OffscreenCanvasRendering(this.image);\r\n\r\n      this.colorMap = this.colorMap || this.ColoredPixelGrid();\r\n\r\n      return this.colorMap;\r\n    }\r\n\r\n\r\n    ColoredPixelGrid() {\r\n\r\n      I('ColoredPixelGrid()');\r\n\r\n      var image = this.image.domElement,\r\n\r\n        ctx = this.canvasObject.ctx,\r\n\r\n        grid = [],\r\n\r\n        frameSizeDiv = this.selected_frame.frameSize.div(12).round();\r\n\r\n      for (var x = 0; x <= image.width; x += frameSizeDiv.x) {\r\n        for (var y = 0; y <= image.height; y += frameSizeDiv.y) {\r\n          // Fetch pixel at current position\r\n          var pixel = ctx.getImageData(x, y, 1, 1);\r\n          // Check that opacity is above zero\r\n          if (pixel.data[3] != 0) {\r\n\r\n            var vector = new Gamelab.Vector(x, y),\r\n\r\n              gridObject = {\r\n\r\n                position: vector,\r\n\r\n                size: frameSizeDiv\r\n              };\r\n\r\n            grid.push(gridObject);\r\n          }\r\n        }\r\n      }\r\n\r\n      return grid;\r\n    }\r\n\r\n\r\n    /**\r\n     * Returns the existing ColorMap for this animation.\r\n     *\r\n     * @function\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    getCurrentPixelMap() {\r\n\r\n      TypeCode.info('getCurrentPixelMap()');\r\n      var map = [];\r\n      var frame = this.selected_frame;\r\n      let __inst = this;\r\n\r\n      this.colorMap = this.init_colorMap();\r\n\r\n      for (var x in this.colorMap) {\r\n        var c = this.colorMap[x];\r\n\r\n        if (Gamelab.Collision.boxesCollide(frame.framePos, frame.frameSize, c.position, c.size)) {\r\n          map.push(c);\r\n        }\r\n      }\r\n\r\n      return map;\r\n\r\n    }\r\n\r\n    /**\r\n     * Sets the frame to a specific array-index.\r\n     *\r\n     * @function\r\n     * @param {number} ix the frame-index to apply.\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    setFrame(ix) {\r\n      this.selected_frame = this.frames[ix];\r\n    }\r\n\r\n\r\n    /**\r\n     * extends the update of this animation with a new function to be called during the update\r\n     * --repeated calls will extend, (not replace) the update --Allows multiple extensions of the update\r\n     * @function\r\n     * @memberof Animation\r\n     * @param {function} fun the function to be appended to sprite.update\r\n     *\r\n     *  * @example\r\n     * // extend the behavior of your animation\r\n     * myAnime.onUpdate(function(spr)\r\n     *\r\n     *                    console.log('extended update'); //runs automatically whenever animation.update runs\r\n     *\r\n     *                   });\r\n     *\r\n     **********/\r\n\r\n\r\n    onUpdate(fun) {\r\n\r\n      fun = fun.bind(this);\r\n\r\n      let update = this.update.bind(this);\r\n      let __inst = this;\r\n      this.update = function(__inst) {\r\n        update(__inst);\r\n        fun(__inst);\r\n      };\r\n    }\r\n\r\n    update(){\r\n      this.update_frame();\r\n    }\r\n\r\n    update_frame() {\r\n\r\n      this.selected_frame = this.frames[Math.round(this.cix) % this.frames.length];\r\n    }\r\n\r\n    reset() {\r\n\r\n      this.apply2DFrames();\r\n\r\n      this.cix = 0;\r\n    }\r\n\r\n    /**\r\n     * Applies a continuous animation. Use this in parent-sprite's update if continuous animation is required.\r\n     * Also works as a single call at any time during game-update.\r\n     *\r\n     * @function\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    run() {\r\n\r\n\r\n      if (this.__frametype == 'single') {\r\n        return 0;\r\n      }\r\n\r\n      this.apply2DFrames();\r\n\r\n      this.cix += 1;\r\n\r\n      //update once:\r\n      this.update_frame();\r\n\r\n      if (this.cix % this.frames.length == 0) {\r\n\r\n        this.engage();\r\n\r\n      }\r\n    }\r\n\r\n    /**\r\n     * animate():: same as run()\r\n     *\r\n     * @function\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    animate() {\r\n\r\n\r\n      if (this.__frametype == 'single') {\r\n        return 0;\r\n      }\r\n\r\n      this.apply2DFrames();\r\n\r\n      //update once:\r\n      //this.update();\r\n\r\n      if (this.cix % this.frames.length == 0) {\r\n\r\n        this.engage();\r\n\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Engages, or updates the animation for a one full frame-cycle.\r\n     *\r\n     * @function\r\n     * @param {number} duration the number of milliseconds the animation should take.\r\n     * @memberof Animation\r\n     **********/\r\n\r\n    engage(duration) {\r\n\r\n      this.call_on_run();\r\n\r\n      duration = duration || this.duration || this.frames.length * 20;\r\n\r\n      if (this.__frametype == 'single') {\r\n        return 0;\r\n      }\r\n\r\n            //note support of min_cix (eg: min_cix of 1 if top-row starts 1 frame later than bottom)\r\n            if (this.cix >= this.frames.length - 1 || this.cix < this.min_cix) {\r\n              this.cix = this.min_cix;\r\n            }\r\n\r\n      let __inst = this;\r\n\r\n      //we have a target\r\n      this.tween = new TWEEN.Tween(this)\r\n        .easing(__inst.curve || TWEEN.Easing.Linear.None)\r\n\r\n        .to({\r\n          cix: this.min_cix + (this.frames.length - 1)\r\n        }, duration)\r\n        .onUpdate(function() {\r\n          //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n            //__inst.cix = Math.ceil(__inst.cix);\r\n\r\n          __inst.update_frame();\r\n\r\n        })\r\n        .onComplete(function() {\r\n          //console.log(objects[0].position.x, objects[0].position.y);\r\n\r\n          __inst.cix = __inst.min_cix;\r\n\r\n          __inst.call_on_complete();\r\n\r\n          __inst.isComplete = true;\r\n\r\n        });\r\n\r\n\r\n      if (this.cix == this.min_cix)\r\n        this.tween.start();\r\n\r\n\r\n    }\r\n  };\r\n\r\n  /** @memberof Gamelab */\r\n\r\n  Gamelab.Animation = Animation;\r\n\r\n  Gamelab.Animation.continuous = Gamelab.Animation.run; //'continuous is an alternate reference to 'run'.'\r\n\r\n  Gamelab.Animation.continue = Gamelab.Animation.run; //'continue is an alternate reference to 'run'.'\r\n\r\n  Gamelab.Animation.animate = Gamelab.Animation.run; //'animate is an alternate reference to 'run'.'\r\n\r\n})();\r\n;\r\n\r\n\r\nclass Box2D{\r\n\r\n  constructor(pos, size){\r\n    this.Position(pos | 0);\r\n    this.Size(size | 0);\r\n  }\r\n\r\n  Position(x, y)\r\n  {\r\n    this.position = new Gamelab.Vector(x, y);\r\n    return this;\r\n  }\r\n  Size(x, y)\r\n  {\r\n    this.size = new Gamelab.Vector(x, y);\r\n    return this;\r\n  }\r\n\r\n}\r\n\r\n\r\n\r\nGamelab.Box2D = Box2D;\r\n;\nclass Mesh\n{\n    constructor(vertices, position)\n    {\n    this.vertices = vertices;\n    this.position = position;\n    }\n}\n\n\nGamelab.Mesh = Mesh;\n;\r\n\r\n\r\nclass FeildSpan {\r\n  constructor(a, b, transition = 'linear', duration = 500) {\r\n    //console.log('FeildSpan(a, b, transition) :: transition may be the key-name of a curve or \"random\"');\r\n\r\n    this.a = a;\r\n    this.b = b;\r\n    this.transition = transition;\r\n    this.duration = duration;\r\n    this.ticker = 0;\r\n\r\n    this.Duration = function(d) {\r\n      this.duration = d;\r\n      return this;\r\n    };\r\n\r\n    this.Clone = function() {\r\n      return new FeildSpan(this.a, this.b, this.transition, this.duration);\r\n    };\r\n\r\n    this.reset = function() {\r\n      this.ticker = 0;\r\n    };\r\n\r\n    this.getValue = function() {\r\n\r\n      var option = this,\r\n\r\n        value = 0,\r\n\r\n        diff = option.a - option.b;\r\n        option.duration = option.duration || 500;\r\n        var tvalue = option.transition;\r\n\r\n        var curveMethod;\r\n\r\n      for (var x in Twix.Curves) {\r\n        if (x.toLowerCase() == option.transition.toLowerCase())\r\n          curveMethod = Twix.Curves[x].None || Twix.Curves[x].In;\r\n      }\r\n\r\n      if (tvalue == 'random') {\r\n        option.ticker += 1;\r\n\r\n        var finalValue = option.a;\r\n\r\n        if (option.a <= option.b) {\r\n          return option.a + Math.abs((Math.random() * diff));\r\n        } else {\r\n          return option.a - Math.abs((Math.random() * diff));\r\n        }\r\n\r\n\r\n      } else if (curveMethod) {\r\n\r\n        var portion = option.ticker / option.duration;\r\n\r\n        option.ticker += 1;\r\n\r\n        diff = Math.abs(diff);\r\n\r\n        var curveStep = Math.abs(curveMethod(portion) * diff);\r\n\r\n        var finalValue = option.a;\r\n\r\n        finalValue += option.a > option.b ? curveStep * -1 : curveStep;\r\n\r\n        if (option.ticker >= option.duration) {\r\n          return option.b;\r\n        }\r\n\r\n        return finalValue;\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n\r\nclass ColorFeildSpan {\r\n\r\n  constructor(a, b, transition = 'linear', duration = 500) {\r\n    this.a = a;\r\n    this.b = b;\r\n    this.transition = transition;\r\n    this.duration = duration;\r\n    this.ticker = 0;\r\n    this.colors = [];\r\n\r\n    this.Duration = function(d) {\r\n      this.duration = d;\r\n      return this;\r\n    };\r\n\r\n    this.Clone = function() {\r\n\r\n      return new ColorFeildSpan(this.a, this.b, this.transition, this.duration);\r\n    };\r\n\r\n    //runs 100 X , creates set of differential colors on the specified scale\r\n    for (var x = 0.0; x <= 1.0; x += 0.01) {\r\n      //use the x value to get the set of y values for this transition | curve (ex 'cubic')\r\n      var tvalue = this.transition !== 'random' ? this.transition : 'linear';\r\n      var option = JSON.parse(JSON.stringify(this)),\r\n        value = 0;\r\n\r\n      var curveMethod;\r\n\r\n      option.duration = option.duration || 500;\r\n\r\n      //if 'random' then create a linear scale to select from\r\n      if (this.transition == 'random') {\r\n        tvalue = 'linear';\r\n      }\r\n\r\n      var portion = x;\r\n\r\n      this.colors.push(Gamelab.ColorCalculator.scaledRGBAFromHex(option.a, option.b, portion));\r\n    };\r\n\r\n    this.reset = function() {\r\n      this.ticker = 0;\r\n    };\r\n\r\n\r\n    //getValue :: returns the color for current step\r\n    this.getValue = function() {\r\n      //calculate portion as step 0.0 - 1.0\r\n      var portion = this.ticker / this.duration;\r\n\r\n      //increment ticker\r\n      this.ticker += 1;\r\n\r\n      //handle random transition\r\n      if (this.transition == 'random') {\r\n        return this.colors[Math.floor(Math.random() * this.colors.length)];\r\n      }\r\n\r\n      //get the correct array-member of index 0-99 using portion\r\n      return this.colors[Math.floor(portion * 100)];\r\n    };\r\n\r\n  }\r\n\r\n}\r\n\r\nGamelab.FeildSpan = FeildSpan;\r\n\r\nGamelab.ColorFeildSpan = ColorFeildSpan;\r\n\r\n\r\nclass Particle {\r\n\r\n  constructor(options = {}, gameWindow) {\r\n\r\n    var canvas = document.createElement('CANVAS');\r\n\r\n    options.size = options.size || new Gamelab.Vector(2000, 2000);\r\n\r\n    options.birthrate = options.birthrate || new Gamelab.FeildSpan(8, 10, \"random\")\r\n\r\n    this.options = options;\r\n\r\n    canvas.width = options.size.x;\r\n    canvas.height = options.size.y;\r\n    canvas.style.display = 'none';\r\n\r\n    options.max = 1000;\r\n\r\n    this.Life(70, 70, 'random');\r\n\r\n    this.DefaultValues();\r\n\r\n    this.Options(options);\r\n\r\n    var sourceSprites = [],\r\n      livingSprites = [],\r\n      ctx = canvas.getContext('2d');\r\n\r\n    this.sourceSprites = [];\r\n\r\n    this.Src('./res/images/particles/colored-ring-01.png');\r\n\r\n    this.gameWindow = gameWindow;\r\n    this.ctx = ctx;\r\n    this.canvas = canvas;\r\n\r\n    this.sprites = [];\r\n    this.birthInterval = 0;\r\n    this.ticker = 0;\r\n    this.total = 0;\r\n    this.position = new Gamelab.Vector(200, 200);\r\n  }\r\n\r\n  DefaultValues() {\r\n    var def_life = 50;\r\n    this.BirthRate(4, 8, 'random', def_life);\r\n    this.Composite('lighter');\r\n    this.Scale(0.6, 0.8, 'quadratic', def_life);\r\n    this.Speed(7.5, 1.0, 'linear', def_life);\r\n    this.Alpha(1.0, 0.1, 'quintic', def_life);\r\n    this.Color('#ff0000', '#0000ff', 'quadratic', def_life);\r\n  }\r\n\r\n  Options(options) {\r\n\r\n    this.BirthRate(options.birthrate.a, options.birthrate.b, options.birthrate.transition, options.birthrate.duration);\r\n\r\n    this.Composite(options.composite || options.globalComposite || options.gobalCompositeOperation || 'lighter');\r\n\r\n    if(options.life)\r\n    this.Life(options.life.a, options.life.b, options.life.transition, 500);\r\n\r\n    var life = this.life.Clone().getValue();\r\n\r\n    if (options.angle)\r\n      this.Angle(options.angle.a, options.angle.b, options.angle.transition, life);\r\n\r\n    if (options.scale)\r\n      this.Scale(options.scale.a, options.scale.b, options.scale.transition, life);\r\n\r\n    if (options.speed)\r\n      this.Speed(options.speed.a, options.speed.b, options.speed.transition, life);\r\n\r\n    if (options.alpha)\r\n      this.Alpha(options.alpha.a, options.alpha.b, options.alpha.transition, life);\r\n\r\n    if (options.color)\r\n      this.Color(options.color.a, options.color.b, options.color.transition, life);\r\n  }\r\n\r\n  //Add delay per birth of particles\r\n  Delay(d) {\r\n    this.delay = d;\r\n    return this;\r\n  }\r\n\r\n  //flipX :: reverse the x-speed of sprite over x-axis\r\n  FlipX(value) {\r\n    this.flipX = value;\r\n\r\n    if (this.flipX) {\r\n      if (this.options.speed.a > 0) {\r\n        this.options.speed.a = -this.options.speed.a;\r\n      }\r\n      if (this.options.speed.b > 0) {\r\n        this.options.speed.b = -this.options.speed.b;\r\n      }\r\n    } else {\r\n      if (this.options.speed.a < 0) {\r\n        this.options.speed.a = -this.options.speed.a;\r\n      }\r\n      if (this.options.speed.b < 0) {\r\n        this.options.speed.b = -this.options.speed.b;\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  //Define the src (image) of the particle\r\n  Src(src) {\r\n\r\n    this.sourceSprites = [];\r\n    this.options.src = src;\r\n\r\n    for (var x = 0; x < this.options.max; x++) {\r\n      var sprite = new Gamelab.Sprite(this.options.src).Scale(this.options.scale.a);\r\n      sprite.options = this.options;\r\n      this.sourceSprites.push(sprite);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  //Total particles to draw from\r\n  Stock(stock) {\r\n    this.options.stock = stock;\r\n    return this;\r\n  }\r\n\r\n  //birth rate, updateable\r\n  BirthRate(a, b, transition, life) {\r\n    this.options.birthrate = new Gamelab.FeildSpan(a, b, transition, life);\r\n    return this;\r\n  }\r\n\r\n  OffsetAllByX(x) {\r\n\r\n    var particle = this;\r\n\r\n    this.sprites.forEach(function(sprite) {\r\n      if (!sprite.detached_particle && sprite.flipX == particle.flipX)\r\n        sprite.position.x += x;\r\n      else {\r\n        sprite.detached_particle = true;\r\n      }\r\n    });\r\n\r\n    return this;\r\n  }\r\n\r\n  //composite :: example value = 'lighter'\r\n  Composite(c) {\r\n    this.options.globalCompositeOperation = c;\r\n    return this;\r\n  }\r\n\r\n  //Life span\r\n  Life(a, b, transition, duration = 500) {\r\n    this.life = new Gamelab.FeildSpan(a, b, transition, duration);\r\n    return this;\r\n  }\r\n\r\n  Color(a, b, transition, life) {\r\n    this.options.color = new Gamelab.ColorFeildSpan(a, b, transition, life);\r\n  }\r\n\r\n  //scale transition\r\n  Scale(a, b, transition, life) {\r\n    this.options.scale = new Gamelab.FeildSpan(a, b, transition, life);\r\n    return this;\r\n  }\r\n\r\n  //allowable angles\r\n  Angle(a, b, transition, life) {\r\n    this.options.angle = new Gamelab.FeildSpan(a, b, transition, life);\r\n    return this;\r\n  }\r\n\r\n  //alpha transition\r\n  Alpha(a, b, transition, life) {\r\n    this.options.alpha = new Gamelab.FeildSpan(a, b, transition, life);\r\n    return this;\r\n  }\r\n\r\n  //speed transition\r\n  Speed(a, b, transition, life) {\r\n    this.options.speed = new Gamelab.FeildSpan(a, b, transition, life);\r\n    return this;\r\n  }\r\n\r\n  addParticles(total) {\r\n\r\n    var options = this.options;\r\n\r\n    for (var x = 0; x < total; x++) {\r\n\r\n      this.total += 1;\r\n\r\n      var sprite = this.sourceSprites[this.total % this.sourceSprites.length];\r\n\r\n      if (sprite.constructor.name !== 'Sprite') {\r\n        console.error('not a sprite');\r\n      }\r\n\r\n      sprite.Scale(2.0);\r\n\r\n      sprite.detached_particle = false;\r\n\r\n      sprite.Position(this.position);\r\n\r\n      sprite.flipX = this.flipX;\r\n\r\n      var particle = this;\r\n\r\n      sprite.flyByRotation = function(angle, speed) {\r\n\r\n        this.speed = Gamelab.Trig.rotational_speed(angle, speed);\r\n\r\n        this.position = this.position.add(this.speed);\r\n\r\n      };\r\n\r\n      sprite.ticker = 0;\r\n\r\n      sprite.gunOptions = {};\r\n\r\n      sprite.gunOptions.life = this.life.Clone();\r\n\r\n      sprite.life = sprite.gunOptions.life.getValue();\r\n\r\n      sprite.gunOptions.angle = options.angle.Duration(sprite.life).Clone();\r\n\r\n      sprite.gunOptions.color = options.color.Duration(sprite.life).Clone();\r\n\r\n      sprite.gunOptions.alpha = options.alpha.Duration(sprite.life).Clone();\r\n\r\n      sprite.gunOptions.speed = options.speed.Duration(sprite.life).Clone();\r\n\r\n      sprite.gunOptions.scale = options.scale.Duration(sprite.life).Clone();\r\n\r\n      sprite.opacity = sprite.gunOptions.alpha.getValue();\r\n\r\n      sprite.color = sprite.gunOptions.color.getValue();\r\n\r\n      sprite.scale = sprite.gunOptions.scale.getValue();\r\n\r\n      sprite.EffectCanvas(sprite.color);\r\n\r\n      sprite.globalCompositeOperation = options.globalCompositeOperation || 'lighter';\r\n\r\n      var angleDiff = Math.abs(options.angle.a - options.angle.b);\r\n\r\n      sprite.fly_angle = sprite.gunOptions.angle.getValue();\r\n\r\n      sprite.Scale(sprite.scale);\r\n\r\n\r\n      sprite.update = function() {\r\n\r\n        this.ticker += 1;\r\n\r\n        if (this.life <= 0) {\r\n          particle.sprites.splice(particle.sprites.indexOf(this), 1);\r\n          gameWindow.remove(this);\r\n        }\r\n\r\n\r\n                this.scale = this.gunOptions.scale.getValue();\r\n\r\n                this.Scale(this.scale);\r\n\r\n                this.anime.Scale(this.scale);\r\n\r\n        this.color = this.gunOptions.color.getValue();\r\n\r\n        this.Opacity(this.gunOptions.alpha.getValue());\r\n\r\n        this.EffectCanvas(this.color);\r\n\r\n        this.gunSpeed = this.gunOptions.speed.getValue();\r\n\r\n        this.flyByRotation(this.fly_angle % 360, this.gunSpeed);\r\n      };\r\n\r\n      this.sprites.push(sprite);\r\n\r\n      this.gameWindow.add(sprite);\r\n    }\r\n  }\r\n\r\n  shoot() {\r\n\r\n    this.ticker += 1;\r\n\r\n    if (this.birthInterval < 1)\r\n      this.birthInterval = 1;\r\n\r\n    if (this.ticker % this.birthInterval == 0) {\r\n\r\n      this.addParticles(this.options.birthrate.getValue());\r\n\r\n    }\r\n\r\n  }\r\n}\r\n\r\n\r\nGamelab.Particle = Particle;\r\n;/**\r\n * Creates a new Sprite.\r\n *\r\n * <info-bit>Gamelab.Sprite is a container for 2D Animations.\r\n * -apply Sprite class to create a 2D game-object.\r\n *\r\n * Sprites hold reference to their-own Animations and Sounds.</info-bit>\r\n * <iframe style='width:400px; height:450px; overflow:hidden;' src='../client/examples/js-class/Sprite.html'> </iframe>\r\n\r\n * @param   {string} src the srcPath for the image of the Sprite\r\n * @param   {number} scale=1.0 the scale to be applied to size of each animation-frame\r\n *\r\n * @returns {Sprite} a Gamelab.Sprite object\r\n *\r\n *\r\n *\r\n */\r\n\r\nvar Checkers = {\r\n\r\n    ListProps:function(array, props, call){\r\n\r\n      array.forEach(function(){\r\n\r\n\r\n\r\n      });\r\n\r\n    }\r\n\r\n};\r\n\r\nclass Sprite extends Scriptable {\r\n  constructor(src = {}, scale = 1.0) {\r\n    super();\r\n    this.Object(this);\r\n\r\n    var args = typeof src == 'object' ? src : {};\r\n\r\n\r\n    if (args instanceof Gamelab.Animation) //instantiate from animation\r\n    {\r\n      console.dev('args was Gamelab.Animation', args);\r\n      args = {\r\n        selected_animation: args,\r\n        image: args.image,\r\n        size: new Gamelab.Vector(args.frameSize)\r\n      };\r\n    }\r\n\r\n    this.animations = [];\r\n\r\n    //create size property\r\n    this.size = new Gamelab.Vector(0, 0);\r\n    this.active = true; //defaults to active or visible\r\n\r\n\r\n    //apply image from string 'src'\r\n\r\n    if (src instanceof HTMLCanvasElement) {\r\n      this.src = src;\r\n      this.selected_animation = new Gamelab.Animation(src);\r\n      this.image = this.selected_animation.image;\r\n      this.animations = [];\r\n      this.animations.push(this.selected_animation);\r\n      this.SingleFrame();\r\n    } else if (typeof src == 'string') {\r\n      this.src = src;\r\n      this.selected_animation = new Gamelab.Animation(src);\r\n      this.image = this.selected_animation.image;\r\n      this.animations = [];\r\n      this.animations.push(this.selected_animation);\r\n      this.SingleFrame();\r\n    }\r\n\r\n    if (typeof(scale) == 'number') //image plus 'scale' argument\r\n    {\r\n      this.scale = scale || 1.0;\r\n    }\r\n\r\n    //apply remaining args\r\n    this.apply_args(args);\r\n\r\n    if (!this.selected_animation)\r\n      this.SingleFrame();\r\n  }\r\n\r\n\r\n  Size(x, y, z) {\r\n    this.size = new Gamelab.Vector(x, y, z);\r\n    if (this.selected_animation && this.selected_animation.frames instanceof Array) {\r\n      this.selected_animation.Size(vector);\r\n    }\r\n    return this.size;\r\n  }\r\n\r\n\r\n  static_image_load(img) {\r\n    this.size = new Gamelab.Vector(img.width * this.scale, img.height * this.scale).round();\r\n  }\r\n\r\n  EffectCanvas(color) {\r\n\r\n    this.effectCanvas = document.createElement('CANVAS');\r\n\r\n    var img = this.image.domElement;\r\n\r\n    this.effectCanvas.width = img.width;\r\n    this.effectCanvas.height = img.height;\r\n\r\n    this.effectCtx = this.effectCanvas.getContext('2d');\r\n\r\n\r\n    this.effectCtx.drawImage(img, 0, 0, img.width, img.height);\r\n\r\n    this.effectCtx.fillStyle = color;\r\n    this.effectCtx.globalAlpha = 0.62;\r\n    this.effectCtx.globalCompositeOperation = \"source-atop\";\r\n    this.effectCtx.fillRect(0, 0, img.width, img.height);\r\n    this.effectCtx.globalCompositeOperation = \"source-over\";\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * runs a function for the onload event of this sprite's image\r\n   *\r\n   * @function\r\n   * @param {Function} f the function to be called on load\r\n   * @memberof Sprite\r\n   **********/\r\n\r\n  onLoad(f) {\r\n\r\n    if (this.src instanceof HTMLCanvasElement) {\r\n\r\n      var f = f || function() {};\r\n\r\n      f.bind(this).call(false);\r\n\r\n    }\r\n\r\n    if (this.image && this.image.domElement) {\r\n\r\n      var img = this.image.domElement,\r\n\r\n        load = img.onload;\r\n\r\n      f = f || function() {};\r\n\r\n      f.bind(this);\r\n\r\n      this.load_call = f;\r\n\r\n      var $sprite = this;\r\n\r\n      img.onload = function() {\r\n\r\n        $sprite.load_total += 1;\r\n\r\n        load.bind($sprite).call(false, $sprite);\r\n        //  $sprite.static_image_load(img);\r\n        $sprite.load_call(false, $sprite);\r\n      };\r\n\r\n      img.onerror = function(err) {\r\n        $sprite.load_call(true, $sprite);\r\n      }\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n\r\n  Opacity(o) {\r\n\r\n    this.opacity = o;\r\n    return this;\r\n  }\r\n\r\n\r\n  /**********\r\n   * @ignore\r\n   **********/\r\n\r\n  apply_args(args = {}) {\r\n\r\n    this.FromData(args, true); //Using a FUNCTIONAL COPY --heavy to process\r\n\r\n\r\n    function array_instance(list) {\r\n      return list.slice(0);\r\n    };\r\n\r\n    if (args.image instanceof Gamelab.GameImage && !this.image) {\r\n      this.image = args.image;\r\n    }\r\n\r\n    this.name = args.name || \"__blankName\";\r\n\r\n    this.life = args.life || 999999999999;\r\n\r\n    this.description = args.description || \"__spriteDesc\";\r\n\r\n    this.opacity = args.opacity || 1.0;\r\n\r\n    this.color = args.color || '#ffffff';\r\n\r\n\r\n    /**\r\n     * @property {String} id the unique identifier of the Sprite --called automatically on constructor.\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    this.id = this.create_id();\r\n\r\n\r\n    /**\r\n     * @property {Array} animations the array of animations attached to the Sprite\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    var listnames = ['animations', 'bones', 'meshes', 'scripts', 'events', 'sounds'];\r\n\r\n    var $object = this;\r\n\r\n    listnames.forEach(function(ln) {\r\n\r\n      $object[ln] = array_instance(Gamelab.getArg(args, ln, []));\r\n\r\n    });\r\n\r\n\r\n    /**\r\n     * @property {Array} scripts the array of scripts attached to the Sprite\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    this.motions = Gamelab.getArg(args, 'motions', []);\r\n\r\n    this.particles = Gamelab.getArg(args, 'particles', []);\r\n\r\n    this.shots = Gamelab.getArg(args, 'shots', []);\r\n\r\n    this.init_ext = Gamelab.getArg(args, 'init_ext', []);\r\n\r\n    this.group = Gamelab.getArg(args, 'group', 'one');\r\n\r\n    this.scrollFactor = args.scrollFactor || 1.0;\r\n\r\n    this.noScroll = args.noScroll || false;\r\n\r\n    if (this.noScroll) {\r\n      this.scrollFactor = 0;\r\n    }\r\n\r\n\r\n    /**\r\n     * @property {Vector} speed the speed of the Sprite\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    this.speed = new Gamelab.Vector(Gamelab.getArg(args, 'speed', new Gamelab.Vector(0, 0)));\r\n\r\n    /**\r\n     * @property {Vector} size the vector-size of the Sprite\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    this.size = new Gamelab.Vector(Gamelab.getArg(args, 'size', new Gamelab.Vector(0, 0)));\r\n\r\n\r\n    /**\r\n     * @property {Vector} position the position of the Sprite\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    this.position = new Gamelab.Vector(Gamelab.getArg(args, 'position', new Gamelab.Vector(0, 0, 0)));\r\n\r\n\r\n    this.realPosition = new Gamelab.Vector(Gamelab.getArg(args, 'realPosition', new Gamelab.Vector(0, 0, 0)));\r\n\r\n    this.collision_bounds = Gamelab.getArg(args, 'collision_bounds', new Gamelab.VectorBounds(new Gamelab.Vector(0, 0, 0), new Gamelab.Vector(0, 0, 0)));\r\n\r\n\r\n    /**\r\n     *\r\n     *\r\n     * @property {Vector} rotation the rotation of the Sprite\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    this.rotation = new Gamelab.Vector(Gamelab.getArg(args, 'rotation', new Gamelab.Vector(0, 0, 0)));\r\n\r\n\r\n    /**\r\n     * @property {number} scale the scale of the Sprite, controls draw-size\r\n     * @memberof Sprite\r\n     **********/\r\n\r\n    this.scale = args.scale || 1.0;\r\n\r\n    this.acceleration = Gamelab.getArg(args, 'acceleration', new Gamelab.Vector(0, 0, 0));\r\n\r\n    this.rot_speed = new Gamelab.Vector(Gamelab.getArg(args, 'rot_speed', new Gamelab.Vector(0, 0)));\r\n\r\n    this.rot_accel = new Gamelab.Vector(Gamelab.getArg(args, 'rot_accel', new Gamelab.Vector(0, 0)));\r\n\r\n    this.padding = Gamelab.getArg(args, 'padding', new Gamelab.Vector(0, 0, 0));\r\n\r\n\r\n    var __inst = this;\r\n\r\n    //Apply / instantiate Sound(), Gamelab.Motion(), and Gamelab.Animation() args...\r\n\r\n\r\n    Gamelab.each(this.shots, function(ix, item) {\r\n\r\n      __inst.shots[ix] = new Gamelab.Shot(item);\r\n\r\n    });\r\n\r\n    Gamelab.each(this.sounds, function(ix, item) {\r\n\r\n      __inst.sounds[ix] = new Gamelab.Sound(item);\r\n\r\n    });\r\n\r\n    Gamelab.each(this.motions, function(ix, item) {\r\n\r\n      __inst.motions[ix] = new Gamelab.TweenMotion(item);\r\n\r\n    });\r\n\r\n    Gamelab.each(this.animations, function(ix, item) {\r\n\r\n      __inst.animations[ix] = new Gamelab.Animation(item);\r\n\r\n    });\r\n\r\n    Gamelab.each(this.particles, function(ix, item) {\r\n\r\n      __inst.particles[ix] = new Gamelab.GSProton(item);\r\n\r\n    });\r\n\r\n    //Apply initializers:\r\n\r\n    Gamelab.each(this.init_ext, function(ix, item) {\r\n\r\n      __inst.addInitializer(item);\r\n\r\n    });\r\n\r\n    if (!this.selected_animation && args.selected_animation) {\r\n\r\n      console.dev('applying animation:' + jstr(args.selected_animation));\r\n      this.selected_animation = new Gamelab.Animation(args.selected_animation);\r\n\r\n      this.animations = [];\r\n      if (this.animations.indexOf(this.selected_animation) == -1)\r\n        this.animations.push(this.selected_animation);\r\n\r\n    }\r\n  }\r\n\r\n  RealPosition() {\r\n    return this.realPosition;\r\n  }\r\n\r\n  Origin(x, y) {\r\n\r\n    this.origin = new Gamelab.Vector(x, y);\r\n\r\n    var sprite = this;\r\n\r\n    this.animations.forEach(function($anime) {\r\n\r\n      $anime.Origin(sprite.origin);\r\n\r\n    });\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * Clones a sprite from existing data\r\n   *\r\n   * @function\r\n   * @param {Object} object the data to be cloned\r\n   * @memberof Sprite\r\n   **********/\r\n\r\n  Clone(sprite) {\r\n    console.log('using Clone() function');\r\n\r\n    var clone = new Gamelab.Sprite(sprite.src);\r\n\r\n    clone.Anime(new Gamelab.Animation(sprite.anime));\r\n\r\n    clone.apply_args(sprite);\r\n\r\n    return clone;\r\n  }\r\n\r\n  draw(ctx, camera) {\r\n\r\n    var sprite;\r\n\r\n    if (this.constructor.name == 'SpriteBrush') {\r\n      sprite = this.selected_sprite;\r\n    } else {\r\n      sprite = this;\r\n    }\r\n\r\n    camera = camera || false;\r\n\r\n    if (!camera && Gamelab.game_windows[0] && Gamelab.game_windows[0].camera)\r\n      camera = Gamelab.game_windows[0].camera;\r\n\r\n    else if (!camera) {\r\n      camera = {\r\n        position: new Gamelab.Vector(0, 0, 0)\r\n      };\r\n    }\r\n\r\n    if (sprite.active && (this.DRAWOFFSCREEN || sprite.onScreen(Gamelab.WIDTH, Gamelab.HEIGHT))) {\r\n      this.draw_current_frame(ctx, camera);\r\n    }\r\n  }\r\n\r\n\r\n  draw_current_frame(ctx, camera) {\r\n\r\n    var sprite;\r\n\r\n    if (this.constructor.name == 'SpriteBrush') {\r\n      sprite = this.selected_sprite;\r\n    } else {\r\n      sprite = this;\r\n    }\r\n\r\n    var frame = false,\r\n      frameList = [];\r\n\r\n    if (sprite.active) {\r\n\r\n      if (sprite.selected_animation instanceof Array && sprite.selected_animation.length >= 1) {\r\n        sprite.selected_animation.forEach(function(anime) {\r\n\r\n          frameList.push(anime.selected_frame);\r\n\r\n        });\r\n      }\r\n\r\n      if (sprite.selected_animation instanceof Object && sprite.selected_animation.hasOwnProperty('selected_frame')) {\r\n\r\n        frame = sprite.selected_animation.selected_frame;\r\n\r\n      }\r\n\r\n      var p = sprite.position;\r\n\r\n      var camera_pos = camera.position || {\r\n        x: 0,\r\n        y: 0,\r\n        z: 0\r\n      };\r\n\r\n      if (!sprite.hasOwnProperty('scrollFactor')) {\r\n        sprite.scrollFactor = 1.0;\r\n      }\r\n\r\n      var x = p.x,\r\n        y = p.y,\r\n        scrollFactor = sprite.scrollFactor >= -1.0 && sprite.scrollFactor <= 1.0 ? sprite.scrollFactor : 1.0;\r\n\r\n      if (sprite.noScroll) {\r\n        scrollFactor = 0;\r\n      }\r\n\r\n\r\n      //optional animation : gameSize\r\n\r\n      var targetSize = sprite.size || sprite.selected_animation.size;\r\n\r\n      var realWidth = targetSize.x;\r\n      var realHeight = targetSize.y;\r\n\r\n\r\n      var origin = sprite.origin || new Gamelab.Vector(realWidth / 2, realHeight / 2);\r\n\r\n      //optional animation : offset\r\n\r\n      var rotation;\r\n\r\n      if (typeof(sprite.rotation) == 'object') {\r\n        rotation = sprite.rotation.x;\r\n\r\n      } else {\r\n        rotation = sprite.rotation;\r\n      }\r\n\r\n      if(!(sprite.selected_animation && sprite.selected_animation.selected_frame))\r\n      {\r\n        return;\r\n      }\r\n\r\n      var frame = sprite.selected_animation.selected_frame;      \r\n\r\n      if (frame && frame.image && frame.image.data) {\r\n\r\n        ctx.putImageData(frame.image.data, x, y, 0, 0, sprite.size.x, sprite.size.y);\r\n\r\n      } else {\r\n\r\n        if (frameList.length >= 1) {\r\n\r\n          frameList.forEach(function(frame) {\r\n\r\n            var realWidth = frame.size.x;\r\n            var realHeight = frame.size.y;\r\n\r\n            var xpos = frame.position.x,\r\n              ypos = frame.position.y;\r\n\r\n            x += sprite.position.x;\r\n            y += sprite.position.y;\r\n\r\n            x -= camera_pos.x * scrollFactor || 0;\r\n            y -= camera_pos.y * scrollFactor || 0;\r\n\r\n            sprite.realPosition = new Gamelab.Vector(x, y);\r\n\r\n            if (frame.rotation && typeof frame.rotation.x == 'number') {\r\n              rotation = frame.rotation.x;\r\n            }\r\n\r\n            if (frame.origin) {\r\n              origin = frame.origin;\r\n              //console.log('drawing with origin:' + origin.x + ':' + origin.y);\r\n            }\r\n\r\n            if (frame && frame.image)\r\n              Gamelab.Canvas.draw_image_frame(sprite.effectCanvas ? sprite.effectCanvas : frame.image.domElement, frame.framePos, frame.frameSize, new Gamelab.Vector2D(Math.round(xpos + (origin.x)), Math.round(ypos + (origin.y))), new Gamelab.Vector2D(realWidth, realHeight), rotation % 360, ctx, sprite.flipX, sprite.flipY, origin, this.opacity, this.globalCompositeOperation || false);\r\n\r\n          });\r\n\r\n        } else {\r\n          var fx = frame.position.x,\r\n            fy = frame.position.y,\r\n            pos = new Gamelab.Vector(x + fx, y + fy);\r\n\r\n          pos.x -= camera_pos.x * scrollFactor || 0;\r\n          pos.y -= camera_pos.y * scrollFactor || 0;\r\n          sprite.realPosition = pos;\r\n          if (frame.image.domElement instanceof HTMLImageElement || frame.image.domElement instanceof HTMLCanvasElement) {\r\n            Gamelab.Canvas.draw_image_frame(this.effectCanvas ? this.effectCanvas : frame.image.domElement, frame.framePos, frame.frameSize, new Gamelab.Vector2D(Math.round(pos.x + (origin.x)), Math.round(pos.y + (origin.y))), new Gamelab.Vector2D(realWidth, realHeight), rotation % 360, ctx, sprite.flipX, sprite.flipY, origin, this.opacity, this.globalCompositeOperation || false);\r\n          }\r\n\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * adds an animation to the sprites\r\n   *\r\n   * @function\r\n   * @param {Object} object the animation to be added\r\n   * @memberof Sprite\r\n   **********/\r\n\r\n\r\n  Add(object) {\r\n\r\n    if (object instanceof Gamelab.Animation) {\r\n      this.animations.add(object);\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  get animation() {\r\n    return this.selected_animation;\r\n  }\r\n\r\n  get anime() {\r\n    return this.selected_animation;\r\n  }\r\n\r\n  Anime(anime) {\r\n    if (anime)\r\n      this.selected_animation = anime;\r\n    return this;\r\n  }\r\n\r\n\r\n  Animation(anime) {\r\n    if (anime)\r\n      this.selected_animation = anime;\r\n    return this;\r\n  }\r\n\r\n\r\n  FromData(data = {}, fxlCopy = false) {\r\n    for (var x in data) {\r\n      if (fxlCopy || typeof(data[x]) !== 'function')\r\n        this[x] = data[x];\r\n    }\r\n    return this;\r\n  }\r\n\r\n  FromSourceImage(src) {\r\n    return new this.constructor(src);\r\n  }\r\n\r\n  /**************************************************************\r\n   * scales the sprite.size property according to image-size.\r\n   * @param {number} scaleFloat a 0-1+ value\r\n   *\r\n   * @function\r\n   * @memberof Sprite\r\n   **************************************************************/\r\n\r\n  Scale(scaleFloat) {\r\n\r\n    this.scale = scaleFloat;\r\n\r\n    this.size = new Gamelab.Vector(this.image.domElement.width * scaleFloat, this.image.domElement.height * scaleFloat);\r\n\r\n    return this;\r\n  }\r\n\r\n\r\n  /**************************************************************\r\n   * applies a float value arg to Sprite.scrollFactor\r\n   * @param {number} s a 0-1+ value\r\n   *\r\n   * @function\r\n   * @memberof Sprite\r\n   **************************************************************/\r\n\r\n\r\n  ScrollFactor(s) {\r\n    this.scrollFactor = s;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n\r\n  engage(obj) //engages an object having an engage function\r\n  {\r\n\r\n    obj.parent = this;\r\n\r\n    if (obj.engage) {\r\n      obj.engage();\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * pass argument v to the sprite.life property.\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {number} v number of render-updates that this Sprite will last. --update occurs 60+ times per second, or less, depending on performance\r\n   * @returns {Sprite} the sprite object --enables chainable function calls\r\n   **********/\r\n\r\n  Life(v) {\r\n\r\n    this.life = v;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * initializes sprites. triggers all functions previously passed to the addInitializer function.\r\n   * Use this function when a sprite, instantiated from json-data, carries initializers.\r\n   * --This feature is built for the purpose of data-persistence. --sprites from json-file may carry behaviors onto the scene.\r\n   *\r\n   * @function\r\n   * @memberof Sprite\r\n   **********/\r\n\r\n  init() {\r\n\r\n\r\n  }\r\n\r\n  /**\r\n   * extends the init function.\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {function} fun the function to be passed into the init function of the sprite\r\n   **********/\r\n\r\n  addInitializer(fun) {\r\n\r\n    let boundFun = fun.bind(this)\r\n\r\n    if (this.init_ext.indexOf(boundFun) < 0) {\r\n\r\n      this.init_ext.push(boundFun)\r\n    };\r\n\r\n  }\r\n\r\n  /*****************************\r\n   * Getters\r\n   ***************************/\r\n\r\n  /**\r\n   * returns the 'id' property of the sprite\r\n   * @function\r\n   * @memberof Sprite\r\n   * @returns {string}\r\n   **********/\r\n\r\n  get_id() {\r\n    return this.id;\r\n  }\r\n\r\n  /**********\r\n   * @ignore\r\n   **********/\r\n\r\n  to_map_object(size, framesize) {\r\n\r\n    this.__mapSize = new Gamelab.Vector(size || this.size);\r\n\r\n    this.frameSize = new Gamelab.Vector(framesize || this.size);\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n  /*****************************\r\n   * Setters and Creators\r\n   ***************************/\r\n\r\n  /**\r\n   * creates a unique string id property for the sprite.\r\n   * @function\r\n   * @memberof Sprite\r\n   * @returns {string}\r\n   **********/\r\n\r\n  create_id() {\r\n\r\n    return Gamelab.create_id();\r\n\r\n  }\r\n\r\n  /**\r\n   * returns a maximum scaled size, according to max dimensions of width and height\r\n   * @param {number} mx the maximum size.x for the returned size\r\n   * @param {number} my the maximum size.y for the returned size\r\n   * @function\r\n   * @memberof Sprite\r\n   * @returns {Vector} a vector of x,y,z? values\r\n   **********/\r\n\r\n  getSizeByMax(mx, my) {\r\n\r\n    var size = new Gamelab.Vector(this.size);\r\n\r\n    var wth = size.y / size.x;\r\n\r\n    var htw = size.x / size.y;\r\n\r\n    if (size.x > mx) {\r\n      size.x = mx;\r\n\r\n      size.y = size.x * wth;\r\n\r\n    }\r\n\r\n    if (size.y > my) {\r\n      size.y = my;\r\n\r\n      size.x = size.y * htw;\r\n\r\n    }\r\n\r\n    return size;\r\n\r\n  }\r\n\r\n  /*****************************\r\n   *  assert the existence of a speed{} property\r\n   *  sprite.speed (vector) is created if not existing in sprite\r\n   *  @memberof Sprite\r\n   ***************************/\r\n\r\n  assertSpeed() {\r\n    if (!this.speed) {\r\n      this.speed = new Gamelab.Vector(0, 0, 0);\r\n    }\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * set the 'selected_animation' property to a single-frame-animation\r\n   * @function\r\n   * @memberof Sprite\r\n   **********/\r\n\r\n  SingleFrame() {\r\n\r\n    if (!this.image || !this.image.domElement) {\r\n      return this;\r\n    }\r\n\r\n    var __inst = this,\r\n      load = this.image.domElement.onload || function() {};\r\n\r\n    if (this.size && this.size.x !== 0 && this.size.y !== 0)\r\n      return;\r\n\r\n    var _obj = this;\r\n\r\n    if (this.image.domElement instanceof HTMLCanvasElement) {\r\n      if (_obj.size && _obj.size.x !== 0 && _obj.size.y !== 0) {\r\n\r\n      } else {\r\n        __inst.size = new Gamelab.Vector(__inst.image.domElement.width, __inst.image.domElement.height);\r\n        __inst.selected_animation = new Gamelab.Animation(this.image.domElement).FrameSize(__inst.size);\r\n        __inst.animations = [];\r\n        __inst.animations.push(__inst.selected_animation);\r\n        __inst.Scale(__inst.scale || 1.0);\r\n      }\r\n\r\n      return this;\r\n\r\n    }\r\n\r\n    this.image.domElement.onload = function() {\r\n\r\n      load(false, __inst);\r\n\r\n      if (_obj.size && _obj.size.x !== 0 && _obj.size.y !== 0) {\r\n\r\n      } else {\r\n        __inst.size = new Gamelab.Vector(__inst.image.domElement.width, __inst.image.domElement.height);\r\n        __inst.selected_animation = new Gamelab.Animation(__inst.image).FrameSize(__inst.size);\r\n        __inst.animations = [];\r\n        __inst.animations.push(__inst.selected_animation);\r\n        __inst.Scale(__inst.scale || 1.0);\r\n      }\r\n\r\n    };\r\n\r\n    Gamelab.log('set single-frame animation');\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * set the 'life' property to a specified integer\r\n   * @function\r\n   * @memberof Sprite\r\n   **********/\r\n\r\n  LifeSpan(value) {\r\n    this.life = value;\r\n  }\r\n\r\n  /**\r\n   * set the 'life' property to a specified integer\r\n   * @function\r\n   * @memberof Sprite\r\n   **********/\r\n\r\n  Life(value) //same as LifeSpan\r\n  {\r\n    this.life = value;\r\n  }\r\n\r\n  /**\r\n   * tells if sprite has been taken out of game\r\n   * @function\r\n   * @memberof Sprite\r\n   **********/\r\n\r\n  isDead(gw) {\r\n\r\n    gw = gw || Gamelab.game_windows[0];\r\n\r\n    return this.hasOwnProperty('life') && this.life <= 0;\r\n  }\r\n\r\n  /**\r\n   * sets life to 0, then ending the sprite\r\n   * @function\r\n   * @memberof Sprite\r\n   **********/\r\n\r\n  die(gw) {\r\n\r\n    this.life = 0;\r\n\r\n    return this;\r\n\r\n  }\r\n\r\n  /**\r\n   * indicates if any portion of the sprite is within screen bounds --uses Gamelab.WIDTH, Gamelab.HEIGHT OR any w,h arguments passed to this method\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {number} w optional screen-width argument, defaults to Gamelab.WIDTH\r\n   * @param {number} h optional screen-height argument, defaults to Gamelab.HEIGHT\r\n   * @returns {boolean} a true or false value to show if any part of the sprite is on-screen\r\n   **********/\r\n\r\n  onScreen(w, h, gw) {\r\n\r\n    w = w || Gamelab.WIDTH;\r\n\r\n    h = h || Gamelab.HEIGHT;\r\n\r\n    gw = gw || Gamelab.game_windows[0];\r\n\r\n    var camera = gw && gw.camera ? gw.camera : Gamelab && Gamelab.camera ? Gamelab.camera : {\r\n        position: new Gamelab.Vector(0, 0, 0)\r\n      },\r\n      scrollFactor = this.noScroll ? 0 : this.scrollFactor;\r\n\r\n    var sprite = this,\r\n\r\n      p = sprite.position,\r\n\r\n      camera_pos = camera.position || {\r\n        x: 0,\r\n        y: 0,\r\n        z: 0\r\n      };\r\n\r\n    if (!sprite.hasOwnProperty('scrollFactor')) {\r\n      sprite.scrollFactor = 1.0;\r\n    }\r\n\r\n    var x = p.x,\r\n      y = p.y,\r\n      scrollFactor = sprite.scrollFactor >= -1.0 && sprite.scrollFactor <= 1.0 ? sprite.scrollFactor : 1.0;\r\n\r\n    if (sprite.noScroll) {\r\n      scrollFactor = 0;\r\n    }\r\n\r\n    x -= camera_pos.x * scrollFactor || 0;\r\n    y -= camera_pos.y * scrollFactor || 0;\r\n\r\n    return x + sprite.size.x > -1000 - w && x < w + 1000 &&\r\n      y + sprite.size.y > 0 - 1000 - h && y < h + 1000;\r\n\r\n  }\r\n\r\n  /*****************************\r\n   * Updates\r\n   ***************************/\r\n\r\n  /*****************************\r\n   * update()\r\n   * -starts empty:: is applied recursively by Gamelab.js as the main sprite-update\r\n   ***************************/\r\n\r\n  /**\r\n   * the main update for the sprite --applied recursively by GameWindow after gameWindow.start is called\r\n   * @function\r\n   * @memberof Sprite\r\n   **********/\r\n\r\n  update(sprite) {}\r\n\r\n  /*****************************\r\n   * def_update()\r\n   * -applies speed and other default factors of movement\r\n   * -is used by Quick2d.js as the system def_update (default update)\r\n   ***************************/\r\n\r\n  /**\r\n   * Automatically updates various speed and rotational properties for the Sprite()\r\n   * @function\r\n   * @memberof Sprite\r\n   *\r\n   * @example\r\n   * // applies a constant speed property --speed is Vector(x, y)\r\n   * mySprite.rot_speed = new Gamelab.Vector(3);\r\n   * //def_update() will run automatically with the gamelab update. The above sprite will rotate at a constant speed of 3.\r\n   * @example\r\n   * // how to reset to nothing:: if automatic speed updates are undesired, replace the def_update() function with a 'do nothing' function.\r\n   * mySprite.def_update = function()\r\n   *                      {\r\n   *                     //do nothing\r\n   *                     };\r\n   **********/\r\n\r\n\r\n  def_update(sprite) {\r\n\r\n    if (this.hasOwnProperty('life') && !isNaN(this.life)) {\r\n\r\n      this.life -= 1;\r\n\r\n    };\r\n\r\n    for (var x in this.speed) {\r\n\r\n      if (this.speed[x] > 0 || this.speed[x] < 0) {\r\n\r\n        this.position[x] += this.speed[x];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var x in this.acceleration) {\r\n\r\n      if (this.acceleration[x] > 0 || this.acceleration[x] < 0) {\r\n\r\n        this.speed[x] += this.acceleration[x];\r\n\r\n      }\r\n\r\n    }\r\n\r\n    for (var x in this.rot_speed) {\r\n\r\n      if (this.rot_speed[x] > 0 || this.rot_speed[x] < 0) {\r\n\r\n        this.rotation[x] += this.rot_speed[x];\r\n\r\n      }\r\n\r\n\r\n    }\r\n\r\n    for (var x in this.rot_accel) {\r\n\r\n\r\n      if (this.rot_accel[x] > 0 || this.rot_accel[x] < 0) {\r\n\r\n        this.rot_speed[x] += this.rot_accel[x];\r\n\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * extends an existing function, and is applied by Gamelab in addInitializer();\r\n   * @ignore\r\n   * -REMOVED FROM DOCS : SYSTEM USE ONLY\r\n   **********/\r\n\r\n  extendFunc(fun, extendedFunc) {\r\n\r\n    console.log('extending func');\r\n\r\n    var ef = extendedFunc;\r\n\r\n    var __inst = this;\r\n\r\n    return function() {\r\n\r\n      ef(__inst);\r\n\r\n      //any new function comes after\r\n\r\n      fun(__inst);\r\n\r\n    }.bind(this);\r\n\r\n  }\r\n\r\n\r\n  /*****************************\r\n   *  onUpdate(fun)\r\n   * -args: 1 function(sprite){ } //the self-instance/sprite is passed into the function()\r\n   * -overrides and maintains existing code for update(){} function\r\n   ***************************/\r\n\r\n\r\n  /**\r\n   * extends the update of this sprite with a new function to be called during the update\r\n   * --repeated calls will extend, (not replace) the update --Allows multiple extensions of the update\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {function} fun the function to be appended to sprite.update\r\n   *\r\n   *  * @example\r\n   * // extend the behavior of your sprite\r\n   * mySprite.onUpdate(function(spr)\r\n   *\r\n   *                    console.log('extended update'); //runs automatically whenever sprite.update runs\r\n   *\r\n   *                   });\r\n   *\r\n   **********/\r\n\r\n\r\n  onUpdate(fun) {\r\n\r\n    var id = this.create_id();\r\n\r\n    fun = fun.bind(this);\r\n\r\n    let update = this.update.bind(this);\r\n\r\n    let __inst = this;\r\n\r\n    this.update = function(__inst) {\r\n\r\n      update(__inst);\r\n\r\n      fun(__inst);\r\n\r\n    };\r\n  }\r\n\r\n  /*****************************\r\n   *  travelLineTwoWay()\r\n   *  -sprite travels line: any Line() or object with property of line\r\n   ***************************/\r\n\r\n  /********************************************************************************\r\n   * sprite travels on a line in a back-and-forth motion --to the end of the line, and back.\r\n   * #Dev-todo:MORE ON THIS\r\n   * @function\r\n   * @memberof Sprite\r\n   *********************************************************************************/\r\n\r\n  travelLineTwoWay(lineObject, speed, curveKey, offset) {\r\n\r\n    speed = speed || 1;\r\n\r\n    var motionCurveOptions = [\"linear\", \"quadratic\", \"cubic\"];\r\n\r\n    curveKey = curveKey || \"linear\";\r\n\r\n    var line = lineObject;\r\n\r\n    if (lineObject.line) {\r\n      line = lineObject.line;\r\n    }\r\n\r\n    this.__crtLineIx = this.__crtLineIx || 0;\r\n\r\n    var __inst = this,\r\n\r\n      pctFloat = __inst.__crtLineIx % ((line.points.length - 1) / 2) / ((line.points.length - 1) / 2);\r\n\r\n    if (__inst.__crtLineIx >= ((line.points.length - 1) / 2)) {\r\n      pctFloat = 1.0 - pctFloat;\r\n\r\n    }\r\n\r\n    var ixChange = Gamelab.Curves.InOut[curveKey](pctFloat) * speed * 0.5;\r\n\r\n    if (curveKey == 'linear') {\r\n      ixChange = speed;\r\n    }\r\n\r\n    ixChange = Math.ceil(ixChange);\r\n\r\n    if (ixChange < 1) {\r\n      ixChange = 1;\r\n    }\r\n\r\n    __inst.position = new Gamelab.Vector(line.points[__inst.__crtLineIx]);\r\n\r\n    //console.log(ixChange);\r\n\r\n    __inst.__crtLineIx += ixChange;\r\n\r\n    if (__inst.__crtLineIx >= line.points.length) {\r\n\r\n      line.points = line.points.reverse();\r\n      __inst.__crtLineIx = 0;\r\n    }\r\n\r\n    if (offset instanceof Gamelab.Vector) {\r\n      this.position = this.position.add(offset);\r\n    }\r\n  }\r\n\r\n\r\n  /*****************************\r\n   *  travelLineOnLoop()\r\n   *  -sprite travels line: any Line() or object with property of line\r\n   ***************************/\r\n\r\n  /**\r\n   * the sprite travels one line in a looping motion --useful for traveling Square, Circle, or other enclosed Lines.\r\n   * #Dev-todo:MORE ON THIS\r\n   * @function\r\n   * @memberof Sprite\r\n   **********/\r\n\r\n  travelLineOnLoop(lineObject, speed, curveKey, offset) {\r\n\r\n    speed = speed || 1;\r\n\r\n    var motionCurveOptions = [\"linear\", \"quadratic\", \"cubic\"];\r\n\r\n    curveKey = curveKey || \"linear\";\r\n\r\n    var line = lineObject;\r\n\r\n    if (lineObject.line) {\r\n      line = lineObject.line;\r\n    }\r\n\r\n    this.__crtLineIx = this.__crtLineIx || 0;\r\n\r\n    var __inst = this,\r\n\r\n      pctFloat = __inst.__crtLineIx % ((line.points.length - 1) / 2) / ((line.points.length - 1) / 2);\r\n\r\n    if (__inst.__crtLineIx >= ((line.points.length - 1) / 2)) {\r\n      pctFloat = 1.0 - pctFloat;\r\n\r\n    }\r\n\r\n    var ixChange = Gamelab.Curves.InOut[curveKey](pctFloat) * speed * 0.5;\r\n\r\n    if (curveKey == 'linear') {\r\n      ixChange = speed;\r\n    }\r\n\r\n    ixChange = Math.ceil(ixChange);\r\n\r\n    if (ixChange < 1) {\r\n      ixChange = 1;\r\n    }\r\n\r\n    __inst.position = new Gamelab.Vector(line.points[__inst.__crtLineIx]);\r\n\r\n    // console.log(ixChange);\r\n\r\n    __inst.__crtLineIx += ixChange;\r\n\r\n    if (__inst.__crtLineIx >= line.points.length) {\r\n      __inst.__crtLineIx = 0;\r\n    }\r\n\r\n    if (offset instanceof Gamelab.Vector) {\r\n      this.position = this.position.add(offset);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * returns a true || false value for immediate color-collision --non-transparent-pixels --between colored-pixels of this sprite and the sprite argument\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Sprite} spr the sprite object to be collided\r\n   * @returns {boolean} a true or false value to show if collision is happening\r\n   **********/\r\n\r\n  hasPixelCollision(sprite) {\r\n\r\n    if (!TypeCode.truthyPropsPerArray([this, sprite], 'selected_animation'))\r\n      return;\r\n\r\n    if (!TypeCode.truthyPropsPerArray([this.selected_animation, sprite.selected_animation], 'getCurrentPixelMap'))\r\n      return;\r\n\r\n    let anime = this.selected_animation,\r\n      alt_anime = sprite.selected_animation;\r\n\r\n    var grid1 = anime.selectedFramePixelMap = this.selected_animation.getCurrentPixelMap(),\r\n\r\n      grid2 = alt_anime.selectedFramePixelMap = alt_anime.getCurrentPixelMap();\r\n\r\n    for (var x in grid1) {\r\n      for (var y in grid2) {\r\n        if (Gamelab.Collision.boxesCollide(grid1[x].position, grid1[x].size, grid2[y].position, grid2[y].size)) {\r\n          return true;\r\n\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  init_pixelCollision() {\r\n    let anime = this.selected_animation;\r\n\r\n    this.selectedFramePixelMap = anime.getCurrentPixelMap(anime.scaleOf(this.size));\r\n    this.colliderHighlights = this.colliderHighlights || [];\r\n  }\r\n\r\n  init_colliderHighlights(unitMarker) {\r\n    while (this.colliderHighlights.length < 100) {\r\n      var sprite = new Gamelab.Sprite(unitMarker);\r\n      this.colliderHighlights.push(sprite);\r\n      Gamelab.game_windows[0].add(sprite);\r\n    }\r\n  }\r\n\r\n  pixelGridOff() {\r\n\r\n\r\n  }\r\n\r\n  set_colliderHighlights(hSprite, on) {\r\n    this.collider_highlightsOn = on || false;\r\n\r\n    this.init_pixelCollision();\r\n\r\n    this.init_colliderHighlights(hSprite);\r\n\r\n    let anime = this.selected_animation;\r\n\r\n    for (var x in this.colliderHighlights) {\r\n      this.colliderHighlights[x].active = false;\r\n    }\r\n\r\n    if (hSprite && this.collider_highlightsOn)\r\n      for (var x in this.selectedFramePixelMap) {\r\n        if (!this.colliderHighlights[x]) {\r\n          continue;\r\n        }\r\n\r\n        let gridPiece = this.selectedFramePixelMap[x];\r\n\r\n        let anime_scale = anime.scaleOf(this.size),\r\n          real_gridPiece_pos = gridPiece.position.mult(anime_scale),\r\n          real_gridPiece_size = gridPiece.size.mult(anime_scale);\r\n\r\n        this.colliderHighlights[x].Pos(this.position.add(new Gamelab.Vector(real_gridPiece_pos.x, real_gridPiece_pos.y).sub(anime.selected_frame.framePos.mult(anime_scale))));\r\n\r\n        this.colliderHighlights[x].Size(real_gridPiece_size);\r\n\r\n        this.colliderHighlights[x].active = true;\r\n      };\r\n\r\n  }\r\n\r\n  onPixelCollision(sprite, callback, highlightSprite) {\r\n\r\n    let anime = this.selected_animation;\r\n\r\n    this.onUpdate(function() {\r\n\r\n      var anime = this.selected_animation;\r\n\r\n      if (this.hasPixelCollision(sprite)) {\r\n\r\n        if (!this.colliderHighlights) {\r\n\r\n\r\n        } else\r\n          for (var x in colliderHighlights) {\r\n            gameWindow.remove(colliderHighlights[x]);\r\n          };\r\n\r\n        callback(this, sprite);\r\n\r\n      };\r\n\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n   * returns a true || false value for immediate box-collision --between this sprite and the sprite argument\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Sprite} sprite the alternate Sprite for collision detection\r\n   * @returns {boolean} a true or false value to show if collision is happening\r\n   **********/\r\n\r\n  hasBoxCollision(sprite) {\r\n\r\n    return Gamelab.Collision.spriteBoxesCollide(this, sprite);\r\n\r\n  }\r\n\r\n  onBoxCollision(sprite, callback) {\r\n    this.onUpdate(function() {\r\n\r\n      if (this.hasBoxCollision(sprite, this.boxCollisionSettings.padding)) {\r\n\r\n        callback(this, sprite);\r\n\r\n      };\r\n    });\r\n  }\r\n\r\n  /*****************************\r\n   *  shoot(sprite)\r\n   *  -fire a shot from the sprite:: as in a firing gun or spaceship\r\n   *  -takes options{} for number of shots anglePerShot etc...\r\n   *  -TODO: complete and test this code\r\n   ***************************/\r\n\r\n\r\n  /**\r\n   * fire a Shot, or bullet-Sprite from the Sprite\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Object} options an object of arguments\r\n   * @param {Gamelab.Animation} animation the animation to fire from the Sprite\r\n   * @param {number} speed the speed of the shot that is projected\r\n   * @param {Gamelab.Vector} position the initial position of the shot: defaults to current Sprite position\r\n   * @param {Gamelab.Vector} size the Vector size of the shot\r\n   * @param {Gamelab.Vector} rot_offset the rotational offset to apply: controls direction of the shot\r\n   **********/\r\n\r\n  shoot(options, gw) {\r\n    //character shoots an animation\r\n\r\n    gw = gw || Gamelab.game_windows[0];\r\n\r\n    this.prep_key = 'shoot';\r\n\r\n    let animation = options.bullet || options.animation || options.anime || new Gamelab.Animation();\r\n\r\n    let speed = options.speed || options.velocity || 1;\r\n\r\n\r\n    let size = options.size || new Gamelab.Vector(10, 10, 0);\r\n\r\n    let position = new Gamelab.Vector(options.position) || new Gamelab.Vector(this.position);\r\n\r\n\r\n    let rot_offset = options.rot_offset || options.rotation || 0;\r\n\r\n    let total = options.total || 1;\r\n\r\n    let rot_disp = options.rot_disp || 0; //the full rotational-dispersion of the bullets\r\n\r\n    let life = options.life || 900;\r\n\r\n    var shots = [];\r\n\r\n    for (var x = 0; x < total; x++) {\r\n\r\n      var __playerInst = this;\r\n\r\n      if (Gamelab.isAtPlay) {\r\n\r\n        var bx = position.x,\r\n          by = position.y,\r\n          bw = size.x,\r\n          bh = size.y;\r\n\r\n        var shot = new Gamelab.Sprite().FromData({\r\n\r\n          active: true,\r\n\r\n          position: new Gamelab.Vector(position),\r\n\r\n          size: new Gamelab.Vector(size),\r\n\r\n          speed: speed,\r\n\r\n          image: animation.image,\r\n\r\n          rotation: new Gamelab.Vector(0, 0, 0),\r\n\r\n          flipX: false,\r\n\r\n          life: options.life,\r\n\r\n          noScroll: true\r\n\r\n        });\r\n\r\n\r\n        shot.Animation(animation);\r\n\r\n        rot_offset = new Gamelab.Vector(rot_offset, 0, 0);\r\n\r\n        shot.position.x = bx, shot.position.y = by;\r\n\r\n        //Danger On this line: annoying math --dispersing rotation of bullets by rot_disp\r\n\r\n        var div = rot_disp / total;\r\n\r\n        var rotPlus = div * x + div / 2 - rot_disp / 2;\r\n\r\n        shot.rotation.x = rot_offset.x + rotPlus;\r\n\r\n        //  shot.origin = new Gamelab.Vector(position);\r\n\r\n        shot.speed = new Gamelab.Vector(Math.cos((shot.rotation.x) * 3.14 / 180) * speed, Math.sin((shot.rotation.x) * 3.14 / 180) * speed);\r\n\r\n        shots.push(shot);\r\n\r\n        shot.onUpdate(function(spr) {\r\n          // console.log('update:rotation:' + shot.rotation.x);\r\n\r\n\r\n        });\r\n\r\n        gw.add(shot);\r\n      }\r\n    }\r\n    return shots;\r\n  }\r\n\r\n  /**\r\n   * create a sub-sprite belonging to the current sprite\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Object} options an object of arguments\r\n   * @param {Animation} animation the animation to fire from the Sprite\r\n   * @param {number} speed the speed of the shot that is projected\r\n   * @param {Vector} position the initial position of the shot: defaults to current Sprite position\r\n   * @param {Vector} size the Vector size of the shot\r\n   * @param {Vector} offset the positional offset to apply\r\n   * @returns {Sprite} a Gamelab.Sprite object\r\n   **********/\r\n\r\n  subsprite(options, gw) {\r\n\r\n    gw = gw || Gamelab.game_windows[0];\r\n\r\n    let animation = options.animation || new Gamelab.Animation();\r\n\r\n    let position = options.position || new Gamelab.Vector(this.position);\r\n\r\n    let offset = options.offset || new Gamelab.Vector(0, 0, 0);\r\n\r\n    let size = new Gamelab.Vector(options.size || this.size);\r\n\r\n    if (Gamelab.isAtPlay) {\r\n\r\n      var subsprite = gw.add(new Gamelab.Sprite().FromData({\r\n\r\n        active: true,\r\n\r\n        position: position,\r\n\r\n        size: size,\r\n\r\n        offset: offset,\r\n\r\n        image: animation.image,\r\n\r\n        rotation: new Gamelab.Vector(0, 0, 0),\r\n\r\n        flipX: false,\r\n\r\n        scrollFactor: this.scrollFactor,\r\n\r\n        noScroll: this.noScroll\r\n\r\n      }));\r\n\r\n\r\n      subsprite.Animation(animation);\r\n\r\n      return subsprite;\r\n\r\n    } else {\r\n      alert('No subsprite when not at play');\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * switch to the next frame on sprite.selected_animation\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Animation} animation the optional animation to switch to before animate is called, defaults to the existing sprite.selected_animation\r\n   **********/\r\n\r\n  animate(animation) {\r\n\r\n    if (Gamelab.isAtPlay) {\r\n\r\n      if (animation) {\r\n        this.Animation(animation)\r\n      }\r\n\r\n      this.selected_animation.run();\r\n\r\n    }\r\n\r\n  }\r\n\r\n  /**\r\n   * run a function when the sprite.selected_animation is complete\r\n   *\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Function} fun the function to call when the animation is complete\r\n   *\r\n   **********/\r\n\r\n  onAnimationComplete(fun) {\r\n\r\n    this.selected_animation.onComplete(fun);\r\n\r\n  }\r\n\r\n  /*****************************\r\n   *  accelY\r\n   *  -accelerate on Y-Axis with 'accel' and 'max' (speed) arguments\r\n   *  -example-use: gravitation of sprite || up / down movement\r\n   ***************************/\r\n\r\n  /**\r\n   * accelerate speed on the y-axis\r\n   *\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {number} accel the increment of acceleration\r\n   * @param {number} max the maximum for speed\r\n   *\r\n   **********/\r\n\r\n  accelY(accel, max) {\r\n\r\n    accel = Math.abs(accel);\r\n\r\n    if (typeof(max) == 'number') {\r\n      max = {\r\n        y: max\r\n      };\r\n\r\n    }\r\n\r\n    this.assertSpeed();\r\n\r\n    let diff = max.y - this.speed.y;\r\n\r\n    if (diff > 0) {\r\n      this.speed.y += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n    };\r\n\r\n    if (diff < 0) {\r\n      this.speed.y -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n    };\r\n\r\n  }\r\n\r\n  /*****************************\r\n   *  accelX\r\n   *  -accelerate on x-Axis\r\n   *  -example-use: running of sprite || left / right movement\r\n   ***************************/\r\n\r\n\r\n  /**\r\n   * accelerate speed on the x-Axis\r\n   *\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {number} accel the increment of acceleration\r\n   * @param {number} max the maximum for speed\r\n   *\r\n   **********/\r\n\r\n\r\n  accelX(accel, max) {\r\n\r\n    accel = Math.abs(accel);\r\n\r\n    if (typeof(max) == 'number') {\r\n      max = {\r\n        x: max\r\n      };\r\n\r\n    }\r\n\r\n    this.assertSpeed();\r\n\r\n    let diff = max.x - this.speed.x;\r\n\r\n    if (diff > 0) {\r\n      this.speed.x += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n    };\r\n\r\n    if (diff < 0) {\r\n      this.speed.x -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n    };\r\n\r\n  }\r\n\r\n\r\n  /*****************************\r\n   *  accel\r\n   *  -accelerate any acceleration -key\r\n   ***************************/\r\n\r\n\r\n  /**\r\n   * decelerate speed on the x-Axis, toward zero\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {number} amt the increment of deceleration, negatives ignored\r\n   *\r\n   **********/\r\n\r\n  decelY(amt) {\r\n\r\n    amt = Math.abs(amt);\r\n\r\n    if (Math.abs(this.speed.y) <= amt) {\r\n      this.speed.y = 0;\r\n\r\n    } else if (this.speed.y > amt) {\r\n\r\n      this.speed.y -= amt;\r\n    } else if (this.speed.y < amt * -1) {\r\n\r\n      this.speed.y += amt;\r\n    }\r\n\r\n  }\r\n\r\n  /*****************************\r\n   *  decelX\r\n   *  -decelerate on the X axis\r\n   *  -args: 1 float:amt\r\n   ***************************/\r\n\r\n\r\n  /**\r\n   * decelerate speed on the x-Axis, toward zero\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {number} amt the increment of deceleration, negatives ignored\r\n   *\r\n   **********/\r\n\r\n  decelX(amt) {\r\n\r\n    amt = Math.abs(amt);\r\n\r\n\r\n    if (this.speed.x > amt) {\r\n\r\n      this.speed.x -= amt;\r\n    } else if (this.speed.x < amt * -1) {\r\n\r\n      this.speed.x += amt;\r\n    }\r\n\r\n    if (Math.abs(this.speed.x) <= amt) {\r\n\r\n      this.speed.x = 0;\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * accelerate toward a max value on any object-property\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Object} prop The object to control\r\n   * @param {string} key the target property-key for object argument\r\n   * @param {number} accel the additive increase to the property on each call\r\n   * @param {number} max the max value to accelerate towards\r\n   **********/\r\n\r\n  accel(object, key, accel, max) {\r\n\r\n    var prop = object;\r\n\r\n    accel = Math.abs(accel);\r\n\r\n    if (typeof(max) == 'number') {\r\n      max = {\r\n        x: max\r\n      };\r\n    }\r\n\r\n    let speed = prop[key];\r\n\r\n    // this.assertSpeed();\r\n\r\n    let diff = max.x - prop[key];\r\n\r\n    if (diff > 0) {\r\n      prop[key] += Math.abs(diff) >= accel ? accel : diff;\r\n\r\n    };\r\n\r\n    if (diff < 0) {\r\n      prop[key] -= Math.abs(diff) >= accel ? accel : diff;\r\n\r\n    };\r\n\r\n  }\r\n\r\n\r\n  /*****************************\r\n   *  decel\r\n   *  -deceleration -key\r\n   ***************************/\r\n\r\n  /**\r\n   * decelerate toward a max value on any object-property\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Object} prop the object to control\r\n   * @param {string} key the property-key for targeted property of prop argument\r\n   *\r\n   * @param {number} decel the increment of deceleration\r\n   *\r\n   * @param {number} max the max value to decelerate towards\r\n   *\r\n   *\r\n   **********/\r\n\r\n  decel(prop, key, rate) {\r\n\r\n    if (typeof(rate) == 'object') {\r\n\r\n      rate = rate.rate;\r\n\r\n    }\r\n\r\n    rate = Math.abs(rate);\r\n\r\n    if (Math.abs(prop[key]) <= rate) {\r\n      prop[key] = 0;\r\n    } else if (prop[key] > 0) {\r\n      prop[key] -= rate;\r\n\r\n    } else if (prop[key] < 0) {\r\n      prop[key] += rate;\r\n\r\n    } else {\r\n\r\n      prop[key] = 0;\r\n\r\n    }\r\n  }\r\n\r\n\r\n  seekPosition(target_Position, differential_SpeedMultiple) {\r\n    var target = {};\r\n\r\n    //always positive:\r\n    differential_SpeedMultiple = Math.abs(differential_SpeedMultiple);\r\n\r\n    if (target_Position.hasOwnProperty('position')) {\r\n      console.log('1st argument had its own position property. Using this property now:');\r\n      target = target_Position.position;\r\n    } else {\r\n      target = target_Position;\r\n    }\r\n\r\n    let diff = this.position.sub(target).mult(-1);\r\n\r\n    this.speed = diff.mult(differential_SpeedMultiple);\r\n  }\r\n\r\n  /*****************************\r\n   *  decelY\r\n   *  -decelerate on the Y axis\r\n   *  -args: 1 float:amt\r\n   ***************************/\r\n\r\n\r\n  /**\r\n   * A generic 'smooth motion', adds to position.x and position.y with smooth acceleration and deceleration\r\n   * --uses quadratic-easing of the TWEEN.js library\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {number} x The x to be added to Sprite().positon.x over the course of the SmoothMotion --use negative for subtractive motion\r\n   * @param {number} y The y to be added to Sprite().positon.y over the course of the SmoothMotion- -use negative for subtractive motion\r\n   * @param {number} duration the amount of time taken to complete this motion\r\n   *\r\n   **********/\r\n\r\n  SmoothMotion(x, y, duration) {\r\n    if (typeof(x) == 'object') //argument coercion: x is a vector, y is duration\r\n    {\r\n      duration = y;\r\n      y = x.y;\r\n      x = x.x;\r\n    }\r\n\r\n    x = x + this.position.x;\r\n\r\n    y = y + this.position.y;\r\n\r\n    if (!TWEEN instanceof Object) {\r\n      return console.error('TWEEN.js required for SmoothMotion();');\r\n    }\r\n\r\n    var t = new TWEEN.Tween(this.position)\r\n      .easing(TWEEN.Easing.Quadratic.InOut)\r\n\r\n      .to(new Gamelab.Vector(x, y), duration)\r\n      .onUpdate(function() {\r\n        //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n\r\n      })\r\n      .onComplete(function() {\r\n        //console.log(objects[0].position.x, objects[0].position.y);\r\n\r\n\r\n      });\r\n\r\n    t.start();\r\n\r\n  }\r\n\r\n  /**\r\n   * A generic 'smooth rotate', adds to rotation.x with smooth acceleration and deceleration\r\n   * --uses quadratic-easing of the TWEEN.js library\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {number} r The numeric value to be added to Sprite().rotation.x over the course of the SmoothRotate --use negative for subtractive rotation\r\n   * @param {number} duration the amount of time taken to complete this rotation\r\n   **********/\r\n\r\n  SmoothRotate(r, duration) {\r\n\r\n    if (!TWEEN instanceof Object) {\r\n      return console.error('TWEEN.js required for SmoothRotate();');\r\n    }\r\n\r\n    r = r + this.rotation.x;\r\n\r\n    var t = new TWEEN.Tween(this.rotation)\r\n      .easing(TWEEN.Easing.Quadratic.InOut)\r\n\r\n      .to(new Gamelab.Vector(r), duration)\r\n      .onUpdate(function() {\r\n        //console.log(objects[0].position.x,objects[0].position.y);\r\n\r\n\r\n      })\r\n      .onComplete(function() {\r\n        //console.log(objects[0].position.x, objects[0].position.y);\r\n\r\n\r\n      });\r\n    t.start();\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * get the vector-position at the center of the sprite, based on its current position and size\r\n   * @function\r\n   * @memberof Sprite\r\n   *\r\n   * @returns (Vector) a vector-position pinpointing the current-center of the sprite\r\n   *\r\n   **********/\r\n\r\n  center() {\r\n\r\n    return new Gamelab.Vector(this.position.x + this.size.x / 2, this.position.y + this.size.y / 2, 0);\r\n\r\n  }\r\n\r\n\r\n  /*****************************\r\n   *  System Use / Collision\r\n   ***************************/\r\n\r\n\r\n  /*****************************\r\n   * @ignore\r\n   ***************************/\r\n\r\n  shortest_stop(item, callback) {\r\n\r\n    var diff_min_y = item.min ? item.min.y : Math.abs(item.position.y - this.position.y + this.size.y);\r\n\r\n    var diff_min_x = item.min ? item.min.x : Math.abs(item.position.x - this.position.x + this.size.x);\r\n\r\n    var diff_max_y = item.max ? item.max.y : Math.abs(item.position.y + item.size.y - this.position.y);\r\n\r\n    var diff_max_x = item.max ? item.max.x : Math.abs(item.position.x + item.size.x - this.position.y);\r\n\r\n    var dimens = {\r\n      top: diff_min_y,\r\n      left: diff_min_x,\r\n      bottom: diff_max_y,\r\n      right: diff_max_x\r\n    };\r\n\r\n    var minkey = \"\",\r\n      min = 10000000;\r\n\r\n    for (var x in dimens) {\r\n      if (dimens[x] < min) {\r\n        min = dimens[x];\r\n        minkey = x; // a key of top left bottom or right\r\n\r\n      }\r\n    }\r\n\r\n    callback(minkey);\r\n\r\n  }\r\n\r\n\r\n  /*************\r\n   * #BE CAREFUL\r\n   * -with this function :: change sensitive / tricky / 4 way collision\r\n   * *************/\r\n\r\n\r\n  /**\r\n   * determine if sprite overlaps on x-axis with another sprite\r\n   *\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Sprite} item the Sprite to compare with\r\n   * @param {number} padding the 0-1.0 float value of padding to use on self when testing overlap\r\n   * @returns {boolean} a true || false var showing if overlap has occured\r\n   *\r\n   **********/\r\n\r\n  overlap_x(item, padding) {\r\n    if (!padding) {\r\n      padding = 0;\r\n    }\r\n\r\n    var p1 = this.position,\r\n      p2 = item.position;\r\n    var paddingX = Math.round(padding * this.size.x),\r\n\r\n      paddingY = Math.round(padding * this.size.y),\r\n      left = p2.x + paddingX,\r\n      right = p2.x + this.size.x - paddingX;\r\n\r\n    return right > p1.x && left < p1.x + item.size.x;\r\n  }\r\n\r\n  /*************\r\n   * #BE CAREFUL\r\n   * -with this function :: change sensitive / tricky / 4 way collision\r\n   * *************/\r\n\r\n\r\n  /**\r\n   * determine if sprite overlaps on y-axis with another sprite\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Sprite} item the Sprite to compare with\r\n   * @param {number} padding the 0-1.0 float value of padding to use on self when testing overlap\r\n   * @returns {boolean} a true || false var showing if overlap has occured\r\n   *\r\n   **********/\r\n\r\n  overlap_y(item, padding) {\r\n    if (!padding) {\r\n      padding = 0;\r\n    }\r\n\r\n    var p1 = this.position,\r\n      p2 = item.position;\r\n\r\n    var paddingX = Math.round(padding * this.size.x),\r\n\r\n      paddingY = Math.round(padding * this.size.y),\r\n\r\n      top = p2.y + paddingY,\r\n      bottom = p2.y + this.size.y - paddingY;\r\n\r\n    return bottom > p1.y && top < p1.y + item.size.x;\r\n\r\n  }\r\n\r\n\r\n  /*************\r\n   * #BE CAREFUL\r\n   * -with this function :: change sensitive / tricky / 4 way collision\r\n   * *************/\r\n\r\n\r\n  /**\r\n   * stop collision on x-axis with another sprite\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Sprite} item the Sprite with which to collide-stop on the x-axis\r\n   **********/\r\n\r\n  collide_stop_x(item) {\r\n\r\n    var apart = false;\r\n    var ct = 10000;\r\n\r\n    while (!apart && ct > 0) {\r\n      ct--;\r\n\r\n      var diffX = this.center().sub(item.center()).x;\r\n      var distX = Math.abs(this.size.x / 2 + item.size.x / 2 - Math.round(this.size.x * this.padding.x));\r\n\r\n      if (Math.abs(diffX) < distX) {\r\n        this.position.x -= diffX > 0 ? -1 : 1;\r\n      } else {\r\n        this.speed.x = 0;\r\n        apart = true;\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  /*************\r\n   * #BE CAREFUL\r\n   * -with this function :: change sensitive / tricky / 4 way collision\r\n   * *************/\r\n\r\n\r\n  /**\r\n   * Trigger a fourway collision-stop between this and another Sprite ::\r\n   * objects will behave clastically and resist passing through one-another\r\n   *\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Sprite} item the Sprite to collide with\r\n   *\r\n   **********/\r\n\r\n  collide_stop(item) {\r\n\r\n    if (this.id == item.id) {\r\n      return false;\r\n\r\n    }\r\n\r\n    this.speed = this.speed || new Gamelab.Vector(0, 0, 0);\r\n\r\n    this.padding = this.padding || new Gamelab.Vector(0, 0, 0);\r\n\r\n    // this.position = this.position.sub(this.speed);\r\n\r\n    if (this.hasBoxCollision(item)) {\r\n\r\n      var diff = this.center().sub(item.center());\r\n\r\n      if (this.overlap_x(item, this.padding.x + 0.1) && Math.abs(diff.x) < Math.abs(diff.y)) {\r\n\r\n        var apart = false;\r\n\r\n        var ct = 10000;\r\n\r\n        while (!apart && ct > 0) {\r\n\r\n          ct--;\r\n\r\n          var diffY = this.center().sub(item.center()).y;\r\n\r\n          var distY = Math.abs(this.size.y / 2 + item.size.y / 2 - Math.round(this.size.y * this.padding.y));\r\n\r\n          if (Math.abs(diffY) < distY) {\r\n\r\n            this.position.y -= diffY > 0 ? -1 : diffY < 0 ? 1 : 0;\r\n\r\n            this.position.y = Math.round(this.position.y);\r\n\r\n          } else {\r\n\r\n            if (diffY <= 0) {\r\n              this.__inAir = false;\r\n            };\r\n\r\n            this.speed.y = 0;\r\n\r\n            return apart = true;\r\n\r\n\r\n          }\r\n\r\n\r\n        }\r\n\r\n\r\n      }\r\n\r\n\r\n      if (this.overlap_y(item, this.padding.y) && Math.abs(diff.y) < Math.abs(diff.x)) {\r\n\r\n        this.collide_stop_x(item);\r\n\r\n      }\r\n\r\n\r\n    }\r\n\r\n\r\n  }\r\n\r\n  /**\r\n   * collide-stop only from the top (of the sprite passed as argument) ::\r\n   *\r\n   * @function\r\n   * @memberof Sprite\r\n   * @param {Sprite} item the Sprite to collide with\r\n   *\r\n   **********/\r\n\r\n  collide_stop_top(item, callback) {\r\n\r\n\r\n    if (this.id == item.id) {\r\n      return false;\r\n\r\n    }\r\n\r\n    if (this.overlap_x(item, this.padding.x + 0.1)) {\r\n\r\n      console.log('OVERLAP_X');\r\n\r\n      var paddingY = this.padding.y * this.size.y;\r\n\r\n      var p1 = this.position,\r\n        p2 = item.position;\r\n\r\n      if (p1.y + this.size.y - paddingY <= p2.y) {\r\n\r\n        this.groundMaxY = p2.y - this.size.y + paddingY;\r\n\r\n      }\r\n\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n  /**\r\n   * restore a sprite from existing json-data --applies to data-persistence\r\n   *\r\n   * @function\r\n   * @memberof Sprite\r\n   *\r\n   * @returns (Sprite)\r\n   **********/\r\n\r\n  restoreFrom(data) {\r\n    data.image = new GameImage(data.src || data.image.src);\r\n\r\n    return new Gamelab.Sprite(data);\r\n\r\n  }\r\n\r\n\r\n  /*****************************\r\n   * @ignore\r\n   * #IN-TESTING\r\n   *  fromFile(file_path)\r\n   *  -TODO : complete this function based on code to load Sprite() from file, located in the spritemaker.html file\r\n   *  -TODO: test this function\r\n   ***************************/\r\n\r\n  fromFile(file_path) {\r\n\r\n    if (typeof file_path == 'string') {\r\n\r\n      var __inst = this;\r\n\r\n      $.getJSON(file_path, function(data) {\r\n\r\n        __inst = new Gamelab.Sprite(data);\r\n\r\n      });\r\n    }\r\n  }\r\n\r\n  /*****************************\r\n   * return a decycled json-string for the sprite --without circular references\r\n   * @returns {string} a json string\r\n   ***************************/\r\n\r\n  toJSONString() {\r\n    return jstr(JSON.decycle(this));\r\n  }\r\n\r\n};\r\n\r\nGamelab.Sprite = Sprite;\r\n;\r\nvar getTextHeight = function(font) {\r\n\r\n  var text = $('<span>Hg</span>').css({ fontFamily: font });\r\n  var block = $('<div style=\"display: inline-block; width: 1px; height: 0px;\"></div>');\r\n\r\n  var div = $('<div></div>');\r\n  div.append(text, block);\r\n\r\n  var body = $('body');\r\n  body.append(div);\r\n\r\n  try {\r\n\r\n    var result = {};\r\n\r\n    block.css({ verticalAlign: 'baseline' });\r\n    result.ascent = block.offset().top - text.offset().top;\r\n\r\n    block.css({ verticalAlign: 'bottom' });\r\n    result.height = block.offset().top - text.offset().top;\r\n\r\n    result.descent = result.height - result.ascent;\r\n\r\n  } finally {\r\n    div.remove();\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n\r\nclass Text {\r\n\r\n  constructor(value){\r\n    \r\n    this.Text(value);\r\n\r\n    this.FontSize(15);\r\n    this.FontFamily('Arial');\r\n\r\n    this.color = 'white';\r\n\r\n    this.position = new Gamelab.Vector(0, 0);\r\n\r\n  }\r\n\r\n  Text(t){\r\n\r\n    this.text = t;\r\n    this.value = t;\r\n    return this;\r\n  }\r\n\r\n  Font(fsize, ffamily){\r\n    this.FontSize(fsize);\r\n    this.FontFamily(ffamily)\r\n    return this;\r\n  }\r\n\r\n  FontSize(value){\r\n    if(typeof value !== 'string')\r\n    value = value + '';\r\n\r\n    value = value.replace('px', '') + 'px';\r\n\r\n    this.fontSize = value;\r\n    return this;\r\n  }\r\n  FontFamily(value)\r\n  {\r\n    this.fontFamily = value;\r\n    return this;\r\n  }\r\n\r\n\r\n    getOffsetPos(pos){\r\n      var offset = this.window_offset || new Gamelab.Vector(0, 0);\r\n      return pos.add(offset);\r\n    }\r\n\r\n  draw(ctx, camera){\r\n\r\n    console.log(\"DRAWING object.text.js\");\r\n\r\n    var x = this.position.x + camera.position.x,\r\n     y = this.position.y + camera.position.y;\r\n\r\n     if(ctx.save)\r\n     {\r\n    ctx.save();\r\n    }\r\n\r\n    ctx.fillStyle = this.color;\r\n\r\n    ctx.font = this.fontSize + ' ' + this.fontFamily;\r\n\r\n    var size = ctx.measureText(this.text);\r\n\r\n    this.size = new Gamelab.Vector(size.width, getTextHeight(ctx.font).height);\r\n\r\n    var pos = new Gamelab.Vector(x, y),\r\n    realPos = this.getOffsetPos(pos);\r\n\r\n    ctx.fillText(this.text, realPos.x, realPos.y);\r\n\r\n    ctx.restore();\r\n\r\n  }\r\n}\r\n\r\n\r\nGamelab.Text = Text;\r\n;/**\n * Creates a GravityForce instance.\n *\n *@param   {Object} args the object of arguments\n * @param   {string} args.name optional\n * @param   {string} args.description optional\n * @param   {Array} args.subjects the subjects to be pulled by the GravityForce\n * @param   {Array} args.clasticObjects any clastic object or array-of-objects that should have collision-stop behavior with subjects\n * @param   {Vector} args.max the max speed of the gravity-force, similar to concept of 'terminal velocity'\n * @param   {number} args.accel the increment of acceleration for each update called, while subjects are falling\n *\n * @returns {GravityForce} a GravityForce object\n */\n\n(function () {\n    console.log('Force class... creating');\n\n    class GravityForce {\n        constructor(args = {}) {\n            this.name = args.name || \"\";\n\n            this.description = args.description || \"\";\n\n            this.subjects = args.subjects || [];\n\n            this.clasticObjects = args.clasticObjects || [];\n\n            this.topClastics = args.topClastics || [];\n\n            this.max = args.max || new Gamelab.Vector(3, 3, 3);\n            this.accel = args.accel || new Gamelab.Vector(1.3, 1.3, 1.3);\n\n\n            for (var x in this.clasticObjects) {\n                if (!this.clasticObjects[x] instanceof Gamelab.Sprite) {\n                    this.clasticObjects[x] = Gamelab.getById(this.clasticObjects[x].id);\n                }\n\n            }\n\n\n            for (var x in this.topClastics) {\n                if (!this.topClastics[x] instanceof Gamelab.Sprite) {\n                    this.topClastics[x] = Gamelab.getById(this.topClastics[x].id);\n                }\n\n            }\n\n\n            for (var x in this.subjects) {\n                if (!this.subjects[x] instanceof Gamelab.Sprite) {\n                    this.subjects[x] = Gamelab.getById(this.subjects[x].id);\n                }\n\n            }\n\n        }\n\n        getArg(args, key, fallback) {\n\n            if (args.hasOwnProperty(key)) {\n                return args[key];\n            }\n            else {\n                return fallback;\n\n            }\n        }\n\n\n        /**\n         * Updates position for all objects effected by this instance.\n         * @memberof GravityForce\n         */\n\n        update() {\n\n            var subjects = this.subjects;\n\n            var clasticObjects = this.clasticObjects;\n\n            var topClastics = this.topClastics;\n\n            var accel = this.accel || {};\n\n            var max = this.max || {};\n\n            Gamelab.each(subjects, function (ix, itemx) {\n\n                if(!itemx.jumping && !itemx.flying)\n                itemx.accelY(accel, max);\n\n                itemx.__inAir = true;\n\n\n                if (itemx.position.y >= itemx.groundMaxY) {\n                    itemx.position.y = itemx.groundMaxY;\n                }\n\n                itemx.groundMaxY = 3000000; //some crazy number you'll never reach in-game\n\n                Gamelab.each(topClastics, function (iy, itemy) {\n\n                    itemx.collide_stop_top(itemy);\n\n                });\n\n            });\n        }\n    };\n\n    let Force = GravityForce;\n\n    Gamelab.Force = Force;\n\n    Gamelab.GForce = Force;\n\n    Gamelab.GravityForce = GravityForce;\n\n})();\n;\r\n\r\nclass Background extends Sprite{\r\n  constructor(){\r\n    super(arguments);\r\n  }\r\n}\r\n\r\n\r\nGamelab.Background = Background;\r\n;/**\r\n * Creates a new BoneSprite.\r\n *\r\n * <info-bit>Gamelab.BoneSprite is a container for 2D Animations.\r\n * -apply Sprite class to create a 2D game-object.\r\n *\r\n * BoneSprites are a group of moving animations.</info-bit>\r\n * <iframe style='width:400px; height:450px; overflow:hidden;' src='../client/examples/js-class/Sprite.html'> </iframe>\r\n\r\n * @param   {string} src the srcPath for the image of the Sprite\r\n * @param   {number} scale=1.0 the scale to be applied to size of each animation-frame\r\n *\r\n * @returns {Sprite} a Gamelab.BoneSprite object\r\n */\r\n\r\nclass BoneSprite extends Sprite {\r\n  constructor(src = {}, scale = 1.0) {\r\n    super(src, scale);\r\n    this.bones = [];\r\n  }\r\n  addBone(oncreate) {\r\n    var bone = new Bone(this, this.size);\r\n    oncreate.bind(bone).call();\r\n  }\r\n  draw_current_frame(ctx, camera) {\r\n\r\n    var sprite = this;\r\n    var frameList = [];\r\n    if (sprite.active) {\r\n\r\n      if (sprite.selected_animation instanceof Array && sprite.selected_animation.length >= 1) {\r\n        sprite.selected_animation.forEach(function(anime) {\r\n\r\n          anime.selected_frame.parent = anime;\r\n          frameList.push(anime.selected_frame);\r\n\r\n        });\r\n      }\r\n\r\n      var origin = sprite.origin || new Gamelab.Vector(0, 0);\r\n      var rotation = sprite.rotation.x;\r\n\r\n      frameList.reverse().forEach(function(frame){\r\n\r\n        var realWidth = frame.size.x;\r\n        var realHeight = frame.size.y;\r\n\r\n        var x = frame.position.x,\r\n          y = frame.position.y;\r\n\r\n        if (frame.rotation && typeof frame.rotation.x == 'number') {\r\n          rotation = frame.rotation.x;\r\n        }\r\n\r\n        if (frame.origin) {\r\n          origin = frame.origin;\r\n          //console.log('drawing with origin:' + origin.x + ':' + origin.y);\r\n        }\r\n\r\n        var frame_offset = new Gamelab.Vector(0, 0);\r\n\r\n        if(frame.parent && frame.parent.frameOffset instanceof Gamelab.Vector)\r\n        {\r\n          //console.log('object.bonesprite.js:: frame-parent-offset');\r\n          frame_offset = frame.parent.frameOffset;\r\n        }\r\n\r\n        if (frame && frame.image)\r\n          Gamelab.Canvas.draw_image_frame(frame.image.domElement, new Gamelab.Vector(frame.framePos).add(frame_offset), frame.frameSize, new Gamelab.Vector2D(Math.round(x + (origin.x)), Math.round(y + (origin.y))), new Gamelab.Vector2D(realWidth, realHeight), rotation % 360, ctx, sprite.flipX, sprite.flipY, origin);\r\n      });\r\n\r\n    }\r\n\r\n  }\r\n};\r\n\r\nGamelab.BoneSprite = BoneSprite;\r\n;/**\r\n * Creates a new SpriteBrush.\r\n */\r\n\r\nclass SpriteBrush{\r\n  constructor(onCreate, mode = 'random') {\r\n    this.sprites = [];\r\n    this.overlaySprites = [];\r\n    this.mode = mode;\r\n    this.index = -1;\r\n    this.total = 0;\r\n    this.selected_sprite = {};\r\n    this.id = Gamelab.create_id();\r\n    onCreate = onCreate || function(){};\r\n    onCreate.bind(this);\r\n  }\r\n\r\n  addSprite(src, scale, callback) {\r\n    this.sprites.push(new Gamelab.Sprite(src, scale));\r\n    if(callback) callback.bind(this).call();\r\n  }\r\n  addOverlaySprite(src, scale, callback) {\r\n    console.info(`SpriteFill().addOverlay(): --adds an overlay.\r\n      Every overlay must fit with every sourceSprite, matching non-transparent pixels only`);\r\n    this.overlaySprites.push(new Gamelab.Sprite(src, scale));\r\n    if(callback) callback.bind(this).call();\r\n  }\r\n\r\n  removeAll(){\r\n    this.sprites = [];\r\n    this.overlaySprites = [];\r\n  }\r\n\r\n  next(){\r\n    this.index += 1;\r\n    switch(this.mode.toLowerCase())\r\n    {\r\n        case 'random':\r\n        var index = Math.floor(Math.random() * this.sprites.length);\r\n        this.selected_sprite = this.sprites[index];\r\n        return this.selected_sprite;\r\n        break;\r\n\r\n        case 'consecutive':\r\n        this.selected_sprite = this.sprites[this.index % this.sprites.length];\r\n        return this.selected_sprite;\r\n        break;\r\n    }\r\n  }\r\n\r\n  Clone(spritebrush)\r\n  {\r\n    var outputSprite = new Gamelab.SpriteBrush();\r\n    outputSprite.id = spritebrush.id;\r\n    var oix = 0;\r\n\r\n    spritebrush.sprites.forEach(function(sprite){\r\n        outputSprite.addSprite(sprite.src, sprite.size);\r\n        oix += 1;\r\n    });\r\n\r\n    spritebrush.overlaySprites.forEach(function(sprite){\r\n        outputSprite.addOverlaySprite(sprite.src, sprite.size);\r\n        oix += 1;\r\n    });\r\n    return outputSprite;\r\n  }\r\n\r\n  FromData(spritebrush)\r\n  {\r\n    var outputSprite = new Gamelab.SpriteBrush();\r\n\r\n    outputSprite.id = spritebrush.id;\r\n\r\n    var oix = 0;\r\n\r\n    spritebrush.sprites.forEach(function(sprite){\r\n\r\n        outputSprite.addSprite(sprite.src, sprite.size);\r\n\r\n        oix += 1;\r\n    });\r\n\r\n    spritebrush.overlaySprites.forEach(function(sprite){\r\n\r\n        outputSprite.addOverlaySprite(sprite.src, sprite.size);\r\n\r\n        oix += 1;\r\n    });\r\n\r\n    return outputSprite;\r\n  }\r\n};\r\n\r\nGamelab.SpriteBrush = SpriteBrush;\r\n;/**\r\n * Creates a new SpriteFill.\r\n */\r\n\r\nclass SpriteFill extends Sprite {\r\n  constructor(src = {}, scale = 1.0) {\r\n    super(src, scale);\r\n    this.sourceSprites = [];\r\n    this.overlaySprites = [];\r\n    this.shape = [];\r\n  }\r\n  //draw function is overwritten to nothing. --limits console errors --todo --complete\r\n  draw() {\r\n    return 0;\r\n  }\r\n  addSprite(src, scale, callback) {\r\n    this.sourceSprites.push(new Gamelab.Sprite(src, scale));\r\n    if(callback) callback.bind(this).call();\r\n  }\r\n  addOverlaySprite(src, scale, callback) {\r\n    console.info(`SpriteFill().addOverlay(): --adds an overlay.\r\n      Every overlay must fit with every sourceSprite, matching non-transparent pixels only`);\r\n    this.overlaySprites.push(new Gamelab.Sprite(src, scale));\r\n    if(callback) callback.bind(this).call();\r\n  }\r\n  SelectionMode(mode) {\r\n    this.selection_mode = mode || this.selected_mode || 'random';\r\n    return this.selection_mode;\r\n  }\r\n  BuildShape(onCreateShape) {\r\n    if(onCreateShape) onCreateShape.bind(this).call();\r\n    return this.shape;\r\n  }\r\n  enclose_rectangle() {\r\n    var rect = new Gamelab.Rectangle(Infinity, Infinity, -Infinity, -Infinity);\r\n    this.shape.forEach(function(point) {\r\n      if (point.x < rect.min.x) {\r\n        rect.min.x = point.x;\r\n      }\r\n      if (point.y < rect.min.y) {\r\n        rect.min.y = point.y;\r\n      }\r\n      if (point.x > rect.max.x) {\r\n        rect.max.x = point.x;\r\n      }\r\n      if (point.y > rect.max.y) {\r\n        rect.max.y = point.y;\r\n      }\r\n    });\r\n    return rect;\r\n  }\r\n\r\n  Fill() {\r\n\r\n    var bounds = this.enclose_rectangle();\r\n\r\n    //step 1: fill the shape with rectangles:\r\n\r\n    var tracker = new Gamelab.Vector(),\r\n      sprite = this.sourceSprites[0],\r\n      currentSize = new Gamelab.Vector(sprite.size),\r\n      currentIndex = 0;\r\n\r\n    this.offscreenCanvas = new Gamelab.OffscreenCanvas(document.createElement('CANVAS'), bounds.min.x, bounds.min.y);\r\n\r\n    var ctx = this.offscreenCanvas.ctx;\r\n\r\n    //apply loop through x, y bounds, fill with sprites\r\n    for (var x = bounds.min.x; x < bounds.max.x; x += currentSize.x) {\r\n      for (var y = bounds.min.y; y < bounds.max.y; y += currentSize.y) {\r\n        var nextSprite = new Gamelab.Sprite().FromData(this.sourceSprites[currentIndex]);\r\n        this.sprites.push(nextSprite);\r\n        currentSize = new Gamelab.Vector(nextSprite.size);\r\n        currentIndex += 1;\r\n        nextSprite.onLoad(function() {\r\n          this.draw(ctx);\r\n        });\r\n      }\r\n    }\r\n\r\n    return this.offscreenCanvas;\r\n\r\n  }\r\n\r\n};\r\n\r\nGamelab.SpriteFill = SpriteFill;\r\n;class FeatureSymbol {\r\n  constructor(key) {\r\n    this.key = key || \"@NONE\";\r\n    this.symbol = Symbol(key);\r\n  }\r\n}\r\n\r\nGamelab.FeatureSymbol = FeatureSymbol;\r\n\r\nGamelab.FeatureInjectors = Gamelab.FeatureInjectors || {};\r\n\r\nGamelab.FeatureInject = function(constructor, args) {\r\n\r\n  //console.log('Gamelab.FeatureInject()');\r\n\r\n  var GClassFeatures = {};\r\n\r\n\r\n  for (var y in Gamelab.ObjectFeatureMap) {\r\n\r\n    if (Gamelab[y] && typeof Gamelab[y] == 'function') {\r\n\r\n      var constructor = Gamelab[y];\r\n\r\n      GClassFeatures[y] = {};\r\n\r\n      //  console.log('Feature Symbol-key:' + Gamelab.ObjectFeatureMap[x][y]);\r\n\r\n      GClassFeatures[y].featureSymbols = GClassFeatures[y].featureSymbols || [];\r\n\r\n      for (var z in Gamelab.ObjectFeatureMap[y]) {\r\n\r\n        GClassFeatures[y].featureSymbols.push(new Gamelab.FeatureSymbol(Gamelab.ObjectFeatureMap[y][z]));\r\n\r\n        GClassFeatures[y].featureSymbols.hasKey = function(key) {\r\n\r\n          for (var x = 0; x < this.length; x++) {\r\n            if (typeof this[x].key !== 'string')\r\n              continue;\r\n\r\n            if (this[x].key.indexOf('@') == -1)\r\n              console.error('feature-keys must contain @');\r\n\r\n            //  console.log('eval key:' + this[x].key.split('@')[1]);\r\n\r\n            if (this[x].key.split('@')[1] == key)\r\n              return true;\r\n          }\r\n\r\n          return false;\r\n        };\r\n\r\n        GClassFeatures[y].featureSymbols.hasSymbol = function(symbol) {\r\n          for (var x in this) {\r\n            if (this[x].symbol == symbol)\r\n              return true;\r\n          }\r\n\r\n          return false;\r\n        };\r\n\r\n        //  console.info('adding feature-symbol:' + Gamelab.ObjectFeatureMap[x][y]);\r\n      }\r\n    } else {\r\n      console.error('Gamelab.ObjectFeatureMap: member by name of ' + x + ' does not exist as member of Gamelab');\r\n    }\r\n  }\r\n\r\n\r\n  console.info('FEATURES:', GClassFeatures);\r\n\r\n\r\n  for (var x in Gamelab.FeatureInjectors) {\r\n\r\n    //  console.log(Gamelab.FeatureInjectors[x]);\r\n\r\n    var props = TypeCode.getProtoFuncs(Gamelab.FeatureInjectors[x]);\r\n\r\n    for (var y = 0; y < props.length; y++) {\r\n\r\n      console.log(x + \":\" + props[y]);\r\n\r\n      for (var z in GClassFeatures)\r\n        if (GClassFeatures[z] && GClassFeatures[z].featureSymbols.hasKey(props[y])) {\r\n\r\n\r\n          Gamelab.FeatureInjectors[x][props[y]](Gamelab[z].prototype, args);\r\n\r\n        }\r\n    }\r\n  }\r\n\r\n};\r\n\r\n\r\nclass CssFeatures {\r\n\r\n  colored(obj){\r\n    obj.Color = function(c)\r\n    {\r\n      this.color = c;\r\n      return this;\r\n    }\r\n  }\r\n\r\n  color_transition(min_color, max_color){\r\n    this.min_color = min_color;\r\n    this.max_color = max_color;\r\n    return this;\r\n  }\r\n\r\n  text(obj){\r\n    obj.Text = function(value)\r\n    {\r\n      this.text = value;\r\n      return this;\r\n    }\r\n  }\r\n\r\n  opaque(obj){\r\n    obj.Opacity = function(o){\r\n      this.opacity = o;\r\n      return this;\r\n    }\r\n  }\r\n};\r\n\r\n\r\nclass DataFunctions {\r\n\r\n  data(obj){\r\n\r\n    obj.Name = function(n) {\r\n      this.name = n;\r\n      return this;\r\n    };\r\n\r\n    obj.Description = function(d){\r\n      this.description = d;\r\n      return this;\r\n    };\r\n\r\n    obj.Context = function(c) {\r\n      this.context = c;\r\n      return this;\r\n    };\r\n\r\n    obj.create_id = function(){\r\n      return Gamelab.create_id();\r\n    }\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n/***************************\r\nGeometryFeatures:\r\n  A functional dependency injector\r\n  injects properties and functions according to Symbols\r\n**************************/\r\nclass VectorFunctions {\r\n  constructor() {\r\n\r\n    this.name = 'VectorFunctionals';\r\n\r\n  }\r\n\r\n  collideable(obj) {\r\n    obj.collision_callback = function() {};\r\n    obj.onCollide = args.onCollide || function(collideables, callback) {\r\n      if (typeof(collideables) == 'function') {\r\n        callback = collideables;\r\n      }\r\n      this.collision_callback = callback || function() {};\r\n    };\r\n  }\r\n\r\n  spatial(obj) {\r\n\r\n    obj.Size = function(x, y, z) {\r\n\r\n      if (typeof(x) == 'object')\r\n        this.size = new Gamelab.Vector(x);\r\n\r\n      else if (!isNaN(x) && !isNaN(y)) //has minimum of numeric x and y\r\n        this.size = new Gamelab.Vector(x, y, z);\r\n\r\n      else //use x accross the vector\r\n        this.size = new Gamelab.Vector(x, x, x);\r\n\r\n      return this;\r\n    };\r\n\r\n    obj.Pos = function(x, y, z) {\r\n\r\n      if (typeof(x) == 'object')\r\n        this.position = new Gamelab.Vector(x);\r\n\r\n      else if (!isNaN(x) && !isNaN(y)) //has minimum of numeric x and y\r\n        this.position = new Gamelab.Vector(x, y, z);\r\n\r\n      else //use x accross the vector\r\n        this.position = new Gamelab.Vector(x, x, x);\r\n\r\n      return this;\r\n    };\r\n\r\n    obj.Rot = function(x, y, z) {\r\n\r\n      if (typeof(x) == 'object')\r\n        this.rotation = new Gamelab.Vector(x);\r\n\r\n      else if (!isNaN(x) && !isNaN(y)) //has minimum of numeric x and y\r\n        this.rotation = new Gamelab.Vector(x, y, z);\r\n\r\n      else //use x accross the vector\r\n        this.rotation = new Gamelab.Vector(x, x, x);\r\n\r\n      return this;\r\n    };\r\n\r\n    obj.Position = obj.Pos;\r\n\r\n    obj.Rotate = obj.Rot;\r\n\r\n    obj.Rotation = obj.Rot;\r\n\r\n  }\r\n\r\n  posable(obj) {\r\n\r\n    obj.Pos = function(x, y, z) {\r\n\r\n      if (typeof(x) == 'object')\r\n        this.position = new Gamelab.Vector(x);\r\n\r\n      else if (!isNaN(x) && !isNaN(y)) //has minimum of numeric x and y\r\n        this.position = new Gamelab.Vector(x, y, z);\r\n\r\n      else //use x accross the vector\r\n        this.position = new Gamelab.Vector(x, x, x);\r\n\r\n      return this;\r\n    };\r\n\r\n    obj.Position = obj.Pos;\r\n\r\n  }\r\n\r\n  sizeable(obj) {\r\n\r\n    obj.Size = function(x, y, z) {\r\n\r\n      if (typeof(x) == 'object')\r\n        this.size = new Gamelab.Vector(x);\r\n\r\n      else if (!isNaN(x) && !isNaN(y)) //has minimum of numeric x and y\r\n        this.size = new Gamelab.Vector(x, y, z);\r\n\r\n      else //use x accross the vector\r\n        this.size = new Gamelab.Vector(x, x, x);\r\n\r\n      return this;\r\n    };\r\n\r\n    obj.Position = obj.Pos;\r\n\r\n  }\r\n\r\n  rotable(obj) {\r\n    obj.Rot = function(x, y, z) {\r\n\r\n      if (typeof(x) == 'object')\r\n        this.rotation = new Gamelab.Vector(x);\r\n\r\n      else if (!isNaN(x) && !isNaN(y)) //has minimum of numeric x and y\r\n        this.rotation = new Gamelab.Vector(x, y, z);\r\n\r\n      else //use x accross the vector\r\n        this.rotation = new Gamelab.Vector(x, x, x);\r\n\r\n      if (typeof this.Transpose == 'function') {\r\n        this.Transpose();\r\n      }\r\n\r\n      return this;\r\n    };\r\n\r\n    obj.Rotate = obj.Rot;\r\n\r\n    obj.Rotation = obj.Rot;\r\n\r\n  }\r\n\r\n  minable(obj) {\r\n    obj.Min = function(x, y, z) {\r\n\r\n      if (typeof(x) == 'object')\r\n        this.min = new Gamelab.Vector(x);\r\n\r\n      else if (!isNaN(x) && !isNaN(y)) //has minimum of numeric x and y\r\n        this.min = new Gamelab.Vector(x, y, z);\r\n\r\n      else //use x accross the vector\r\n        this.min = new Gamelab.Vector(x, x, x);\r\n\r\n      return this;\r\n    };\r\n\r\n    obj.Minimum = obj.Min;\r\n\r\n  }\r\n\r\n  maxable(obj) {\r\n    obj.Max = function(x, y, z) {\r\n\r\n      if (typeof(x) == 'object')\r\n        this.max = new Gamelab.Vector(x);\r\n\r\n      else if (!isNaN(x) && !isNaN(y)) //has minimum of numeric x and y\r\n        this.max = new Gamelab.Vector(x, y, z);\r\n\r\n      else //use x accross the vector\r\n        this.max = new Gamelab.Vector(x, x, x);\r\n\r\n      return this;\r\n    };\r\n\r\n    obj.Maximum = obj.Max;\r\n\r\n  }\r\n\r\n  boundable(obj) {\r\n    this.minable(obj);\r\n\r\n    this.maxable(obj);\r\n  }\r\n\r\n  selftransposable(obj) {\r\n    //apply the transposition\r\n    obj.Transpose = function(rotation, position) {\r\n\r\n      this.rotation = new Gamelab.Vector(rotation || this.rotation);\r\n\r\n      this.position = new Gamelab.Vector(position || this.position);\r\n\r\n      //TODO: Modify this trig function and its call below to an optional 3D rotation\r\n\r\n      for (var x = 0; x < this.points.length; x++) {\r\n\r\n        var p = this.points[x];\r\n\r\n        var np = Gamelab.Trig.rotate_from_xy(0, 0, p.x, p.y, this.rotation.x);\r\n\r\n        this.points[x] = this.position.add(np);\r\n\r\n      }\r\n      return this;\r\n    };\r\n\r\n  }\r\n\r\n  pointarrayflippable(obj) {\r\n    //apply the transposition\r\n    obj.FlipX = function() {\r\n\r\n      var middle = Math.floor(this.points.length / 2); //account for FlipX with length of --odd number\r\n\r\n      var x, y;\r\n\r\n      for (x = this.points.length - 1, y = 0; x > middle, y < middle; x--, y++) {\r\n\r\n        var p1 = this.points[x],\r\n          p2 = this.points[y];\r\n\r\n        [p1.x, p2.x] = [p2.x, p1.x];\r\n\r\n      }\r\n\r\n      return this;\r\n    };\r\n\r\n\r\n    //apply the transposition\r\n    obj.FlipY = function() {\r\n\r\n      var middle = Math.floor(this.points.length / 2); //account for FlipX with length of --odd number\r\n\r\n      var x, y;\r\n\r\n      for (x = this.points.length - 1, y = 0; x > middle, y < middle; x--, y++) {\r\n\r\n        var p1 = this.points[x],\r\n          p2 = this.points[y];\r\n\r\n        [p1.y, p2.y] = [p2.y, p1.y];\r\n\r\n      }\r\n\r\n      return this;\r\n    };\r\n\r\n  }\r\n\r\n  informable(obj, args) {\r\n    obj.name = Gamelab.getArg(args, 'name', \"__ObjectName\");\r\n\r\n    obj.description = Gamelab.getArg(args, 'description', false);\r\n\r\n    obj.group = Gamelab.getArg(args, 'group', 'one');\r\n  }\r\n\r\n  tweenable(obj) {\r\n\r\n    obj.curve_string = obj.curve_string || \"linearNone\";\r\n\r\n    obj.setTweenCurve = function(c) {\r\n\r\n      c = c || \"linear_none\";\r\n\r\n      var cps = c.split('_');\r\n\r\n      //alert(cps);\r\n\r\n      var s1 = cps[0].toLowerCase(),\r\n        s2 = cps[1].toLowerCase();\r\n\r\n      var curve = TWEEN.Easing.Linear.None;\r\n\r\n      obj.curve_string = 'linear_none'\r\n\r\n      Gamelab.each(TWEEN.Easing, function(ix, easing) {\r\n\r\n        Gamelab.each(TWEEN.Easing[ix], function(iy, easeType) {\r\n\r\n          if (ix == s1 && iy == s2) {\r\n\r\n            // alert('setting curve');\r\n\r\n            curve = TWEEN.Easing[ix][iy];\r\n\r\n            obj.curve_string = ix + '_' + iy;\r\n\r\n          }\r\n\r\n        });\r\n\r\n      });\r\n\r\n      obj.curve = curve;\r\n\r\n      return curve;\r\n\r\n    };\r\n\r\n    obj.curvesToArray = function() {\r\n\r\n      var c = [];\r\n\r\n      Gamelab.each(TWEEN.Easing, function(ix, easing) {\r\n\r\n        Gamelab.each(easing, function(iy, easeType) {\r\n\r\n          if (['in', 'out', 'inout', 'none'].indexOf(iy.toLowerCase()) >= 0) {\r\n\r\n            c.push(ix + \"_\" + iy);\r\n\r\n          }\r\n\r\n        });\r\n\r\n      });\r\n\r\n      return c;\r\n\r\n    }\r\n  }\r\n\r\n};\r\n\r\nGamelab.FeatureInjectors.CssFeatures = new CssFeatures();\r\n\r\nGamelab.FeatureInjectors.VectorFunctions = new VectorFunctions();\r\n\r\nGamelab.FeatureInjectors.DataFunctions = new DataFunctions();\r\n;/*\n=========================================================================\n   JSManipulate v1.0 (2011-08-01)\n\nJavascript image filter & effect library\n\nDeveloped by Joel Besada (http://www.joelb.me)\nDemo page: http://www.joelb.me/jsmanipulate\n\nMIT LICENSED (http://www.opensource.org/licenses/mit-license.php)\nCopyright (c) 2011, Joel Besada\n=========================================================================\n*/\n\n\n/**\n * Contains common filter functions.\n */\nfunction FilterUtils(){\n\tthis.HSVtoRGB = function (h, s, v){\n\t\tvar r, g, b;\n\t\tvar i = Math.floor(h * 6);\n\t\tvar f = h * 6 - i;\n\t\tvar p = v * (1 - s);\n\t\tvar q = v * (1 - f * s);\n\t\tvar t = v * (1 - (1 - f) * s);\n\t\tswitch(i % 6){\n\t\t\tcase 0: r = v; g = t; b = p; break;\n\t\t\tcase 1: r = q; g = v; b = p; break;\n\t\t\tcase 2: r = p; g = v; b = t; break;\n\t\t\tcase 3: r = p; g = q; b = v; break;\n\t\t\tcase 4: r = t; g = p; b = v; break;\n\t\t\tcase 5: r = v; g = p; b = q; break;\n\t\t\tdefault: break;\n\t\t}\n\t\treturn [r * 255, g * 255, b * 255];\n\t};\n\tthis.RGBtoHSV = function (r, g, b){\n\t\tr = r/255; g = g/255; b = b/255;\n\t\tvar max = Math.max(r, g, b);\n\t\tvar min = Math.min(r, g, b);\n\t\tvar h, s, v = max;\n\t\tvar d = max - min;\n\t\ts = max === 0 ? 0 : d / max;\n\t\tif(max === min){\n\t\t\th = 0;\n\t\t}else{\n\t\t\tswitch(max){\n\t\t\t\tcase r: h = (g - b) / d + (g < b ? 6 : 0); break;\n\t\t\t\tcase g: h = (b - r) / d + 2; break;\n\t\t\t\tcase b: h = (r - g) / d + 4; break;\n\t\t\t\tdefault: break;\n\t\t\t}\n\t\t\th /= 6;\n\t\t}\n\t\treturn [h, s, v];\n\t};\n\tthis.getPixel = function (pixels,x,y,width,height){\n\t\tvar pix = (y*width + x)*4;\n\t\tif (x < 0 || x >= width || y < 0 || y >= height) {\n\t\t\treturn [pixels[((this.clampPixel(y, 0, height-1) * width) + this.clampPixel(x, 0, width-1))*4],\n\t\t\tpixels[((this.clampPixel(y, 0, height-1) * width) + this.clampPixel(x, 0, width-1))*4 + 1],\n\t\t\tpixels[((this.clampPixel(y, 0, height-1) * width) + this.clampPixel(x, 0, width-1))*4 + 2],\n\t\t\tpixels[((this.clampPixel(y, 0, height-1) * width) + this.clampPixel(x, 0, width-1))*4 + 3]];\n\t\t}\n\t\treturn [pixels[pix],pixels[pix+1],pixels[pix+2],pixels[pix+3]];\n\t};\n\tvar haveNextGaussian = false;\n\tvar nextGaussian;\n\tthis.gaussianRandom = function(){\n\t\tif(haveNextGaussian){\n\t\t\thaveNextGaussian = false;\n\t\t\treturn nextGaussian;\n\t\t} else {\n\t\t\tvar v1, v2, s;\n\t\t\tdo {\n\t\t\t\tv1 = 2 * Math.random() - 1;\n\t\t\t\tv2 = 2 * Math.random() - 1;\n\t\t\t\ts = v1 * v1 + v2 * v2;\n\t\t\t} while (s >= 1 || s === 0);\n\t\t\tvar mult = Math.sqrt(-2 * Math.log(s)/s);\n\t\t\tnextGaussian = v2 * mult;\n\t\t\thaveNextGaussian = true;\n\t\t\treturn v1 * mult;\n\t\t}\n\t};\n\tthis.clampPixel = function (x,a,b){\n\t\treturn (x < a) ? a : (x > b) ? b : x;\n\t};\n\tthis.triangle = function(x){\n\t\tvar r = this.mod(x, 1);\n\t\treturn 2*(r < 0.5 ? r : 1-r);\n\t};\n\tthis.mod = function(a,b){\n\t\tvar n = parseInt(a/b,10);\n\t\ta -= n*b;\n\t\tif(a < 0){\n\t\t\treturn a + b;\n\t\t}\n\t\treturn a;\n\t};\n\tthis.mixColors = function(t, rgb1, rgb2){\n\t\tvar r = this.linearInterpolate(t,rgb1[0],rgb2[0]);\n\t\tvar g = this.linearInterpolate(t,rgb1[1],rgb2[1]);\n\t\tvar b = this.linearInterpolate(t,rgb1[2],rgb2[2]);\n\t\tvar a = this.linearInterpolate(t,rgb1[3],rgb2[3]);\n\t\treturn [r,g,b,a];\n\t};\n\n\tthis.linearInterpolate = function(t,a,b){\n\t\treturn a + t * (b-a);\n\t};\n\tthis.bilinearInterpolate = function (x,y,nw,ne,sw,se){\n\t\tvar m0, m1;\n\t\tvar r0 = nw[0]; var g0 = nw[1]; var b0 = nw[2]; var a0 = nw[3];\n\t\tvar r1 = ne[0]; var g1 = ne[1]; var b1 = ne[2]; var a1 = ne[3];\n\t\tvar r2 = sw[0]; var g2 = sw[1]; var b2 = sw[2]; var a2 = sw[3];\n\t\tvar r3 = se[0]; var g3 = se[1]; var b3 = se[2]; var a3 = se[3];\n\t\tvar cx = 1.0 - x; var cy = 1.0 - y;\n\n\t\tm0 = cx * a0 + x * a1;\n\t\tm1 = cx * a2 + x * a3;\n\t\tvar a = cy * m0 + y * m1;\n\n\t\tm0 = cx * r0 + x * r1;\n\t\tm1 = cx * r2 + x * r3;\n\t\tvar r = cy * m0 + y * m1;\n\n\t\tm0 = cx * g0 + x * g1;\n\t\tm1 = cx * g2 + x * g3;\n\t\tvar g = cy * m0 + y * m1;\n\n\t\tm0 = cx * b0 + x * b1;\n\t\tm1 = cx * b2 + x * b3;\n\t\tvar b =cy * m0 + y * m1;\n\t\treturn [r,g,b,a];\n\t};\n\tthis.tableFilter = function (inputData, table, width, height){\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tfor(var i = 0; i < 3; i++){\n\t\t\t\t\tinputData[pixel+i] = table[inputData[pixel+i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\tthis.convolveFilter = function(inputData, matrix, width, height){\n\t\tvar outputData = [];\n\t\tvar rows, cols;\n\t\trows = cols = Math.sqrt(matrix.length);\n\t\tvar rows2 = parseInt(rows/2,10);\n\t\tvar cols2 = parseInt(cols/2,10);\n\t\tvar trace = true;\n\t\tfor(var y = 0; y < height; y++){\n\t\t\tfor (var x = 0; x < width; x++){\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar r = 0, g = 0, b = 0;\n\t\t\t\tfor(var row = -rows2; row <= rows2; row++){\n\t\t\t\t\tvar iy = y+row;\n\t\t\t\t\tvar ioffset;\n\t\t\t\t\tif (0 <= iy && iy < height) {\n\t\t\t\t\t\tioffset = iy*width;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tioffset = y*width;\n\t\t\t\t\t}\n\t\t\t\t\tvar moffset = cols*(row+rows2)+cols2;\n\t\t\t\t\tfor (var col = -cols2; col <= cols2; col++) {\n\t\t\t\t\t\tvar f = matrix[moffset+col];\n\t\t\t\t\t\tif (f !== 0) {\n\t\t\t\t\t\t\tvar ix = x+col;\n\t\t\t\t\t\t\tif (!(0 <= ix && ix < width)) {\n\t\t\t\t\t\t\t\tix = x;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar iPixel = (ioffset+ix)*4;\n\t\t\t\t\t\t\tr += f * inputData[iPixel];\n\t\t\t\t\t\t\tg += f * inputData[iPixel+1];\n\t\t\t\t\t\t\tb += f * inputData[iPixel+2];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\toutputData[pixel] = parseInt(r+0.5,10);\n\t\t\t\toutputData[pixel+1] = parseInt(g+0.5,10);\n\t\t\t\toutputData[pixel+2] = parseInt(b+0.5,10);\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}\n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n\tthis.transformFilter = function(inputData, transformInverse, width, height){\n\t\tvar out = [];\n\t\tvar outputData = [];\n\t\tfor(var j = 0; j < inputData.length; j++){\n\t\t\toutputData[j] = inputData[j];\n\t\t}\n\t\tfor(var y = 0; y < height; y++){\n\t\t\tfor (var x = 0; x < width; x++){\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\ttransformInverse.apply(this,[x,y,out]);\n\t\t\t\tvar srcX = Math.floor(out[0]);\n\t\t\t\tvar srcY = Math.floor(out[1]);\n\t\t\t\tvar xWeight = out[0]-srcX;\n\t\t\t\tvar yWeight = out[1]-srcY;\n\t\t\t\tvar nw,ne,sw,se;\n\t\t\t\tif(srcX >= 0 && srcX < width-1 && srcY >= 0 && srcY < height-1){\n\t\t\t\t\tvar i = (width*srcY + srcX)*4;\n\t\t\t\t\tnw = [inputData[i],inputData[i+1],inputData[i+2],inputData[i+3]];\n\t\t\t\t\tne = [inputData[i+4],inputData[i+5],inputData[i+6],inputData[i+7]];\n\t\t\t\t\tsw = [inputData[i+width*4],inputData[i+width*4+1],inputData[i+width*4+2],inputData[i+width*4+3]];\n\t\t\t\t\tse = [inputData[i+(width + 1)*4],inputData[i+(width + 1)*4+1],inputData[i+(width + 1)*4+2],inputData[i+(width + 1)*4+3]];\n\t\t\t\t} else {\n\t\t\t\t\tnw = this.getPixel( inputData, srcX, srcY, width, height );\n\t\t\t\t\tne = this.getPixel( inputData, srcX+1, srcY, width, height );\n\t\t\t\t\tsw = this.getPixel( inputData, srcX, srcY+1, width, height );\n\t\t\t\t\tse = this.getPixel( inputData, srcX+1, srcY+1, width, height );\n\t\t\t\t}\n\t\t\t\tvar rgba = this.bilinearInterpolate(xWeight,yWeight,nw,ne,sw,se);\n\t\t\t\toutputData[pixel] = rgba[0];\n\t\t\t\toutputData[pixel + 1] = rgba[1];\n\t\t\t\toutputData[pixel + 2] = rgba[2];\n\t\t\t\toutputData[pixel + 3] = rgba[3];\n\t\t\t}\n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Blurs the image with Gaussian blur.\n */\nfunction BlurFilter(){\n\tthis.name = \"Blur\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tamount : 3\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0, max:10}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width;\n\t\tvar width4 = width << 2;\n\t\tvar height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar q;\n\t\tvar amount = values.amount;\n\t\tif (amount < 0.0) {\n\t\t\tamount = 0.0;\n\t\t}\n\t\tif (amount >= 2.5) {\n\t\t\tq = 0.98711 * amount - 0.96330;\n\t\t} else if (amount >= 0.5) {\n\t\t\tq = 3.97156 - 4.14554 * Math.sqrt(1.0 - 0.26891 * amount);\n\t\t} else {\n\t\t\tq = 2 * amount * (3.97156 - 4.14554 * Math.sqrt(1.0 - 0.26891 * 0.5));\n\t\t}\n\t\tvar qq = q * q;\n\t\tvar qqq = qq * q;\n\t\tvar b0 = 1.57825 + (2.44413 * q) + (1.4281 * qq ) + (0.422205 * qqq);\n\t\tvar b1 = ((2.44413 * q) + (2.85619 * qq) + (1.26661 * qqq)) / b0;\n\t\tvar b2 = (-((1.4281 * qq) + (1.26661 * qqq))) / b0;\n\t\tvar b3 = (0.422205 * qqq) / b0;\n\t\tvar bigB = 1.0 - (b1 + b2 + b3);\n\t\tvar c = 0;\n\t\tvar index;\n\t\tvar indexLast;\n\t\tvar pixel;\n\t\tvar ppixel;\n\t\tvar pppixel;\n\t\tvar ppppixel;\n\t\tfor (c = 0; c < 3; c++) {\n\t\t\tfor (var y = 0; y < height; y++) {\n\t\t\t\tindex = y * width4 + c;\n\t\t\t\tindexLast = y * width4 + ((width - 1) << 2) + c;\n\t\t\t\tpixel = inputData[index];\n\t\t\t\tppixel = pixel;\n\t\t\t\tpppixel = ppixel;\n\t\t\t\tppppixel = pppixel;\n\t\t\t\tfor (; index <= indexLast; index += 4) {\n\t\t\t\t\tpixel = bigB * inputData[index] + b1 * ppixel + b2 * pppixel + b3 * ppppixel;\n\t\t\t\t\tinputData[index] = pixel;\n\t\t\t\t\tppppixel = pppixel;\n\t\t\t\t\tpppixel = ppixel;\n\t\t\t\t\tppixel = pixel;\n\t\t\t\t}\n\t\t\t\tindex = y * width4 + ((width - 1) << 2) + c;\n\t\t\t\tindexLast = y * width4 + c;\n\t\t\t\tpixel = inputData[index];\n\t\t\t\tppixel = pixel;\n\t\t\t\tpppixel = ppixel;\n\t\t\t\tppppixel = pppixel;\n\t\t\t\tfor (; index >= indexLast; index -= 4) {\n\t\t\t\t\tpixel = bigB * inputData[index] + b1 * ppixel + b2 * pppixel + b3 * ppppixel;\n\t\t\t\t\tinputData[index] = pixel;\n\t\t\t\t\tppppixel = pppixel;\n\t\t\t\t\tpppixel = ppixel;\n\t\t\t\t\tppixel = pixel;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (c = 0; c < 3; c++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tindex = (x << 2) + c;\n\t\t\t\tindexLast = (height - 1) * width4 + (x << 2) + c;\n\t\t\t\tpixel = inputData[index];\n\t\t\t\tppixel = pixel;\n\t\t\t\tpppixel = ppixel;\n\t\t\t\tppppixel = pppixel;\n\t\t\t\tfor (; index <= indexLast; index += width4) {\n\t\t\t\t\tpixel = bigB * inputData[index] + b1 * ppixel + b2 * pppixel + b3 * ppppixel;\n\t\t\t\t\tinputData[index] = pixel;\n\t\t\t\t\tppppixel = pppixel;\n\t\t\t\t\tpppixel = ppixel;\n\t\t\t\t\tppixel = pixel;\n\t\t\t\t}\n\t\t\t\tindex = (height - 1) * width4 + (x << 2) + c;\n\t\t\t\tindexLast = (x << 2) + c;\n\t\t\t\tpixel = inputData[index];\n\t\t\t\tppixel = pixel;\n\t\t\t\tpppixel = ppixel;\n\t\t\t\tppppixel = pppixel;\n\t\t\t\tfor (; index >= indexLast; index -= width4) {\n\t\t\t\t\tpixel = bigB * inputData[index] + b1 * ppixel + b2 * pppixel + b3 * ppppixel;\n\t\t\t\t\tinputData[index] = pixel;\n\t\t\t\t\tppppixel = pppixel;\n\t\t\t\t\tpppixel = ppixel;\n\t\t\t\t\tppixel = pixel;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Adjusts the brightness of the image by going over to HSV values.\n * Negative values decrease brightness while positive values increase brightness.\n */\nfunction BrightnessFilter(){\n\tthis.name = \"Brightness\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 0.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:-1.0, max:1.0}\n\t};\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar hsv = filterUtils.RGBtoHSV(inputData[pixel],inputData[pixel+1],inputData[pixel+2]);\n\t\t\t\thsv[2] += amount;\n\t\t\t\tif(hsv[2] < 0){\n\t\t\t\t\thsv[2] = 0;\n\t\t\t\t} else if (hsv[2] > 1){\n\t\t\t\t\thsv[2] = 1;\n\t\t\t\t}\n\t\t\t\tvar rgb = filterUtils.HSVtoRGB(hsv[0],hsv[1],hsv[2]);\n\t\t\t\tfor(var i = 0; i < 3; i++){\n\t\t\t\t\tinputData[pixel+i] = rgb[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Embosses the edges of the image.\n * This filter takes no parameters but can be applied several times for\n * further effect.\n */\nfunction BumpFilter(){\n\tthis.name = \"Bump\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar matrix = [-1,-1, 0,\n\t\t\t\t\t  -1, 1, 1,\n\t\t\t\t\t   0, 1, 1];\n\t\tfilterUtils.convolveFilter(inputData,matrix,width,height);\n\t};\n}\n/**\n * Smears out the image with circular shapes to create a painting style effect.\n * The mix values sets the intensity of the effect.\n * NOTE: This filter can be very slow, especially at higher densities/sizes. Use with caution.\n */\nfunction CircleSmearFilter(){\n\tthis.name = \"Circle Smear\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tsize : 4,\n\t\tdensity : 0.5,\n\t\tmix : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tsize : {min:1, max:10},\n\t\tdensity : {min:0.0, max:1.0},\n\t\tmix : {min:0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\t for(var j = 0; j < inputData.length; j++){\n\t\t\toutputData[j] = inputData[j];\n\t\t}\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar size = (values.size === undefined) ? this.defaultValues.size : values.size;\n\t\tif(size < 1){ size = 1;}\n\t\tsize = parseInt(size,10);\n\t\tvar density = (values.density === undefined) ? this.defaultValues.density : values.density;\n\t\tvar mix = (values.mix === undefined) ? this.defaultValues.mix : values.mix;\n\t\tvar radius = size+1;\n\t\tvar radius2 = radius*radius;\n\t\tvar numShapes = parseInt(2*density/30*width*height / 2,10);\n\t\tfor(var i = 0; i < numShapes; i++){\n\t\t\tvar sx = (Math.random()*Math.pow(2,32) & 0x7fffffff) % width;\n\t\t\tvar sy = (Math.random()*Math.pow(2,32) & 0x7fffffff) % height;\n\t\t\tvar rgb2 = [inputData[(sy*width+sx)*4],inputData[(sy*width+sx)*4+1],inputData[(sy*width+sx)*4+2],inputData[(sy*width+sx)*4+3]];\n\t\t\tfor(var x = sx - radius; x < sx + radius + 1; x++){\n\t\t\t\tfor(var y = sy - radius; y < sy + radius + 1; y++){\n\t\t\t\t\tvar f = (x - sx) * (x - sx) + (y - sy) * (y - sy);\n\t\t\t\t\tif (x >= 0 && x < width && y >= 0 && y < height && f <= radius2) {\n\t\t\t\t\t\tvar rgb1 = [outputData[(y*width+x)*4],outputData[(y*width+x)*4+1],outputData[(y*width+x)*4+2],outputData[(y*width+x)*4+3]];\n\t\t\t\t\t\tvar mixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\t\tfor(var k = 0; k < 3; k++){\n\t\t\t\t\t\t\toutputData[(y*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(var l = 0; l < outputData.length; l++){\n\t\t\tinputData[l] = outputData[l];\n\t\t}\n\t};\n}\n/**\n * Adjusts the contrast of the image.\n */\nfunction ContrastFilter(){\n\tthis.name = \"Contrast\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 1.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0.0, max:2.0}\n\t};\n\tif(!FilterUtils){\n\t\t\tif(console){\n\t\t\t\tconsole.error(\"Unable to find filterutils.js, please include this file! (Required by \" + this.name + \" filter)\");\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tif(amount < 0){\n\t\t\tamount = 0.0;\n\t\t}\n\t\tvar table = [];\n\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\ttable[i] = parseInt(255 * (((i/255)-0.5)*amount+0.5),10);\n\t\t}\n\t\tfilterUtils.tableFilter(inputData,table,width,height);\n\t};\n}\n/**\n * Smears out the image with cross shapes to create a painting style effect.\n * The mix values sets the intensity of the effect.\n */\nfunction CrossSmearFilter(){\n\tthis.name = \"Cross Smear\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tdistance : 8,\n\t\tdensity : 0.5,\n\t\tmix : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tdistance : {min:0, max:30},\n\t\tdensity : {min:0.0, max:1.0},\n\t\tmix : {min:0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\t for(var j = 0; j < inputData.length; j++){\n\t\t\toutputData[j] = inputData[j];\n\t\t}\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar distance = (values.distance === undefined) ? this.defaultValues.distance : values.distance;\n\t\tif(distance < 0){ distance = 0;}\n\t\tdistance = parseInt(distance,10);\n\t\tvar density = (values.density === undefined) ? this.defaultValues.density : values.density;\n\t\tvar mix = (values.mix === undefined) ? this.defaultValues.mix : values.mix;\n\t\tvar numShapes = parseInt(2*density*width * height / (distance + 1),10);\n\t\tfor(var i = 0; i < numShapes; i++){\n\t\t\tvar x = (Math.random()*Math.pow(2,32) & 0x7fffffff) % width;\n\t\t\tvar y = (Math.random()*Math.pow(2,32) & 0x7fffffff) % height;\n\t\t\tvar length = (Math.random()*Math.pow(2,32)) % distance + 1;\n\t\t\tvar rgb2 = [inputData[(y*width+x)*4],inputData[(y*width+x)*4+1],inputData[(y*width+x)*4+2],inputData[(y*width+x)*4+3]];\n\t\t\tvar rgb1;\n\t\t\tvar mixedRGB;\n\t\t\tvar k;\n\t\t\tfor (var x1 = x-length; x1 < x+length+1; x1++) {\n\t\t\t\tif(x1 >= 0 && x1 < width){\n\t\t\t\t\trgb1 = [outputData[(y*width+x1)*4],outputData[(y*width+x1)*4+1],outputData[(y*width+x1)*4+2],outputData[(y*width+x1)*4+3]];\n\t\t\t\t\tmixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\t\toutputData[(y*width+x1)*4+k] = mixedRGB[k];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tfor (var y1 = y-length; y1 < y+length+1; y1++) {\n\t\t\t\tif(y1 >= 0 && y1 < height){\n\t\t\t\t\trgb1 = [outputData[(y1*width+x)*4],outputData[(y1*width+x)*4+1],outputData[(y1*width+x)*4+2],outputData[(y1*width+x)*4+3]];\n\t\t\t\t\tmixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\t\toutputData[(y1*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\t\tfor(var l = 0; l < outputData.length; l++){\n\t\t\tinputData[l] = outputData[l];\n\t\t}\n\t};\n}\n/**\n * Diffuses the image creating a frosted glass effect.\n */\nfunction DiffusionFilter(){\n\tthis.name = \"Diffusion\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tscale: 4\n\t};\n\tthis.valueRanges = {\n\t\tscale: {min: 1, max: 100}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar scale = (values.scale === undefined) ? this.defaultValues.scale : values.scale;\n\t\tvar out = [];\n\t\tvar outputData = [];\n\t\tvar sinTable = [];\n\t\tvar cosTable = [];\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\tvar angle = Math.PI*2*i/256;\n\t\t\tsinTable[i] = scale*Math.sin(angle);\n\t\t\tcosTable[i] = scale*Math.cos(angle);\n\t\t}\n\t\ttransInverse = function (x,y,out){\n\t\t\tvar angle = parseInt(Math.random() * 255,10);\n\t\t\tvar distance = Math.random();\n\t\t\tout[0] = x + distance * sinTable[angle];\n\t\t\tout[1] = y + distance * cosTable[angle];\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n  };\n}\n/**\n * Dithers the image to the specified number of colors. Setting color to false\n * grayscales the image.\n */\nfunction DitherFilter(){\n\tthis.name = \"Dither\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tlevels : 3,\n\t\tcolor : true\n\t};\n\tthis.valueRanges = {\n\t\tlevels : {min:2, max:30},\n\t\tcolor : {min:false, max:true}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tvar i, j;\n\t\tfor (j=0; j < inputData.length; j++) {\n\t\t\toutputData[j] = 0;\n\t\t}\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar levels = (values.levels === undefined) ? this.defaultValues.levels : values.levels;\n\t\tvar color = (values.color === undefined) ? this.defaultValues.color : values.color;\n\t\tif(levels <= 1){\n\t\t\tlevels = 1;\n\t\t}\n\t\tvar matrix = [0,0,0,\n\t\t\t\t\t  0,0,7,\n\t\t\t\t\t  3,5,1];\n\t\tvar sum = 7+3+5+1;\n\t\tvar index = 0;\n\t\tvar map = [];\n\n\t\tfor (i=0; i < levels; i++) {\n\t\t\tmap[i] = parseInt(255* i / (levels-1),10);\n\t\t}\n\t\tvar div = [];\n\t\tfor (i=0; i < 256; i++) {\n\t\t\tdiv[i] = parseInt(levels*i / 256,10);\n\t\t}\n\t  \tfor (var y = 0; y < height; y++) {\n\t\t\tvar reverse = ((y & 1) == 1);\n\t\t\tvar direction;\n\t\t\tif(reverse){\n\t\t\t\tindex = (y*width+width-1)*4;\n\t\t\t\tdirection = -1;\n\t\t\t} else {\n\t\t\t\tindex = y*width*4;\n\t\t\t\tdirection = 1;\n\t\t\t}\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar r1 = inputData[index]; var g1 = inputData[index+1]; var b1 = inputData[index+2];\n\t\t\t\tif(!color){\n\t\t\t\t\tr1 = g1 = b1 = parseInt((r1+g1+b1) / 3,10);\n\t\t\t\t}\n\t\t\t\tvar r2 = map[div[r1]];var g2 = map[div[g1]];var b2 = map[div[b1]];\n\n\t\t\t\toutputData[index] = r2; outputData[index + 1] = g2; outputData[index+2] = b2; outputData[index+3] = inputData[index+3];\n\n\t\t\t\tvar er = r1-r2; var eg = g1-g2; var eb = b1-b2;\n\n\t\t\t\tfor (i = -1; i <= 1; i++) {\n\t\t\t\t\tvar iy = i+y;\n\t\t\t\t\tif (0 <= iy && iy < height) {\n\t\t\t\t\t\tfor (j = -1; j <= 1; j++) {\n\t\t\t\t\t\t\tvar jx = j+x;\n\t\t\t\t\t\t\tif (0 <= jx && jx < width) {\n\t\t\t\t\t\t\t\tvar w;\n\t\t\t\t\t\t\t\tif (reverse){\n\t\t\t\t\t\t\t\t\tw = matrix[(i+1)*3-j+1];\n\t\t\t\t\t\t\t\t} else{\n\t\t\t\t\t\t\t\t\tw = matrix[(i+1)*3+j+1];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (w !== 0) {\n\t\t\t\t\t\t\t\t\tvar k = (reverse) ? index - j*4 : index + j*4;\n\t\t\t\t\t\t\t\t\tr1 = inputData[k]; g1 = inputData[k+1]; b1 = inputData[k+2];\n\t\t\t\t\t\t\t\t\tvar factor = w/sum;\n\t\t\t\t\t\t\t\t\tr1 += er * factor; g1 += eg * factor; b1 += eb * factor;\n\t\t\t\t\t\t\t\t\tinputData[k] = r1; inputData[k+1] = g1 ;inputData[k+2] = b1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tindex += direction*4;\n\t\t\t}\n\t\t}\n\t\tfor(j = 0; j < outputData.length; j++){\n\t\t\tinputData[j] = outputData[j];\n\t\t}\n\t};\n}\n/**\n * Highlights the edges of the image.\n */\nfunction EdgeFilter(){\n\tthis.name = \"Edge Detection\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tvar matrixH = [-1,-2,-1,\n\t\t\t\t\t0, 0, 0,\n\t\t\t\t\t1, 2, 1];\n\tvar matrixV = [-1, 0, 1,\n\t\t\t\t   -2, 0, 2,\n\t\t\t\t   -1, 0, 1];\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar rh = 0; gh = 0; bh = 0;\n\t\t\t\tvar rv = 0; gv = 0; bv = 0;\n\t\t\t\tfor(var row = -1; row <= 1; row++){\n\t\t\t\t\tvar iy = y+row;\n\t\t\t\t\tvar ioffset;\n\t\t\t\t\tif(iy >= 0 && iy < height){\n\t\t\t\t\t\tioffset = iy*width*4;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tioffset = y*width*4;\n\t\t\t\t\t}\n\t\t\t\t\tvar moffset = 3*(row+1)+1;\n\t\t\t\t\tfor(var col = -1; col <= 1; col++){\n\t\t\t\t\t\tvar ix = x+col;\n\t\t\t\t\t\tif(!(ix >= 0 && ix < width)){\n\t\t\t\t\t\t\tix = x;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tix *= 4;\n\t\t\t\t\t\tvar r = inputData[ioffset+ix];\n\t\t\t\t\t\tvar g = inputData[ioffset+ix+1];\n\t\t\t\t\t\tvar b = inputData[ioffset+ix+2];\n\t\t\t\t\t\tvar h = matrixH[moffset+col];\n\t\t\t\t\t\tvar v = matrixV[moffset+col];\n\t\t\t\t\t\trh += parseInt(h*r,10);\n\t\t\t\t\t\tbh += parseInt(h*g,10);\n\t\t\t\t\t\tgh += parseInt(h*b,10);\n\t\t\t\t\t\trv += parseInt(v*r,10);\n\t\t\t\t\t\tgv += parseInt(v*g,10);\n\t\t\t\t\t\tbv += parseInt(v*b,10);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tr = parseInt(Math.sqrt(rh*rh + rv*rv) / 1.8,10);\n\t\t\t\tg = parseInt(Math.sqrt(gh*gh + gv*gv) / 1.8,10);\n\t\t\t\tb = parseInt(Math.sqrt(bh*bh + bv*bv) / 1.8,10);\n\n\t\t\t\toutputData[pixel] = r;\n\t\t\t\toutputData[pixel+1] = g;\n\t\t\t\toutputData[pixel+2] = b;\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}\n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Embosses the image with a simulated light source.\n * Angle and elevation sets the position of the light.\n */\nfunction EmbossFilter(){\n\tthis.name = \"Emboss\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\theight : 1,\n\t\tangle : 135,\n\t\televation : 30\n\t};\n\tthis.valueRanges = {\n\t\theight : {min:1, max:10},\n\t\tangle : {min:0, max:360},\n\t\televation : {min:0, max:180}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar bumpHeight = (values.height === undefined) ? this.defaultValues.height : values.height;\n\t\tvar angle = (values.angle === undefined) ? this.defaultValues.angle : values.angle;\n\t\tvar elevation = (values.elevation === undefined) ? this.defaultValues.elevation : values.elevation;\n\t\tangle = angle / 180 * Math.PI;\n\t\televation = elevation / 180 * Math.PI;\n\t\tvar width45 = 3 * bumpHeight;\n\t\tvar pixelScale = 255.9;\n\n\t\tvar bumpPixels = [];\n\t\tvar bumpMapWidth = width;\n\t\tvar bumpMapHeight = height;\n\t\tfor(var i = 0; i < inputData.length; i+=4){\n\t\t\tbumpPixels[i/4] = (inputData[i] + inputData[i+1] + inputData[i+2])/3;\n\t\t}\n\t\tvar Nx, Ny, Nz, Lx, Ly, Lz, Nz2, NzLz, NdotL;\n\t\tvar shade, background;\n\n\t\tLx = parseInt(Math.cos(angle) * Math.cos(elevation) * pixelScale,10);\n\t\tLy = parseInt(Math.sin(angle) * Math.cos(elevation) * pixelScale,10);\n\t\tLz = parseInt(Math.sin(elevation) * pixelScale,10);\n\n\t\tNz = parseInt(6 * 255 / width45,10);\n\t\tNz2 = Nz * Nz;\n\t\tNzLz = Nz * Lz;\n\t\tbackground = Lz;\n\n\t\tvar bumpIndex = 0;\n\n\t\tfor (var y = 0; y < height; y++, bumpIndex += bumpMapWidth) {\n\t\t\tvar s1 = bumpIndex;\n\t\t\tvar s2 = s1 + bumpMapWidth;\n\t\t\tvar s3 = s2 + bumpMapWidth;\n\t\t\tfor (var x = 0; x < width; x++, s1++, s2++, s3++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tif (y !== 0 && y < height-2 && x !== 0 && x < width-2) {\n\t\t\t\t\tNx = bumpPixels[s1-1] + bumpPixels[s2-1] + bumpPixels[s3-1] - bumpPixels[s1+1] - bumpPixels[s2+1] - bumpPixels[s3+1];\n\t\t\t\t\tNy = bumpPixels[s3-1] + bumpPixels[s3] + bumpPixels[s3+1] - bumpPixels[s1-1] - bumpPixels[s1] - bumpPixels[s1+1];\n\t\t\t\t\tif (Nx === 0 && Ny === 0){\n\t\t\t\t\t\tshade = background;\n\t\t\t\t\t} else if ((NdotL = Nx*Lx + Ny*Ly + NzLz) < 0){\n\t\t\t\t\t\tshade = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshade = parseInt(NdotL / Math.sqrt(Nx*Nx + Ny*Ny + Nz2),10);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tshade = background;\n\t\t\t\t}\n\t\t\t\tinputData[pixel] = inputData[pixel+1] = inputData[pixel+2] = shade;\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Adjust simulated exposure values on the image.\n */\nfunction ExposureFilter(){\n\tthis.name = \"Exposure\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\texposure : 1.0\n\t};\n\tthis.valueRanges = {\n\t\texposure : {min:0, max:5}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar exposure = (values.exposure === undefined) ? this.defaultValues.exposure : values.exposure;\n\t\tvar table = [];\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\ttable[i] = parseInt(255 *(1-Math.exp(-(i/255) * exposure)),10);\n\t\t}\n\t\tfilterUtils.tableFilter(inputData, table, width, height);\n\t};\n}\n/**\n * Adjusts the gain and bias of the image. Gain alters the contrast while bias biases\n * colors towards lighter or darker.\n */\nfunction GainFilter(){\n\tthis.name = \"Gain/Bias\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tgain: 0.5,\n\t\tbias: 0.5\n\t};\n\tthis.valueRanges = {\n\t\tgain: {min:0.0, max:1.0},\n\t\tbias: {min:0.0, max:1.0}\n\t};\n\tvar table = [];\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar gain = (values.gain === undefined) ? this.defaultValues.gain : values.gain;\n\t\tvar bias = (values.bias === undefined) ? this.defaultValues.bias : values.bias;\n\n\t\tvar table = [];\n\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\tvar val = i/255;\n\t\t\tvar k = (1/gain-2) * (1-2*val);\n\t\t\tval = (val < 0.5) ? val/(k+1) : (k-val)/(k-1);\n\t\t\tval /= (1/bias-2)*(1-val)+1;\n\t\t\ttable[i] = parseInt(255 * val,10);\n\t\t}\n\t\tfilterUtils.tableFilter(inputData,table,width,height);\n\t};\n}\n/**\n * Adjusts the gamma values of the image. Values over 1 increase the gamma while values over 0 decrease gamma.\n */\nfunction GammaFilter(){\n\tthis.name = \"Gamma\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 1.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0.0, max:2.0}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tif(amount < 0){\n\t\t\tamount = 0.0;\n\t\t}\n\t\tif(!FilterUtils){\n\t\t\tif(console){\n\t\t\t\tconsole.error(\"Unable to find filterutils.js, please include this file! (Required by \" + this.name + \" filter)\");\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tvar filterUtils = new FilterUtils();\n\t\tvar table = [];\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\ttable[i] = 255 * Math.pow(i/255, 1/amount) + 0.5;\n\t\t}\n\t\tfilterUtils.tableFilter(inputData,table,width,height);\n\t};\n}\n/**\n * Sets the image to grayscale.\n */\nfunction GrayscaleFilter(){\n\tthis.name = \"Grayscale\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar luma = inputData[pixel]*0.3 + inputData[pixel+1]*0.59 + inputData[pixel+2]*0.11;\n\t\t\t\tinputData[pixel] = inputData[pixel+1] = inputData[pixel+2] = luma;\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Adjusts the hue of the image by going over to HSV values.\n */\nfunction HueFilter(){\n\tthis.name = \"Hue\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 0.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:-1.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar hsv = filterUtils.RGBtoHSV(inputData[pixel],inputData[pixel+1],inputData[pixel+2]);\n\t\t\t\thsv[0] += amount;\n\t\t\t\twhile(hsv[0] < 0){\n\t\t\t\t\thsv[0] += 360;\n\t\t\t\t}\n\t\t\t\tvar rgb = filterUtils.HSVtoRGB(hsv[0],hsv[1],hsv[2]);\n\t\t\t\tfor(var i = 0; i < 3; i++){\n\t\t\t\t\tinputData[pixel+i] = rgb[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Inverts the colors of the image.\n */\nfunction InvertFilter(){\n\tthis.name = \"Invert\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tfor(var i = 0; i < 3; i++){\n\t\t\t\t\tinputData[pixel+i] = 255 - inputData[pixel+i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Creates a kaleidoscope effect on the image. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction KaleidoscopeFilter(){\n\tthis.name = \"Kaleidoscope\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tangle : 0,\n\t\trotation : 0,\n\t\tsides : 3,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tangle : {min: 0, max: 360},\n\t\trotation : {min: 0, max: 360},\n\t\tsides : {min: 1, max: 30},\n\t\tcenterX : {min: 0.0, max:1.0},\n\t\tcenterY : {min: 0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar angle = (values.angle === undefined) ? this.defaultValues.angle : values.angle;\n\t\tvar rotation = (values.rotation === undefined) ? this.defaultValues.rotation : values.rotation;\n\t\tvar sides = (values.sides === undefined) ? this.defaultValues.sides : values.sides;\n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX;\n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY;\n\t\tvar iCenterX = width * centerX; var iCenterY = height * centerY;\n\t\tangle = angle/180 * Math.PI;\n\t\trotation = rotation/180 * Math.PI;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar dx = x - iCenterX;\n\t\t\tvar dy = y - iCenterY;\n\t\t\tvar r = Math.sqrt(dx*dx + dy*dy);\n\t\t\tvar theta = Math.atan2(dy,dx) - angle - rotation;\n\t\t\ttheta = filterUtils.triangle(theta/Math.PI*sides*0.5);\n\t\t\ttheta += angle;\n\t\t\tout[0] = iCenterX + r*Math.cos(theta);\n\t\t\tout[1] = iCenterY + r*Math.sin(theta);\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Applies a fisheye lens distortion effect on the image. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction LensDistortionFilter(){\n\tthis.name = \"Lens Distortion\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\trefraction : 1.5,\n\t\tradius : 50,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\trefraction : {min: 1, max: 10},\n\t\tradius : {min: 1, max: 200},\n\t\tcenterX : {min: 0.0, max:1.0},\n\t\tcenterY : {min: 0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar refraction = (values.refraction === undefined) ? this.defaultValues.refraction : values.refraction;\n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX;\n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY;\n\t\tvar radius = (values.radius === undefined) ? this.defaultValues.radius : values.radius;\n\t\tvar radius2 = radius*radius;\n\t\tvar iCenterX = width * centerX; var iCenterY = height * centerY;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar dx = x-iCenterX;\n\t\t\tvar dy = y-iCenterY;\n\t\t\tvar x2 = dx*dx;\n\t\t\tvar y2 = dy*dy;\n\t\t\tif (y2 >= (radius2 - (radius2*x2)/radius2)) {\n\t\t\t\tout[0] = x;\n\t\t\t\tout[1] = y;\n\t\t\t} else {\n\t\t\t\tvar rRefraction = 1.0 / refraction;\n\n\t\t\t\tvar z = Math.sqrt((1.0 - x2/radius2 - y2/radius2) * radius2);\n\t\t\t\tvar z2 = z*z;\n\n\t\t\t\tvar xAngle = Math.acos(dx / Math.sqrt(x2+z2));\n\t\t\t\tvar angle1 = Math.PI/2 - xAngle;\n\t\t\t\tvar angle2 = Math.asin(Math.sin(angle1)*rRefraction);\n\t\t\t\tangle2 = Math.PI/2 - xAngle - angle2;\n\t\t\t\tout[0] = x - Math.tan(angle2)*z;\n\n\t\t\t\tvar yAngle = Math.acos(dy / Math.sqrt(y2+z2));\n\t\t\t\tangle1 = Math.PI/2 - yAngle;\n\t\t\t\tangle2 = Math.asin(Math.sin(angle1)*rRefraction);\n\t\t\t\tangle2 = Math.PI/2 - yAngle - angle2;\n\t\t\t\tout[1] = y - Math.tan(angle2)*z;\n\t\t\t}\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Smears out the image with line shapes to create a painting style effect. Mix specifies\n * the intensity of the effect.\n */\nfunction LineSmearFilter(){\n\tthis.name = \"Line Smear\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tdistance : 8,\n\t\tdensity : 0.5,\n\t\tangle : 0,\n\t\tmix : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tdistance : {min:1, max:30},\n\t\tdensity : {min:0.0, max:1.0},\n\t\tangle : {min:0, max:360},\n\t\tmix : {min:0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tvar k;\n\t\tfor(k = 0; k < inputData.length; k++){\n\t\t\toutputData[k] = inputData[k];\n\t\t}\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar distance = (values.distance === undefined) ? this.defaultValues.distance : values.distance;\n\t\tif(distance < 1){ distance = 1;}\n\t\tdistance = parseInt(distance,10);\n\t\tvar density = (values.density === undefined) ? this.defaultValues.density : values.density;\n\t\tvar angle = (values.angle === undefined) ? this.defaultValues.angle : values.angle;\n\t\tvar mix = (values.mix === undefined) ? this.defaultValues.mix : values.mix;\n\t\tangle = angle/180*Math.PI;\n\t\tvar sinAngle = Math.sin(angle);\n\t\tvar cosAngle = Math.cos(angle);\n\t\tvar numShapes = parseInt(2*density*width*height / 2,10);\n\t\tfor(var i = 0; i < numShapes; i++){\n\t\t\tvar sx = (Math.random()*Math.pow(2,32) & 0x7fffffff) % width;\n\t\t\tvar sy = (Math.random()*Math.pow(2,32) & 0x7fffffff) % height;\n\t\t\tvar length = (Math.random()*Math.pow(2,32) & 0x7fffffff) % distance + 1;\n\t\t\tvar rgb2 = [inputData[(sy*width+sx)*4],inputData[(sy*width+sx)*4+1],inputData[(sy*width+sx)*4+2],inputData[(sy*width+sx)*4+3]];\n\t\t\tvar dx = parseInt(length*cosAngle,10);\n\t\t\tvar dy = parseInt(length*sinAngle,10);\n\n\t\t\tvar x0 = sx-dx;\n\t\t\tvar y0 = sy-dy;\n\t\t\tvar x1 = sx+dx;\n\t\t\tvar y1 = sy+dy;\n\t\t\tvar x, y, d, incrE, incrNE, ddx, ddy;\n\n\t\t\tif (x1 < x0){\n\t\t\t\tddx = -1;\n\t\t\t} else {\n\t\t\t\tddx = 1;\n\t\t\t}\n\t\t\tif (y1 < y0){\n\t\t\t\tddy = -1;\n\t\t\t} else {\n\t\t\t\tddy = 1;\n\t\t\t}\n\t\t\tdx = x1-x0;\n\t\t\tdy = y1-y0;\n\t\t\tdx = Math.abs(dx);\n\t\t\tdy = Math.abs(dy);\n\t\t\tx = x0;\n\t\t\ty = y0;\n\t\t\tvar rgb1;\n\t\t\tvar mixedRGB;\n\t\t\tif (x < width && x >= 0 && y < height && y >= 0) {\n\t\t\t\trgb1 = [outputData[(y*width+x)*4],outputData[(y*width+x)*4+1],outputData[(y*width+x)*4+2],outputData[(y*width+x)*4+3]];\n\t\t\t\tmixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\toutputData[(y*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (Math.abs(dx) > Math.abs(dy)) {\n\t\t\t\td = 2*dy-dx;\n\t\t\t\tincrE = 2*dy;\n\t\t\t\tincrNE = 2*(dy-dx);\n\n\t\t\t\twhile (x != x1) {\n\t\t\t\t\tif (d <= 0){\n\t\t\t\t\t\td += incrE;\n\t\t\t\t\t} else {\n\t\t\t\t\t\td += incrNE;\n\t\t\t\t\t\ty += ddy;\n\t\t\t\t\t}\n\t\t\t\t\tx += ddx;\n\t\t\t\t\tif (x < width && x >= 0 && y < height && y >= 0) {\n\t\t\t\t\t\trgb1 = [outputData[(y*width+x)*4],outputData[(y*width+x)*4+1],outputData[(y*width+x)*4+2],outputData[(y*width+x)*4+3]];\n\t\t\t\t\t\tmixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\t\t\toutputData[(y*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\td = 2*dx-dy;\n\t\t\t\tincrE = 2*dx;\n\t\t\t\tincrNE = 2*(dx-dy);\n\n\t\t\t\twhile (y != y1) {\n\t\t\t\t\tif (d <= 0) {\n\t\t\t\t\t\td += incrE;\n\t\t\t\t\t}else {\n\t\t\t\t\t\td += incrNE;\n\t\t\t\t\t\tx += ddx;\n\t\t\t\t\t}\n\t\t\t\t\ty += ddy;\n\t\t\t\t\tif (x < width && x >= 0 && y < height && y >= 0) {\n\t\t\t\t\t\trgb1 = [outputData[(y*width+x)*4],outputData[(y*width+x)*4+1],outputData[(y*width+x)*4+2],outputData[(y*width+x)*4+3]];\n\t\t\t\t\t\tmixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\t\t\toutputData[(y*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Replaces every pixel with the maximum RGB value of the neighboring pixels. Each color is\n * considered separately.\n */\nfunction MaximumFilter(){\n\tthis.name = \"Maximum\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar maxR = 0;\n\t\t\t\tvar maxG = 0;\n\t\t\t\tvar maxB = 0;\n\t\t\t\tfor (var dy = -1; dy <= 1; dy++){\n\t\t\t\t\tvar iy = y+dy;\n\t\t\t\t\tif(iy >= 0 && iy < height){\n\t\t\t\t\t\tfor (var dx = -1; dx <= 1; dx++){\n\t\t\t\t\t\t\tvar ix = x+dx;\n\t\t\t\t\t\t\tif(ix >= 0 && ix < width){\n\t\t\t\t\t\t\t\tvar iPixel = (iy*width + ix)*4;\n\t\t\t\t\t\t\t\tmaxR = Math.max(maxR,inputData[iPixel]);\n\t\t\t\t\t\t\t\tmaxG = Math.max(maxG,inputData[iPixel+1]);\n\t\t\t\t\t\t\t\tmaxB = Math.max(maxB,inputData[iPixel+2]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\toutputData[pixel] = maxR;\n\t\t\t\toutputData[pixel+1] = maxG;\n\t\t\t\toutputData[pixel+2] = maxB;\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}\n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Replaces every pixel with the median RGB value of the neighboring pixels. Each color is\n * considered separately.\n */\nfunction MedianFilter(){\n\tthis.name = \"Median\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar rList = [];\n\t\t\t\tvar gList = [];\n\t\t\t\tvar bList = [];\n\t\t\t\tfor (var dy = -1; dy <= 1; dy++){\n\t\t\t\t\tvar iy = y+dy;\n\t\t\t\t\tif(iy >= 0 && iy < height){\n\t\t\t\t\t\tfor (var dx = -1; dx <= 1; dx++){\n\t\t\t\t\t\t\tvar ix = x+dx;\n\t\t\t\t\t\t\tif(ix >= 0 && ix < width){\n\t\t\t\t\t\t\t\tvar iPixel = (iy*width + ix)*4;\n\t\t\t\t\t\t\t\trList.push(inputData[iPixel]);\n\t\t\t\t\t\t\t\tgList.push(inputData[iPixel+1]);\n\t\t\t\t\t\t\t\tbList.push(inputData[iPixel+2]);\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar sortFunc = function(a,b){\n\t\t\t\t\treturn a-b;\n\t\t\t\t};\n\t\t\t\trList.sort(sortFunc);\n\t\t\t\tgList.sort(sortFunc);\n\t\t\t\tbList.sort(sortFunc);\n\t\t\t\toutputData[pixel] = rList[4];\n\t\t\t\toutputData[pixel+1] = gList[4];\n\t\t\t\toutputData[pixel+2] = bList[4];\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}\n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Replaces every pixel with the minimum RGB value of the neighboring pixels. Each color is\n * considered separately.\n */\nfunction MinimumFilter(){\n\tthis.name = \"Minimum\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar minR = 255;\n\t\t\t\tvar minG = 255;\n\t\t\t\tvar minB = 255;\n\t\t\t\tfor (var dy = -1; dy <= 1; dy++){\n\t\t\t\t\tvar iy = y+dy;\n\t\t\t\t\tif(iy >= 0 && iy < height){\n\t\t\t\t\t\tfor (var dx = -1; dx <= 1; dx++){\n\t\t\t\t\t\t\tvar ix = x+dx;\n\t\t\t\t\t\t\tif(ix >= 0 && ix < width){\n\t\t\t\t\t\t\t\tvar iPixel = (iy*width + ix)*4;\n\t\t\t\t\t\t\t\tminR = Math.min(minR,inputData[iPixel]);\n\t\t\t\t\t\t\t\tminG = Math.min(minG,inputData[iPixel+1]);\n\t\t\t\t\t\t\t\tminB = Math.min(minB,inputData[iPixel+2]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\toutputData[pixel] = minR;\n\t\t\t\toutputData[pixel+1] = minG;\n\t\t\t\toutputData[pixel+2] = minB;\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}\n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Creates random noise on the image, with or without color.\n */\nfunction NoiseFilter(){\n\tthis.name = \"Noise\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 25,\n\t\tdensity : 1,\n\t\tmonochrome : true\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0, max:100},\n\t\tdensity : {min:0, max:1.0},\n\t\tmonochrome : {min:false, max:true}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tvar density = (values.density === undefined) ? this.defaultValues.density : values.density;\n\t\tvar monochrome = (values.monochrome === undefined) ? this.defaultValues.monochrome : values.monochrome;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tif(Math.random() <= density){\n\t\t\t\t\tvar n;\n\t\t\t\t\tif(monochrome){\n\t\t\t\t\t\tn = parseInt((2*Math.random()-1) * amount,10);\n\t\t\t\t\t\tinputData[pixel] += n;\n\t\t\t\t\t\tinputData[pixel+1] += n;\n\t\t\t\t\t\tinputData[pixel+2] += n;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor(var i = 0; i < 3; i++){\n\t\t\t\t\t\t\tn = parseInt((2*Math.random()-1) * amount,10);\n\t\t\t\t\t\t\tinputData[pixel+i] += n;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Produces an oil painting effect on the image.\n * NOTE: This filter can be very slow, especially at higher ranges. Use with caution.\n */\nfunction OilFilter(){\n\tthis.name = \"Oil Painting\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\trange : 3\n\t};\n\tthis.valueRanges = {\n\t\trange : {min:0, max:5}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar range = (values.range === undefined) ? this.defaultValues.range : values.range;\n\t\trange = parseInt(range,10);\n\t\tvar index = 0;\n\t\tvar rHistogram = [];\n\t\tvar gHistogram = [];\n\t\tvar bHistogram = [];\n\t\tvar rTotal = [];\n\t\tvar gTotal = [];\n\t\tvar bTotal = [];\n\t\tvar levels = 256;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tfor (var j = 0; j < levels; j++){\n\t\t\t\t\trHistogram[j] = gHistogram[j] = bHistogram[j] = rTotal[j] = gTotal[j] = bTotal[j] = 0;\n\t\t\t\t}\n\t\t\t\tfor (var row = -range; row <= range; row++) {\n\t\t\t\t\tvar iy = y+row;\n\t\t\t\t\tvar ioffset;\n\t\t\t\t\tif (0 <= iy && iy < height) {\n\t\t\t\t\t\tioffset = iy*width;\n\t\t\t\t\t\tfor (var col = -range; col <= range; col++) {\n\t\t\t\t\t\t\tvar ix = x+col;\n\t\t\t\t\t\t\tif (0 <= ix && ix < width) {\n\t\t\t\t\t\t\t\tvar ro = inputData[(ioffset+ix)*4];\n\t\t\t\t\t\t\t\tvar go = inputData[(ioffset+ix)*4+1];\n\t\t\t\t\t\t\t\tvar bo = inputData[(ioffset+ix)*4+2];\n\t\t\t\t\t\t\t\tvar ri = ro*levels/256;\n\t\t\t\t\t\t\t\tvar gi = go*levels/256;\n\t\t\t\t\t\t\t\tvar bi = bo*levels/256;\n\t\t\t\t\t\t\t\trTotal[ri] += ro;\n\t\t\t\t\t\t\t\tgTotal[gi] += go;\n\t\t\t\t\t\t\t\tbTotal[bi] += bo;\n\t\t\t\t\t\t\t\trHistogram[ri]++;\n\t\t\t\t\t\t\t\tgHistogram[gi]++;\n\t\t\t\t\t\t\t\tbHistogram[bi]++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar r = 0, g = 0, b = 0;\n\t\t\t\tfor (var i = 1; i < levels; i++) {\n\t\t\t\t\tif (rHistogram[i] > rHistogram[r]){\n\t\t\t\t\t\tr = i;\n\t\t\t\t\t}\n\t\t\t\t\tif (gHistogram[i] > gHistogram[g]){\n\t\t\t\t\t\tg = i;\n\t\t\t\t\t}\n\t\t\t\t\tif (bHistogram[i] > bHistogram[b]){\n\t\t\t\t\t\tb = i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tr = rTotal[r] / rHistogram[r];\n\t\t\t\tg = gTotal[g] / gHistogram[g];\n\t\t\t\tb = bTotal[b] / bHistogram[b];\n\t\t\t\toutputData[pixel] = r;\n\t\t\t\toutputData[pixel+1] = g;\n\t\t\t\toutputData[pixel+2] = b;\n\t\t\t\toutputData[pixel+3] = inputData[pixel+3];\n\t\t\t}\n\t\t}\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Changes the opacity of the image.\n */\nfunction OpacityFilter(){\n\tthis.name = \"Opacity\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 1.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0.0, max:1.0}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tinputData[pixel+3] = 255*amount;\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Pinches and whirls the image toward the center point. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction PinchFilter(){\n\tthis.name = \"Pinch/Whirl\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tamount : 0.5,\n\t\tradius : 100,\n\t\tangle : 0,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min: -1.0, max: 1.0},\n\t\tradius : {min: 1, max: 200},\n\t\tangle : {min: 0, max: 360},\n\t\tcenterX : {min: 0.0, max:1.0},\n\t\tcenterY : {min: 0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tvar angle = (values.angle === undefined) ? this.defaultValues.angle : values.angle;\n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX;\n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY;\n\t\tvar radius = (values.radius === undefined) ? this.defaultValues.radius : values.radius;\n\t\tvar radius2 = radius*radius;\n\t\tangle = angle/180 * Math.PI;\n\t\tvar iCenterX = width * centerX; var iCenterY = height * centerY;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar dx = x-iCenterX;\n\t\t\tvar dy = y-iCenterY;\n\t\t\tvar distance = dx*dx + dy*dy;\n\t\t\tif(distance > radius2 || distance === 0){\n\t\t\t\tout[0] = x;\n\t\t\t\tout[1] = y;\n\t\t\t} else {\n\t\t\t\tvar d = Math.sqrt( distance / radius2 );\n\t\t\t\tvar t = Math.pow( Math.sin( Math.PI*0.5 * d ), -amount);\n\t\t\t\tdx *= t;\n\t\t\t\tdy *= t;\n\t\t\t\tvar e = 1 - d;\n\t\t\t\tvar a = angle * e * e;\n\t\t\t\tvar s = Math.sin(a);\n\t\t\t\tvar c = Math.cos(a);\n\t\t\t\tout[0] = iCenterX + c*dx - s*dy;\n\t\t\t\tout[1] = iCenterY + s*dx + c*dy;\n\t\t\t}\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Pixelates the image i.e. divides the image into blocks of color.\n */\nfunction PixelationFilter(){\n\tthis.name = \"Pixelation\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tsize : 5\n\t};\n\tthis.valueRanges = {\n\t\tsize : {min:1, max:50}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar size = (values.size === undefined) ? this.defaultValues.size : values.size;\n\t\tsize = parseInt(size,10);\n\t\tvar pixels = [];\n\t\tvar by, bx, bPixel;\n\t\tfor (var y = 0; y < height; y+=size) {\n\t\t\tfor (var x = 0; x < width; x+=size) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar w = Math.min(size, width-x);\n\t\t\t\tvar h = Math.min(size, height-y);\n\t\t\t\tvar t = w*h;\n\t\t\t\tvar r = 0, g = 0, b = 0;\n\t\t\t\tfor(by = y; by < y+h; by++){\n\t\t\t\t\tfor(bx = x; bx < x+w; bx++){\n\t\t\t\t\t\tbPixel = (by*width + bx)*4;\n\t\t\t\t\t\tr += inputData[bPixel];\n\t\t\t\t\t\tg +=  inputData[bPixel+1];\n\t\t\t\t\t\tb += inputData[bPixel+2];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(by = y; by < y+h; by++){\n\t\t\t\t\tfor(bx = x; bx < x+w; bx++){\n\t\t\t\t\t\tbPixel = (by*width + bx)*4;\n\t\t\t\t\t\tinputData[bPixel] = r/t;\n\t\t\t\t\t\tinputData[bPixel+1] = g/t;\n\t\t\t\t\t\tinputData[bPixel+2] = b/t;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Posterizes the image, i.e. restricts the color values to a set amount of levels.\n */\nfunction PosterizeFilter(){\n\tthis.name = \"Posterize\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tlevels : 6\n\t};\n\tthis.valueRanges = {\n\t\tlevels : {min:2, max:30 }\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar levels = (values.levels === undefined) ? this.defaultValues.levels : parseInt(values.levels,10);\n\t\tif(levels <= 1){\n\t\t\treturn;\n\t\t}\n\t\tvar table = [];\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\ttable[i] = parseInt(255 * parseInt(i*levels/256,10) / (levels-1),10);\n\t\t}\n\t\tfilterUtils.tableFilter(inputData,table,width,height);\n\t};\n}\n/**\n * Adjust the factor of each RGB color value in the image.\n */\nfunction RGBAdjustFilter(){\n\tthis.name = \"RGBAdjust\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tred: 1.0,\n\t\tgreen: 1.0,\n\t\tblue: 1.0\n\t};\n\tthis.valueRanges = {\n\t\tred: {min: 0.0, max: 2.0},\n\t\tgreen: {min: 0.0, max: 2.0},\n\t\tblue: {min: 0.0, max: 2.0}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar red = (values.red === undefined) ? this.defaultValues.red : values.red;\n\t\tvar green = (values.green === undefined) ? this.defaultValues.green : values.green;\n\t\tvar blue = (values.blue === undefined) ? this.defaultValues.blue : values.blue;\n\t\tif(red < 0){ red = 0; }\n\t\tif(green < 0){ green = 0; }\n\t\tif(blue < 0){ blue = 0; }\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tinputData[pixel] *= red;\n\t\t\t\tinputData[pixel+1] *= green;\n\t\t\t\tinputData[pixel+2] *= blue;\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Adjusts the saturation value of the image. Values over 1 increase saturation while values below decrease saturation.\n * For a true grayscale effect, use the grayscale filter instead.\n */\nfunction SaturationFilter(){\n\tthis.name = \"Saturation\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 1.0\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0.0, max:2.0}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tvar RW = 0.3;\n\t\tvar RG = 0.59;\n\t\tvar RB = 0.11;\n\t\tvar a = (1 - amount) * RW + amount;\n\t\tvar b = (1 - amount) * RW;\n\t\tvar c = (1 - amount) * RW;\n\t\tvar d = (1 - amount) * RG;\n\t\tvar e = (1 - amount) * RG + amount;\n\t\tvar f = (1 - amount) * RG;\n\t\tvar g = (1 - amount) * RB;\n\t\tvar h = (1 - amount) * RB;\n\t\tvar i = (1 - amount) * RB + amount;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar pR = inputData[pixel];\n\t\t\t\tvar pG = inputData[pixel+1];\n\t\t\t\tvar pB = inputData[pixel+2];\n\t\t\t\tinputData[pixel]   = a*pR + d*pG + g*pB;\n\t\t\t\tinputData[pixel+1] = b*pR + e*pG + h*pB;\n\t\t\t\tinputData[pixel+2]  = c*pR + f*pG + i*pB;\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Creates ripples on the image horizontally/vertically in a sawtooth pattern.\n */\nfunction SawtoothRippleFilter(){\n\tthis.name = \"Sawtooth Ripples\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\txAmplitude : 5,\n\t\tyAmplitude : 5,\n\t\txWavelength : 16,\n\t\tyWavelength : 16\n\t};\n\tthis.valueRanges = {\n\t\txAmplitude : {min:0, max:30},\n\t\tyAmplitude : {min:0, max:30},\n\t\txWavelength : {min:1, max:50},\n\t\tyWavelength : {min:1, max:50}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar xAmplitude = (values.xAmplitude === undefined) ? this.defaultValues.xAmplitude : values.xAmplitude;\n\t\tvar yAmplitude = (values.yAmplitude === undefined) ? this.defaultValues.yAmplitude : values.yAmplitude;\n\t\tvar xWavelength = (values.xWavelength === undefined) ? this.defaultValues.xWavelength : values.xWavelength;\n\t\tvar yWavelength = (values.yWavelength === undefined) ? this.defaultValues.yWavelength : values.yWavelength;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar nx = y/xWavelength;\n\t\t\tvar ny = x/yWavelength;\n\t\t\tvar fx = filterUtils.mod(nx,1);\n\t\t\tvar fy = filterUtils.mod(ny,1);\n\t\t\tout[0] = x + xAmplitude * fx;\n\t\t\tout[1] = y + yAmplitude * fy;\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Creates a sepia effect on the image i.e. gives the image a yellow-brownish tone.\n */\nfunction SepiaFilter(){\n\tthis.name = \"Sepia\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tamount : 10\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0, max:30}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tamount *= 255/100;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar luma = inputData[pixel]*0.3 + inputData[pixel+1]*0.59 + inputData[pixel+2]*0.11;\n\t\t\t\tvar r,g,b;\n\t\t\t\tr = g = b = luma;\n\t\t\t\tr += 40;\n\t\t\t\tg += 20;\n\t\t\t\tb -= amount;\n\n\t\t\t\tinputData[pixel] = r;\n\t\t\t\tinputData[pixel+1] = g;\n\t\t\t\tinputData[pixel+2] = b;\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Sharpens the image slightly. For increased effect, apply the filter multiple times.\n */\nfunction SharpenFilter(){\n\tthis.name = \"Sharpen\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar matrix = [ 0.0,-0.2, 0.0,\n\t\t\t\t\t  -0.2, 1.8,-0.2,\n\t\t\t\t\t   0.0, -0.2, 0.0];\n\t\tfilterUtils.convolveFilter(inputData,matrix,width,height);\n\t};\n}\n/**\n * Creates ripples on the image horizontally/vertically in a sine pattern.\n */\nfunction SineRippleFilter(){\n\tthis.name = \"Sine Ripples\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\txAmplitude : 5,\n\t\tyAmplitude : 5,\n\t\txWavelength : 16,\n\t\tyWavelength : 16\n\t};\n\tthis.valueRanges = {\n\t\txAmplitude : {min:0, max:30},\n\t\tyAmplitude : {min:0, max:30},\n\t\txWavelength : {min:1, max:50},\n\t\tyWavelength : {min:1, max:50}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar xAmplitude = (values.xAmplitude === undefined) ? this.defaultValues.xAmplitude : values.xAmplitude;\n\t\tvar yAmplitude = (values.yAmplitude === undefined) ? this.defaultValues.yAmplitude : values.yAmplitude;\n\t\tvar xWavelength = (values.xWavelength === undefined) ? this.defaultValues.xWavelength : values.xWavelength;\n\t\tvar yWavelength = (values.yWavelength === undefined) ? this.defaultValues.yWavelength : values.yWavelength;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar nx = y/xWavelength;\n\t\t\tvar ny = x/yWavelength;\n\t\t\tvar fx = Math.sin(nx);\n\t\t\tvar fy = Math.sin(ny);\n\t\t\tout[0] = x + xAmplitude * fx;\n\t\t\tout[1] = y + yAmplitude * fy;\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Produces a solarization effect on the image.\n */\nfunction SolarizeFilter(){\n\tthis.name = \"Solarize\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t};\n\tthis.valueRanges = {\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar table = [];\n\t\tfor(var i = 0; i < 256; i++){\n\t\t\tvar val = (i/255 > 0.5) ? 2*(i/255-0.5) : 2*(0.5-i/255);\n\t\t\ttable[i] = parseInt(255 * val,10);\n\t\t}\n\t\tfilterUtils.tableFilter(inputData, table, width, height);\n\t};\n}\n/**\n * Generates a sparkle/sunburst effect on the image. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction SparkleFilter(){\n\tthis.name = \"Sparkle\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\trays : 50,\n\t\tsize : 25,\n\t\tamount : 50,\n\t\trandomness : 25,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\trays : {min:1, max:100},\n\t\tsize : {min:1, max:200},\n\t\tamount : {min:0, max:100},\n\t\trandomness : {min:0, max:50},\n\t\tcenterX : {min:0, max:1.0},\n\t\tcenterY : {min:0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar rays = (values.rays === undefined) ? this.defaultValues.rays : values.rays;\n\t\trays = parseInt(rays, 10);\n\t\tvar size = (values.size === undefined) ? this.defaultValues.size : values.size;\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tvar randomness = (values.randomness === undefined) ? this.defaultValues.randomness : values.randomness;\n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX;\n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY;\n\t\tvar iCenterX = centerX * width;\n\t\tvar iCenterY = centerY * height;\n\t\tvar rayLengths = [];\n\t\tfor(var j = 0; j < rays; j++){\n\t\t\trayLengths[j]= size + randomness / 100 * size * filterUtils.gaussianRandom();\n\t\t}\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar dx = x-iCenterX;\n\t\t\t\tvar dy = y-iCenterY;\n\t\t\t\tvar distance = dx*dx + dy*dy;\n\t\t\t\tvar angle = Math.atan2(dy,dx);\n\t\t\t\tvar d = (angle+Math.PI) / (Math.PI*2) * rays;\n\t\t\t\tvar i = parseInt(d,10);\n\t\t\t\tvar f = d - i;\n\t\t\t\tif(size !== 0){\n\t\t\t\t\tvar length = filterUtils.linearInterpolate(f, rayLengths[i % rays], rayLengths[(i+1) % rays]);\n\t\t\t\t\tvar g = length*length / (distance+0.0001);\n\t\t\t\t\tg = Math.pow(g, (100-amount) / 50);\n\t\t\t\t\tf -= 0.5;\n\t\t\t\t\tf = 1 - f*f;\n\t\t\t\t\tf *= g;\n\t\t\t\t}\n\t\t\t\tf = filterUtils.clampPixel(f,0,1);\n\t\t\t\tvar mixedRGB = filterUtils.mixColors(f,[inputData[pixel],inputData[pixel+1],inputData[pixel+2],inputData[pixel+3]],[255,255,255,255]);\n\t\t\t\tfor(var k = 0; k < 3; k++){\n\t\t\t\t\tinputData[pixel+k] = mixedRGB[k];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Smears out the image with square shapes to create a painting style effect.\n * The mix values sets the intensity of the effect.\n * NOTE: This filter can be very slow, especially at higher densities/sizes. Use with caution.\n */\nfunction SquareSmearFilter(){\n\tthis.name = \"Square Smear\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tsize : 4,\n\t\tdensity : 0.5,\n\t\tmix : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tsize : {min:1, max:10},\n\t\tdensity : {min:0.0, max:1.0},\n\t\tmix : {min:0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tvar k;\n\t\tfor(k = 0; k < inputData.length; k++){\n\t\t\toutputData[k] = inputData[k];\n\t\t}\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar size = (values.size === undefined) ? this.defaultValues.size : values.size;\n\t\tif(size < 1){ size = 1;}\n\t\tsize = parseInt(size,10);\n\t\tvar density = (values.density === undefined) ? this.defaultValues.density : values.density;\n\t\tvar mix = (values.mix === undefined) ? this.defaultValues.mix : values.mix;\n\t\tvar radius = size+1;\n\t\tvar radius2 = radius*radius;\n\t\tvar numShapes = parseInt(2*density/30*width*height / 2,10);\n\t\tfor(var i = 0; i < numShapes; i++){\n\t\t\tvar sx = (Math.random()*Math.pow(2,32) & 0x7fffffff) % width;\n\t\t\tvar sy = (Math.random()*Math.pow(2,32) & 0x7fffffff) % height;\n\t\t\tvar rgb2 = [inputData[(sy*width+sx)*4],inputData[(sy*width+sx)*4+1],inputData[(sy*width+sx)*4+2],inputData[(sy*width+sx)*4+3]];\n\t\t\tfor(var x = sx - radius; x < sx + radius + 1; x++){\n\n\t\t\t\tfor(var y = sy - radius; y < sy + radius + 1; y++){\n\t\t\t\t\tif (x >= 0 && x < width && y >= 0 && y < height) {\n\t\t\t\t\t\tvar rgb1 = [outputData[(y*width+x)*4],outputData[(y*width+x)*4+1],outputData[(y*width+x)*4+2],outputData[(y*width+x)*4+3]];\n\t\t\t\t\t\tvar mixedRGB = filterUtils.mixColors(mix,rgb1,rgb2);\n\t\t\t\t\t\tfor(k = 0; k < 3; k++){\n\t\t\t\t\t\t\toutputData[(y*width+x)*4+k] = mixedRGB[k];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Divides the colors into black and white following the treshold value. Brightnesses above the threshold\n * sets the color to white while values below the threshold sets the color to black.\n */\nfunction ThresholdFilter(){\n\tthis.name = \"Black & White\";\n\tthis.isDirAnimatable = true;\n\tthis.defaultValues = {\n\t\tthreshold : 127\n\t};\n\tthis.valueRanges = {\n\t\tthreshold : {min:0, max:255}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar threshold = (values.threshold === undefined) ? this.defaultValues.threshold : values.threshold;\n\t\tfor (var y = 0; y < height; y++) {\n\t\t\tfor (var x = 0; x < width; x++) {\n\t\t\t\tvar pixel = (y*width + x)*4;\n\t\t\t\tvar brightness = (inputData[pixel] + inputData[pixel+1] + inputData[pixel+2])/3;\n\t\t\t\tvar colorVal = 0;\n\t\t\t\tif(brightness > threshold){\n\t\t\t\t\tcolorVal = 255;\n\t\t\t\t}\n\t\t\t\tinputData[pixel] = inputData[pixel+1] = inputData[pixel+2] = colorVal;\n\t\t\t}\n\t\t}\n\t};\n}\n/**\n * Creates ripples on the image horizontally/vertically in a sine pattern.\n */\nfunction TriangleRippleFilter(){\n\tthis.name = \"Triangle Ripples\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\txAmplitude : 5,\n\t\tyAmplitude : 5,\n\t\txWavelength : 16,\n\t\tyWavelength : 16\n\t};\n\tthis.valueRanges = {\n\t\txAmplitude : {min:0, max:30},\n\t\tyAmplitude : {min:0, max:30},\n\t\txWavelength : {min:1, max:50},\n\t\tyWavelength : {min:1, max:50}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar xAmplitude = (values.xAmplitude === undefined) ? this.defaultValues.xAmplitude : values.xAmplitude;\n\t\tvar yAmplitude = (values.yAmplitude === undefined) ? this.defaultValues.yAmplitude : values.yAmplitude;\n\t\tvar xWavelength = (values.xWavelength === undefined) ? this.defaultValues.xWavelength : values.xWavelength;\n\t\tvar yWavelength = (values.yWavelength === undefined) ? this.defaultValues.yWavelength : values.yWavelength;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar nx = y/xWavelength;\n\t\t\tvar ny = x/yWavelength;\n\t\t\tvar fx = filterUtils.triangle(nx,1);\n\t\t\tvar fy = filterUtils.triangle(ny,1);\n\t\t\tout[0] = x + xAmplitude * fx;\n\t\t\tout[1] = y + yAmplitude * fy;\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Twists the image around a given center point. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction TwirlFilter(){\n\tthis.name = \"Twirl\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tradius : 100,\n\t\tangle : 180,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tradius : {min: 1, max: 200},\n\t\tangle : {min: 0, max: 360},\n\t\tcenterX : {min: 0.0, max:1.0},\n\t\tcenterY : {min: 0.0, max:1.0}\n\t};\n\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar angle = (values.angle === undefined) ? this.defaultValues.angle : values.angle;\n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX;\n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY;\n\t\tvar radius = (values.radius === undefined) ? this.defaultValues.radius : values.radius;\n\t\tvar radius2 = radius*radius;\n\t\tangle = angle/180 * Math.PI;\n\t\tvar iCenterX = width * centerX; var iCenterY = height * centerY;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar dx = x-iCenterX;\n\t\t\tvar dy = y-iCenterY;\n\t\t\tvar distance = dx*dx + dy*dy;\n\t\t\tif(distance > radius2){\n\t\t\t\tout[0] = x;\n\t\t\t\tout[1] = y;\n\t\t\t} else {\n\t\t\t\tdistance = Math.sqrt(distance);\n\t\t\t\tvar a = Math.atan2(dy, dx) + angle * (radius-distance) / radius;\n\t\t\t\tout[0] = iCenterX + distance*Math.cos(a);\n\t\t\t\tout[1] = iCenterY + distance*Math.sin(a);\n\t\t\t}\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * Creates a classical vignette effect on the image i.e. darkens the corners.\n */\nfunction VignetteFilter(){\n\tthis.name = \"Vignette\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tamount : 0.3\n\t};\n\tthis.valueRanges = {\n\t\tamount : {min:0.0, max:1.0}\n\t};\n\tthis.filter = function(input,values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tvar outputData = [];\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar amount = (values.amount === undefined) ? this.defaultValues.amount : values.amount;\n\t\tvar canvas = document.createElement(\"canvas\");\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\t\tvar context = canvas.getContext(\"2d\");\n\t\tvar gradient;\n\t\tvar radius = Math.sqrt( Math.pow(width/2, 2) + Math.pow(height/2, 2) );\n\t\tcontext.putImageData(input,0,0);\n\t\tcontext.globalCompositeOperation = 'source-over';\n\n\t\tgradient = context.createRadialGradient(width/2, height/2, 0, width/2, height/2, radius);\n\t\tgradient.addColorStop(0, 'rgba(0,0,0,0)');\n\t\tgradient.addColorStop(0.5, 'rgba(0,0,0,0)');\n\t\tgradient.addColorStop(1, 'rgba(0,0,0,' + amount + ')');\n\t\tcontext.fillStyle = gradient;\n\t\tcontext.fillRect(0, 0, width, height);\n\t\toutputData = context.getImageData(0,0,width,height).data;\n\t\tfor(var k = 0; k < outputData.length; k++){\n\t\t\tinputData[k] = outputData[k];\n\t\t}\n\t};\n}\n/**\n * Produces a water ripple/waves on the image. CenterX and CenterY specify the\n * position in terms of ratios of width and height.\n */\nfunction WaterRippleFilter(){\n\tthis.name = \"Water Ripples\";\n\tthis.isDirAnimatable = false;\n\tthis.defaultValues = {\n\t\tphase : 0,\n\t\tradius : 50,\n\t\twavelength : 16,\n\t\tamplitude : 10,\n\t\tcenterX : 0.5,\n\t\tcenterY : 0.5\n\t};\n\tthis.valueRanges = {\n\t\tphase : {min: 0, max: 100},\n\t\tradius : {min: 1, max: 200},\n\t\twavelength : {min: 1, max: 100},\n\t\tamplitude : {min: 1, max: 100},\n\t\tcenterX : {min: 0.0, max:1.0},\n\t\tcenterY : {min: 0.0, max:1.0}\n\t};\n\tvar filterUtils = new FilterUtils();\n\n\tthis.filter = function (input, values){\n\t\tvar width = input.width, height = input.height;\n\t\tvar inputData = input.data;\n\t\tif(values === undefined){ values = this.defaultValues; }\n\t\tvar wavelength = (values.wavelength === undefined) ? this.defaultValues.wavelength : values.wavelength;\n\t\tvar amplitude = (values.amplitude === undefined) ? this.defaultValues.amplitude : values.amplitude;\n\t\tvar phase = (values.phase === undefined) ? this.defaultValues.phase : values.phase;\n\t\tvar centerX = (values.centerX === undefined) ? this.defaultValues.centerX : values.centerX;\n\t\tvar centerY = (values.centerY === undefined) ? this.defaultValues.centerY : values.centerY;\n\t\tvar radius = (values.radius === undefined) ? this.defaultValues.radius : values.radius;\n\t\tvar radius2 = radius*radius;\n\t\tvar iCenterX = width * centerX; var iCenterY = height * centerY;\n\t\tvar transInverse = function(x,y,out){\n\t\t\tvar dx = x-iCenterX;\n\t\t\tvar dy = y-iCenterY;\n\t\t\tvar distance2 = dx*dx + dy*dy;\n\t\t\tif(distance2 > radius2){\n\t\t\t\tout[0] = x;\n\t\t\t\tout[1] = y;\n\t\t\t} else {\n\t\t\t\tvar distance = Math.sqrt(distance2);\n\t\t\t\tvar amount = amplitude * Math.sin(distance/wavelength * Math.PI * 2 - phase);\n\t\t\t\tamount *= (radius-distance)/radius;\n\t\t\t\tif(distance !== 0){\n\t\t\t\t\tamount *= wavelength/distance;\n\t\t\t\t}\n\t\t\t\tout[0] = x + dx*amount;\n\t\t\t\tout[1] = y + dy*amount;\n\t\t\t}\n\t\t};\n\t\tfilterUtils.transformFilter(inputData,transInverse,width,height);\n\t};\n}\n/**\n * A collection of all the filters.\n */\nvar JSManipulate = {\n\tblur : new BlurFilter(),\n\tbrightness : new BrightnessFilter(),\n\tbump : new BumpFilter(),\n\tcirclesmear : new CircleSmearFilter(),\n\tcontrast : new ContrastFilter(),\n\tcrosssmear : new CrossSmearFilter(),\n\tdiffusion : new DiffusionFilter(),\n\tdither : new DitherFilter(),\n\tedge : new EdgeFilter(),\n\temboss : new EmbossFilter(),\n\texposure : new ExposureFilter(),\n\tgain : new GainFilter(),\n\tgamma : new GammaFilter(),\n\tgrayscale : new GrayscaleFilter(),\n\thue : new HueFilter(),\n\tinvert : new InvertFilter(),\n\tkaleidoscope : new KaleidoscopeFilter(),\n\tlensdistortion : new LensDistortionFilter(),\n\tlinesmear : new LineSmearFilter(),\n\tmaximum : new MaximumFilter(),\n\tmedian : new MedianFilter(),\n\tminimum : new MinimumFilter(),\n\tnoise : new NoiseFilter(),\n\toil : new OilFilter(),\n\topacity : new OpacityFilter(),\n\tpinch : new PinchFilter(),\n\tpixelate : new PixelationFilter(),\n\tposterize : new PosterizeFilter(),\n\trgbadjust : new RGBAdjustFilter(),\n\tsaturation : new SaturationFilter(),\n\tsawtoothripple : new SawtoothRippleFilter(),\n\tsepia : new SepiaFilter(),\n\tsharpen : new SharpenFilter(),\n\tsineripple : new SineRippleFilter(),\n\tsolarize : new SolarizeFilter(),\n\tsparkle : new SparkleFilter(),\n\tsquaresmear : new SquareSmearFilter(),\n\tthreshold : new ThresholdFilter(),\n\ttriangleripple : new TriangleRippleFilter(),\n\ttwirl : new TwirlFilter(),\n\tvignette : new VignetteFilter(),\n\twaterripple : new WaterRippleFilter()\n};\n\n\n\nvar ImageFilters = JSManipulate;\n\n\n//Attach to Gamelab object\nGamelab.ImageFilters = ImageFilters;\n;/**\r\n * Creates Gamelab.js Canvas: The canvas-renderer for Gamelab games.\r\n\r\n @description\r\n This Canvas library handles the low-level drawing of Gamelab.Animation objects on HTML5Canvas.\r\n -Draws Sprites according to their rotation, size, and properties.\r\n * @returns {CanvasLib} a CanvasLib object.\r\n */\r\n\r\n(function() {\r\n\r\n  console.log('CanvasStack class... creating');\r\n\r\n  class GamelabCanvas {\r\n\r\n    constructor() {\r\n\r\n      this.__levelMaker = false;\r\n\r\n      //draw is synonymous w/ drawSprite\r\n      this.draw = this.draw_object;\r\n    }\r\n\r\n    isStopped() {\r\n\r\n      return Gamelab.stopDraw || false;\r\n\r\n    }\r\n\r\n    arc(p1, p2, options = {}) {\r\n\r\n      if (this.isStopped())\r\n        return;\r\n\r\n\r\n      var ctx = Gamelab.game_windows[0].ctx;\r\n\r\n      ctx.strokeStyle = 'aqua';\r\n\r\n      ctx.beginPath();\r\n      ctx.arc(p1.x, p1.y, p2.x, p2.y, Math.PI * 2, true);\r\n      ctx.stroke();\r\n\r\n    }\r\n\r\n    draw_image_frame(image, framePos, frameSize, position, size, rotation, canvasContext, flipX, flipY, origin, globalAlpha, globalComposite) {\r\n\r\n      if (this.isStopped())\r\n        return;\r\n\r\n\r\n      var fx = framePos.x,\r\n        fy = framePos.y,\r\n        fw = frameSize.x,\r\n        fh = frameSize.y,\r\n        x = position.x,\r\n        y = position.y,\r\n        width = size.x,\r\n        height = size.y;\r\n\r\n\r\n      //save canvas state before draw\r\n      canvasContext.save();\r\n\r\n      //degrees rotation:\r\n      var deg = Math.round(rotation);\r\n      deg = deg % 360;\r\n      var rad = deg * Math.PI / 180;\r\n      //Set the origin to the center of the image\r\n      canvasContext.translate(x, y);\r\n      canvasContext.rotate(rad);\r\n      //Rotate the canvas around the origin\r\n\r\n      canvasContext.translate(0, canvasContext.width);\r\n\r\n      if (flipX) {\r\n\r\n        canvasContext.scale(-1, 1);\r\n      } else {\r\n\r\n      }\r\n\r\n      if (flipY) {\r\n\r\n        canvasContext.scale(1, -1);\r\n      } else {\r\n\r\n      }\r\n\r\n      origin = origin || new Gamelab.Vector(width / 2, height / 2);\r\n\r\n      canvasContext.globalAlpha = globalAlpha || 1.0;\r\n\r\n      if(globalComposite)\r\n      {\r\n        canvasContext.globalCompositeOperation = globalComposite;\r\n      }\r\n\r\n      //draw the image\r\n      canvasContext.drawImage(image, fx, fy, fw, fh, origin.x * (-1), origin.y * (-1), width, height);\r\n      //reset the canvas\r\n\r\n      canvasContext.globalAlpha = 1.0\r\n\r\n      canvasContext.restore();\r\n\r\n    }\r\n\r\n    draw_data(x, y, w, h, data, ctx) {\r\n\r\n      if (this.isStopped())\r\n        return;\r\n\r\n\r\n      ctx.putImageData(data, x, y, 0, 0, w, h);\r\n\r\n    }\r\n  }\r\n\r\n\r\n  Gamelab.Canvas = new GamelabCanvas();\r\n\r\n  Gamelab.GamelabCanvas = GamelabCanvas;\r\n\r\n  class OffscreenCanvasRendering {\r\n    constructor(psuedoImage) {\r\n\r\n      I('StashToCanvas():');\r\n\r\n      this.htmlImage = psuedoImage.domElement || psuedoImage;\r\n\r\n      this.testCanvas = document.createElement(\"CANVAS\");\r\n\r\n      this.testCtx = this.testCanvas.getContext(\"2d\");\r\n\r\n      this.testCanvas.width = this.htmlImage.width;\r\n\r\n      this.testCanvas.height = this.htmlImage.height;\r\n\r\n      this.testCanvas.style.zIndex = '9999';\r\n\r\n      this.testCtx.drawImage(this.htmlImage, 0, 0);\r\n\r\n      return {\r\n        canvas: this.testCanvas,\r\n        ctx: this.testCtx\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  Gamelab.OffscreenCanvasRendering = OffscreenCanvasRendering;\r\n\r\n})();\r\n;if (typeof JSON.decycle !== 'function') {\r\n    JSON.decycle = function decycle(object) {\r\n        \"use strict\";\r\n\r\n        var objects = [],   // Keep a reference to each unique object or array\r\n            paths = [];     // Keep the path to each unique object or array\r\n\r\n        return (function derez(value, path) {\r\n\r\n\r\n            var i,          // The loop counter\r\n                name,       // Property name\r\n                nu;         // The new object or array\r\n\r\n            switch (typeof value) {\r\n            case 'object':\r\n\r\n                if (!value) {\r\n                    return null;\r\n                }\r\n\r\n\r\n                for (i = 0; i < objects.length; i += 1) {\r\n                    if (objects[i] === value) {\r\n                        return {$ref: paths[i]};\r\n                    }\r\n                }\r\n\r\n// Otherwise, accumulate the unique value and its path.\r\n\r\n                objects.push(value);\r\n                paths.push(path);\r\n\r\n// If it is an array, replicate the array.\r\n\r\n                if (Object.prototype.toString.apply(value) === '[object Array]') {\r\n                    nu = [];\r\n                    for (i = 0; i < value.length; i += 1) {\r\n                        nu[i] = derez(value[i], path + '[' + i + ']');\r\n                    }\r\n                } else {\r\n\r\n// If it is an object, replicate the object.\r\n\r\n                    nu = {};\r\n                    for (name in value) {\r\n                        if (Object.prototype.hasOwnProperty.call(value, name)) {\r\n                            nu[name] = derez(value[name],\r\n                                path + '[' + JSON.stringify(name) + ']');\r\n                        }\r\n                    }\r\n                }\r\n                return nu;\r\n            case 'number':\r\n            case 'string':\r\n            case 'boolean':\r\n                return value;\r\n            }\r\n        }(object, '$'));\r\n    };\r\n}\r\n\r\nif (typeof JSON.retrocycle !== 'function') {\r\n    JSON.retrocycle = function retrocycle($) {\r\n        \"use strict\";\r\n\r\n        var px =\r\n            /^\\$(?:\\[(?:\\d?|\\\"(?:[^\\\\\\\"\\u0000-\\u001f]|\\\\([\\\\\\\"\\/bfnrt]|u[0-9a-zA-Z]{4}))*\\\")\\])*$/;\r\n\r\n        (function rez(value) {\r\n\r\n            var i, item, name, path;\r\n\r\n            if (value && typeof value === 'object') {\r\n                if (Object.prototype.toString.apply(value) === '[object Array]') {\r\n                    for (i = 0; i < value.length; i += 1) {\r\n                        item = value[i];\r\n                        if (item && typeof item === 'object') {\r\n                            path = item.$ref;\r\n                            if (typeof path === 'string' && px.test(path)) {\r\n                                value[i] = eval(path);\r\n                            } else {\r\n                                rez(item);\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    for (name in value) {\r\n                        if (typeof value[name] === 'object') {\r\n                            item = value[name];\r\n                            if (item) {\r\n                                path = item.$ref;\r\n                                if (typeof path === 'string' && px.test(path)) {\r\n                                    value[name] = eval(path);\r\n                                } else {\r\n                                    rez(item);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }($));\r\n        return $;\r\n    };\r\n}\r\n\r\nvar json_stringify = JSON.stringify;\r\n\r\nJSON.stringify = function(object, arg2, arg3)\r\n{\r\n  var clean_object = JSON.decycle(object);\r\n  return json_stringify(clean_object, arg2, arg3);\r\n};\r\n\r\nvar json_parse = JSON.parse;\r\n\r\nJSON.parse = function(object, arg2, arg3){\r\n  var retro_object = JSON.retrocycle(object);\r\n  return json_parse(retro_object);\r\n};\r\n;/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\n\r\n/***************\r\n *\r\n * @ignore\r\n *\r\n * *****************/\r\n\r\nvar Stats = function () {\r\n\r\n\tvar mode = 0;\r\n\r\n\tvar container = document.createElement( 'div' );\r\n\tcontainer.style.cssText = 'position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000';\r\n\tcontainer.addEventListener( 'click', function ( event ) {\r\n\r\n\t\tevent.preventDefault();\r\n\t\tshowPanel( ++ mode % container.children.length );\r\n\r\n\t}, false );\r\n\r\n\t//\r\n\r\n\tfunction addPanel( panel ) {\r\n\r\n\t\tcontainer.appendChild( panel.dom );\r\n\t\treturn panel;\r\n\r\n\t}\r\n\r\n\tfunction showPanel( id ) {\r\n\r\n\t\tfor ( var i = 0; i < container.children.length; i ++ ) {\r\n\r\n\t\t\tcontainer.children[ i ].style.display = i === id ? 'block' : 'none';\r\n\r\n\t\t}\r\n\r\n\t\tmode = id;\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tvar beginTime = ( performance || Date ).now(), prevTime = beginTime, frames = 0;\r\n\r\n\tvar fpsPanel = addPanel( new Stats.Panel( 'FPS', '#0ff', '#002' ) );\r\n\tvar msPanel = addPanel( new Stats.Panel( 'MS', '#0f0', '#020' ) );\r\n\r\n\tif ( self.performance && self.performance.memory ) {\r\n\r\n\t\tvar memPanel = addPanel( new Stats.Panel( 'MB', '#f08', '#201' ) );\r\n\r\n\t}\r\n\r\n\tshowPanel( 0 );\r\n\r\n\treturn {\r\n\r\n\t\tREVISION: 16,\r\n\r\n\t\tdom: container,\r\n\r\n\t\taddPanel: addPanel,\r\n\t\tshowPanel: showPanel,\r\n\r\n\t\tbegin: function () {\r\n\r\n\t\t\tbeginTime = ( performance || Date ).now();\r\n\r\n\t\t},\r\n\r\n\t\tend: function () {\r\n\r\n\t\t\tframes ++;\r\n\r\n\t\t\tvar time = ( performance || Date ).now();\r\n\r\n\t\t\tmsPanel.update( time - beginTime, 200 );\r\n\r\n\t\t\tif ( time >= prevTime + 1000 ) {\r\n\r\n\t\t\t\tfpsPanel.update( ( frames * 1000 ) / ( time - prevTime ), 100 );\r\n\r\n\t\t\t\tprevTime = time;\r\n\t\t\t\tframes = 0;\r\n\r\n\t\t\t\tif ( memPanel ) {\r\n\r\n\t\t\t\t\tvar memory = performance.memory;\r\n\t\t\t\t\tmemPanel.update( memory.usedJSHeapSize / 1048576, memory.jsHeapSizeLimit / 1048576 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn time;\r\n\r\n\t\t},\r\n\r\n\t\tupdate: function () {\r\n\r\n\t\t\tbeginTime = this.end();\r\n\r\n\t\t},\r\n\r\n\t\t// Backwards Compatibility\r\n\r\n\t\tdomElement: container,\r\n\t\tsetMode: showPanel\r\n\r\n\t};\r\n\r\n};\r\n\r\nStats.Panel = function ( name, fg, bg ) {\r\n\r\n\tvar min = Infinity, max = 0, round = Math.round;\r\n\tvar PR = round( window.devicePixelRatio || 1 );\r\n\r\n\tvar WIDTH = 80 * PR, HEIGHT = 48 * PR,\r\n\t\t\tTEXT_X = 3 * PR, TEXT_Y = 2 * PR,\r\n\t\t\tGRAPH_X = 3 * PR, GRAPH_Y = 15 * PR,\r\n\t\t\tGRAPH_WIDTH = 74 * PR, GRAPH_HEIGHT = 30 * PR;\r\n\r\n\tvar canvas = document.createElement( 'canvas' );\r\n\tcanvas.width = WIDTH;\r\n\tcanvas.height = HEIGHT;\r\n\tcanvas.style.cssText = 'width:80px;height:48px';\r\n\r\n\tvar context = canvas.getContext( '2d' );\r\n\tcontext.font = 'bold ' + ( 9 * PR ) + 'px Helvetica,Arial,sans-serif';\r\n\tcontext.textBaseline = 'top';\r\n\r\n\tcontext.fillStyle = bg;\r\n\tcontext.fillRect( 0, 0, WIDTH, HEIGHT );\r\n\r\n\tcontext.fillStyle = fg;\r\n\tcontext.fillText( name, TEXT_X, TEXT_Y );\r\n\tcontext.fillRect( GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT );\r\n\r\n\tcontext.fillStyle = bg;\r\n\tcontext.globalAlpha = 0.9;\r\n\tcontext.fillRect( GRAPH_X, GRAPH_Y, GRAPH_WIDTH, GRAPH_HEIGHT );\r\n\r\n\treturn {\r\n\r\n\t\tdom: canvas,\r\n\r\n\t\tupdate: function ( value, maxValue ) {\r\n\r\n\t\t\tmin = Math.min( min, value );\r\n\t\t\tmax = Math.max( max, value );\r\n\r\n\t\t\tcontext.fillStyle = bg;\r\n\t\t\tcontext.globalAlpha = 1;\r\n\t\t\tcontext.fillRect( 0, 0, WIDTH, GRAPH_Y );\r\n\t\t\tcontext.fillStyle = fg;\r\n\t\t\tcontext.fillText( round( value ) + ' ' + name + ' (' + round( min ) + '-' + round( max ) + ')', TEXT_X, TEXT_Y );\r\n\r\n\t\t\tcontext.drawImage( canvas, GRAPH_X + PR, GRAPH_Y, GRAPH_WIDTH - PR, GRAPH_HEIGHT, GRAPH_X, GRAPH_Y, GRAPH_WIDTH - PR, GRAPH_HEIGHT );\r\n\r\n\t\t\tcontext.fillRect( GRAPH_X + GRAPH_WIDTH - PR, GRAPH_Y, PR, GRAPH_HEIGHT );\r\n\r\n\t\t\tcontext.fillStyle = bg;\r\n\t\t\tcontext.globalAlpha = 0.9;\r\n\t\t\tcontext.fillRect( GRAPH_X + GRAPH_WIDTH - PR, GRAPH_Y, PR, round( ( 1 - ( value / maxValue ) ) * GRAPH_HEIGHT ) );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n};\r\n;/**\r\n * Tween.js - Licensed under the MIT license\r\n * https://github.com/tweenjs/tween.js\r\n * ----------------------------------------------\r\n *\r\n * See https://github.com/tweenjs/tween.js/graphs/contributors for the full list of contributors.\r\n * Thank you all, you're awesome!\r\n */\r\n\r\n\r\n/*\r\n*\r\n* @ignore\r\n*\r\n* */\r\n\r\nvar TWEEN = TWEEN || (function () {\r\n\r\n\tvar _tweens = [];\r\n\r\n\treturn {\r\n\r\n\t\tgetAll: function () {\r\n\r\n\t\t\treturn _tweens;\r\n\r\n\t\t},\r\n\r\n\t\tremoveAll: function () {\r\n\r\n\t\t\t_tweens = [];\r\n\r\n\t\t},\r\n\r\n\t\tadd: function (tween) {\r\n\r\n\t\t\t_tweens.push(tween);\r\n\r\n\t\t},\r\n\r\n\t\tremove: function (tween) {\r\n\r\n\t\t\tvar i = _tweens.indexOf(tween);\r\n\r\n\t\t\tif (i !== -1) {\r\n\t\t\t\t_tweens.splice(i, 1);\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tupdate: function (time, preserve) {\r\n\r\n\t\t\tif (_tweens.length === 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar i = 0;\r\n\r\n\t\t\ttime = time !== undefined ? time : TWEEN.now();\r\n\r\n\t\t\twhile (i < _tweens.length) {\r\n\r\n\t\t\t\tif (_tweens[i].update(time) || preserve) {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_tweens.splice(i, 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\t};\r\n\r\n})();\r\n\r\n//removed polyfill\r\n\r\nTWEEN.now = Date.now;\r\n\r\nTWEEN.Tween = function (object) {\r\n\r\n\tvar _object = object;\r\n\tvar _valuesStart = {};\r\n\tvar _valuesEnd = {};\r\n\tvar _valuesStartRepeat = {};\r\n\tvar _duration = 1000;\r\n\tvar _repeat = 0;\r\n\tvar _repeatDelayTime;\r\n\tvar _yoyo = false;\r\n\tvar _isPlaying = false;\r\n\tvar _reversed = false;\r\n\tvar _delayTime = 0;\r\n\tvar _startTime = null;\r\n\tvar _easingFunction = TWEEN.Easing.Linear.None;\r\n\tvar _interpolationFunction = TWEEN.Interpolation.Linear;\r\n\tvar _chainedTweens = [];\r\n\tvar _onStartCallback = null;\r\n\tvar _onStartCallbackFired = false;\r\n\tvar _onUpdateCallback = null;\r\n\tvar _onCompleteCallback = null;\r\n\tvar _onStopCallback = null;\r\n\r\n\t// Set all starting values present on the target object\r\n\tfor (var field in object) {\r\n\t\t_valuesStart[field] = parseFloat(object[field], 10);\r\n\t}\r\n\r\n\tthis.to = function (properties, duration) {\r\n\r\n\t\tif (duration !== undefined) {\r\n\t\t\t_duration = duration;\r\n\t\t}\r\n\r\n\t\t_valuesEnd = properties;\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.start = function (time) {\r\n\r\n\t\tTWEEN.add(this);\r\n\r\n\t\t_isPlaying = true;\r\n\r\n\t\t_onStartCallbackFired = false;\r\n\r\n\t\t_startTime = time !== undefined ? time : TWEEN.now();\r\n\t\t_startTime += _delayTime;\r\n\r\n\t\tfor (var property in _valuesEnd) {\r\n\r\n\t\t\t// Check if an Array was provided as property value\r\n\t\t\tif (_valuesEnd[property] instanceof Array) {\r\n\r\n\t\t\t\tif (_valuesEnd[property].length === 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Create a local copy of the Array with the start value at the front\r\n\t\t\t\t_valuesEnd[property] = [_object[property]].concat(_valuesEnd[property]);\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// If `to()` specifies a property that doesn't exist in the source object,\r\n\t\t\t// we should not set that property in the object\r\n\t\t\tif (_object[property] === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t_valuesStart[property] = _object[property];\r\n\r\n\t\t\tif ((_valuesStart[property] instanceof Array) === false) {\r\n\t\t\t\t_valuesStart[property] *= 1.0; // Ensures we're using numbers, not strings\r\n\t\t\t}\r\n\r\n\t\t\t_valuesStartRepeat[property] = _valuesStart[property] || 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.stop = function () {\r\n\r\n\t\tif (!_isPlaying) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tTWEEN.remove(this);\r\n\t\t_isPlaying = false;\r\n\r\n\t\tif (_onStopCallback !== null) {\r\n\t\t\t_onStopCallback.call(_object, _object);\r\n\t\t}\r\n\r\n\t\tthis.stopChainedTweens();\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.end = function () {\r\n\r\n\t\tthis.update(_startTime + _duration);\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.stopChainedTweens = function () {\r\n\r\n\t\tfor (var i = 0, numChainedTweens = _chainedTweens.length; i < numChainedTweens; i++) {\r\n\t\t\t_chainedTweens[i].stop();\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.delay = function (amount) {\r\n\r\n\t\t_delayTime = amount;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.repeat = function (times) {\r\n\r\n\t\t_repeat = times;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.repeatDelay = function (amount) {\r\n\r\n\t\t_repeatDelayTime = amount;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.yoyo = function (yoyo) {\r\n\r\n\t\t_yoyo = yoyo;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\r\n\tthis.easing = function (easing) {\r\n\r\n\t\t_easingFunction = easing;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.interpolation = function (interpolation) {\r\n\r\n\t\t_interpolationFunction = interpolation;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.chain = function () {\r\n\r\n\t\t_chainedTweens = arguments;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.onStart = function (callback) {\r\n\r\n\t\t_onStartCallback = callback;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.onUpdate = function (callback) {\r\n\r\n\t\t_onUpdateCallback = callback;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.onComplete = function (callback) {\r\n\r\n\t\t_onCompleteCallback = callback;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.onStop = function (callback) {\r\n\r\n\t\t_onStopCallback = callback;\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tthis.update = function (time) {\r\n\r\n\t\tvar property;\r\n\t\tvar elapsed;\r\n\t\tvar value;\r\n\r\n\t\tif (time < _startTime) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (_onStartCallbackFired === false) {\r\n\r\n\t\t\tif (_onStartCallback !== null) {\r\n\t\t\t\t_onStartCallback.call(_object, _object);\r\n\t\t\t}\r\n\r\n\t\t\t_onStartCallbackFired = true;\r\n\t\t}\r\n\r\n\t\telapsed = (time - _startTime) / _duration;\r\n\t\telapsed = elapsed > 1 ? 1 : elapsed;\r\n\r\n\t\tvalue = _easingFunction(elapsed);\r\n\r\n\t\tfor (property in _valuesEnd) {\r\n\r\n\t\t\t// Don't update properties that do not exist in the source object\r\n\t\t\tif (_valuesStart[property] === undefined) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar start = _valuesStart[property] || 0;\r\n\t\t\tvar end = _valuesEnd[property];\r\n\r\n\t\t\tif (end instanceof Array) {\r\n\r\n\t\t\t\t_object[property] = _interpolationFunction(end, value);\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Parses relative end values with start as base (e.g.: +10, -3)\r\n\t\t\t\tif (typeof (end) === 'string') {\r\n\r\n\t\t\t\t\tif (end.charAt(0) === '+' || end.charAt(0) === '-') {\r\n\t\t\t\t\t\tend = start + parseFloat(end, 10);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tend = parseFloat(end, 10);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Protect against non numeric properties.\r\n\t\t\t\tif (typeof (end) === 'number') {\r\n\t\t\t\t\t_object[property] = start + (end - start) * value;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (_onUpdateCallback !== null) {\r\n\t\t\t_onUpdateCallback.call(_object, value);\r\n\t\t}\r\n\r\n\t\tif (elapsed === 1) {\r\n\r\n\t\t\tif (_repeat > 0) {\r\n\r\n\t\t\t\tif (isFinite(_repeat)) {\r\n\t\t\t\t\t_repeat--;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Reassign starting values, restart by making startTime = now\r\n\t\t\t\tfor (property in _valuesStartRepeat) {\r\n\r\n\t\t\t\t\tif (typeof (_valuesEnd[property]) === 'string') {\r\n\t\t\t\t\t\t_valuesStartRepeat[property] = _valuesStartRepeat[property] + parseFloat(_valuesEnd[property], 10);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (_yoyo) {\r\n\t\t\t\t\t\tvar tmp = _valuesStartRepeat[property];\r\n\r\n\t\t\t\t\t\t_valuesStartRepeat[property] = _valuesEnd[property];\r\n\t\t\t\t\t\t_valuesEnd[property] = tmp;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t_valuesStart[property] = _valuesStartRepeat[property];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (_yoyo) {\r\n\t\t\t\t\t_reversed = !_reversed;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (_repeatDelayTime !== undefined) {\r\n\t\t\t\t\t_startTime = time + _repeatDelayTime;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_startTime = time + _delayTime;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif (_onCompleteCallback !== null) {\r\n\r\n\t\t\t\t\t_onCompleteCallback.call(_object, _object);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var i = 0, numChainedTweens = _chainedTweens.length; i < numChainedTweens; i++) {\r\n\t\t\t\t\t// Make the chained tweens start exactly at the time they should,\r\n\t\t\t\t\t// even if the `update()` method was called way past the duration of the tween\r\n\t\t\t\t\t_chainedTweens[i].start(_startTime + _duration);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t};\r\n\r\n};\r\n\r\n\r\nTWEEN.Easing = {\r\n\r\n\tLinear: {\r\n\r\n\t\tNone: function (k) {\r\n\r\n\t\t\treturn k;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tQuadratic: {\r\n\r\n\t\tIn: function (k) {\r\n\r\n\t\t\treturn k * k;\r\n\r\n\t\t},\r\n\r\n\t\tOut: function (k) {\r\n\r\n\t\t\treturn k * (2 - k);\r\n\r\n\t\t},\r\n\r\n\t\tInOut: function (k) {\r\n\r\n\t\t\tif ((k *= 2) < 1) {\r\n\t\t\t\treturn 0.5 * k * k;\r\n\t\t\t}\r\n\r\n\t\t\treturn - 0.5 * (--k * (k - 2) - 1);\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tCubic: {\r\n\r\n\t\tIn: function (k) {\r\n\r\n\t\t\treturn k * k * k;\r\n\r\n\t\t},\r\n\r\n\t\tOut: function (k) {\r\n\r\n\t\t\treturn --k * k * k + 1;\r\n\r\n\t\t},\r\n\r\n\t\tInOut: function (k) {\r\n\r\n\t\t\tif ((k *= 2) < 1) {\r\n\t\t\t\treturn 0.5 * k * k * k;\r\n\t\t\t}\r\n\r\n\t\t\treturn 0.5 * ((k -= 2) * k * k + 2);\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tQuartic: {\r\n\r\n\t\tIn: function (k) {\r\n\r\n\t\t\treturn k * k * k * k;\r\n\r\n\t\t},\r\n\r\n\t\tOut: function (k) {\r\n\r\n\t\t\treturn 1 - (--k * k * k * k);\r\n\r\n\t\t},\r\n\r\n\t\tInOut: function (k) {\r\n\r\n\t\t\tif ((k *= 2) < 1) {\r\n\t\t\t\treturn 0.5 * k * k * k * k;\r\n\t\t\t}\r\n\r\n\t\t\treturn - 0.5 * ((k -= 2) * k * k * k - 2);\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tQuintic: {\r\n\r\n\t\tIn: function (k) {\r\n\r\n\t\t\treturn k * k * k * k * k;\r\n\r\n\t\t},\r\n\r\n\t\tOut: function (k) {\r\n\r\n\t\t\treturn --k * k * k * k * k + 1;\r\n\r\n\t\t},\r\n\r\n\t\tInOut: function (k) {\r\n\r\n\t\t\tif ((k *= 2) < 1) {\r\n\t\t\t\treturn 0.5 * k * k * k * k * k;\r\n\t\t\t}\r\n\r\n\t\t\treturn 0.5 * ((k -= 2) * k * k * k * k + 2);\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tSinusoidal: {\r\n\r\n\t\tIn: function (k) {\r\n\r\n\t\t\treturn 1 - Math.cos(k * Math.PI / 2);\r\n\r\n\t\t},\r\n\r\n\t\tOut: function (k) {\r\n\r\n\t\t\treturn Math.sin(k * Math.PI / 2);\r\n\r\n\t\t},\r\n\r\n\t\tInOut: function (k) {\r\n\r\n\t\t\treturn 0.5 * (1 - Math.cos(Math.PI * k));\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tExponential: {\r\n\r\n\t\tIn: function (k) {\r\n\r\n\t\t\treturn k === 0 ? 0 : Math.pow(1024, k - 1);\r\n\r\n\t\t},\r\n\r\n\t\tOut: function (k) {\r\n\r\n\t\t\treturn k === 1 ? 1 : 1 - Math.pow(2, - 10 * k);\r\n\r\n\t\t},\r\n\r\n\t\tInOut: function (k) {\r\n\r\n\t\t\tif (k === 0) {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (k === 1) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\r\n\t\t\tif ((k *= 2) < 1) {\r\n\t\t\t\treturn 0.5 * Math.pow(1024, k - 1);\r\n\t\t\t}\r\n\r\n\t\t\treturn 0.5 * (- Math.pow(2, - 10 * (k - 1)) + 2);\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tCircular: {\r\n\r\n\t\tIn: function (k) {\r\n\r\n\t\t\treturn 1 - Math.sqrt(1 - k * k);\r\n\r\n\t\t},\r\n\r\n\t\tOut: function (k) {\r\n\r\n\t\t\treturn Math.sqrt(1 - (--k * k));\r\n\r\n\t\t},\r\n\r\n\t\tInOut: function (k) {\r\n\r\n\t\t\tif ((k *= 2) < 1) {\r\n\t\t\t\treturn - 0.5 * (Math.sqrt(1 - k * k) - 1);\r\n\t\t\t}\r\n\r\n\t\t\treturn 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tElastic: {\r\n\r\n\t\tIn: function (k) {\r\n\r\n\t\t\tif (k === 0) {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (k === 1) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\r\n\t\t\treturn -Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\r\n\r\n\t\t},\r\n\r\n\t\tOut: function (k) {\r\n\r\n\t\t\tif (k === 0) {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (k === 1) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\r\n\t\t\treturn Math.pow(2, -10 * k) * Math.sin((k - 0.1) * 5 * Math.PI) + 1;\r\n\r\n\t\t},\r\n\r\n\t\tInOut: function (k) {\r\n\r\n\t\t\tif (k === 0) {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (k === 1) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\r\n\t\t\tk *= 2;\r\n\r\n\t\t\tif (k < 1) {\r\n\t\t\t\treturn -0.5 * Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\r\n\t\t\t}\r\n\r\n\t\t\treturn 0.5 * Math.pow(2, -10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI) + 1;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tBack: {\r\n\r\n\t\tIn: function (k) {\r\n\r\n\t\t\tvar s = 1.70158;\r\n\r\n\t\t\treturn k * k * ((s + 1) * k - s);\r\n\r\n\t\t},\r\n\r\n\t\tOut: function (k) {\r\n\r\n\t\t\tvar s = 1.70158;\r\n\r\n\t\t\treturn --k * k * ((s + 1) * k + s) + 1;\r\n\r\n\t\t},\r\n\r\n\t\tInOut: function (k) {\r\n\r\n\t\t\tvar s = 1.70158 * 1.525;\r\n\r\n\t\t\tif ((k *= 2) < 1) {\r\n\t\t\t\treturn 0.5 * (k * k * ((s + 1) * k - s));\r\n\t\t\t}\r\n\r\n\t\t\treturn 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tBounce: {\r\n\r\n\t\tIn: function (k) {\r\n\r\n\t\t\treturn 1 - TWEEN.Easing.Bounce.Out(1 - k);\r\n\r\n\t\t},\r\n\r\n\t\tOut: function (k) {\r\n\r\n\t\t\tif (k < (1 / 2.75)) {\r\n\t\t\t\treturn 7.5625 * k * k;\r\n\t\t\t} else if (k < (2 / 2.75)) {\r\n\t\t\t\treturn 7.5625 * (k -= (1.5 / 2.75)) * k + 0.75;\r\n\t\t\t} else if (k < (2.5 / 2.75)) {\r\n\t\t\t\treturn 7.5625 * (k -= (2.25 / 2.75)) * k + 0.9375;\r\n\t\t\t} else {\r\n\t\t\t\treturn 7.5625 * (k -= (2.625 / 2.75)) * k + 0.984375;\r\n\t\t\t}\r\n\r\n\t\t},\r\n\r\n\t\tInOut: function (k) {\r\n\r\n\t\t\tif (k < 0.5) {\r\n\t\t\t\treturn TWEEN.Easing.Bounce.In(k * 2) * 0.5;\r\n\t\t\t}\r\n\r\n\t\t\treturn TWEEN.Easing.Bounce.Out(k * 2 - 1) * 0.5 + 0.5;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nTWEEN.Interpolation = {\r\n\r\n\tLinear: function (v, k) {\r\n\r\n\t\tvar m = v.length - 1;\r\n\t\tvar f = m * k;\r\n\t\tvar i = Math.floor(f);\r\n\t\tvar fn = TWEEN.Interpolation.Utils.Linear;\r\n\r\n\t\tif (k < 0) {\r\n\t\t\treturn fn(v[0], v[1], f);\r\n\t\t}\r\n\r\n\t\tif (k > 1) {\r\n\t\t\treturn fn(v[m], v[m - 1], m - f);\r\n\t\t}\r\n\r\n\t\treturn fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\r\n\r\n\t},\r\n\r\n\tBezier: function (v, k) {\r\n\r\n\t\tvar b = 0;\r\n\t\tvar n = v.length - 1;\r\n\t\tvar pw = Math.pow;\r\n\t\tvar bn = TWEEN.Interpolation.Utils.Bernstein;\r\n\r\n\t\tfor (var i = 0; i <= n; i++) {\r\n\t\t\tb += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\r\n\t\t}\r\n\r\n\t\treturn b;\r\n\r\n\t},\r\n\r\n\tCatmullRom: function (v, k) {\r\n\r\n\t\tvar m = v.length - 1;\r\n\t\tvar f = m * k;\r\n\t\tvar i = Math.floor(f);\r\n\t\tvar fn = TWEEN.Interpolation.Utils.CatmullRom;\r\n\r\n\t\tif (v[0] === v[m]) {\r\n\r\n\t\t\tif (k < 0) {\r\n\t\t\t\ti = Math.floor(f = m * (1 + k));\r\n\t\t\t}\r\n\r\n\t\t\treturn fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif (k < 0) {\r\n\t\t\t\treturn v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif (k > 1) {\r\n\t\t\t\treturn v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\r\n\t\t\t}\r\n\r\n\t\t\treturn fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tUtils: {\r\n\r\n\t\tLinear: function (p0, p1, t) {\r\n\r\n\t\t\treturn (p1 - p0) * t + p0;\r\n\r\n\t\t},\r\n\r\n\t\tBernstein: function (n, i) {\r\n\r\n\t\t\tvar fc = TWEEN.Interpolation.Utils.Factorial;\r\n\r\n\t\t\treturn fc(n) / fc(i) / fc(n - i);\r\n\r\n\t\t},\r\n\r\n\t\tFactorial: (function () {\r\n\r\n\t\t\tvar a = [1];\r\n\r\n\t\t\treturn function (n) {\r\n\r\n\t\t\t\tvar s = 1;\r\n\r\n\t\t\t\tif (a[n]) {\r\n\t\t\t\t\treturn a[n];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var i = n; i > 1; i--) {\r\n\t\t\t\t\ts *= i;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ta[n] = s;\r\n\t\t\t\treturn s;\r\n\r\n\t\t\t};\r\n\r\n\t\t})(),\r\n\r\n\t\tCatmullRom: function (p0, p1, p2, p3, t) {\r\n\r\n\t\t\tvar v0 = (p2 - p0) * 0.5;\r\n\t\t\tvar v1 = (p3 - p1) * 0.5;\r\n\t\t\tvar t2 = t * t;\r\n\t\t\tvar t3 = t * t2;\r\n\r\n\t\t\treturn (2 * p1 - 2 * p2 + v0 + v1) * t3 + (- 3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\n\r\n\r\n\r\n//Attach to the global Gamelab object\r\n\r\n/***************\r\n *\r\n * @memberOf Gamelab\r\n *\r\n * *****************/\r\n\r\nGamelab.TWEEN = TWEEN;\r\n\r\n\r\n/*\r\n\r\n// UMD (Universal Module Definition)\r\n(function (root) {\r\n\r\n    if (typeof define === 'function' && define.amd) {\r\n\r\n        // AMD\r\n        define([], function () {\r\n            return TWEEN;\r\n        });\r\n\r\n    } else if (typeof module !== 'undefined' && typeof exports === 'object') {\r\n\r\n        // Node.js\r\n        module.exports = TWEEN;\r\n\r\n    } else if (root !== undefined) {\r\n\r\n        // Global variable\r\n        root.TWEEN = TWEEN;\r\n\r\n    }\r\n\r\n})(this);\r\n\r\n*/\r\n;\n//Call Gamelab.FeatureInject::\n\nGamelab.FeatureInject();\n\n\n// UMD (Universal Module Definition)\n(function (root) {\n\n    if (typeof define === 'function' && define.amd) {\n\n        // AMD\n        define([], function () {\n            return Gamelab;\n        });\n\n    } else if (typeof module !== 'undefined' && typeof exports === 'object') {\n\n        // Node.js\n        module.exports = Gamelab;\n\n    } else if (root !== undefined) {\n\n        // Global variable\n        root.Gamelab = Gamelab;\n\n    }\n\n})(this);\n"]}