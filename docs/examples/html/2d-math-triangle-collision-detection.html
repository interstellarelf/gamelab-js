<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Triangle Sprite-Collision Detection</title>
    <script src="../dist/gamelab/gamelab.js"></script>
    <script src="./js/stats/gl-example-stats.js"></script>
    <script src="./js/libs/dat.gui.js"></script>
    <script src="./js/sprites/MouseActionSprite.js"></script>
    <!-- spritebox-example.css style -->
    <link rel="stylesheet" href="./styles/example.css">

    <style>

      button#rotate {
        position: absolute;
        bottom: 11px;
        left: 20px;
        width: 140px;
        height: 32px;
        padding: 5px;
        font-size: 14px;
      }

    </style>

  </head>

  <body>
    <header>
      <img src="./images/lib/gamelab-logo.png" alt="" id="logo">
      <span class="title">Triangle Sprite-Collision Detection</span>
    </header>

    <button id="rotate" class="mode rotate">Rotate +15 degrees</button>

    <script>

      let gameWindow = new Gamelab.GameWindow().Background('black');

      let sprite = new Gamelab.Sprite('./res/images/weapons/sabre.png');

      let mouse = {position:new Gamelab.Vector(0, 0)};

      let pointSprites = [];

      for (let x = 0; x < 6; x++) {
        pointSprites.push(new Gamelab.Sprite('./res/images/point.png'));
        pointSprites[pointSprites.length - 1].onLoad(function() {

          this.origin = this.size.div(2);
        });
        gameWindow.add(pointSprites[pointSprites.length - 1]);
      }

      sprite.position.x = 300;
      sprite.position.y = 60;

      new MouseActionSprite(sprite);

      gameWindow.add(sprite);

      gameWindow.canvas.addEventListener('mousemove', function(evt){
        console.info('hover::', evt);
        let rect = gameWindow.canvas.getBoundingClientRect(),
        position = {
             x: evt.clientX - rect.left,
             y: evt.clientY - rect.top
           };
           mouse.position = position;
      });

      Gamelab.ready(function() {

        gameWindow.start();

        document.querySelector('button#rotate').onclick = function() {
          sprite.rotation.x += 15;
        };

        sprite.onClick(gameWindow, function() {

        });

        sprite.onHoverUpdate(gameWindow, function(isHovered) {
          sprite.hovered = isHovered || false;
        });

        gameWindow.onBeforeDraw(function() {

          sprite.origin = sprite.size.div(2);

          //this call will set sprite.collisionPoints
          if(sprite.isHovered(mouse, gameWindow))
          {

          }


          if (sprite.collisionPoints) {
            console.log('has collisionPoints');
            pointSprites[0].position = sprite.collisionPoints[0][0].sub(pointSprites[0].size.div(2));
            pointSprites[1].position = sprite.collisionPoints[0][1].sub(pointSprites[0].size.div(2));
            pointSprites[2].position = sprite.collisionPoints[0][2].sub(pointSprites[0].size.div(2));

            pointSprites[3].position = sprite.collisionPoints[1][0].sub(pointSprites[0].size.div(2));
            pointSprites[4].position = sprite.collisionPoints[1][1].sub(pointSprites[0].size.div(2));
            pointSprites[5].position = sprite.collisionPoints[1][2].sub(pointSprites[0].size.div(2));
          }

          pointSprites.forEach((item) => {
            if (sprite.hovered) {
              item.active = true;
            } else {
              item.active = false;
            }
          });

        });

      });

    </script>

  </body>

</html>
